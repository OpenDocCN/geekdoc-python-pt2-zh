<html><head></head><body>
<h2 class="h2" id="ch09"><span epub:type="pagebreak" id="page_233"/><span class="big">9</span><br/>BUILDING A CIRCLE FROM THREE POINTS</h2>&#13;
<div class="image1"><img src="../images/common01.jpg" alt="Image"/></div>&#13;
<p class="noindent">In this chapter, we’ll build an entire command line program to solve a well-known problem: finding a circle passing through three given points. You may have solved this problem graphically in high school using a ruler and compass; you may have even solved it numerically. This time, we’ll be using the computer to solve it for us and produce an SVG image with the result. We already implemented the algorithm in <a href="ch06.xhtml#ch06">Chapter 6</a>; in this chapter, we’ll use the algorithm inside an application.</p>&#13;
<p class="indent">It’s a simple problem, but it is good for understanding how to code a complete application. We’ll read the three input points from a file using regular expressions, which we’ll learn about later in the chapter. We’ll also read in a configuration file with the values for the colors and sizes for the program’s output.</p>&#13;
<p class="indent">Then we’ll build the <em>model</em>: a group of objects that implement what we call the <em>domain logic</em> of our application, that is, the knowledge needed to solve the problem. In this case, the model consists of three points and the factory function that creates a circle passing through the three of them. <span epub:type="pagebreak" id="page_234"/>Thanks to our previous work in <a href="ch06.xhtml#ch06">Chapter 6</a>, this shouldn’t be complicated. We’ll present the results graphically, with a vector image showing the input points and resulting circle.</p>&#13;
<p class="indent">This is our first complete command line program, and it has all the ingredients of an engineering application: reading from an input file, solving a problem, and outputting a result diagram. After building this program, you should feel empowered to build your own. The possibilities are endless!</p>&#13;
<h3 class="h3" id="ch00lev1sec55"><strong>Application Architecture</strong></h3>&#13;
<p class="noindent">Most of the command line applications we’ll build together in this book, and probably many others you may build on your own, will use a similar architecture. The concept of <em>software architecture</em> refers to the organization and design of the components that make up a software application. <em>Architecture</em> deals with both the design of each individual piece of the program and the system of communication and interaction between each piece.</p>&#13;
<p class="indent">To decide what components should make up the architecture of our application, let’s think about what our program has to do. Our application will generally consist of three big phases, each performed by a different set of components or architectural building blocks:</p>&#13;
<div class="bqparan">&#13;
<p class="noindentin"><strong>Input parsing</strong> We read the problem definition data from a file passed to our program. This phase may also include reading an external configuration file to tweak the program’s behavior or outputs.</p>&#13;
<p class="noindentin"><strong>Problem resolution</strong> Using the model we parse from the input definition data, we find a solution to the problem.</p>&#13;
<p class="noindentin"><strong>Output generation</strong> We present the solution to the user. Depending on what kind of report we need, we may choose to produce diagrams, text files with data, simulations, or a combination of them. As important as solving the problem is, producing an output that is easy to understand and contains all the relevant pieces of information is crucial for our program to be of any use.</p>&#13;
</div>&#13;
<p class="indent">Since our problem for this chapter is fairly simple, we’ll divide the three phases into three files: <em>input.py</em>, <em>main.py</em>, and <em>output.py</em>. <a href="ch09.xhtml#ch9fig1">Figure 9-1</a> shows the main architectural blocks of our application graphically.</p>&#13;
<div class="image"><img src="../images/09fig01.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch9fig1"><em>Figure 9-1: The application architecture diagram</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_235"/>The input file will contain the three points and should have the following format,</p>&#13;
<pre>x y&#13;
x y&#13;
x y</pre>&#13;
<p class="noindent">where <span class="literal">x</span> and <span class="literal">y</span> are the coordinates of a point, separated by a space and each on a different line. An example input file could look like this:</p>&#13;
<pre>300 300&#13;
700 400&#13;
300 500</pre>&#13;
<p class="noindent">This file defines three points: <em>A</em>(300, 300), <em>B</em>(700, 400), and <em>C</em>(300, 500). We’ll put a specification for the values of the coordinates and say they need to be positive integers. This simplifies the parsing logic a bit as there won’t be decimal separators or minus signs in the numbers, which is good to get us started with regular expressions, but don’t worry: we’ll learn to identify floating-point numbers and minus signs in <a href="ch12.xhtml#ch12">Chapter 12</a>.</p>&#13;
<p class="indent">Using plaintext files as the input to our programs has a big advantage: we can write them by hand. Also, we can easily inspect and edit them. The downside is that plaintext files usually take up more space than their binary counterparts, but that won’t be an issue for us. We’ll go with ease of creation and manipulation over file size. Just remember, whenever you’re working with plaintext files, always use a plaintext editor and never a rich-text editor. Rich-text editors (such as Word) have their own storage format that includes much more than you actually write to them, such as information about what goes in bold, what font face is used, or what size the font is. We need our input files to have in them only what we’ve written.</p>&#13;
<h3 class="h3" id="ch00lev1sec56"><strong>Setup</strong></h3>&#13;
<p class="noindent">Since we’ll be creating other applications throughout the book, let’s create a new package at the top level of our Python project (the same level as the <em>geom2d</em>, <em>graphic</em>, and <em>utils</em> packages). Right-click the <em>Mechanics</em> folder, and from the menu choose <strong>New</strong> ▸ <strong>Python Package</strong>, name it <em>apps</em>, and click <strong>OK</strong>.</p>&#13;
<p class="indent">In <em>apps</em>, create a new package, this time named <em>circle_from_points</em>.</p>&#13;
<p class="indent">Your project’s directory structure should look similar to the following:</p>&#13;
<p class="pre2">    Mechanics<br/>      |- apps<br/>      |    |- circle_from_points<br/>      |- geom2d<br/>      |    |- tests<br/>      |- graphic<br/>      |    |- svg</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_236"/>Let’s create our main file. This is the file we’ll execute from the command line to run the application. Create a file named <em>main.py</em> in <em>circle_from _points</em>. Enter the code in <a href="ch09.xhtml#ch9lis1">Listing 9-1</a>.</p>&#13;
<pre>if __name__ == '__main__':&#13;
   print('This is working')</pre>&#13;
<p class="caption"><a id="ch9lis1"/><em>Listing 9-1: Main file</em></p>&#13;
<p class="indent">If you recall from <a href="ch01.xhtml#ch01">Chapter 1</a> (in the “Running Files” section), we’re using the “if name is main” pattern to execute our main application script. We want to run this code only if we detect the file is being run by itself, and not when it’s imported by some other file. For now we’ll only print a message to the shell to make sure our setup works.</p>&#13;
<pre>$ <span class="codestrong1">python3 apps/circle_from_points/main.py</span></pre>&#13;
<p class="indent">This should print to the shell:</p>&#13;
<p class="pre2">    This is working</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>This time, our main file doesn’t define any function that could be imported and used by other files. But thanks to the “if name is main” pattern, if this file was imported (presumably by mistake), nothing would be exported, and no code would be run either. All of our “runnable” scripts will use this pattern.</em></p>&#13;
</div>&#13;
<p class="indent">We’ll need a file containing the definition of three points to test our progress. Create a new file inside <em>circle_from_points</em> named <em>test.txt</em>. In it, enter the following coordinates:</p>&#13;
<pre>300 300&#13;
700 400&#13;
300 500</pre>&#13;
<p class="indent">Next, we’ll need to configure our IDE so we can test our application locally inside it.</p>&#13;
<h4 class="h4" id="ch00lev2sec106"><strong><em>Creating a Run Configuration</em></strong></h4>&#13;
<p class="noindent">To test our application’s code using the data in the <em>test.txt</em> file we just wrote, we need to create what’s known as a <em>run configuration</em> inside PyCharm (refer to section “Creating Run Configurations” on page liv for a refresher). Run configurations are a convenience that will save us time when we are developing.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>You may want to refer to the documentation online to better understand run configurations:</em> <a href="https://www.jetbrains.com/help/pycharm/run-debug-configuration.html">https://www.jetbrains.com/help/pycharm/run-debug-configuration.html</a><em>. If you happen to be using an IDE other than PyCharm, refer to its documentation. Most IDEs include a similar concept to run configurations to configure test runs for your programs.</em></p>&#13;
</div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_237"/>To create a run configuration, first make sure the navigation bar is visible by choosing <strong>View</strong> ▸ <strong>Navigation Bar</strong>. From the top menu, choose <strong>Run</strong> ▸ <strong>Edit Configurations</strong>. The dialog shown in <a href="ch09.xhtml#ch9fig2">Figure 9-2</a> will open.</p>&#13;
<div class="image"><img src="../images/09fig02.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch9fig2"><em>Figure 9-2: The run configuration dialog</em></p>&#13;
<p class="indent">Click the <strong>+</strong> icon on the top left, which opens the Add New Configuration drop-down, and choose <strong>Python</strong> (see <a href="ch09.xhtml#ch9fig3">Figure 9-3</a>).</p>&#13;
<div class="image"><img src="../images/09fig03.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch9fig3"><em>Figure 9-3: The new Python run configuration</em></p>&#13;
<p class="indent">The Run Configuration form should appear on the right side of the window. Enter the name <em>circle-three-points</em> in the Name field at the top. This will be the name you’ll use to refer to the configuration. On the Configuration tab, you should see the Script path field. This is the path to our <em>main.py</em> file: our program’s entry point. Click the folder icon inside the field and select <em>main.py</em>. Near the end of the Configuration tab, find the Execution section. Select the <strong>Redirect input from</strong> checkbox, and in the field click the folder icon and select our test file containing the definition of the points: <em>test.txt</em>. This way, the run configuration will always pass <em>test.txt</em> to the program’s standard input. Your configuration dialog should look like <a href="ch09.xhtml#ch9fig4">Figure 9-4</a>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_238"/><img src="../images/09fig04.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch9fig4"><em>Figure 9-4: The run configuration data</em></p>&#13;
<p class="indent">We need to do one last thing. If we executed the run configuration as it is now, the output of the program would be printed to the shell (standard output). That is fine, but since we’ll be outputting SVG code, we want to redirect the standard output to a file with the <em>.svg</em> extension.</p>&#13;
<p class="indent">Go to the Logs tab to the right of Configuration. Check <strong>Save console output to file</strong>; then click the folder icon, and select any file in <em>circle_from _points</em>. Once the file is selected, just change its name to <em>result.svg</em>. Alternatively, you can copy and paste the path to the package <em>circle_from_points</em> and then append the name of the <em>result.svg</em> file. You could also create an empty <em>result.svg</em> file and then select it here. Whatever way you choose, the result should look something like <a href="ch09.xhtml#ch9fig5">Figure 9-5</a>.</p>&#13;
<div class="image"><img src="../images/09fig05.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch9fig5"><em>Figure 9-5: Redirecting output to a file</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_239"/>We’re all set, so click <strong>OK</strong>. In your navigation bar you should see the newly created run configuration selected (see <a href="ch09.xhtml#ch9fig6">Figure 9-6</a>). Click the green play button to its right. This executes the run configuration, which should result in the message “This is working” written in a file named <em>result.svg</em>.</p>&#13;
<div class="image"><img src="../images/09fig06.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch9fig6"><em>Figure 9-6: The run configuration in the navigation bar</em></p>&#13;
<p class="indent">Let’s do a quick recap of what we’ve just done. We’ve created a configuration in PyCharm that instructs it on how to run our project. We told the configuration that <em>main.py</em> is the entry point to start executing our project. Then, we said we wanted the file <em>test.txt</em> containing our test data to be passed to the standard input of the program and the output of the program redirected to a file named <em>result.svg</em>.</p>&#13;
<h4 class="h4" id="ch00lev2sec107"><strong><em>Why Use a Run Configuration?</em></strong></h4>&#13;
<p class="noindent">You may be asking yourself, why do we want to create a run configuration instead of just executing our script from the command line?</p>&#13;
<p class="indent">That’s a good question. There are two good reasons why we use run configurations. The first is that we’ll be much more productive during development. We won’t need to enter commands into the shell to run the program, redirecting its standard input and output as necessary. Besides, this configuration allows us to debug the program, something that would be considerably harder from the shell. If you set a breakpoint somewhere in the code, you can click the bug-like button next to the green play button and the program should stop once the breakpoint is reached.</p>&#13;
<p class="indent">The second reason is that, as we’ll see later in the chapter, if you try to run <em>main.py</em> from the shell, once we start importing our packages (such as <em>geom2d</em>) it simply won’t work. Yes, that’s kind of surprising, but we’ll learn why this happens and, more importantly, how to fix it.</p>&#13;
<h3 class="h3" id="ch00lev1sec57"><strong>Reading the Input and Configuration Files</strong></h3>&#13;
<p class="noindent">So far we have a <em>main.py</em> file and a run configuration that passes it <em>test.txt</em> using the standard input. Right now we’re doing nothing with that file’s contents, so a good next step would be reading the contents of the file and parsing each line as an instance of the <span class="literal">Point</span> class. How do we go about doing this? We need to use regular expressions, a powerful technology for reading and extracting information from a text.</p>&#13;
<p class="indent">Before we explore regular expressions, let’s create a new file in our project to read both the input and configuration files. Let’s also take some time to learn to read files passed to the standard input of our program.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_240"/>In <em>circle_from_points</em>, create a new file named <em>input.py</em>. Your <em>circle_from _points</em> directory should look like the following:</p>&#13;
<p class="pre2">    circle_from_points<br/>      |- __init__.py<br/>      |- input.py<br/>      |- main.py<br/>      |- test.txt</p>&#13;
<p class="indent">Let’s start small and go one step at a time. Enter the code in <a href="ch09.xhtml#ch9lis2">Listing 9-2</a> in the newly created file.</p>&#13;
<pre>def parse_points():&#13;
    return (&#13;
        input(),&#13;
        input(),&#13;
        input(),&#13;
    )</pre>&#13;
<p class="caption"><a id="ch9lis2"/><em>Listing 9-2: Reading lines from the input file</em></p>&#13;
<p class="indent">The <span class="literal">parse_points</span> function is not actually parsing points . . . yet. So far, it returns a tuple consisting of three strings, each of which corresponds to a line obtained from the standard input. Each line is read using Python’s <span class="literal">input</span> function, which reads in one line of input at a time. Let’s call <span class="literal">parse_points</span> from our main program to see how it reads the test file’s contents. Go back to <em>main.py</em> and modify the code to make it match <a href="ch09.xhtml#ch9lis3">Listing 9-3</a>.</p>&#13;
<pre>from apps.circle_from_points.input import parse_points&#13;
&#13;
if __name__ == '__main__':&#13;
    (a, b, c) = parse_points()&#13;
    print(f'{a}\n{b}\n{c}')</pre>&#13;
<p class="caption"><a id="ch9lis3"/><em>Listing 9-3: Printing the points to the shell</em></p>&#13;
<p class="indent">You may be tempted to use Python’s relative imports here like <span class="literal">from</span> <span class="literal">.input import parse_points</span> but that won’t work properly when the file doing the imports is run from the command line. To get an idea of why that is, take a look at this excerpt from PEP 238:</p>&#13;
<p class="indent"/>&#13;
<div class="quote">&#13;
<p class="noindent">Relative imports use a module’s <span class="literal">__name__</span> attribute to determine that module’s position in the package hierarchy. If the module’s name does not contain any package information (e.g. it is set to <span class="literal">'__main__'</span>) then relative imports are resolved as if the module were a top level module, regardless of where the module is actually located on the file system.</p>&#13;
</div>&#13;
<p class="indent">The first thing we do in <a href="ch09.xhtml#ch9lis3">Listing 9-3</a> is import <span class="literal">parse_points</span> from the <em>input.py</em> module. In the “if name is main” condition we call the <span class="literal">parse_points</span> function and assign its output to a tuple <span class="literal">(a, b, c)</span>, which <em>destructures</em> its elements into the variables <span class="literal">a</span>, <span class="literal">b</span>, and <span class="literal">c</span>.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_241"/>The following is the less elegant way of accomplishing the same result:</p>&#13;
<pre>points = parse_points()&#13;
a = points[0]&#13;
b = points[1]&#13;
c = points[2]</pre>&#13;
<p class="noindent">But we’ll go with the former, which is a little cleaner. The last line prints the contents of <span class="literal">a</span>, <span class="literal">b</span>, and <span class="literal">c</span> to the shell, each in its own line. Run the application by clicking the green play button beside the run configuration we created earlier. You should get the following printed to the shell in the IDE:</p>&#13;
<pre>Input is being redirected from <span class="codeitalic1">--snip--</span>/test.txt&#13;
Console output is saving to: <span class="codeitalic1">--snip--</span>/result.svg&#13;
300 300&#13;
700 400&#13;
300 500&#13;
&#13;
Process finished with exit code 0</pre>&#13;
<p class="indent">The two first lines are pretty interesting. They tell us that the configuration used to run the file is receiving input from file <em>test.txt</em> and writing the output to file <em>result.svg</em>. If you open <em>result.svg</em>, you should see the three points the same way they’re defined inside <em>test.txt</em>, and also the same way they were printed to the shell. We’re making good progress here! The next step is to convert those space-separated coordinates into instances of our <span class="literal">Point</span> class. For that, we need regular expressions.</p>&#13;
<h4 class="h4" id="ch00lev2sec108"><strong><em>Regular Expressions</em></strong></h4>&#13;
<p class="noindent"><em>Regular expressions</em> (<em>regex</em> for short) are powerful constructs when it comes to interpreting text. Because the input to most, if not all, applications we’ll be creating in this book will be read from a plaintext file, we want to get acquainted with regular expressions.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>If you want to learn more about regular expressions, take a look at this awesome interactive tutorial:</em> <a href="https://regexone.com"><em>https://regexone.com</em></a>.</p>&#13;
</div>&#13;
<p class="indent">Let’s quickly review the problem we’re trying to solve here: given a string of text containing two integer numbers separated by a space, extract them from the string, convert them to numbers, and use them as the coordinates of an instance of <span class="literal">Point</span>. How do regular expressions help us here?</p>&#13;
<p class="indent">A regular expression is a pattern defined as a string. It’s used to search for matches inside other strings and, optionally, extract parts of them.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_242"/>Let’s try an example. Note that regular expressions are denoted by writing them between two slash characters. Imagine we’re looking for this pattern,</p>&#13;
<p class="pre2">    /repeat 5 times/</p>&#13;
<p class="noindent">and we’re interested in knowing whether that pattern appears in any of the following sentences:</p>&#13;
<div class="bqpara">&#13;
<p class="noindentin">Repeat 5 times.</p>&#13;
<p class="noindentin">For each exercise, repeat 5 times.</p>&#13;
<p class="noindentin">For that particular exercise, repeat 7 times.</p>&#13;
<p class="noindentin">Let’s repeat 3301 times.</p>&#13;
</div>&#13;
<p class="indent">The <span class="literal">/repeat 5 times/</span> regular expression compares itself against these strings searching for exactly the text <span class="literal">repeat 5 times</span> and thus yielding only the single bold match:</p>&#13;
<div class="bqpara">&#13;
<p class="noindentin">Repeat 5 times.</p>&#13;
<p class="noindentin">For each exercise, <strong>repeat 5 times</strong>.</p>&#13;
<p class="noindentin">For that particular exercise, repeat 7 times.</p>&#13;
<p class="noindentin">Let’s repeat 3301 times.</p>&#13;
</div>&#13;
<p class="indent">That’s great, but not very flexible. The first sentence was not a match because the first letter, the <em>R</em>, is uppercase; our pattern is lowercased. We can tweak our pattern to accept both:</p>&#13;
<p class="pre2">    /[Rr]epeat 5 times/</p>&#13;
<p class="noindent">This time the matches are as follows:</p>&#13;
<div class="bqpara">&#13;
<p class="noindentin"><strong>Repeat 5 times</strong>.</p>&#13;
<p class="noindentin">For each exercise, <strong>repeat 5 times</strong>.</p>&#13;
<p class="noindentin">For that particular exercise, repeat 7 times.</p>&#13;
<p class="noindentin">Let’s repeat 3301 times.</p>&#13;
</div>&#13;
<p class="indent">To account for both kinds of <em>r</em>, we introduced a <em>character set</em>: a series of accepted characters in a given position of the text, any of which is considered valid. Character sets are defined between square brackets.</p>&#13;
<p class="indent">There’s much more we can do with regular expressions. What about the number of repetitions specified in the sentence? Can we make it so any number of repetitions is considered a match? We sure can. If we modify our pattern to be</p>&#13;
<p class="pre2">    /[Rr]epeat \d times/</p>&#13;
<p class="noindent">we’ll get the following matches:</p>&#13;
<div class="bqpara">&#13;
<p class="noindentin"><strong>Repeat 5 times</strong>.</p>&#13;
<p class="noindentin">For each exercise, <strong>repeat 5 times</strong>.</p>&#13;
<p class="noindentin">For that particular exercise, <strong>repeat 7 times</strong>.</p>&#13;
<p class="noindentin">Let’s repeat 3301 times.</p>&#13;
</div>&#13;
<p class="indent">The pattern <span class="literal">\d</span> matches a single digit, any number between 0 and 9. But what about that last sentence? If we wanted to match more than one digit, we’d need to add a <em>quantifier</em> to the <span class="literal">\d</span> pattern. In this case, the quantifier that makes the most sense is <span class="literal">+</span>, which is used to match one or more of the tokens it quantifies. The pattern</p>&#13;
<p class="pre2">    /[Rr]epeat \d+ times/</p>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_243"/>would then work with any number of repetitions and thus get us the full range of matches we’ve been after:</p>&#13;
<div class="bqpara">&#13;
<p class="noindentin"><strong>Repeat 5 times</strong>.</p>&#13;
<p class="noindentin">For each exercise, <strong>repeat 5 times</strong>.</p>&#13;
<p class="noindentin">For that particular exercise, <strong>repeat 7 times</strong>.</p>&#13;
<p class="noindentin">Let’s <strong>repeat 3301 times</strong>.</p>&#13;
</div>&#13;
<p class="indent">Now that you’re starting to see what regular expressions are about, let’s explore some of their basic concepts.</p>&#13;
<h5 class="h5" id="ch00lev3sec52"><strong>Character Sets</strong></h5>&#13;
<p class="noindent">As we’ve seen, we can include several different characters between square brackets to have our regular expression match any of them. For instance, we could use</p>&#13;
<p class="pre2">    /[mbg]ore/</p>&#13;
<p class="noindent">to match <strong>more</strong>, <strong>bore</strong>, and <strong>gore</strong>. We can also include ranges like all lowercase letters from <em>a</em> to <em>z</em> like so:</p>&#13;
<p class="pre2">    /[a-z]ore/</p>&#13;
<p class="noindent">This would produce a wide range of matches, for instance <strong>more</strong>, <strong>core</strong>, and exp<strong>lore</strong>. We can also include the range of uppercase letters,</p>&#13;
<p class="pre2">    /[a-zA-Z]ore/</p>&#13;
<p class="noindent">to include matches like <strong>More</strong> or <strong>Core</strong>. One thing to keep an eye on is that consecutive ranges are not separated by a space. If you separated them using a space, the set would include the space as a valid character.</p>&#13;
<h5 class="h5" id="ch00lev3sec53"><strong>Character Classes</strong></h5>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_244"/>There are some special characters we can use to match common things such as digits, whitespace, or single letters. The first one is a dot (<strong>.</strong>). We use it to match anything except line breaks. It matches letters (both uppercase and lowercase), numbers, punctuation marks, and whitespace. As you can see, this is quite a powerful <em>matcher</em>. For example, the pattern</p>&#13;
<p class="pre2">    /the end./</p>&#13;
<p class="noindent">would match <strong>the end.</strong>, <strong>the end?</strong>, <strong>the end!</strong>, and many more. To match a single dot, we need to escape the dot character using a backward slash,</p>&#13;
<p class="pre2">    /the end\./</p>&#13;
<p class="noindent">which would produce only one match: <strong>the end.</strong></p>&#13;
<p class="indent">We already learned about the class <span class="literal">\d</span>, which matches a digit. If we want to match everything <em>but</em> digits, we can use <span class="literal">\D</span> (uppercase). Similarly, to match letters, we can use the class <span class="literal">\w</span>, and we can use <span class="literal">\W</span> for nonletters. Lastly, for whitespace there’s <span class="literal">\s</span>, and there’s <span class="literal">\S</span> to match whatever isn’t whitespace.</p>&#13;
<p class="indent">Now let’s combine our knowledge on character classes into a regular expression:</p>&#13;
<p class="pre2">    /code\s\w-\d\d/</p>&#13;
<p class="noindent">This regular expression matches strings like <strong>code f-44</strong>, <strong>code M-81</strong>, and <strong>code p-29</strong>.</p>&#13;
<h5 class="h5" id="ch00lev3sec54"><strong>Quantifiers</strong></h5>&#13;
<p class="noindent">Quantifiers modify the number of matches expected for the token they quantify. There are five quantifiers:</p>&#13;
<div class="bqparan">&#13;
<p class="noindentin"><span class="codestrong">?</span>     Matches zero or one of the preceding tokens</p>&#13;
<p class="noindentin"><span class="codestrong">*</span>     Matches zero or more of the preceding tokens</p>&#13;
<p class="noindentin"><span class="codestrong">+</span>     Matches one or more of the preceding tokens</p>&#13;
<p class="noindentin"><span class="codestrong">(n)</span>     Matches exactly <span class="literal">n</span> of the preceding tokens</p>&#13;
<p class="noindentin"><span class="codestrong">(n,m)</span>     Matches from <span class="literal">n</span> to <span class="literal">m</span> of the preceding tokens</p>&#13;
</div>&#13;
<p class="indent">For example,</p>&#13;
<p class="pre2">    /o{2}m/</p>&#13;
<p class="noindent">would match b<strong>oom</strong>, z<strong>oom</strong>, or kab<strong>oom</strong>. But, if instead we use</p>&#13;
<p class="pre2">    /o+m/</p>&#13;
<p class="noindent">our matches could be any of the following: n<strong>om</strong>ad, b<strong>oooo</strong>m, or r<strong>oom</strong>. We’ll be using most of these quantifiers throughout the text, so there will be plenty more examples of them.</p>&#13;
<h5 class="h5" id="ch00lev3sec55"><strong>Capturing Groups</strong></h5>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_245"/>So far we’ve seen how to match text using regular expressions. But sometimes we also want to extract the text we’ve matched. Here’s where groups come in. Groups are defined between parentheses. Let’s try the following regular expression,</p>&#13;
<p class="pre2">    /it takes (\d+) hours to go from (\w+) to (\w+)/</p>&#13;
<p class="noindent">which applied to the sentence “it takes 4 hours to go from Barcelona to Pamplona” would match it entirely and capture the following groups:</p>&#13;
<p class="pre2">    ('4', 'Barcelona', 'Pamplona')</p>&#13;
<p class="indent">Let’s try it in Python’s shell. Python’s standard library includes a powerful regular expression package: <span class="literal">re</span>. Open your IDE’s shell and try entering the code in <a href="ch09.xhtml#ch9lis4">Listing 9-4</a>.</p>&#13;
<pre>&gt;&gt;&gt; <span class="codestrong1">import re</span>&#13;
&gt;&gt;&gt; <span class="codestrong1">pattern = r</span>'<span class="codestrong1">it takes (\d+) hours to go from (\w+) to (\w+)</span>'&#13;
&gt;&gt;&gt; <span class="codestrong1">target =</span> '<span class="codestrong1">it takes 4 hours to go from Barcelona to Pamplona</span>'&#13;
&gt;&gt;&gt; <span class="codestrong1">matches = re.match(pattern, target)</span>&#13;
&gt;&gt;&gt; <span class="codestrong1">matches.groups()</span>&#13;
('4', 'Barcelona', 'Pamplona')</pre>&#13;
<p class="caption"><a id="ch9lis4"/><em>Listing 9-4: Capturing groups with regular expressions</em></p>&#13;
<p class="indent">We define the pattern using a <em>raw string literal</em>, which has the format <span class="literal">r</span>’’. These strings treat the backslash (<span class="literal">\</span>) as a valid character instead of interpreting it as an escape sequence. Regular expressions need the backslash to define their structure.</p>&#13;
<p class="indent">In <a href="ch09.xhtml#ch9lis4">Listing 9-4</a>, the result is stored in a variable named <span class="literal">matches</span>, which we can call the <span class="literal">groups</span> method on to yield the three captured groups: <span class="literal">4</span>, <span class="literal">Barcelona</span>, and <span class="literal">Pamplona</span>.</p>&#13;
<p class="indent">A neat thing about groups is that they can be assigned a name that we can later use to retrieve the matched value. For instance, consider the following pattern:</p>&#13;
<p class="pre2">    /(?P&lt;name&gt;\w+), but they call me (?P&lt;nick&gt;\w+)/</p>&#13;
<p class="noindent">Applied to a sentence like “my name is Nelson, but they call me Big Head,” this would capture two groups, which we can retrieve by name:</p>&#13;
<pre>name = matches.group('name')&#13;
nick = matches.group('nick')</pre>&#13;
<p class="noindent">As you can guess, the syntax used to assign a name to a group is as follows,</p>&#13;
<pre>(?P&lt;<span class="codeitalic1">name</span>&gt;&lt;<span class="codeitalic1">regex</span>&gt;)</pre>&#13;
<p class="noindent">where <span class="literal">name</span> is the name assigned to the group and <span class="literal">regex</span> is the actual pattern to match the group.</p>&#13;
<h4 class="h4" id="ch00lev2sec109"><strong><em>Regular Expressions Cheat Sheet</em></strong></h4>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_246"/><a href="ch09.xhtml#ch9tab1">Table 9-1</a>, <a href="ch09.xhtml#ch9tab2">Table 9-2</a>, <a href="ch09.xhtml#ch9tab3">Table 9-3</a>, and <a href="ch09.xhtml#ch9tab4">Table 9-4</a> summarize the concepts we’ve explored and can be used as references throughout the rest of the book.</p>&#13;
<p class="tabcap" id="ch9tab1"><strong>Table 9-1:</strong> Regular Expressions Character Sets</p>&#13;
<table class="all">&#13;
<tbody><tr>&#13;
<td style="vertical-align: top;" class="table-hs"><p class="taba"><span class="literal">[abc]</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;" class="table-hs"><p class="taba">Matches ’a’ or ’b’ or ’c’</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="taba"><span class="literal">[^ab]</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;"><p class="taba">Matches every character except ’a’ and ’b’</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-hs1"><p class="taba"><span class="literal">[a-z]</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;" class="table-hs1"><p class="taba">Matches every character between ’a’ and ’z’</p>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="tabcap" id="ch9tab2"><strong>Table 9-2:</strong> Regular Expressions Character Classes</p>&#13;
<table class="all">&#13;
<tbody><tr>&#13;
<td style="vertical-align: top;" class="table-hs"><p class="taba"><span class="literal">\s</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;" class="table-hs"><p class="taba">Matches whitespace</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="taba"><span class="literal">\S</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;"><p class="taba">Matches every character but whitespace</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="taba"><span class="literal">\d</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;"><p class="taba">Matches digits</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="taba"><span class="literal">\D</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;"><p class="taba">Matches every character but digits</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="taba"><span class="literal">\w</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;"><p class="taba">Matches letters</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-hs1"><p class="taba"><span class="literal">\W</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;" class="table-hs1"><p class="taba">Matches every character but letters</p>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="tabcap" id="ch9tab3"><strong>Table 9-3:</strong> Regular Expressions Quantifiers</p>&#13;
<table class="all">&#13;
<tbody><tr>&#13;
<td style="vertical-align: top;" class="table-hs"><p class="taba"><span class="literal">?</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;" class="table-hs"><p class="taba">Zero or one</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="taba"><span class="literal">*</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;"><p class="taba">Zero or more</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="taba"><span class="literal">+</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;"><p class="taba">One or more</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;"><p class="taba"><span class="literal">{n}</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;"><p class="taba">Exactly n</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-hs1"><p class="taba"><span class="literal">{n,m}</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;" class="table-hs1"><p class="taba">Between n and m (both included)</p>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<p class="tabcap" id="ch9tab4"><strong>Table 9-4:</strong> Regular Expressions Capture Groups</p>&#13;
<table class="all">&#13;
<tbody><tr>&#13;
<td style="vertical-align: top;" class="table-hs"><p class="taba"><span class="literal">(...)</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;" class="table-hs"><p class="taba">A capture group goes between parentheses</p>&#13;
</td>&#13;
</tr>&#13;
<tr>&#13;
<td style="vertical-align: top;" class="table-hs1"><p class="taba"><span class="literal">(?P&lt;name&gt;...)</span></p>&#13;
</td>&#13;
<td style="vertical-align: top;" class="table-hs1"><p class="taba">A named capture group</p>&#13;
</td>&#13;
</tr>&#13;
</tbody>&#13;
</table>&#13;
<h4 class="h4" id="ch00lev2sec110"><strong><em>Matching Points</em></strong></h4>&#13;
<p class="noindent">We already know everything we need to match the points defined as their space-separated coordinates and capture them by name. Because coordinates will be defined by integer numbers only, we can use the following regular expression:</p>&#13;
<p class="pre2">    /(?P&lt;x&gt;\d+)\s(?P&lt;y&gt;\d+)/</p>&#13;
<p class="noindent">Let’s break that down. There are three parts to it:</p>&#13;
<div class="bqparan">&#13;
<p class="noindentin"><span class="codestrong">(?P&lt;x&gt;\d+)</span>   Captures a group named <span class="literal">x</span> of one or more digits</p>&#13;
<p class="noindentin"><span class="codestrong">\s</span>   Matches a single space</p>&#13;
<p class="noindentin"><span class="codestrong">(?P&lt;y&gt;\d+)</span>   Captures a group named <span class="literal">y</span> of one or more digits</p>&#13;
</div>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_247"/>Let’s implement this matching pattern in our application’s <em>input.py</em> file. Edit the code we wrote so that it looks like <a href="ch09.xhtml#ch9lis5">Listing 9-5</a>.</p>&#13;
<pre><span class="ent">➊</span> import re&#13;
&#13;
  from geom2d import Point&#13;
&#13;
&#13;
  def parse_points():&#13;
      return (&#13;
          __point_from_string(input()),&#13;
          __point_from_string(input()),&#13;
          __point_from_string(input()),&#13;
      )&#13;
&#13;
&#13;
  def __point_from_string(string: str):&#13;
   <span class="ent">➋</span> matches = re.match(r'(?P&lt;x&gt;\d+)\s(?P&lt;y&gt;\d+)', string)&#13;
      return Point(&#13;
       <span class="ent">➌</span> int(matches.group('x')),&#13;
       <span class="ent">➍</span> int(matches.group('y'))&#13;
      )</pre>&#13;
<p class="caption"><a id="ch9lis5"/><em>Listing 9-5: Parsing points</em></p>&#13;
<p class="indent">We start by importing <span class="literal">re</span> <span class="ent">➊</span>. Then, we modify the <span class="literal">parse_points</span> function to map the line we read using <span class="literal">input()</span> on an instance of <span class="literal">Point</span>. This conversion is handled by the private <span class="literal">__point_from_string</span> function, which, using <span class="literal">re.match</span>, looks for matches of the pattern in the passed-in string <span class="ent">➋</span>.</p>&#13;
<p class="indent">From <span class="literal">matches</span> we know there should be two groups named <span class="literal">x</span> and <span class="literal">y</span>, respectively. The function thus creates and returns an instance of <span class="literal">Point</span> whose x-coordinate is the result of parsing the string captured by the group with name <span class="literal">x</span> as an integer <span class="ent">➌</span>. The y-coordinate is, in a similar fashion, the result of parsing the group named <span class="literal">y</span> <span class="ent">➍</span>.</p>&#13;
<p class="indent">Run the application (using the <em>circle-three-points</em> configuration) by clicking the green play button. You should see something like this printed to the shell:</p>&#13;
<pre>Input is being redirected from <span class="codeitalic1">--snip--</span>/test.txt&#13;
Console output is saving to: <span class="codeitalic1">--snip--</span>/result.svg&#13;
(300, 300)&#13;
(700, 400)&#13;
(300, 500)&#13;
&#13;
Process finished with exit code 0</pre>&#13;
<p class="indent">Congratulations! You just parsed three points from a file containing three lines of plaintext. From here on out, all the command line applications <span epub:type="pagebreak" id="page_248"/>we’ll create can expect the input data from a file, which you already know how to parse and interpret using the almighty regular expressions.</p>&#13;
<h4 class="h4" id="ch00lev2sec111"><strong><em>The Configuration File</em></strong></h4>&#13;
<p class="noindent">Our application will produce a beautiful vector image of both the input points and the resulting circle. To do this, we’ll use different colors and line thicknesses to help visually distinguish its parts. We could directly hard-code those colors and size values in our code, but that’s not a great idea; our app will be easier to maintain if we separate the configuration values from the actual logic. Instead, we’ll keep the configuration values in a separate JSON file. We’ll use the JSON format because it’s extremely easy to convert to a Python dictionary.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>We say something is</em> hard-coded <em>into the code when there’s no way of changing it without altering the program’s source code. Configuration values, for instance, are often hard-coded into the main application’s logic, making them impossible to change without the need of reading through the code and potentially recompiling the application. Don’t do that. The fewer times you need to edit and recompile existing code, the better. Always move configuration values out of the program’s logic into a file of its own.</em></p>&#13;
</div>&#13;
<p class="indent">Inside <em>circle_from_points</em>, create a new file by right-clicking the package name and choosing <strong>New</strong> ▸ <strong>File</strong>. Enter the name <em>config.json</em>, and in it, write the contents in <a href="ch09.xhtml#ch9lis6">Listing 9-6</a>.</p>&#13;
<pre>{&#13;
  "input": {&#13;
    "stroke-color": "#4A90E2",&#13;
    "stroke-width": 2,&#13;
    "fill-color": "#ffffffbb",&#13;
    "label-size": 16,&#13;
    "font-family": "Helvetica"&#13;
  },&#13;
  "output": {&#13;
    "stroke-color": "#50E3C2",&#13;
    "stroke-width": 4,&#13;
    "fill-color": "#ffffff",&#13;
    "label-size": 14,&#13;
    "font-family": "Helvetica"&#13;
  }&#13;
}</pre>&#13;
<p class="caption"><a id="ch9lis6"/><em>Listing 9-6: Application configuration inside a JSON file</em></p>&#13;
<p class="indent">This file is in JSON, a widely used format. If you happen to be new to it, you can read more about it at <a href="http://www.json.org/"><em>www.json.org/</em></a>. It looks similar to Python dictionaries as it stores data in a key-value fashion. Luckily for us, Python has <span epub:type="pagebreak" id="page_249"/>an easy way of reading in JSON files: the standard library includes the <em>json</em> package to handle JSON data.</p>&#13;
<p class="indent">In <em>input.py</em>, enter the function in <a href="ch09.xhtml#ch9lis7">Listing 9-7</a> (don’t forget the imports).</p>&#13;
<pre><span class="codestrong1">import json</span>&#13;
import re&#13;
&#13;
<span class="codestrong1">import pkg_resources as res</span>&#13;
&#13;
&#13;
def read_config():&#13;
    config = res.resource_string(__name__, 'config.json')&#13;
    return json.loads(config)&#13;
&#13;
<span class="codeitalic1">--snip--</span></pre>&#13;
<p class="caption"><a id="ch9lis7"/><em>Listing 9-7: Reading the configuration</em></p>&#13;
<p class="indent">Using the <span class="literal">pkg_resources</span> module, this process becomes a breeze. The contents of file <em>config.json</em> are read into a binary string using <span class="literal">res.resource_string()</span>, which, when passed to <span class="literal">json.loads</span>, gets us the resulting Python dictionary with everything parsed and ready to be used. We’ll be using these values soon.</p>&#13;
<h3 class="h3" id="ch00lev1sec58"><strong>Problem Model and Resolution</strong></h3>&#13;
<p class="noindent">We’ve already parsed the problem’s model: the three instances of our <span class="literal">Point</span> class. Using these, our application should now compute the circle that passes through all of them. Our earlier work is about to pay off: we already have the code to do this (check out “Circle Factories” on <a href="ch06.xhtml#ch00lev2sec74">page 153</a> for a refresher).</p>&#13;
<p class="indent">Open <em>main.py</em> and enter the code in <a href="ch09.xhtml#ch9lis8">Listing 9-8</a>.</p>&#13;
<pre>from apps.circle_from_points.input import parse_points&#13;
<span class="codestrong1">from geom2d import make_circle_from_points</span>&#13;
&#13;
if __name__ == '__main__':&#13;
    (a, b, c) = parse_points()&#13;
    circle = make_circle_from_points(a, b, c)&#13;
    print(circle)</pre>&#13;
<p class="caption"><a id="ch9lis8"/><em>Listing 9-8: Computing the circle passing through the three points</em></p>&#13;
<p class="indent">That was easy! We import <span class="literal">make_circle_from_points</span> from <em>geom2d</em> and simply pass it the three points: <span class="literal">a</span>, <span class="literal">b</span>, and <span class="literal">c</span>. To make sure the circle was correctly computed, we print the resulting circle. Run the application; you should expect the following string representation for the resulting circle:</p>&#13;
<pre>circle c = (487.5, 400.0), r = 212.5</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_250"/>If you open <em>result.svg</em>, that should be its content. This file is where we’re redirecting our program’s output. There’s only one thing missing from our program: plotting the output using the SVG format!</p>&#13;
<h3 class="h3" id="ch00lev1sec59"><strong>Generating Output</strong></h3>&#13;
<p class="noindent">Now that the problem is solved, we need to draw an SVG with the resulting circle and input points. Start by creating a new file in <em>circle_from_points</em> named <em>output.py</em>. Your <em>circle_from_points</em> directory should look like the following:</p>&#13;
<p class="pre2">    circle_from_points<br/>      |- __init__.py<br/>      |- input.py<br/>      |- main.py<br/>      |- output.py<br/>      |- test.txt</p>&#13;
<p class="noindent">In it, enter the code in <a href="ch09.xhtml#ch9lis9">Listing 9-9</a>.</p>&#13;
<pre>from geom2d import Circle, Point&#13;
&#13;
&#13;
def draw_to_svg(points: [Point], circle: Circle, config):&#13;
    print("Almost there...")</pre>&#13;
<p class="caption"><a id="ch9lis9"/><em>Listing 9-9: First step to generating the output image</em></p>&#13;
<p class="indent">We defined a new function, <span class="literal">draw_to_svg</span>, which receives a sequence of points (the input points to the problem), the resulting circle, and a configuration dictionary. Note the type hint for a sequence of points: <span class="literal">[Point]</span>; it’s declared by the <span class="literal">Point</span> class between square brackets. A sequence type hint defined like this accepts both lists and tuples.</p>&#13;
<p class="indent">For now, the function simply prints a message to the standard output, but we’ll be updating it one step at a time until it finally draws everything. With this, you can go ahead and give <em>main.py</em> its final look. Modify your code so that it looks like <a href="ch09.xhtml#ch9lis10">Listing 9-10</a>.</p>&#13;
<pre>from apps.circle_from_points.input import parse_points, <span class="codestrong1">read_config</span>&#13;
<span class="codestrong1">from apps.circle_from_points.output import draw_to_svg</span>&#13;
from geom2d import make_circle_from_points&#13;
&#13;
if __name__ == '__main__':&#13;
    (a, b, c) = parse_points()&#13;
    circle = make_circle_from_points(a, b, c)&#13;
    draw_to_svg((a, b, c), circle, read_config())</pre>&#13;
<p class="caption"><a id="ch9lis10"/><em>Listing 9-10: Main file</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_251"/>This code is concise. There are fundamentally three lines, which, respectively, read the input, solve the problem, and draw the output. With our main file all set up, let’s fill out <span class="literal">draw_to_svg</span>.</p>&#13;
<h4 class="h4" id="ch00lev2sec112"><strong><em>Drawing the Output Circle</em></strong></h4>&#13;
<p class="noindent">We’ll start by drawing the circle. Open <em>output.py</em> and enter the code in <a href="ch09.xhtml#ch9lis11">Listing 9-11</a>.</p>&#13;
<pre>from geom2d import make_rect_centered, Circle, Point, Vector&#13;
from graphic import svg&#13;
&#13;
&#13;
def draw_to_svg(points: [Point], circle: Circle, config):&#13;
 <span class="ent">➊</span> svg_output = output_to_svg(circle, config['output'])&#13;
&#13;
 <span class="ent">➋</span> viewbox = make_viewbox(circle)&#13;
 <span class="ent">➌</span> svg_img = svg.svg_content(&#13;
        viewbox.size, svg_output, viewbox&#13;
    )&#13;
&#13;
    print(svg_img)&#13;
&#13;
&#13;
def output_to_svg(circle: Circle, config):&#13;
 <span class="ent">➍</span> style = style_from_config(config)&#13;
 <span class="ent">➎</span> label_style = label_style_from_config(config)&#13;
&#13;
    return [&#13;
     <span class="ent">➏</span> svg.circle(circle, style),&#13;
     <span class="ent">➐</span> svg.text(&#13;
            f'O {circle.center}',&#13;
            circle.center,&#13;
            Vector(0, 0),&#13;
            label_style&#13;
        ),&#13;
     <span class="ent">➑</span> svg.text(&#13;
            f'r = {circle.radius}',&#13;
            circle.center,&#13;
            Vector(0, 20),&#13;
            label_style&#13;
        )&#13;
    ]</pre>&#13;
<p class="caption"><a id="ch9lis11"/><em>Listing 9-11: Drawing the resulting circle</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_252"/>That seems like a lot of code, but don’t worry, we’ll break it down. First, we update the <span class="literal">draw_to_svg</span> function. Using the <span class="literal">output_to_svg</span> function we define later in the code, we create the SVG representation for the circle <span class="ent">➊</span>. Note that we’re passing this function <span class="literal">config[</span>’<span class="literal">output</span>’<span class="literal">]</span>, the <em>output</em> part of the configuration dictionary.</p>&#13;
<p class="indent">Then, using <span class="literal">make_viewbox</span>, a function we’ve yet to define, we compute the <span class="literal">viewBox</span> for the image <span class="ent">➋</span>. Using this <span class="literal">viewBox</span>, its size, and <span class="literal">svg_output</span>, we generate the image <span class="ent">➌</span> and print it to the standard output.</p>&#13;
<p class="indent">Now let’s look at <span class="literal">output_to_svg</span>. This function stores the SVG attributes for the circle using another function we’ll define shortly (<span class="literal">style_from_config</span>) in a variable named <span class="literal">style</span> <span class="ent">➍</span>. The same happens for the styling attributes we’ll use with the text, generated by <span class="literal">label_style_from_config</span> <span class="ent">➎</span>. The function returns an array of three SVG primitives: the circle and two labels.</p>&#13;
<p class="indent">The circle is straightforward; we use our prewritten <span class="literal">circle</span> function <span class="ent">➏</span>. Then comes the label indicating where the center of the circle is <span class="ent">➐</span>, located with its origin at the center point. Lastly, there’s the label with the information about the circle’s radius. This label is located in the center of the circle but displaced ⟨0, 20⟩ so that it appears below the former <span class="ent">➑</span>.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>You may remember we said that when displacing the label by a vector</em> ⟨0, 20⟩<em>, it appears below the other. A positive number in the y-coordinate of the vector should produce an upward displacement and hence move the label on top of the other. But remember that in SVG the y-axis points downward. We could fix that by applying an affine transformation, but we won’t right now.</em></p>&#13;
</div>&#13;
<p class="indent">To compute the <span class="literal">viewBox</span>, enter the code in <a href="ch09.xhtml#ch9lis12">Listing 9-12</a> under <span class="literal">output_to_svg</span>.</p>&#13;
<pre><span class="codeitalic1">--snip--</span>&#13;
&#13;
def make_viewbox(circle: Circle):&#13;
    height = 2.5 * circle.radius&#13;
    width = 4 * circle.radius&#13;
    return make_rect_centered(circle.center, width, height)</pre>&#13;
<p class="caption"><a id="ch9lis12"/><em>Listing 9-12: Computing the <span class="codeitalic1">viewBox</span> for the image</em></p>&#13;
<p class="indent">This function computes the rectangle that defines the visible portion of the image. If you need a refresher, go back to section “The viewBox” on <a href="ch08.xhtml#ch00lev2sec92">page 207</a>. To construct the rectangle, we use the <span class="literal">make_rect_centered</span> factory function, which is pretty convenient now that we need a rectangle containing a circle. The height of the rectangle is 2.5 times the radius of the circle, that is, the diameter plus some margin. For the width, we use 4 times the radius (or 2 times the diameter), as we need some room for the labels we’ll draw. I came up with these values by pure trial and error, but feel free to adjust them based on your experiments. They’ll basically add more or less margin to your drawing; that’s all.</p>&#13;
<p class="indent"><a href="ch09.xhtml#ch9fig7">Figure 9-7</a> describes the layout of the SVG image we’re drawing for reference.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_253"/><img src="../images/09fig07.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch9fig7"><em>Figure 9-7: The SVG output layout</em></p>&#13;
<p class="indent">Let’s implement the functions that generate the SVG styling attributes. Toward the end of your file <em>output.py</em>, enter the code in <a href="ch09.xhtml#ch9lis13">Listing 9-13</a>.</p>&#13;
<pre><span class="codeitalic1">--snip--</span>&#13;
&#13;
def style_from_config(config):&#13;
    return [&#13;
        svg.stroke_color(config['stroke-color']),&#13;
        svg.stroke_width(config['stroke-width']),&#13;
        svg.fill_color(config['fill-color'])&#13;
    ]</pre>&#13;
<p class="caption"><a id="ch9lis13"/><em>Listing 9-13: Creating styles from configuration</em></p>&#13;
<p class="indent">The <span class="literal">style_from_config</span> function creates a list of SVG attributes using the values from the configuration dictionary. Let’s do the same for the label’s style (see <a href="ch09.xhtml#ch9lis14">Listing 9-14</a>).</p>&#13;
<pre><span class="codeitalic1">--snip--</span>&#13;
&#13;
def label_style_from_config(config):&#13;
    return [&#13;
        svg.font_size(config['label-size']),&#13;
        svg.font_family(config['font-family']),&#13;
        svg.fill_color(config['stroke-color'])&#13;
    ]</pre>&#13;
<p class="caption"><a id="ch9lis14"/><em>Listing 9-14: Creating label styles from configuration</em></p>&#13;
<p class="indent">That’s it! We have all the code needed to draw the resulting circle in a cyanish color. If you run the application now, you should see how the shell spits out some SVG code, the same that is written in the file <em>result.svg</em>. Open this file using your favorite browser. The result should be something similar to <a href="ch09.xhtml#ch9fig8">Figure 9-8</a>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_254"/><img src="../images/09fig08.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch9fig8"><em>Figure 9-8: The SVG output circle</em></p>&#13;
<p class="indent">There you go! We solved our first geometry problem and plotted the result into a vector image. Isn’t that super exciting? Go ahead and play with the configuration. Try changing the color for the output and rerunning the application.</p>&#13;
<h4 class="h4" id="ch00lev2sec113"><strong><em>Drawing the Input Points</em></strong></h4>&#13;
<p class="noindent">It’s nice that we drew the resulting circle with captions that indicate the position of the center and the radius, but the resulting image doesn’t include information about the input points that generated the circle. Let’s draw those so that one can get all the information from a single glance at the resulting image.</p>&#13;
<p class="indent">Let’s create a new function that is similar to <span class="literal">output_to_svg</span> but produces the SVG primitives that represent the input points. We’ll represent these points as circles as well. In <em>output.py</em> enter the code in <a href="ch09.xhtml#ch9lis15">Listing 9-15</a>.</p>&#13;
<pre><span class="codeitalic1">--snip--</span>&#13;
&#13;
def input_to_svg(points: [Point], point_radius: float, config):&#13;
    style = style_from_config(config)&#13;
    label_style = label_style_from_config(config)&#13;
 <span class="ent">➊</span> [a, b, c] = points&#13;
 <span class="ent">➋</span> disp = Vector(1.25 * point_radius, 0)&#13;
&#13;
 <span class="ent">➌</span> return [&#13;
        svg.circle(Circle(a, point_radius), style),&#13;
        svg.circle(Circle(b, point_radius), style),&#13;
        svg.circle(Circle(c, point_radius), style),&#13;
        svg.text(f'A {a}', a, disp, label_style),&#13;
        svg.text(f'B {b}', b, disp, label_style),&#13;
        <span epub:type="pagebreak" id="page_255"/>svg.text(f'C {c}', c, disp, label_style)&#13;
    ]</pre>&#13;
<p class="caption"><a id="ch9lis15"/><em>Listing 9-15: Drawing the input points</em></p>&#13;
<p class="indent">The <span class="literal">input_to_svg</span> function gets passed a list with the three input points, the radius to use for representing the points, and the input configuration dictionary.</p>&#13;
<p class="indent">As you’ll see, we’ll use a fraction of the size of the resulting circle as the radius for the input points. This is so that they look good no matter the size of the resulting image. Using a fixed number for their radius could result in tiny, almost invisible circles for certain inputs and monstrous circles bigger than the resulting one for others.</p>&#13;
<p class="indent">The styles for both the points and their labels are computed using the same functions we used before: <span class="literal">style_from_config</span> and <span class="literal">label_style_from_config</span>. The points in the sequence are destructured into variables <span class="literal">a</span>, <span class="literal">b</span>, and <span class="literal">c</span> so that we can conveniently use them <span class="ent">➊</span>.</p>&#13;
<p class="indent">Because we’ll need to move the labels a bit to the right so they don’t overlap with their circle, we construct a displacement vector, <span class="literal">disp</span> <span class="ent">➋</span>. The function returns the array of circles with their labels <span class="ent">➌</span>.</p>&#13;
<p class="indent">Now update function <span class="literal">draw_to_svg</span> so that it also includes the three points in the resulting image (see <a href="ch09.xhtml#ch9lis16">Listing 9-16</a>).</p>&#13;
<pre>def draw_to_svg(points: [Point], circle: Circle, config):&#13;
 <span class="ent">➊</span> pt_radius = circle.radius / 20&#13;
    svg_output = output_to_svg(circle, config['output'])&#13;
 <span class="ent">➋</span> svg_input = input_to_svg(points, pt_radius, config['input'])&#13;
&#13;
    viewbox = make_viewbox(circle)&#13;
    svg_img = svg.svg_content(&#13;
     <span class="ent">➌</span> viewbox.size, svg_output + svg_input, viewbox&#13;
    )&#13;
&#13;
&#13;
    print(svg_img)&#13;
&#13;
<span class="codeitalic1">--snip--</span></pre>&#13;
<p class="caption"><a id="ch9lis16"/><em>Listing 9-16: Drawing to SVG</em></p>&#13;
<p class="indent">As mentioned, the radius for the input points needs to be a fraction of that from the resulting circle, so we chose one-twentieth of its radius <span class="ent">➊</span>. If you think the resulting circles are too big or too small, you can change that value and experiment until you’re happy with the result. This value could be perfectly fine as part of the application’s configuration, but we’ll keep it as an implementation detail for the sake of simplicity.</p>&#13;
<p class="indent">After we compute <span class="literal">pt_radius</span>, we compute the SVG primitives for the output as before. Then we compute the SVG primitives for the input using the <span class="literal">input_to_svg</span> function and store the result in <span class="literal">svg_input</span> <span class="ent">➋</span>.</p>&#13;
<p class="indent">After creating a <span class="literal">viewBox</span>, we update the contents of the SVG image by appending <span class="literal">svg_input</span> to <span class="literal">svg_output</span> <span class="ent">➌</span>. It’s important that <span class="literal">svg_input</span> goes after <span class="literal">svg_output</span>, as <span epub:type="pagebreak" id="page_256"/>the image primitives are drawn in order. If you switched the order to this,</p>&#13;
<pre>svg_input + svg_output</pre>&#13;
<p class="noindent">you’d see the input point circles behind the big circle.</p>&#13;
<p class="indent">You’re now ready to run the application and then reload the <em>result.svg</em> file in the browser. The result should look like <a href="ch09.xhtml#ch9fig9">Figure 9-9</a>.</p>&#13;
<div class="image"><img src="../images/09fig09.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch9fig9"><em>Figure 9-9: An SVG with the complete result</em></p>&#13;
<h4 class="h4" id="ch00lev2sec114"><strong><em>Result</em></strong></h4>&#13;
<p class="noindent">For your reference, <a href="ch09.xhtml#ch9lis17">Listing 9-17</a> contains the finished version of <em>output.py</em>.</p>&#13;
<pre>from geom2d import make_rect_centered, Circle, Point, Vector&#13;
from graphic import svg&#13;
&#13;
&#13;
def draw_to_svg(points: [Point], circle: Circle, config):&#13;
    pt_radius = circle.radius / 20&#13;
    svg_output = output_to_svg(circle, config['output'])&#13;
    svg_input = input_to_svg(points, pt_radius, config['input'])&#13;
&#13;
    viewbox = make_viewbox(circle)&#13;
    svg_img = svg.svg_content(&#13;
        viewbox.size, svg_output + svg_input, viewbox&#13;
    )&#13;
&#13;
    print(svg_img)&#13;
&#13;
&#13;
<span epub:type="pagebreak" id="page_257"/>def output_to_svg(circle: Circle, config):&#13;
    style = style_from_config(config)&#13;
    label_style = label_style_from_config(config)&#13;
&#13;
    return [&#13;
        svg.circle(circle, style),&#13;
        svg.text(&#13;
            f'O {circle.center}',&#13;
            circle.center,&#13;
            Vector(0, 0),&#13;
            label_style&#13;
        ),&#13;
        svg.text(&#13;
            f'r = {circle.radius}',&#13;
            circle.center,&#13;
            Vector(0, 20),&#13;
            label_style&#13;
        )&#13;
    ]&#13;
&#13;
&#13;
def input_to_svg(points: [Point], point_radius: float, config):&#13;
    style = style_from_config(config)&#13;
    label_style = label_style_from_config(config)&#13;
    [a, b, c] = points&#13;
    disp = Vector(1.25 * point_radius, 0)&#13;
&#13;
    return [&#13;
        svg.circle(Circle(a, point_radius), style),&#13;
        svg.circle(Circle(b, point_radius), style),&#13;
        svg.circle(Circle(c, point_radius), style),&#13;
        svg.text(f'A {a}', a, disp, label_style),&#13;
        svg.text(f'B {b}', b, disp, label_style),&#13;
        svg.text(f'C {c}', c, disp, label_style)&#13;
    ]&#13;
&#13;
&#13;
def style_from_config(config):&#13;
    return [&#13;
        svg.stroke_color(config['stroke-color']),&#13;
        svg.stroke_width(config['stroke-width']),&#13;
        svg.fill_color(config['fill-color'])&#13;
    ]&#13;
&#13;
&#13;
def label_style_from_config(config):&#13;
    return [&#13;
        <span epub:type="pagebreak" id="page_258"/>svg.font_size(config['label-size']),&#13;
        svg.font_family(config['font-family']),&#13;
        svg.fill_color(config['stroke-color'])&#13;
    ]&#13;
&#13;
&#13;
def make_viewbox(circle: Circle):&#13;
    height = 2.5 * circle.radius&#13;
    width = 4 * circle.radius&#13;
    return make_rect_centered(circle.center, width, height)</pre>&#13;
<p class="caption"><a id="ch9lis17"/><em>Listing 9-17: Drawing to SVG result</em></p>&#13;
<h4 class="h4" id="ch00lev2sec115"><strong><em>Flip the Y-Axis</em></strong></h4>&#13;
<p class="noindent">As you know by now, the SVG y-axis points downward. Point <em>C</em> at <em>y</em> = 500, for instance, is below <em>A</em> with <em>y</em> = 300. This isn’t necessarily bad, but it may be the opposite of what you’re used to.</p>&#13;
<p class="indent">Here’s a challenge for you: modify <em>output.py</em> so that the SVG produced uses an affine transformation such that the y-axis is flipped and therefore points upward. If you need a clue, go back to the section “Space Transformation” from <a href="ch08.xhtml#ch08">Chapter 8</a>.</p>&#13;
<p class="indent">Note that if you choose to add an affine transformation that flips the y-axis of the entire SVG image, as follows,</p>&#13;
<pre>&lt;svg <span class="codeitalic1">--snip--</span> <span class="codestrong1">transform="matrix(1 0 0 -1 0 0)"</span>&gt;&#13;
    <span class="codeitalic1">--snip--</span>&#13;
&lt;/svg&gt;</pre>&#13;
<p class="noindent">all of the text labels will also flip vertically, which makes them impossible to read. Try to address this problem by also adding an affine transformation to all captions so that you basically flip them twice.</p>&#13;
<p class="indent">This is challenging, but a great exercise for you to try. Don’t worry, we’ll explore this in depth in <a href="part05.xhtml#part05">Part V</a>.</p>&#13;
<h3 class="h3" id="ch00lev1sec60"><strong>Distributing Our Application</strong></h3>&#13;
<p class="noindent">The word has spread among your friends, and they’ve all heard about your achievement: you developed an application that computes the circle passing through three points and plots a beautiful vector image with the result. They know you’ve accomplished this all by yourself, without using any third-party library. They are amazed; “That is so hardcore,” you’ve even heard them say. They want to try it, and they’ve prepared a few input files to test your program. You share the code with them, and as they know Python, they open the shell and try to execute your <em>main.py</em> script, only to discover there’s a strange error that won’t let the program run.</p>&#13;
<p class="indent">It’s unfortunate that to load all the modules that your application uses, there’s a trick that PyCharm does and we need to account for. But don’t <span epub:type="pagebreak" id="page_259"/>worry, we’ll explore why the error happens and give a solution to it. You can use what you’ll learn here to distribute any application that we build in this book, or even those that you write yourself.</p>&#13;
<h4 class="h4" id="ch00lev2sec116"><strong><em>Understanding the Problem</em></strong></h4>&#13;
<p class="noindent">Let’s try to run our recently created program from the shell, without any change, to see whether we get the same result as from the IDE. In the bash shell (the one in your IDE or your system’s), navigate to the app’s directory,</p>&#13;
<pre>$ <span class="codestrong1">cd apps/circle_from_points</span></pre>&#13;
<p class="noindent">and run this:</p>&#13;
<pre>$ <span class="codestrong1">python3 main.py &lt; test.txt</span></pre>&#13;
<p class="noindent">Surprisingly, it doesn’t work:</p>&#13;
<pre>    Traceback (most recent call last):&#13;
      File "main.py", line 6, in &lt;module&gt;&#13;
        from apps.circle_from_points.input import <span class="codeitalic1">--snip--</span>&#13;
    ModuleNotFoundError: No module named 'apps'</pre>&#13;
<p class="noindent">This is the error we get:</p>&#13;
<pre>    ModuleNotFoundError: No module named 'apps'</pre>&#13;
<p class="indent">This is telling us that Python couldn’t find the <span class="literal">apps</span> module when it tried to import it. But if that’s the case, why was it running correctly from the IDE using the run configuration? Well, PyCharm’s run configurations do a trick under the hood, a trick we now need to do ourselves.</p>&#13;
<p class="indent">When a script imports modules, Python looks for them in specific directories. To know what those directories are exactly, you can query them at runtime: Python stores them at <span class="literal">sys.path</span>, which is a list that contains all the paths where Python looks for libraries in your machine. Python also appends the path to the script itself; this path is known as the <em>working directory</em>.</p>&#13;
<p class="indent">The problem that we encountered is that <span class="literal">sys.path</span> doesn’t get the parent path of our project appended. That is unfortunate because this is where it should go to find our <em>geom2d</em>, <em>graphic</em>, and <em>apps</em> packages. PyCharm’s run configuration worked fine because it appends this path to <span class="literal">sys.path</span>. Let’s check this fact by printing the contents of <span class="literal">sys.path</span> to the shell inside the main script and then run it again using the run configuration. Open the <em>main.py</em> file and at the top of the file add the following:</p>&#13;
<pre>import sys&#13;
print(sys.path)&#13;
&#13;
<span class="codeitalic1">--snip--</span></pre>&#13;
<p class="indent">Notice that the <span class="literal">print</span> statement goes right after importing <span class="literal">sys</span> and before the rest of the imports. You may get a PyCharm warning that doing this is <span epub:type="pagebreak" id="page_260"/>conceptually wrong according to PEP-8 standards—ignore that warning. We want that <span class="literal">print</span> right before Python attempts to load anything else; otherwise, we’d get the same error as before when the script is run from the shell and never get to print <span class="literal">sys.path</span>. If you now rerun the project using the run configuration, the output you’ll get should be similar to the following:</p>&#13;
<pre>/usr/local/bin/python3.7 <span class="codeitalic1">--snip--</span>/main.py&#13;
Input is being redirected from <span class="codeitalic1">--snip--</span>/test.txt&#13;
Console output is saving to: <span class="codeitalic1">--snip--</span>/result.svg&#13;
&#13;
['<span class="codeitalic1">--snip--</span>/Mechanics/apps/circle_from_points',&#13;
<span class="codestrongitalic1">'--snip--/Mechanics',</span>&#13;
'<span class="codeitalic1">--snip--</span>/Python.framework/Versions/3.7/lib/python37.zip',&#13;
'<span class="codeitalic1">--snip--</span>/Python.framework/Versions/3.7/lib/python3.7',&#13;
'<span class="codeitalic1">--snip--</span>/Python.framework/Versions/3.7/lib/python3.7/lib-dynload',&#13;
'<span class="codeitalic1">--snip--</span>/Python/3.7/lib/python/site-packages',&#13;
'/usr/local/lib/python3.7/site-packages']</pre>&#13;
<p class="indent">Can you spot the second line (in bold) from the <span class="literal">sys.path</span> list? That line is the key to solving the problem of not finding the included modules inside our program. Let’s run the script now from the shell to see what that list of paths contains. In the IDE’s shell, navigate to the app’s directory and run this:</p>&#13;
<pre>$ <span class="codestrong1">python3 main.py &lt; test.txt</span></pre>&#13;
<p class="noindent">This time the output is as follows:</p>&#13;
<pre>['<span class="codeitalic1">--snip--</span>/Mechanics/apps/circle_from_points',&#13;
'<span class="codeitalic1">--snip--</span>/Python.framework/Versions/3.7/lib/python37.zip',&#13;
'<span class="codeitalic1">--snip--</span>/Python.framework/Versions/3.7/lib/python3.7',&#13;
'<span class="codeitalic1">--snip--</span>/Python.framework/Versions/3.7/lib/python3.7/lib-dynload',&#13;
'<span class="codeitalic1">---snip--</span>/Python/3.7/lib/python/site-packages',&#13;
'/usr/local/lib/python3.7/site-packages']</pre>&#13;
<p class="noindent">Can you see how the <em>Mechanics</em> directory isn’t listed here as a search path? If that directory isn’t included, Python won’t be able to find any module from that route when running our application.</p>&#13;
<p class="indent">Delete the two lines you added to <em>main.py</em> so that the file looks like it did before, and let’s explore some possible solutions.</p>&#13;
<h4 class="h4" id="ch00lev2sec117"><strong><em>Finding a Solution</em></strong></h4>&#13;
<p class="noindent">The problem is clear: Python can’t load our libraries since it doesn’t have their parent directory listed as a search path. Let’s see how we can solve this. We’ll present two options, so we’ll try to understand their pros and cons before we decide which one works best for us.</p>&#13;
<h5 class="h5" id="ch00lev3sec56"><span epub:type="pagebreak" id="page_261"/><strong>Appending to sys.path</strong></h5>&#13;
<p class="noindent">One possible solution is to do what PyCharm’s run configuration does: append the parent directory of our project to <span class="literal">sys.path</span> before Python attempts to import anything from it. We could modify <em>main.py</em> so that it looks like <a href="ch09.xhtml#ch9lis18">Listing 9-18</a>.</p>&#13;
<pre>  import os&#13;
  import sys&#13;
&#13;
<span class="ent">➊</span> parent_path = os.path.normpath(os.path.join(os.getcwd(), '..', '..'))&#13;
<span class="ent">➋</span> sys.path.append(parent_path)&#13;
&#13;
  from apps.circle_from_points.input import parse_points, read_config&#13;
  from apps.circle_from_points.output import draw_to_svg&#13;
  from geom2d import make_circle_from_points&#13;
&#13;
&#13;
  if __name__ == '__main__':&#13;
      (a, b, c) = parse_points()&#13;
      circle = make_circle_from_points(a, b, c)&#13;
      draw_to_svg((a, b, c), circle, read_config())</pre>&#13;
<p class="caption"><a id="ch9lis18"/><em>Listing 9-18: Appending to <span class="codeitalic1">sys.path</span></em></p>&#13;
<p class="indent">We first import both the <span class="literal">os</span> and <span class="literal">sys</span> modules. We then compute the project’s parent path by obtaining the current working directory (<span class="literal">os.getcwd()</span>) and navigating two steps back (’<span class="literal">..</span>’<span class="literal">,</span> ’<span class="literal">..</span>’) <span class="ent">➊</span>.</p>&#13;
<p class="indent">We’re using the <span class="literal">os.path.normpath</span> function to normalize the path so that it doesn’t contain the dots representing a backward movement in the directory tree. This function transforms a path like</p>&#13;
<p class="pre2">    /Documents/MechBook/code/Mechanics/../..</p>&#13;
<p class="noindent">into the following:</p>&#13;
<p class="pre2">    /Documents/MechBook</p>&#13;
<p class="indent">That path is appended to <span class="literal">sys.path</span> before any other import attempts to load anything from our project <span class="ent">➋</span>. If you run the app from the shell, it should run error free.</p>&#13;
<pre>$ <span class="codestrong1">python3 main.py &lt; test.txt</span></pre>&#13;
<p class="indent">This solution works, but it still seems a bit awkward that we have to make users navigate into the <em>apps/circle_from_points</em> directory to run our script: it’d be more convenient if we could run the program from the parent directory of our project. Furthermore, the lines we added to <em>main.py</em> look a bit ugly and have nothing to do with solving the problem of finding the circle passing through three points. We don’t want to add those lines to every application that we implement; that’s unnecessary complexity we want to avoid.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_262"/>Let’s try a different approach that doesn’t involve changing the code in our main script: let’s create a bash script that appends the right working directory path to the Python script’s execution. Start by undoing what we did in <a href="ch09.xhtml#ch9lis18">Listing 9-18</a> so your <em>main.py</em> file looks the same as in <a href="ch09.xhtml#ch9lis10">Listing 9-10</a>.</p>&#13;
<h5 class="h5" id="ch00lev3sec57"><strong>Wrapping the App with a Script</strong></h5>&#13;
<p class="noindent">For what we just saw in the previous section, every package that our <em>main.py</em> script needs to run should be accessible either from the working directory or from any other path listed in <span class="literal">sys.path</span>.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>Remember that the working directory is where the executing file (in this case</em> main.py<em>) is located.</em></p>&#13;
</div>&#13;
<p class="indent">Apart from appending paths to <span class="literal">sys.path</span> inside our Python code, we can also include paths in an <em>environment variable</em>: <span class="literal">PYTHONPATH</span>. When a Python script is run, it includes all paths defined in <span class="literal">PYTHONPATH</span> inside its <span class="literal">sys.path</span>.</p>&#13;
<p class="indent">We can therefore create a bash script at the project’s top level, which sets the right paths in <span class="literal">PYTHONPATH</span> and then executes our app’s <em>main.py</em>. Remember that we use bash scripts to group a set of command line statements and run them together by executing a single file (revisit <a href="ch03.xhtml#ch03">Chapter 3</a> for a refresher).</p>&#13;
<p class="indent">At the top level of the project (at the same level as <em>geom2d</em> or <em>apps</em>), create a new file named <em>cifpts.sh</em> (an abbreviation of “circle from points”). In it, write the line in <a href="ch09.xhtml#ch9lis19">Listing 9-19</a>.</p>&#13;
<pre>PYTHONPATH=$PWD python3 apps/circle_from_points/main.py</pre>&#13;
<p class="caption"><a id="ch9lis19"/><em>Listing 9-19: Wrapper script</em></p>&#13;
<p class="indent">The first thing we do in this line is define an environment variable <span class="literal">PYTHONPATH</span> with a value set to the current directory; the current directory is stored inside another Unix environment variable: <span class="literal">PWD</span>.</p>&#13;
<p class="indent">Then, in the same line, we run <em>main.py</em> in <em>apps/circle_from_points</em>. Having the definition of <span class="literal">PYTHONPATH</span> in the same line where the script is run scopes the environment variable to the execution of the script only. This means that once the script is done, the variable doesn’t exist anymore.</p>&#13;
<p class="indent">Let’s try running the script from the shell passing the file <em>test.txt</em>:</p>&#13;
<pre>$ <span class="codestrong1">bash cifpts.sh &lt; apps/circle_from_points/test.txt</span></pre>&#13;
<p class="noindent">That should’ve printed the SVG output to the shell. We can even make the bash script appear as an executable by changing its user rights:</p>&#13;
<pre>$ <span class="codestrong1">chmod +x cifpts.sh</span></pre>&#13;
<p class="noindent">This allows us to further simplify the execution:</p>&#13;
<pre>$ <span class="codestrong1">./cifpts.sh &lt; apps/circle_from_points/test.txt</span></pre>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_263"/>Remember that the output needs to be redirected to a file if we want the result written to it instead of being printed to the shell:</p>&#13;
<pre>$ <span class="codestrong1">./cifpts.sh &lt; apps/circle_from_points/test.txt &gt; result.svg</span></pre>&#13;
<p class="indent">This looks more like something we want to share with our friends, all of whom have longed to have a script that computes the circle that passes through any three points.</p>&#13;
<h4 class="h4" id="ch00lev2sec118"><strong><em>Running the App Without an Input File</em></strong></h4>&#13;
<p class="noindent">It’s interesting to note that although we’ve been passing the script a file containing the definition of three points by their coordinates, our code just expects three lines from the standard input. This means we don’t have to create a file to pass our script. We can simply execute the script and write the expected input. If you try this in the shell,</p>&#13;
<pre>$ <span class="codestrong1">./cifpts.sh &gt; result.svg</span>&#13;
$ <span class="codestrong1">300 300</span>&#13;
$ <span class="codestrong1">700 400</span>&#13;
$ <span class="codestrong1">300 500</span></pre>&#13;
<p class="noindent">you’ll get an image named <em>result.svg</em> with the result inside the current directory. As you see, you can directly give your program its input data from the shell.</p>&#13;
<h3 class="h3" id="ch00lev1sec61"><strong>Summary</strong></h3>&#13;
<p class="noindent">In this chapter, we’ve developed our first application: a command line tool that reads a file, parses it using regular expressions, and produces a beautiful SVG vector image. This application has integrated a lot of knowledge that we’ve been acquiring throughout the past chapters and has taught us about regular expressions.</p>&#13;
<p class="indent">We also analyzed the problem that caused our modules to not be found by Python when the application was run from the shell. We learned that this happened because our project’s root folder, <em>Mechanics</em>, wasn’t part of the list of directories Python uses to resolve imports. You can now easily distribute your <em>Mechanics</em> project to your friends so that they can play with the applications that we’ll be creating throughout the book, which will conveniently be wrapped into top-level bash scripts.<span epub:type="pagebreak" id="page_264"/></p>&#13;
</body></html>