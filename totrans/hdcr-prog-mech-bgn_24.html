<html><head></head><body>
<h2 class="h2" id="ch19"><span epub:type="pagebreak" id="page_529"/><span class="big">19</span><br/>ASSEMBLING OUR APPLICATION</h2>&#13;
<div class="image1"><img src="../images/common01.jpg" alt="Image"/></div>&#13;
<p class="noindent">We’ve implemented all the pieces of our truss structure application, so now it’s time to assemble them into something we can run from the command line. The application we’ll write this chapter will parse an input file into the structure model, use the <span class="literal">solve_structure</span> method from the <span class="literal">Structure</span> class to assemble the solved structure, and then use the functions we implemented in the previous chapter to create an SVG diagram and text file describing the solution.</p>&#13;
<h3 class="h3" id="ch00lev1sec113"><strong>A General Overview</strong></h3>&#13;
<p class="noindent">To get an overview of how we’ll assemble the different modules into a final application, let’s take a look at <a href="ch19.xhtml#ch19fig1">Figure 19-1</a>. This figure illustrates the stages that take place when our application is executed.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_530"/><img src="../images/19fig01.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch19fig1"><em>Figure 19-1: Structure resolution steps</em></p>&#13;
<p class="indent">First, our application is given a text file defining the structure. This file is formatted according to the rules we defined in <a href="ch17.xhtml#ch17">Chapter 17</a>. In the first step, we’ll read the contents of the file into a string that’s then parsed into a model built from our structure classes.</p>&#13;
<p class="indent">Once the structure model is constructed, the <span class="literal">Structure</span> class’s <span class="literal">solve</span> <span class="literal">_structure</span> method does the analysis and creates a structure solution model. If you recall, the <span class="literal">StructureSolution</span> class is the top-level entity representing the solution.</p>&#13;
<p class="indent">The last step is to save the result in the form of a diagram (into an SVG file) and in the form of a text report (into a plaintext file). Thus, our program’s output will be two files.</p>&#13;
<p class="indent">Before we can do anything, though, we first need to set up a new directory for our application.</p>&#13;
<h3 class="h3" id="ch00lev1sec114"><strong>Setup</strong></h3>&#13;
<p class="noindent">First, let’s create a new package in the <em>apps</em> directory. Name it <em>truss_structures</em>. Your directory should look like the following:</p>&#13;
<p class="pre2">    apps<br/>      |- aff_transf_motion<br/>      |   |- ...<br/>      |- circle_from_points<br/>      |   |- ...<br/>      |- truss_structures<br/>      |    |- __init__.py</p>&#13;
<p class="indent">If you created the package folder as a regular folder, don’t forget to include an empty <em>__init__.py</em> file to make it a Python package. In the package, let’s now add the main file. Create a new Python file named <em>main.py</em>, and in it, simply add the following lines:</p>&#13;
<pre>if __name__ == '__main__':&#13;
    print('Main')</pre>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_531"/>Your <em>truss_structures</em> package should now contain two files:</p>&#13;
<p class="pre2">    truss_structures<br/>      |- __init__.py<br/>      |- main.py</p>&#13;
<p class="indent">In this chapter, we won’t be using a run configuration inside our IDE; we’ll instead rely on a bash script that wraps the program. Let’s prepare the script now so we can use it throughout the chapter. At the top of the project directory, in the <em>Mechanics</em> folder, create a new bash file and name it <em>truss.sh</em>. Enter the code in <a href="ch19.xhtml#ch19lis1">Listing 19-1</a>.</p>&#13;
<pre>#!/usr/bin/env bash&#13;
PYTHONPATH=$PWD python3 apps/truss_structures/main.py $@</pre>&#13;
<p class="caption"><a id="ch19lis1"/><em>Listing 19-1: Bash wrapper script</em></p>&#13;
<p class="noindent">We have to change the permissions on the file to make it executable. From the shell, run the following:</p>&#13;
<pre>$ <span class="codestrong1">chmod +x truss.sh</span></pre>&#13;
<p class="indent">If you run this script from the shell,</p>&#13;
<pre>$ <span class="codestrong1">./truss.sh</span></pre>&#13;
<p class="noindent">you should see ’<span class="literal">Main</span>’ printed out. We’re all set up; let’s start coding!</p>&#13;
<h3 class="h3" id="ch00lev1sec115"><strong>Input Arguments</strong></h3>&#13;
<p class="noindent">Our command line application is going to accept a few arguments: the overall scale of the drawing, the scale of the node displacements, the scale of the loads, and whether the original geometry should be drawn (see <a href="ch18.xhtml#ch18tab1">Table 18-1</a> on <a href="ch18.xhtml#ch18tab1">page 497</a> for a refresher).</p>&#13;
<p class="indent">We pass these arguments to our program like so:</p>&#13;
<pre>$ <span class="codestrong1">./truss.sh --scale=1.25 --disp-scale=100 --load-scale=0.1 --no-draw-original</span></pre>&#13;
<p class="indent">We want to read these arguments, parse their values, and use a default value if the user doesn’t provide a value. We can do this using a handy tool from Python’s standard library: <em>argparse</em>. Argparse will also generate help messages about the different arguments for the user and validate the passed-in values.</p>&#13;
<p class="indent">Create a new file in the <em>apps/truss_structures</em> package named <em>arguments.py</em>. Your <em>truss_structures</em> package should now look like this:</p>&#13;
<p class="pre2">    truss_structures<br/>      |- __init__.py<br/>      |- arguments.py<br/>      |- main.py</p>&#13;
<p class="indent">Enter the code in <a href="ch19.xhtml#ch19lis2">Listing 19-2</a>.<span epub:type="pagebreak" id="page_532"/></p>&#13;
<pre>import argparse&#13;
&#13;
&#13;
def parse_arguments():&#13;
 <span class="ent">➊</span> parser = argparse.ArgumentParser(&#13;
        description='Solves a truss structure'&#13;
    )&#13;
&#13;
 <span class="ent">➋</span> parser.add_argument(&#13;
        '--scale',&#13;
        help='scale applied to the geometry (for plotting)',&#13;
        default=2,&#13;
        type=float&#13;
    )&#13;
&#13;
 <span class="ent">➌</span> parser.add_argument(&#13;
        '--disp-scale',&#13;
        help='scale applied to the displacements (for plotting)',&#13;
        default=500,&#13;
        type=float&#13;
    )&#13;
&#13;
 <span class="ent">➍</span> parser.add_argument(&#13;
        '--load-scale',&#13;
        help='scale applied to the loads (for plotting)',&#13;
        default=0.02,&#13;
        type=float&#13;
    )&#13;
&#13;
 <span class="ent">➎</span> parser.add_argument(&#13;
        '--no-draw-original',&#13;
        help='Should draw the original geometry?',&#13;
        action='store_true'&#13;
    )&#13;
&#13;
 <span class="ent">➏</span> return parser.parse_args()</pre>&#13;
<p class="caption"><a id="ch19lis2"/><em>Listing 19-2: Parsing the command line arguments</em></p>&#13;
<p class="indent">In this file, we define a function named <span class="literal">parse_arguments</span>. This function configures an instance of the <span class="literal">ArgumentParser</span> <span class="ent">➊</span> class to identify our arguments and parse them. We pass the constructor a description of what our program does. This will be used as a help message if the user passes in the <span class="literal">--help</span> flag, like so:</p>&#13;
<pre>$ <span class="codestrong1">./truss.sh --help</span></pre>&#13;
<p class="noindent"><span epub:type="pagebreak" id="page_533"/>This provides the user with the following description:</p>&#13;
<pre>usage: main.py [--help] [--scale SCALE] [--disp-scale DISP_SCALE]&#13;
               [--load-scale LOAD_SCALE] [--no-draw-original]&#13;
&#13;
Solves a truss structure&#13;
&#13;
optional arguments:&#13;
  -h, --help            show this help message and exit&#13;
  --scale SCALE         scale applied to the geometry (for plotting)&#13;
  --disp-scale DISP_SCALE&#13;
                        scale applied to the displacements (for plotting)&#13;
  --load-scale LOAD_SCALE&#13;
                        scale applied to the loads (for plotting)&#13;
  --no-draw-original    Should draw the original geometry?</pre>&#13;
<p class="indent">The first argument we add is <span class="literal">--scale</span> <span class="ent">➋</span>; we give it a help message and a default value of 2, and we set its type to be a floating-point number.</p>&#13;
<p class="indent">Then comes the <span class="literal">--disp-scale</span> argument <span class="ent">➌</span> with a default value of 500. Don’t forget that the displacements are usually small compared to the size of the bars, so we’ll need a big scale to appreciate them. Each structure solution has a different order of magnitude for the displacements, so this scale is better adjusted by trial and error.</p>&#13;
<p class="indent">Next comes the <span class="literal">--load-scale</span> argument <span class="ent">➍</span> with a default value of 0.02. This scale will shrink the loads so that they fit inside the drawing.</p>&#13;
<p class="indent">Last comes the <span class="literal">--no-draw-original</span> flag <span class="ent">➎</span>, which controls whether we draw the original structure’s geometry. If the flag isn’t present in the arguments, we’ll draw the original geometry but use a lighter color to keep the focus on the solution drawing. This will look something like <a href="ch19.xhtml#ch19fig2">Figure 19-2</a>.</p>&#13;
<div class="image"><img src="../images/19fig02.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch19fig2"><em>Figure 19-2: Drawing the original geometry (in a lighter color)</em></p>&#13;
<p class="indent">The <span class="literal">--no-draw-original</span> flag is different than the other parameters: it’s not expecting an associated value; we only care whether the flag appears in the parameters list. We add this flag to the parser using the <span class="literal">add_argument</span> method with an <span class="literal">action</span> parameter. When this argument is found in the arguments list, an action is executed. In this case, we use the ’<span class="literal">store_true</span>’ action, which simply saves a <span class="literal">True</span> value in the argument if the flag is present and a <span class="literal">False</span> otherwise. There are a few actions defined in the <em>argsparse</em> package, which you can browse in the documentation. We’ll need only ’<span class="literal">store_true</span>’.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_534"/>The last line returns the result of calling the <span class="literal">parse_args</span> method <span class="ent">➏</span>. This method reads the arguments from <span class="literal">sys.argv</span>, which is where Python stores the arguments passed to a program, and parses the values following the rules we defined earlier.</p>&#13;
<p class="indent">The result is a dictionary-like structure with the values for the parameters. As we’ll see later, the names for the keys of the dictionary are the same as the arguments, but without the initial dashes (<span class="literal">--</span>) and with underscores instead of the middle dashes. For example, <span class="literal">--load-scale</span> becomes <span class="literal">load_scale</span>, a much more Pythonic name for a variable. In addition, the dash isn’t allowed for variable names in Python.</p>&#13;
<p class="indent">Let’s now write the code that generates the application’s output files.</p>&#13;
<h3 class="h3" id="ch00lev1sec116"><strong>Generating the Output</strong></h3>&#13;
<p class="noindent">We prepared two functions in the previous chapter that generate both the SVG and text solution representations. We’ll use these functions in the app and write their results to an external file.</p>&#13;
<p class="indent">First, create a new file named <em>output.py</em>. Your <em>truss_structures</em> package should now look like the following:</p>&#13;
<p class="pre2">    truss_structures<br/>      |- __init__.py<br/>      |- arguments.py<br/>      |- main.py<br/>      |- output.py</p>&#13;
<p class="noindent">In <em>output.py</em>, enter the code in <a href="ch19.xhtml#ch19lis3">Listing 19-3</a>.</p>&#13;
<pre>import os&#13;
&#13;
from structures.out.svg import structure_solution_to_svg&#13;
from structures.out.text import structure_solution_to_string&#13;
from structures.solution.structure import StructureSolution&#13;
&#13;
&#13;
def save_solution_to_svg(solution: StructureSolution, arguments):&#13;
 <span class="ent">➊</span> solution_svg = structure_solution_to_svg(solution, arguments)&#13;
    __write_to_file('result.svg', solution_svg)&#13;
&#13;
def save_solution_to_text(solution: StructureSolution):&#13;
 <span class="ent">➋</span> solution_text = structure_solution_to_string(solution)&#13;
    __write_to_file('result.txt', solution_text)&#13;
&#13;
def __write_to_file(filename, content):&#13;
 <span class="ent">➌</span> file_path = os.path.join(os.getcwd(), filename)&#13;
 <span class="ent">➍</span> with open(file_path, 'w') as file:&#13;
        <span epub:type="pagebreak" id="page_535"/>file.write(content)</pre>&#13;
<p class="caption"><a id="ch19lis3"/><em>Listing 19-3: Handling the structure output</em></p>&#13;
<p class="indent">We define three functions: one for saving the solution into an SVG image file (<span class="literal">save_solution_to_svg</span>), another one that saves the solution in a text file (<span class="literal">save_solution_to_text</span>), and a third function that creates a new file and saves it in the current working directory (<span class="literal">__write_to_file</span>).</p>&#13;
<p class="indent">The <span class="literal">save_solution_to_svg</span> function calls the <span class="literal">structure_solution_to_svg</span> function from the previous chapter <span class="ent">➊</span> and passes the generated SVG string to the <span class="literal">__write_to_file</span> function. Note that we pass the command line argument’s dictionary to this function; these are the settings we use to generate the SVG vector image. For this to work, we have to make sure the command line arguments are parsed using the same name as the settings expected by <span class="literal">structure_solution_to_svg</span>. After the SVG diagram is created, we use <span class="literal">__write_to_file</span> to create a file named <em>result.svg</em> in the program’s working directory.</p>&#13;
<p class="indent">The <span class="literal">save_solution_to_text</span> function is similar to <span class="literal">save_solution_to_svg</span>: it produces the text result using the <span class="literal">structure_solution_to_string</span> function <span class="ent">➋</span> and then writes the results to a <em>result.txt</em> file.</p>&#13;
<p class="indent">In <span class="literal">__write_to_file</span>, the first thing we do is figure out the file path by joining the current working directory with the filename (which should already include the extension). We then store the file path in the <span class="literal">file_path</span> variable <span class="ent">➌</span>. Lastly, we use the <span class="literal">with</span> block to open the file in write mode (’<span class="literal">w</span>’), which creates the file if it doesn’t exist, and then we write the passed-in <span class="literal">content</span> string to the file <span class="ent">➍</span>.</p>&#13;
<p class="indent">We’re almost done! We just need to stitch the input, resolution, and output together.</p>&#13;
<h3 class="h3" id="ch00lev1sec117"><strong>The Main Script</strong></h3>&#13;
<p class="noindent">Let’s head back to the <em>main.py</em> file. Open it and enter the code in <a href="ch19.xhtml#ch19lis4">Listing 19-4</a> (you can delete the <span class="literal">print(</span>’<span class="literal">Main</span>’<span class="literal">)</span> line we wrote earlier).</p>&#13;
<pre>import sys&#13;
import time&#13;
&#13;
import apps.truss_structures.output as out&#13;
from apps.truss_structures.arguments import parse_arguments&#13;
from structures.parse.str_parse import parse_structure_from_lines&#13;
&#13;
if __name__ == '__main__':&#13;
 <span class="ent">➊</span> arguments = parse_arguments()&#13;
 <span class="ent">➋</span> lines = sys.stdin.readlines()&#13;
&#13;
    start_time = time.time()&#13;
&#13;
 <span class="ent">➌</span> structure = parse_structure_from_lines(lines)&#13;
 <span class="ent">➍</span> solution = structure.solve_structure()&#13;
    <span epub:type="pagebreak" id="page_536"/>out.save_solution_to_svg(solution, arguments)&#13;
    out.save_solution_to_text(solution)&#13;
&#13;
    end_time = time.time()&#13;
    elapsed_secs = end_time - start_time&#13;
 <span class="ent">➎</span> print(f'Took {round(elapsed_secs, 3)} seconds to solve')</pre>&#13;
<p class="caption"><a id="ch19lis4"/><em>Listing 19-4: Main script</em></p>&#13;
<p class="indent">In the “if name is main” block, we parse the arguments passed to the script from the command line. To do this, we use our <span class="literal">parse_arguments</span> function <span class="ent">➊</span>, which we import from the <em>arguments.py</em> module. If this parsing fails, because a required flag was left out or something similar, the execution halts, and a helpful message is sent to the user.</p>&#13;
<p class="indent">Once the arguments are parsed, we read all of the lines passed to the program via the standard input and save them in the <span class="literal">lines</span> variable <span class="ent">➋</span>.</p>&#13;
<p class="indent">Next, we parse those passed-in lines to create the structure model using the <span class="literal">parse_structure_from_lines</span> function <span class="ent">➌</span> we developed in <a href="ch17.xhtml#ch17">Chapter 17</a>. Once we have the structure model, we call its <span class="literal">solve_structure</span> method to compute the solution <span class="ent">➍</span>.</p>&#13;
<p class="indent">Then, we call the two functions we wrote in the previous section to produce the output files: <span class="literal">save_solution_to_svg</span> and <span class="literal">save_solution_to_text</span>.</p>&#13;
<p class="indent">Lastly, we calculate the time the program took to run to have it as a reference and compare how long it takes to solve structures of different sizes. We stored the time in the <span class="literal">start_time</span> variable before we started to parse and compute the structure. We also stored the time in <span class="literal">end_time</span> just after generating the output files. Subtracting <span class="literal">start_time</span> from <span class="literal">end_time</span> yields the elapsed seconds, the amount of time our app took to produce the results. We print this resulting time in seconds before the application execution finishes <span class="ent">➎</span>.</p>&#13;
<p class="indent">I’m sure you’re as excited as I am to try our new app. Let’s write a structure file by hand and solve it.</p>&#13;
<h3 class="h3" id="ch00lev1sec118"><strong>Trying the App</strong></h3>&#13;
<p class="noindent">Let’s create a structure file to try the app. <a href="ch19.xhtml#ch19fig3">Figure 19-3</a> illustrates four common truss configurations found in bridges. From these standard designs, we’ll pick the Warren typology for our first test. We’ll write a file by hand defining a structure following this configuration of the bars in the truss.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_537"/><img src="../images/19fig03.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch19fig3"><em>Figure 19-3: Truss typologies</em></p>&#13;
<p class="indent">Create a new file named <em>warren.txt</em> inside <em>apps/truss_structures</em>. Enter the following structure definition:</p>&#13;
<pre># Warren truss with 4 spans&#13;
&#13;
nodes&#13;
# lower nodes&#13;
1: (0.0, 0.0) (xy)&#13;
2: (400.0, 0.0) ()&#13;
3: (800.0, 0.0) ()&#13;
4: (1200.0, 0.0) ()&#13;
5: (1600.0, 0.0) (y)&#13;
# upper nodes&#13;
6: (400.0, 300.0) ()&#13;
7: (800.0, 300.0) ()&#13;
8: (1200.0, 300.0) ()&#13;
&#13;
loads&#13;
6 -&gt; (2500.0, -5000.0)&#13;
7 -&gt; (2500.0, -5000.0)&#13;
8 -&gt; (2500.0, -5000.0)&#13;
&#13;
<span epub:type="pagebreak" id="page_538"/>bars&#13;
# horizontal bars&#13;
1: (1 -&gt; 2) 20.0 20000000.0&#13;
2: (2 -&gt; 3) 20.0 20000000.0&#13;
3: (3 -&gt; 4) 20.0 20000000.0&#13;
4: (4 -&gt; 5) 20.0 20000000.0&#13;
5: (6 -&gt; 7) 20.0 20000000.0&#13;
6: (7 -&gt; 8) 20.0 20000000.0&#13;
# vertical bars&#13;
7: (2 -&gt; 6) 15.0 20000000.0&#13;
8: (3 -&gt; 7) 15.0 20000000.0&#13;
9: (4 -&gt; 8) 15.0 20000000.0&#13;
# diagonal bars&#13;
10: (1 -&gt; 6) 30.0 20000000.0&#13;
11: (6 -&gt; 3) 30.0 20000000.0&#13;
12: (3 -&gt; 8) 30.0 20000000.0&#13;
13: (8 -&gt; 5) 30.0 20000000.0</pre>&#13;
<p class="noindent">Alternatively, to avoid writing all this yourself, you may copy and paste the contents of the file provided in the code that accompanies the book. <a href="ch19.xhtml#ch19fig4">Figure 19-4</a> might help you visually understand how the nodes and bars are arranged in our Warren structure example file.</p>&#13;
<div class="image"><img src="../images/19fig04.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch19fig4"><em>Figure 19-4: Warren truss structure to test our app</em></p>&#13;
<p class="indent">Now it’s time to solve this structure and see the beautiful results our app produces. From the shell, run the following:</p>&#13;
<pre>$ <span class="codestrong1">./truss.sh --scale=1.25 --disp-scale=250 &lt; apps/truss_structures/warren.txt</span></pre>&#13;
<p class="noindent">This should print to the shell:</p>&#13;
<pre>Took 0.058 seconds to solve</pre>&#13;
<p class="indent">In the previous command, we execute the bash script that wraps our code and passes it two arguments: a global drawing scale of 1.25 and a displacement scale of 250. The other arguments will use their default values, which if you recall are a load scale of 0.02 and <span class="literal">False</span> for the <span class="literal">--no-draw-original</span> flag.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_539"/>Two new files should have appeared in your project, at the same level as the <em>truss.sh</em> bash file: <em>result.svg</em> and <em>result.txt</em>. If you open the second, the textual representation of the solution, you’ll see something like <a href="ch19.xhtml#ch19lis5">Listing 19-5</a>.</p>&#13;
<pre>NODE 1&#13;
    original position: (0.0, 0.0)&#13;
    displacement: (0.0, 0.0) with norm 0.0&#13;
    displaced position: (0.0, 0.0)&#13;
    reaction: (-7513.0363, 6089.8571) with norm 9671.1981&#13;
&#13;
<span class="codeitalic1">--snip--</span>&#13;
&#13;
NODE 8&#13;
    original position: (1200.0, 300.0)&#13;
    displacement: (0.0185, -0.0693) with norm 0.0717&#13;
    displaced position: (1200.0185, 299.9307)&#13;
&#13;
------------------------------------------&#13;
&#13;
&#13;
BAR 1 (1 → 2) : ⊕ TENSION&#13;
    Δ<span class="codeitalic1">l</span> (elongation) = 0.0156&#13;
    ϵ  (strain)     = 3.908e-05&#13;
    σ  (stress)     = 781.5951&#13;
&#13;
<span class="codeitalic1">--snip--</span>&#13;
&#13;
BAR 13 (8 → 5) : ⊖ COMPRESSION&#13;
    Δ<span class="codeitalic1">l</span> (elongation) = -0.0124&#13;
    ϵ  (strain)     = -2.473e-05&#13;
    σ  (stress)     = -494.5523</pre>&#13;
<p class="caption"><a id="ch19lis5"/><em>Listing 19-5: Warren truss plaintext solution</em></p>&#13;
<p class="indent">The plaintext solution report is useful for checking all the solution values. For instance, you can check the reactions in nodes 1 and 5 (the externally constrained nodes). The node with an ID of 1 (<span class="literal">NODE</span> <span class="literal">1</span>), which is externally constrained in both the horizontal and vertical directions, has an approximate reaction force of <img class="inline" src="../images/Rvictor_caps.jpg" alt="Image"/> = ⟨–7513, 6090⟩. The displacement of this node is necessarily zero. The node with an ID of 5 (<span class="literal">NODE</span> <span class="literal">5</span>), which is constrained only in the vertical direction, has a displacement vector of <img class="inline" src="../images/uvictorit.jpg" alt="Image"/> = ⟨0.055, 0.0⟩.</p>&#13;
<p class="indent">Take a look at the section of each bar section now. You can readily identify the compressed and elongated bars and check their elongation, strain, and stress values. This report gives us all the data we need if we want to analyze the structure under the given loads.</p>&#13;
<p class="indent">The best part is inside the <em>result.svg</em> file. Open the resulting image in your favorite browser. Your result should look like <a href="ch19.xhtml#ch19fig5">Figure 19-5</a>.</p>&#13;
<div class="image"><img src="../images/19fig05.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch19fig5"><span epub:type="pagebreak" id="page_540"/><em>Figure 19-5: Warren solution diagram</em></p>&#13;
<p class="indent">As you can see on your screen, the bars are colored in red if subject to compression and green if subject to tension. The captions aligned to the bars indicate their stress. The original geometry is drawn in the background using a light-blue color, which gives us a better visualization of how the loads deform the structure.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>&#13;
<p class="notep"><em>You can view SVG images in PyCharm, but if we try to open and visualize our diagrams inside the IDE, you’ll be surprised to see them upside down. Don’t panic: you haven’t gotten it wrong. It’s just that (as of the 2021.1 version) PyCharm doesn’t support the</em> <span class="literal">transform</span> <em>attribute we added to the SVG, which, if you recall from earlier, we require to flip the y-axis. I recommend using a browser instead.</em></p>&#13;
</div>&#13;
<p class="indent">Can you see the difference in the bars’ line thickness? Using line thickness to represent the cross section of the bars helps us identify the bars of the structure that can withstand a greater load. The stress labels we added to the bars allow us to readily inspect the stress on each bar, giving us one of the most important pieces of information upfront. We can gather quite a bit of information from just a single glance at our diagram; this is precisely the value of these sorts of graphical representations.</p>&#13;
<p class="indent">To understand what the arguments to our program do, let’s play around with them and see what kind of results we can get.</p>&#13;
<h4 class="h4" id="ch00lev2sec209"><strong><em>Playing with the Arguments</em></strong></h4>&#13;
<p class="noindent">Let’s first check what happens if we pass the <span class="literal">--no-draw-original</span> flag:</p>&#13;
<pre>$ <span class="codestrong1">./truss.sh --scale=1.25 --disp-scale=250 --no-draw-original&#13;
  &lt; apps/truss_structures/warren.txt</span></pre>&#13;
<p class="indent">If you open the <em>result.svg</em> image in your favorite browser, you should see the image in <a href="ch19.xhtml#ch19fig6">Figure 19-6</a>.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_541"/><img src="../images/19fig06.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch19fig6"><em>Figure 19-6: Warren solution diagram without original geometry</em></p>&#13;
<p class="indent">Without the original geometry we can see the deformed structure with less clutter; at the same time, we cannot see how the nodes and bars are moving relative to their original position.</p>&#13;
<p class="indent">What about using a larger displacement scale? Let’s try the following:</p>&#13;
<pre>$ <span class="codestrong1">./truss.sh --scale=1.25 --disp-scale=500&#13;
  &lt; apps/truss_structures/warren.txt</span></pre>&#13;
<p class="indent">Using a displacement scale of 500 exaggerates the deformations so we can see them clearly. The diagram should now look like <a href="ch19.xhtml#ch19fig7">Figure 19-7</a>.</p>&#13;
<div class="image"><img src="../images/19fig07.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch19fig7"><em>Figure 19-7: Warren solution diagram with a larger displacement scale</em></p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_542"/>We haven’t used the loads diagram yet; we’ve been using the default value of 0.02. Let’s try to edit this value to see its effect:</p>&#13;
<pre>$ <span class="codestrong1">/truss.sh --scale=1.25 --disp-scale=400 --load-scale=0.01&#13;
  &lt; apps/truss_structures/warren.txt</span></pre>&#13;
<p class="indent">If we use a load scale of 0.01, half of what we’ve used so far, you can see that the load vectors’ lengths have shrunk, as in <a href="ch19.xhtml#ch19fig8">Figure 19-8</a>.</p>&#13;
<div class="image"><img src="../images/19fig08.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch19fig8"><em>Figure 19-8: Warren solution diagram with a smaller load scale</em></p>&#13;
<p class="indent">As you can see, the load scale is important for the correct visualization of the load vectors. A small value shrinks the vectors so much that there’s no space for their labels to be nicely placed. You can try a larger load scale, say 0.5. The labels should disappear from the diagram. In this case, the vectors we draw are so long that their centers lie outside the drawing bounds, and therefore, the load caption that we place toward the start point is simply not visible.</p>&#13;
<h4 class="h4" id="ch00lev2sec210"><strong><em>Solving a Large Structure</em></strong></h4>&#13;
<p class="noindent">In the <em>apps/truss_structures</em> directory of the code distributed with the book is a file, <em>baltimore.txt</em>, that defines a Baltimore truss structure with 10 spans. Copy this file into your project, in the same folder. Alternatively, you can create and write the file by hand (<a href="ch19.xhtml#ch19lis6">Listing 19-6</a>):</p>&#13;
<pre># Baltimore truss with 10 spans&#13;
&#13;
nodes&#13;
# lower nodes&#13;
1: (0.0, 0.0) (xy)&#13;
2: (200.0, 0.0) ()&#13;
3: (400.0, 0.0) ()&#13;
4: (600.0, 0.0) ()&#13;
<span epub:type="pagebreak" id="page_543"/>5: (800.0, 0.0) ()&#13;
6: (1000.0, 0.0) ()&#13;
7: (1200.0, 0.0) ()&#13;
8: (1400.0, 0.0) ()&#13;
9: (1600.0, 0.0) ()&#13;
10: (1800.0, 0.0) ()&#13;
11: (2000.0, 0.0) ()&#13;
12: (2200.0, 0.0) ()&#13;
13: (2400.0, 0.0) ()&#13;
14: (2600.0, 0.0) ()&#13;
15: (2800.0, 0.0) ()&#13;
16: (3000.0, 0.0) ()&#13;
17: (3200.0, 0.0) ()&#13;
18: (3400.0, 0.0) ()&#13;
19: (3600.0, 0.0) ()&#13;
20: (3800.0, 0.0) ()&#13;
21: (4000.0, 0.0) (y)&#13;
# middle nodes&#13;
22: (200.0, 150.0) ()&#13;
23: (600.0, 150.0) ()&#13;
24: (1000.0, 150.0) ()&#13;
25: (1400.0, 150.0) ()&#13;
26: (1800.0, 150.0) ()&#13;
27: (2200.0, 150.0) ()&#13;
28: (2600.0, 150.0) ()&#13;
29: (3000.0, 150.0) ()&#13;
30: (3400.0, 150.0) ()&#13;
31: (3800.0, 150.0) ()&#13;
# upper nodes&#13;
32: (400.0, 300.0) ()&#13;
33: (800.0, 300.0) ()&#13;
34: (1200.0, 300.0) ()&#13;
35: (1600.0, 300.0) ()&#13;
36: (2000.0, 300.0) ()&#13;
37: (2400.0, 300.0) ()&#13;
38: (2800.0, 300.0) ()&#13;
39: (3200.0, 300.0) ()&#13;
40: (3600.0, 300.0) ()&#13;
&#13;
loads&#13;
1 -&gt; (0.0, -500.0)&#13;
2 -&gt; (0.0, -500.0)&#13;
<span class="codeitalic1">--snip--</span>&#13;
40 -&gt; (0.0, -500.0)&#13;
&#13;
bars&#13;
# zig-zag bars&#13;
<span epub:type="pagebreak" id="page_544"/>1: (1 -&gt; 22) 20.0 20000000.0&#13;
2: (22 -&gt; 3) 20.0 20000000.0&#13;
3: (3 -&gt; 23) 20.0 20000000.0&#13;
4: (23 -&gt; 5) 20.0 20000000.0&#13;
5: (5 -&gt; 24) 20.0 20000000.0&#13;
6: (24 -&gt; 7) 20.0 20000000.0&#13;
7: (7 -&gt; 25) 20.0 20000000.0&#13;
8: (25 -&gt; 9) 20.0 20000000.0&#13;
9: (9 -&gt; 26) 20.0 20000000.0&#13;
10: (26 -&gt; 11) 20.0 20000000.0&#13;
11: (11 -&gt; 27) 20.0 20000000.0&#13;
12: (27 -&gt; 13) 20.0 20000000.0&#13;
13: (13 -&gt; 28) 20.0 20000000.0&#13;
14: (28 -&gt; 15) 20.0 20000000.0&#13;
15: (15 -&gt; 29) 20.0 20000000.0&#13;
16: (29 -&gt; 17) 20.0 20000000.0&#13;
17: (17 -&gt; 30) 20.0 20000000.0&#13;
18: (30 -&gt; 19) 20.0 20000000.0&#13;
19: (19 -&gt; 31) 20.0 20000000.0&#13;
20: (31 -&gt; 21) 20.0 20000000.0&#13;
# left diagonal bars&#13;
21: (32 -&gt; 22) 20.0 20000000.0&#13;
22: (32 -&gt; 23) 20.0 20000000.0&#13;
23: (33 -&gt; 24) 20.0 20000000.0&#13;
24: (34 -&gt; 25) 20.0 20000000.0&#13;
25: (35 -&gt; 26) 20.0 20000000.0&#13;
# right diagonal bars&#13;
26: (37 -&gt; 27) 20.0 20000000.0&#13;
27: (38 -&gt; 28) 20.0 20000000.0&#13;
28: (39 -&gt; 29) 20.0 20000000.0&#13;
29: (40 -&gt; 30) 20.0 20000000.0&#13;
30: (40 -&gt; 31) 20.0 20000000.0&#13;
# vertical bars&#13;
31: (2 -&gt; 22) 20.0 20000000.0&#13;
32: (3 -&gt; 32) 20.0 20000000.0&#13;
33: (4 -&gt; 23) 20.0 20000000.0&#13;
34: (5 -&gt; 33) 20.0 20000000.0&#13;
35: (6 -&gt; 24) 20.0 20000000.0&#13;
36: (7 -&gt; 34) 20.0 20000000.0&#13;
37: (8 -&gt; 25) 20.0 20000000.0&#13;
38: (9 -&gt; 35) 20.0 20000000.0&#13;
39: (10 -&gt; 26) 20.0 20000000.0&#13;
40: (11 -&gt; 36) 20.0 20000000.0&#13;
41: (12 -&gt; 27) 20.0 20000000.0&#13;
42: (13 -&gt; 37) 20.0 20000000.0&#13;
43: (14 -&gt; 28) 20.0 20000000.0&#13;
44: (15 -&gt; 38) 20.0 20000000.0&#13;
<span epub:type="pagebreak" id="page_545"/>45: (16 -&gt; 29) 20.0 20000000.0&#13;
46: (17 -&gt; 39) 20.0 20000000.0&#13;
47: (18 -&gt; 30) 20.0 20000000.0&#13;
48: (19 -&gt; 40) 20.0 20000000.0&#13;
49: (20 -&gt; 31) 20.0 20000000.0&#13;
# lower horizontal bars&#13;
50: (1 -&gt; 2) 20.0 20000000.0&#13;
51: (2 -&gt; 3) 20.0 20000000.0&#13;
52: (3 -&gt; 4) 20.0 20000000.0&#13;
53: (4 -&gt; 5) 20.0 20000000.0&#13;
54: (5 -&gt; 6) 20.0 20000000.0&#13;
55: (6 -&gt; 7) 20.0 20000000.0&#13;
56: (7 -&gt; 8) 20.0 20000000.0&#13;
57: (8 -&gt; 9) 20.0 20000000.0&#13;
58: (9 -&gt; 10) 20.0 20000000.0&#13;
59: (10 -&gt; 11) 20.0 20000000.0&#13;
60: (11 -&gt; 12) 20.0 20000000.0&#13;
61: (12 -&gt; 13) 20.0 20000000.0&#13;
62: (13 -&gt; 14) 20.0 20000000.0&#13;
63: (14 -&gt; 15) 20.0 20000000.0&#13;
64: (15 -&gt; 16) 20.0 20000000.0&#13;
65: (16 -&gt; 17) 20.0 20000000.0&#13;
66: (17 -&gt; 18) 20.0 20000000.0&#13;
67: (18 -&gt; 19) 20.0 20000000.0&#13;
68: (19 -&gt; 20) 20.0 20000000.0&#13;
69: (20 -&gt; 21) 20.0 20000000.0&#13;
# upper horizontal bars&#13;
70: (32 -&gt; 33) 20.0 20000000.0&#13;
71: (33 -&gt; 34) 20.0 20000000.0&#13;
72: (34 -&gt; 35) 20.0 20000000.0&#13;
73: (35 -&gt; 36) 20.0 20000000.0&#13;
74: (36 -&gt; 37) 20.0 20000000.0&#13;
75: (37 -&gt; 38) 20.0 20000000.0&#13;
76: (38 -&gt; 39) 20.0 20000000.0&#13;
77: (39 -&gt; 40) 20.0 20000000.0</pre>&#13;
<p class="caption"><a id="ch19lis6"/><em>Listing 19-6: Baltimore truss structure definition</em></p>&#13;
<p class="noindent">Note that, in this code, we apply the same load to every node, but we’ve left out some of the load lines. If you write this by hand, you should include those load definition lines.</p>&#13;
<p class="indent">Let’s pass the file defining this large structure to our program:</p>&#13;
<pre>$ <span class="codestrong1">./truss.sh --scale=0.75 --disp-scale=100 --load-scale=0.2&#13;
  &lt; apps/truss_structures/baltimore.txt</span></pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_546"/>The output produced by the program should look something like the following:</p>&#13;
<pre>Took 0.106 seconds to solve</pre>&#13;
<p class="indent">Even for the Baltimore typology with 40 nodes and 77 bars, the computation time is a fraction of a second. If you open the <em>solution.svg</em> file, you’ll see something like <a href="ch19.xhtml#ch19fig9">Figure 19-9</a>.</p>&#13;
<div class="image"><img src="../images/19fig09.jpg" alt="Image"/></div>&#13;
<p class="figcap" id="ch19fig9"><em>Figure 19-9: Baltimore solution diagram</em></p>&#13;
<p class="indent">Now that you’ve gotten this far, spend some time playing with your application. Try with different structures and parameters to check the results.</p>&#13;
<h3 class="h3" id="ch00lev1sec119"><strong>Summary</strong></h3>&#13;
<p class="noindent">In this chapter, we took all of the structural analysis modules we’ve been building in the previous chapters and assembled them into a command line application that solves truss structures. Our app reads structure files from the standard input and produces two result files: one is a vector diagram representing the solution, and the other is a plaintext report including all the relevant values.</p>&#13;
<p class="indent">This is the last chapter in <a href="part05.xhtml#part05">Part V</a> of the book. It’s been an intense couple of chapters, but I hope the result has paid off. We’ve made up a format for files that defines a structure, written a function to parse it into our model, implemented the resolution algorithm that generates the solution model, coded a way to export this solution into a diagram and text report, and, finally, assembled all of it into a final application.</p>&#13;
<p class="indent">We chose an application that solves truss structures to exemplify the process of writing engineering applications, but we could have chosen any other topic—heat transfer, fluid dynamics, beam analysis, and so on. The process and techniques are the same. The knowledge you’ve acquired should empower you to write code that works with any engineering domain you might encounter.</p>&#13;
<p class="indent">This is also the last chapter in the book. I hope you’ve enjoyed learning about how to build engineering applications, split them into modules, and, of course, test them. All that’s left is for you to start creating your own apps. As mentioned in the introduction of the book, the only way to become an expert is by doing: build many apps, learn from your mistakes, and then build some more. Good luck!</p>&#13;
</body></html>