<html><head></head><body>
<h2 class="h2" id="ch04"><span epub:type="pagebreak" id="page_59"/><strong><span class="blue"><span class="big">4</span></span><br/>CREATING THE SPACE STATION</strong></h2>
<div class="image1"><img src="../images/common01.jpg" alt="image"/></div>
<p class="noindent">In this chapter, you’ll build the map for your space station on Mars. Using the simple <em>Explorer</em> code that you’ll add in this chapter, you’ll be able to look at the walls of each room and start to find your bearings. We’ll use lists, loops, and the techniques you learned in <a href="ch01.xhtml#ch01">Chapters 1</a>, <a href="ch02.xhtml#ch02">2</a>, and <a href="ch03.xhtml#ch03">3</a> to create the map data and display the room in 3D.</p>
<h3 class="h3" id="lev60"><strong>AUTOMATING THE MAP MAKING PROCESS</strong></h3>
<p class="noindent">The problem with our current <span class="literal">room_map</span> data is that there’s a lot of it. The <em>Escape</em> game includes 50 locations. If you had to enter <span class="literal">room_map</span> data for every location, it would take ages and be hugely inefficient. As an example, if each room consisted of 9 × 9 tiles, we would have 81 data items per room, or 4,050 data items in total. Just the room data would take up 10 pages of this book.</p>
<p class="indent"><span epub:type="pagebreak" id="page_60"/>Much of that data is repeated: 0s mark the floor and exits, and 1s mark the walls at the edges. You know from <a href="ch03.xhtml#ch03">Chapter 3</a> that we can use loops to efficiently manage repetition. We can use that knowledge to make a program that will generate the <span class="literal">room_map</span> data automatically when we give it certain information, such as the room size and the location of the exits.</p>
<h3 class="h3" id="lev61"><strong>HOW THE AUTOMATIC MAP MAKER WORKS</strong></h3>
<p class="noindent">The <em>Escape</em> program will work like this: when the player visits a room, our code will take the data for that room (its size and exit positions) and convert it into the <span class="literal">room_map</span> data. The <span class="literal">room_map</span> data will include columns and rows that represent the floor, walls around the edge, and gaps where the exits should be. Eventually, we’ll use the <span class="literal">room_map</span> data to draw the room with the floor and walls in the correct place.</p>
<p class="indent"><a href="ch04.xhtml#ch04fig1">Figure 4-1</a> shows the map for the space station. I’ll refer to each location as a room, although numbers 1 to 25 are sectors on the planet surface within the station compound, similar to a garden. Numbers 26 to 50 are rooms inside the space station.</p>
<p class="indent">The indoor layout is a simple maze with many corridors, dead-ends, and rooms to explore. When you make your own maps, try to create winding paths and corners to explore, even if the map isn’t very big. Be sure to reward players for their exploration by placing a useful or appealing item at the end of each corridor. Players also often feel more comfortable travelling from left to right as they explore a game world, so the player’s character will start on the left of the map in room 31.</p>
<p class="indent">Outside, players can walk anywhere, but a fence will stop them from leaving the station compound (or wandering off the game map). Due to the claustrophobic atmosphere inside the space station, players will experience a sense of freedom outside with space to roam.</p>
<div class="image"><a id="ch04fig1"/><img src="../images/fig4-1.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 4-1: The space station map</em></p>
<p class="indent">When you’re playing the final <em>Escape</em> game, you can refer to this map, but you might find it more enjoyable to explore without a map or to make your own. This map doesn’t show where the doors are, which in the final game will stop players from accessing some parts of the map until they find the right key cards.</p>
<h3 class="h3" id="lev62"><strong>CREATING THE MAP DATA</strong></h3>
<p class="noindent">Let’s create the map data. The rooms in our space station will all join up, so we only need to store the location of an exit from one side of the wall. For <span epub:type="pagebreak" id="page_61"/>instance, an exit on the right of room 31 and an exit on the left of room 32 would be the same doorway connecting the two rooms. We don’t need to specify that exit for both rooms. For each room in the map, we’ll store whether it has an exit at the top or on the right. The program can work out on its own whether an exit exists at the bottom or on the left (as I’ll explain shortly). This approach also ensures that the map is consistent and no exits seem to vanish after you walk through them. If you can go one way through an exit, you can always go back the other way.</p>
<p class="indent">Each room in the map needs the following data:</p>
<ul>
<li class="noindent">A short description of the room.</li>
<li class="noindent">Height in tiles, which is the size of the room from top to bottom on the screen. (This has nothing to do with the distance from floor to ceiling.)</li>
<li class="noindent">Width in tiles, which is the size of the room from left to right across the screen.</li>
<li class="noindent">Whether or not there is an exit at the top (<span class="literal">True</span> or <span class="literal">False</span>).</li>
<li class="noindent">Whether or not there is an exit on the right (<span class="literal">True</span> or <span class="literal">False</span>).</li>
</ul>
<div class="sidebar1">
<p class="sidebart"><strong>TIP</strong></p>
<p class="spara"><span class="literal">True</span> and <span class="literal">False</span> are known as <em>Boolean values</em>. In Python, these values must start with a capital letter, and they don’t need quotes around them, because they’re not strings.</p>
</div>
<p class="indent">We call the unit we use to measure the room size a <em>tile</em> because it’s the same size as a floor tile. As you learned in <a href="ch03.xhtml#ch03">Chapter 3</a>, a tile will be our basic unit of measurement for all objects. For instance, a single object in the room, such as a chair or a cabinet, will often be the size of one tile. In <a href="ch03.xhtml#ch03">Chapter 3</a> (see <a href="ch03.xhtml#ch03fig1">Figure 3-1</a> and <a href="ch03.xhtml#ch03list5">Listing 3-5</a>), we made a room map that had seven rows with five list items in each row, so that room would be seven tiles high and five tiles wide.</p>
<p class="indent">Having rooms of different sizes adds variety to the map: some rooms can be narrow like corridors, and some can be expansive like community rooms. To fit in our game window, the maximum size of a room is 15 tiles high by 25 tiles wide. Large rooms or rooms with lots of objects in them might run more slowly on older computers, though.</p>
<p class="indent">Here’s an example of the data for room 26: it’s a narrow room 13 tiles high and 5 tiles wide with an exit at the top but none to the right (see the map in <a href="ch04.xhtml#ch04fig1">Figure 4-1</a>).</p>
<p class="programs">[<span class="green">"The airlock"</span>, 13, 5, <span class="orange">True</span>, <span class="orange">False</span>]</p>
<p class="indent">We give the room a name (or description), numbers for the height and width respectively, and <span class="literal">True</span> and <span class="literal">False</span> values for whether the top and right edges have an exit. In this game, each wall can have only one exit, and that exit will be automatically positioned in the middle of the wall.</p>
<p class="indent"><span epub:type="pagebreak" id="page_62"/>When the program makes the <span class="literal">room_map</span> data for room 27 next door, it will check room 26 to see whether it has an exit on the right. Because room 26 has no exit on the right, the program will know that room 27 has no left exit.</p>
<p class="indent">We’ll store the lists of data for each room in a list called <span class="literal">GAME_MAP</span>.</p>
<h3 class="h3" id="lev63"><strong>WRITING THE GAME_MAP CODE</strong></h3>
<p class="noindent">Click <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to start a new file in Python. Enter the code from <a href="ch04.xhtml#ch04list1">Listing 4-1</a> to start building the space station. Save your listing as <em>listing4-1.py</em>.</p>
<div class="sidebar1">
<p class="sidebart"><strong>TIP</strong></p>
<p class="spara">Remember to save your work regularly when you’re typing a long program. As in many applications, you can press <small>CTRL</small>-S to save in IDLE.</p>
</div>
<p class="margin"><em>listing4-1.py</em></p>
<p class="programs">   <span class="red"># Escape - A Python Adventure</span><br/>   <span class="red"># by Sean McManus / www.sean.co.uk</span><br/>   <span class="red"># Typed in by PUT YOUR NAME HERE</span><br/><br/>   <span class="orange">import</span> time, random, math<br/><br/>   <span class="red">###############</span><br/>   <span class="red">## VARIABLES ##</span><br/>   <span class="red">###############</span><br/><br/>   WIDTH = 800 <span class="red"># window size</span><br/>   HEIGHT = 800<br/><br/>   <span class="red">#PLAYER variables</span><br/><span class="ent">➊</span> PLAYER_NAME = <span class="green">"Sean"</span> <span class="red"># change this to your name!</span><br/>   FRIEND1_NAME = <span class="green">"Karen"</span> <span class="red"># change this to a friend's name!</span><br/>   FRIEND2_NAME = <span class="green">"Leo"</span> <span class="red"># change this to another friend's name!</span><br/>   current_room = 31 <span class="red"># start room = 31</span><br/><br/><span class="ent">➋</span> top_left_x = 100<br/>   top_left_y = 150<br/><br/><span class="ent">➌</span> DEMO_OBJECTS = [images.floor, images.pillar, images.soil]<br/><br/>   <span class="red">###############</span><br/>   <span class="red">##    MAP    ##</span><br/>   <span class="red">###############  </span><br/><br/><span class="ent">➍</span> MAP_WIDTH = 5<br/>   MAP_HEIGHT = 10<br/>   MAP_SIZE = MAP_WIDTH * MAP_HEIGHT<br/><br/><span epub:type="pagebreak" id="page_63"/><span class="ent">➎</span> GAME_MAP = [ [<span class="green">"Room 0 - where unused objects are kept"</span>, 0, 0, <span class="orange">False</span>, <span class="orange">False</span>] ]<br/><br/>   outdoor_rooms = <span class="purple">range</span>(1, 26)<br/><span class="ent">➏</span> <span class="orange">for</span> planetsectors <span class="orange">in</span> <span class="purple">range</span>(1, 26): <span class="red">#rooms 1 to 25 are generated here</span><br/>       GAME_MAP.append( [<span class="green">"The dusty planet surface"</span>, 13, 13, <span class="orange">True</span>, <span class="orange">True</span>] )<br/><br/><span class="ent">➐</span> GAME_MAP += [<br/>           <span class="red">#["Room name", height, width, Top exit?, Right exit?]</span><br/>           [<span class="green">"The airlock"</span>, 13, 5, <span class="orange">True</span>, <span class="orange">False</span>], <span class="red"># room 26</span><br/>           [<span class="green">"The engineering lab"</span>, 13, 13, <span class="orange">False</span>, <span class="orange">False</span>], <span class="red"># room 27</span><br/>           [<span class="green">"Poodle Mission Control"</span>, 9, 13, <span class="orange">False</span>, <span class="orange">True</span>], <span class="red"># room 28</span><br/>           [<span class="green">"The viewing gallery"</span>, 9, 15, <span class="orange">False</span>, <span class="orange">False</span>], <span class="red"># room 29</span><br/>           [<span class="green">"The crew's bathroom"</span>, 5, 5, <span class="orange">False</span>, <span class="orange">False</span>], <span class="red"># room 30</span><br/>           [<span class="green">"The airlock entry bay"</span>, 7, 11, <span class="orange">True</span>, <span class="orange">True</span>], <span class="red"># room 31</span><br/>           [<span class="green">"Left elbow room"</span>, 9, 7, <span class="orange">True</span>, <span class="orange">False</span>], <span class="red"># room 32</span><br/>           [<span class="green">"Right elbow room"</span>, 7, 13, <span class="orange">True</span>, <span class="orange">True</span>], <span class="red"># room 33</span><br/>           [<span class="green">"The science lab"</span>, 13, 13, <span class="orange">False</span>, <span class="orange">True</span>], <span class="red"># room 34</span><br/>           [<span class="green">"The greenhouse"</span>, 13, 13, <span class="orange">True</span>, <span class="orange">False</span>], <span class="red"># room 35</span><br/>           [PLAYER_NAME + <span class="green">"'s sleeping quarters"</span>, 9, 11, <span class="orange">False</span>, <span class="orange">False</span>], <span class="red"># room 36</span><br/>           [<span class="green">"West corridor"</span>, 15, 5, <span class="orange">True</span>, <span class="orange">True</span>], <span class="red"># room 37</span><br/>           [<span class="green">"The briefing room"</span>, 7, 13, <span class="orange">False</span>, <span class="orange">True</span>], <span class="red"># room 38</span><br/>           [<span class="green">"The crew's community room"</span>, 11, 13, <span class="orange">True</span>, <span class="orange">False</span>], <span class="red"># room 39</span><br/>           [<span class="green">"Main Mission Control"</span>, 14, 14, <span class="orange">False</span>, <span class="orange">False</span>], <span class="red"># room 40</span><br/>           [<span class="green">"The sick bay"</span>, 12, 7, <span class="orange">True</span>, <span class="orange">False</span>], <span class="red"># room 41</span><br/>           [<span class="green">"West corridor"</span>, 9, 7, <span class="orange">True</span>, <span class="orange">False</span>], <span class="red"># room 42</span><br/>           [<span class="green">"Utilities control room"</span>, 9, 9, <span class="orange">False</span>, <span class="orange">True</span>], <span class="red"># room 43</span><br/>           [<span class="green">"Systems engineering bay"</span>, 9, 11, <span class="orange">False</span>, <span class="orange">False</span>], <span class="red"># room 44</span><br/>           [<span class="green">"Security portal to Mission Control"</span>, 7, 7, <span class="orange">True</span>, <span class="orange">False</span>], <span class="red"># room 45</span><br/><span class="ent">➑</span>         [FRIEND1_NAME + <span class="green">"'s sleeping quarters"</span>, 9, 11, <span class="orange">True</span>, <span class="orange">True</span>], <span class="red"># room 46</span><br/>           [FRIEND2_NAME + <span class="green">"'s sleeping quarters"</span>, 9, 11, <span class="orange">True</span>, <span class="orange">True</span>], <span class="red"># room 47</span><br/>           [<span class="green">"The pipeworks"</span>, 13, 11, <span class="orange">True</span>, <span class="orange">False</span>], <span class="red"># room 48</span><br/>           [<span class="green">"The chief scientist's office"</span>, 9, 7, <span class="orange">True</span>, <span class="orange">True</span>], <span class="red"># room 49</span><br/>           [<span class="green">"The robot workshop"</span>, 9, 11, <span class="orange">True</span>, <span class="orange">False</span>] <span class="red"># room 50</span><br/>           ]<br/><br/>   <span class="red"># simple sanity check on map above to check data entry</span><br/><span class="ent">➒</span> <span class="orange">assert</span> <span class="purple">len</span>(GAME_MAP)-1 == MAP_SIZE, <span class="green">"Map size and GAME_MAP don't match"</span></p>
<p class="listing" id="ch04list1"><em>Listing 4-1: The</em> <span class="codeitalic">GAME_MAP</span> <em>data</em></p>
<p class="indent">Let’s take a closer look at this code for setting out the room map data. Keep in mind that as we build the <em>Escape</em> game, we’ll keep adding to the program. To help you find your way around the program, I’ll mark the different sections with headings like this:</p>
<p class="programs"><span class="red">###############</span><br/><span class="red">## VARIABLES ##</span><br/><span class="red">###############</span></p>
<p class="indent">The <span class="literal">#</span> symbol marks a comment and tells Python to ignore anything after it on the same line, so the game will work with or without these comments. The comments will make it easier to figure out where you are in <span epub:type="pagebreak" id="page_64"/><span epub:type="pagebreak" id="page_65"/>the code and where you need to add new instructions as the program gets bigger. I’ve drawn boxes using the comment symbols to make the headings stand out as you scroll through the program code.</p>
<p class="indent">Three astronauts are based on the space station, and you can personalize their names in the code <span class="ent">➊</span>. Change the <span class="literal">PLAYER_NAME</span> to your own, and add the names of two friends for the <span class="literal">FRIEND1_NAME</span> and <span class="literal">FRIEND2_NAME</span> variables. Throughout the code, we’ll use these variables wherever we need to use the name of one of your friends: for example, each astronaut has their own sleeping quarters. We need to set up these variables now because we’ll use them to set up some of the room descriptions later in this program. Who will you take with you to Mars?</p>
<p class="indent">The program also sets up some variables we’ll need at the end of this chapter to draw our room: the <span class="literal">top_left_x</span> and <span class="literal">top_left_y</span> variables <span class="ent">➋</span> specify where to start drawing the room; and the <span class="literal">DEMO_OBJECTS</span> list contains the images to use <span class="ent">➌</span>.</p>
<p class="indent">First, we set up variables to contain the height, width, and overall size of the map in tiles <span class="ent">➍</span>. We create the <span class="literal">GAME_MAP</span> list <span class="ent">➎</span> and give it the data for room 0: this room is for storing items that aren’t in the game yet because the player hasn’t discovered or created them. It’s not a real room the player can visit.</p>
<p class="indent">We then use a loop <span class="ent">➏</span> to add the same data for each of the 25 planet surface rooms that make up the grounds of the compound. The <span class="literal">range(1, 26</span><span class="literal">)</span> function is used to repeat 25 times. The first number is the one we want to start at, and the second is the number we want to finish at plus one (<span class="literal">range()</span> doesn’t include the last number you give it, remember). Each time through the loop, the program adds the same data to the end of <span class="literal">GAME_MAP</span> because all the planet surface “rooms” are the same size and have exits in every direction. The data for every surface room looks like this:</p>
<p class="programs">[<span class="green">"The dusty planet surface"</span>, 13, 13, <span class="orange">True</span>, <span class="orange">True</span>]</p>
<p class="indent">When this loop finishes, <span class="literal">GAME_MAP</span> will include room 0 and also have the same “dusty planet surface” data for rooms 1 to 25. We also set up the <span class="literal">outdoor</span><span class="literal">_rooms</span> range to store the room numbers 1 to 25. We’ll use this range when we need to check whether a room is inside or outside the space station.</p>
<p class="indent">Finally, we add rooms 26 to 50 to <span class="literal">GAME_MAP</span> <span class="ent">➐</span>. We do this by using <span class="literal">+=</span> to add a new list to the end of <span class="literal">GAME_MAP</span>. That new list includes the data for the remaining rooms. Each of these rooms will be different, so we need to enter the data for them separately. You saw the information for room 26 earlier: the data contains the room name, its height and width, and whether it has exits at the top and the right. Each piece of room data is a list, so it has square brackets at the start and end. At the end of each piece of room data (except the last one), we must use a comma to separate it from the next one. I’ve also put the room number in a comment at the end of each line to help keep track of the room numbers. These comments will be helpful as you develop the game. It’s good practice to annotate your code like this so you can understand it when you revisit it.</p>
<p class="indent"><span epub:type="pagebreak" id="page_66"/>Rooms 46 and 47 add the variables <span class="literal">FRIEND1_NAME</span> and <span class="literal">FRIEND2_NAME</span> to the room description, so you have two rooms called something like “Karen’s sleeping quarters,” using your friends’ names <span class="ent">➑</span>. As well as using the <span class="literal">+</span> symbol to add numbers and combine lists, you can also use it to combine strings.</p>
<p class="indent">At the end of <em>listing4-1.py</em>, we perform a simple check using <span class="literal">assert()</span> to make sure the map data makes sense <span class="ent">➒</span>. We check whether the length of the <span class="literal">GAME_MAP</span> (the number of rooms in the map data) is the same as the size of the map, which we calculated at <span class="ent">➍</span> by multiplying its width by its height. If it’s not, it means we’re missing some data or have too much.</p>
<p class="indent">We have to subtract 1 from the length of <span class="literal">GAME_MAP</span> because it also includes room 0, which we didn’t include when we calculated the map size. This check won’t catch all errors, but it can tell you whether you missed a line of the map data when entering it. Wherever possible, I’ll try to include simple tests like this to help you check for any errors as you enter the program code.</p>
<h3 class="h3" id="lev64"><strong>TESTING AND DEBUGGING THE CODE</strong></h3>
<p class="noindent">Run <em>listing4-1.py</em> by clicking <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> or press F5 (the keyboard shortcut). Nothing much should happen. The shell window should just display a message that says <span class="literal">"RESTART:"</span> together with your filename. The reason is that all we’ve asked the program to do is set up some variables and a list, so there is nothing to see. But if you made a mistake entering the listing, you might also see a red error message in the shell window. If you do get an error, double-check the following details:</p>
<ul>
<li class="noindent">Are the quote marks in the right place? Strings are in green in the Python program window, so look for large areas of green, which suggest you didn’t close your string. If room descriptions are in black, you didn’t open the string. Both indicate a missing quote mark.</li>
<li class="noindent">Are you using the correct brackets and parentheses in the proper places? In this listing, square brackets surround list items, and parentheses (curved brackets) are used for functions, such as <span class="literal">range()</span> and <span class="literal">append()</span>. Curly brackets {…} are not used at all.</li>
<li class="noindent">Are you missing any brackets or parentheses? A simple way to check is to count the number of opening and closing brackets and parentheses. Every opening bracket or parenthesis should have a closing bracket or parenthesis of the same shape.</li>
<li class="noindent">You have to close brackets and parentheses in the reverse order of how you opened them. If you have an opening parenthesis and then an opening square bracket, you must close them first with a closing square bracket and then a closing parenthesis. This format is correct: ( [ … ] ). This format is wrong: ( [ … ) ].</li>
<li class="noindent">Are your commas in the correct place? Remember that each list for a room in <span class="literal">GAME_MAP</span> must have a comma after the closing square bracket to separate it from the next room’s data (except for the last room).</li>
</ul>
<div class="sidebar1">
<p class="sidebart"><strong>TIP</strong></p>
<p class="spara">Why not ask a friend to help you build the game? Programmers often work in pairs to help each other with ideas and, perhaps most importantly, have two pairs of eyes checking everything. You can take turns typing too!</p>
</div>
<h3 class="h3" id="lev65"><strong>GENERATING ROOMS FROM THE DATA</strong></h3>
<p class="noindent">Now the space station map is stored in our <span class="literal">GAME_MAP</span> list. The next step is to add the function that takes the data for the current room from <span class="literal">GAME_MAP</span> and expands it into the <span class="literal">room_map</span> list that the <em>Escape</em> game will use to see what’s at each position in the room. The <span class="literal">room_map</span> list always stores information about the room the player is currently in. When the player enters a different room, we replace the data in <span class="literal">room_map</span> with the map of the new room. Later in the book, we’ll add scenery and props to the <span class="literal">room_map</span>, so the player has items to interact with too.</p>
<p class="indent">The <span class="literal">room_map</span> data is made by a function we’ll create called <span class="literal">generate_map()</span>, shown in <a href="ch04.xhtml#ch04list2">Listing 4-2</a>.</p>
<p class="indent">Add the code in <a href="ch04.xhtml#ch04list2">Listing 4-2</a> to the end of <a href="ch04.xhtml#ch04list1">Listing 4-1</a>. The grayed out code shows you where <a href="ch04.xhtml#ch04list1">Listing 4-1</a> ends. Make sure all the indentation is correct. The indentation determines whether code belongs to the <span class="literal">get_floor_type()</span> or <span class="literal">generate_map()</span> function, and some code is indented further to tell Python which <span class="literal">if</span> or <span class="literal">for</span> command it belongs to.</p>
<p class="indent">Save your program as <em>listing4-2.py</em> and click <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> to run it and check for any error messages in the shell.</p>
<div class="note">
<p class="notet"><strong><span class="notes">RED ALERT</span></strong></p>
<p class="notep"><em>Don’t start a new program with the code in <a href="ch04.xhtml#ch04list2">Listing 4-2</a>: make sure you add <a href="ch04.xhtml#ch04list2">Listing 4-2</a> to the end of <a href="ch04.xhtml#ch04list1">Listing 4-1</a>. As you follow along in this book, you’ll increasingly add to your existing program to build the</em> Escape <em>game.</em></p>
</div>
<p class="margin"><em>listing4-2.py</em></p>
<p class="programs">   <span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>   <span class="gray"># simple sanity check on map above to check data entry</span><br/>   <span class="gray">assert len(GAME_MAP)-1 == MAP_SIZE, "Map size and GAME_MAP don't match"</span><br/><br/><br/>   <span class="red">###############</span><br/>   <span class="red">## MAKE MAP  ##</span><br/>   <span class="red">###############</span><br/><br/><span class="ent">➊</span> <span class="orange">def</span> <span class="blue">get_floor_type</span>():<br/>       <span class="orange">if</span> current_room <span class="orange">in</span> outdoor_rooms:<br/>           <span class="orange">return</span> 2 <span class="red"># soil</span><br/>       <span class="orange">else</span>:<br/>           <span class="orange">return</span> 0 <span class="red"># tiled floor</span>       <br/><br/>   <span class="orange">def</span> <span class="blue">generate_map</span>():<br/>   <span class="red"># This function makes the map for the current room,</span><br/>   <span class="red"># using room data, scenery data and prop data.</span><br/><span epub:type="pagebreak" id="page_67"/>       <span class="orange">global</span> room_map, room_width, room_height, room_name, hazard_map<br/>       <span class="orange">global</span> top_left_x, top_left_y, wall_transparency_frame<br/><span class="ent">➋</span>     room_data = GAME_MAP[current_room]<br/>       room_name = room_data[0]<br/>       room_height = room_data[1]<br/>       room_width = room_data[2]<br/><br/><span class="ent">➌</span>     floor_type = get_floor_type()<br/>       <span class="orange">if</span> current_room <span class="orange">in</span> <span class="purple">range</span>(1, 21):<br/>           bottom_edge = 2 <span class="red">#soil</span><br/>           side_edge = 2 <span class="red">#soil</span><br/>       <span class="orange">if</span> current_room <span class="orange">in</span> <span class="purple">range</span>(21, 26):<br/>           bottom_edge = 1 <span class="red">#wall</span><br/>           side_edge = 2 <span class="red">#soil</span><br/>       <span class="orange">if</span> current_room &gt; 25:<br/>           bottom_edge = 1 <span class="red">#wall</span><br/>           side_edge = 1 <span class="red">#wall</span><br/><br/>       <span class="red"># Create top line of room map.</span><br/><span class="ent">➍</span>     room_map=[[side_edge] * room_width]<br/>       <span class="red"># Add middle lines of room map (wall, floor to fill width, wall).</span><br/><span class="ent">➎</span>     <span class="orange">for</span> y <span class="orange">in</span> <span class="purple">range</span>(room_height - 2):<br/>           room_map.append([side_edge]<br/>                           + [floor_type]*(room_width - 2) + [side_edge])<br/>       <span class="red"># Add bottom line of room map.</span><br/><span class="ent">➏</span>     room_map.append([bottom_edge] * room_width)<br/><br/>       <span class="red"># Add doorways.</span><br/><span class="ent">➐</span>     middle_row = <span class="purple">int</span>(room_height / 2)<br/>       middle_column = <span class="purple">int</span>(room_width / 2)<br/><br/><span class="ent">➑</span>     <span class="orange">if</span> room_data[4]: <span class="red"># If exit at right of this room</span><br/>           room_map[middle_row][room_width - 1] = floor_type<br/>           room_map[middle_row+1][room_width - 1] = floor_type<br/>           room_map[middle_row-1][room_width - 1] = floor_type<br/><br/><span class="ent">➒</span>     <span class="orange">if</span> current_room % MAP_WIDTH != 1: <span class="red"># If room is not on left of map</span><br/>           room_to_left = GAME_MAP[current_room - 1]<br/>           <span class="red"># If room on the left has a right exit, add left exit in this room</span><br/>           <span class="orange">if</span> room_to_left[4]:<br/>               room_map[middle_row][0] = floor_type<br/>               room_map[middle_row + 1][0] = floor_type<br/>               room_map[middle_row - 1][0] = floor_type<br/><br/><span class="ent">➓</span>     <span class="orange">if</span> room_data[3]: <span class="red"># If exit at top of this room</span><br/>           room_map[0][middle_column] = floor_type<br/>           room_map[0][middle_column + 1] = floor_type<br/>           room_map[0][middle_column - 1] = floor_type<br/><br/>       <span class="orange">if</span> current_room &lt;= MAP_SIZE - MAP_WIDTH: <span class="red"># If room is not on bottom row</span><br/>           room_below = GAME_MAP[current_room+MAP_WIDTH]<br/>           <span class="red"># If room below has a top exit, add exit at bottom of this one</span><br/>           if room_below[3]:<br/>               room_map[room_height-1][middle_column] = floor_type<br/><span epub:type="pagebreak" id="page_68"/>               room_map[room_height-1][middle_column + 1] = floor_type<br/>               room_map[room_height-1][middle_column - 1] = floor_type</p>
<p class="listing" id="ch04list2"><em>Listing 4-2: Generating the</em> <span class="codeitalic">room_map</span> <em>data</em></p>
<p class="indent">You can build the <em>Escape</em> game and even make your own game maps without understanding how the <span class="literal">room_map</span> code works. But if you’re curious, read on and I’ll walk you through it.</p>
<h4 class="h4" id="lev66"><strong>HOW THE ROOM GENERATING CODE WORKS</strong></h4>
<p class="noindent">Let’s start with a reminder of what we want the <span class="literal">generate_map()</span> function to do. Given the height and width of a room, and the location of the exits, we want it to generate a room map, which might look something like this:</p>
<p class="programs">[<br/>[1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1],<br/>[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],<br/>[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],<br/>[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],<br/>[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],<br/>[1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],<br/>[1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]<br/>]</p>
<p class="indent">This is room number 31 on the map, the room the player starts the game in. It’s 7 tiles high and 11 tiles wide, and it has an exit at the top and right. The floor spaces (and exits in the wall) are marked with a 0. The walls around the room are marked with a 1. <a href="ch04.xhtml#ch04fig2">Figure 4-2</a> shows the same room in a grid layout, with the index numbers for the lists shown at the top and on the left.</p>
<div class="image"><a id="ch04fig2"/><img src="../images/fig4-2.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 4-2: A grid representing room 31; the 1s are wall pillars, and the 0s are empty floor spaces.</em></p>
<p class="indent">The number of the room the player is currently in is stored in the <span class="literal">current</span><span class="literal">_room</span> variable, which you set up in the <span class="literal">VARIABLES</span> section of your program (see <a href="ch04.xhtml#ch04list1">Listing 4-1</a>). The <span class="literal">generate_map()</span> function starts by collecting the room data for the current room from the <span class="literal">GAME_MAP</span> <span class="ent">➋</span> and putting it into a list called <span class="literal">room_data</span>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_69"/>If you cast your mind back to when we set up <span class="literal">GAME_MAP</span>, the information in the <span class="literal">room_data</span> list will now look similar to this:</p>
<p class="programs">[<span class="green">"The airlock"</span>, 13, 5, <span class="orange">True</span>, <span class="orange">False</span>]</p>
<p class="indent">This list format allows us to set up the <span class="literal">room_name</span> by taking the first element from this list at index 0. We can find the room’s height at index 1 and width at index 2 by taking the next elements. The <span class="literal">generate_map()</span> function stores the height and width information in the <span class="literal">room_height</span> and <span class="literal">room_width</span> variables.</p>
<h4 class="h4" id="lev67"><strong>CREATING THE BASIC ROOM SHAPE</strong></h4>
<p class="noindent">The next step is to set the materials we’ll use to build the rooms and create the basic room shape using them. We’ll add exits later. We’ll use three elements for each room:</p>
<ul>
<li class="noindent">The <em>floor type</em>, which is stored in the variable <span class="literal">floor_type</span>. Inside the space station, we use floor tiles (represented by 0 in <span class="literal">room_map</span>), and outside we use soil (represented by 2 in <span class="literal">room_map</span>).</li>
<li class="noindent">The <em>edge type</em>, which appears in each space at the edge of the room. For an inside room, this is a wall pillar, represented by 1. For an outside room, this is the soil.</li>
<li class="noindent"><p class="list">The <em>bottom edge type</em>, which is a wall inside the station and usually soil outside. The bottom row of the outside compound, where it meets the space station, is a special case because the station wall is visible here, so the <span class="literal">bottom_edge</span> type is a wall pillar (see <a href="ch04.xhtml#ch04fig3">Figure 4-3</a>).</p>
<div class="image"><a id="ch04fig3"/><img src="../images/fig4-3.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 4-3: Different materials are used for the edges and bottom edge of the room, depending on where the room is in the space station compound. (Note that the astronaut and additional scenery won’t be in your game yet.)</em></p></li>
</ul>
<p class="indent">We use a function called <span class="literal">get_floor_type()</span> <span class="ent">➊</span> to find out the correct floor type for the room. Functions can send information back to other parts of the program using the <span class="literal">return</span> instruction, as you can see in this function. <span epub:type="pagebreak" id="page_70"/>The <span class="literal">get_floor_type()</span> function checks whether the <span class="literal">current_room</span> value is in the <span class="literal">outdoor_rooms</span> range. If so, the function returns the number 2, which represents Martian soil. Otherwise, it returns the number 0, which represents a tiled floor. This check is in a separate function so other parts of the program can use it too. The <span class="literal">generate_map()</span> function puts the number that <span class="literal">get_floor_type()</span> returns into the <span class="literal">floor_type</span> variable. Using one instruction <span class="ent">➌</span>, <span class="literal">generate_map()</span> sets up the <span class="literal">floor_type</span> variable to be equal to whatever <span class="literal">get_floor_type()</span> sends back, and it tells the <span class="literal">get_floor_type()</span> function to run now too.</p>
<p class="indent">The <span class="literal">generate_map()</span> function also sets up variables for the <span class="literal">bottom_edge</span> and <span class="literal">side_edge</span>. These variables store the type of material that will be used to make the edges of the room, as shown in <a href="ch04.xhtml#ch04fig3">Figure 4-3</a>. The side edge material is used for the top, left, and right sides, and the bottom edge material is for the bottom edge. If the room number is between 1 and 20 inclusive, it’s a regular planet surface room. The bottom and edge are soil in that case. If the room number is between 21 and 25, it’s a planet surface room that touches the space station at the bottom. This is a special case: the side edge material is soil, but the bottom edge is made of wall pillars. If the room number is higher than 25, the side and bottom edges are made of wall pillars because it’s an inside room. (You can check that these room numbers make sense in <a href="ch04.xhtml#ch04fig1">Figure 4-1</a>.)</p>
<p class="indent">We start making the <span class="literal">room_map</span> list by creating the top row, which will be a row of soil outside or the back wall inside. The top row is made of the same material all the way across, so we can use a shortcut. Try this in the shell:</p>
<p class="programs"><span class="brown">&gt;&gt;&gt;</span> <span class="purple">print</span>([1] * 10)<br/><span class="blue">[1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</span></p>
<p class="indent">The <span class="literal">[1]</span> in the <span class="literal">print()</span> instruction is a list that contains just one item. When we multiply it by 10, we get a list that contains that item 10 times. In our program, we multiply the edge type we’re using by the width of the room <span class="ent">➍</span>. If the top edge has an exit in it, we’ll add that shortly.</p>
<p class="indent">The middle rows of the room are made using a loop <span class="ent">➎</span> that adds each row in turn to the end of <span class="literal">room_map</span>. All the middle rows in a room are the same and are made up of the following:</p>
<ol>
<li class="noindent">An edge tile (either wall or soil) for the left side of the room.</li>
<li class="noindent">The floor in the middle. We can use our shortcut again here. We multiply the <span class="literal">floor_type</span> by the size of the space in the middle of the room. That is the <span class="literal">room_width</span> minus 2 because there are two edge spaces.</li>
<li class="noindent">The edge piece at the right side.</li>
</ol>
<p class="indent">The bottom line is then added <span class="ent">➏</span> and is generated in the same way as the top line.</p>
<h4 class="h4" id="lev68"><span epub:type="pagebreak" id="page_71"/><strong>ADDING EXITS</strong></h4>
<p class="noindent">Next, we add exits in the walls where required. We’ll put the exits in the middle of the walls, so we start by figuring out where the middle row and middle column are <span class="ent">➐</span> by dividing the room height and width by 2. Sometimes this calculation results in a number with a decimal. We need a whole number for our index positions, so we use the <span class="literal">int()</span> function to remove the decimal part <span class="ent">➐</span>. The <span class="literal">int()</span> function converts a decimal number into a whole number (an <em>integer</em>).</p>
<p class="indent">We check for a right exit first <span class="ent">➑</span>. Remember that <span class="literal">room_data</span> contains the information for this room, which was originally taken from <span class="literal">GAME_MAP</span>. The value <span class="literal">room_data[4]</span> tells us whether there is an exit on the right of this room. This instruction:</p>
<p class="programs"><span class="orange">if</span> room_data[4]:</p>
<p class="noindent">is shorthand for this instruction:</p>
<p class="programs"><span class="orange">if</span> room_data[4] == True:</p>
<p class="indent">We use <span class="literal">==</span> to check whether two things are the same. One reason that Boolean values are often a great choice to use for your data is that they make the code easier to read and write, as this example shows.</p>
<p class="indent">When there is a right exit, we change three positions in the middle of the right wall from the edge type to the floor type, making a gap in the wall there. The value <span class="literal">room_width-1</span> finds the <em>x</em> position on the right edge: we subtract 1 because index numbers start at 0. In <a href="ch04.xhtml#ch04fig2">Figure 4-2</a>, for example, you can see that the room width is 11 tiles, but the index position for the right wall is 10. On the planet surface, this code doesn’t change anything, because there’s no wall there to put a gap in. But it’s simpler to let the program add the floor tiles anyway so we don’t have to write code for special cases.</p>
<p class="indent">Before we check whether we need an exit for the left wall, we make sure the room isn’t on the left edge of the map where there can be no exit <span class="ent">➒</span>. The <span class="literal">%</span> operator gives us the remainder when we divide one number by another. If we divide the current room number by the map width, 5, using the <span class="literal">%</span> operator, we’ll get a 1 if the room is on the left edge. The left edge room numbers are 1, 6, 11, 16, 21, 26, 31, 36, 41, and 46. So we only continue checking for a left exit if the remainder is not 1 (<span class="literal">!=</span> means “is not equal to”).</p>
<p class="indent">To see whether we need an exit on the left in this room, we work out which room is on the other side of that wall by subtracting 1 from the current room number. Then we check whether that room has a right exit. If so, our current room needs a left exit, and we add it.</p>
<p class="indent">The exits at the top and bottom are added in a similar way <span class="ent">➓</span>. We check <span class="literal">room_data</span> directly to see whether there’s an exit at the top of the room, and if so, we add a gap in that wall. We can check the room below as well to see whether there should be a bottom exit in the room.</p>
<h4 class="h4" id="lev69"><span epub:type="pagebreak" id="page_72"/><strong>TESTING THE PROGRAM</strong></h4>
<p class="noindent">When you run the program, you can confirm that you don’t see any errors in the Python shell. You can also check that the program is working by generating the map and then printing it from the shell, like this:</p>
<p class="programs"><span class="brown">&gt;&gt;&gt;</span> generate_map()<br/><span class="brown">&gt;&gt;&gt;</span> <span class="purple">print</span>(room_map)<br/><span class="blue">[[1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 1], [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 0,<br/>0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], [1, 1, 1, 1, 1, 1, 1, 1,<br/>1, 1, 1]]</span></p>
<p class="indent">The <span class="literal">current_room</span> variable is set by default to be room 31, the starting room in the game, so that is the <span class="literal">room_map</span> data that prints. From our <span class="literal">GAME_MAP</span> data (and <a href="ch04.xhtml#ch04fig2">Figure 4-2</a>) we can see that this room has 7 rows and 11 columns, and our output confirms that we have 7 lists, each containing 11 numbers: perfect. What’s more, we can see that the first row features four wall pillars, three empty spaces, and then four more wall pillars, so the function has put an exit here as we would expect. Three of the lists have a 0 as their last number too, indicating an exit on the right. It looks like the program is working!</p>
<div class="sidebar">
<p class="sidebart" id="ch4sb1"><strong>TRAINING MISSION #1</strong></p>
<p class="noindent">You can change the value of <span class="literal">current_room</span> from the shell to print a different room. Try entering different values for the room, regenerating the map, and printing it. Check the output against the map and the <span class="literal">GAME_MAP</span> code to make sure the results match what you expect. Here is one example:</p>
<p class="programs"><span class="brown">&gt;&gt;&gt;</span> current_room = 45<br/><span class="brown">&gt;&gt;&gt;</span> generate_map()<br/><span class="brown">&gt;&gt;&gt;</span> <span class="purple">print</span>(room_map)<br/><span class="blue">[[1, 1, 0, 0, 0, 1, 1], [1, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 1],<br/>[1, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0, 1],<br/>[1, 1, 0, 0, 0, 1, 1]]</span></p>
<p class="spara1">What happens when you enter a value for one of the planet surface rooms?</p>
</div>
<h3 class="h3" id="lev70"><strong>EXPLORING THE SPACE STATION IN 3D</strong></h3>
<p class="noindent">Let’s turn our room maps into rooms! We’ll combine the code we created for turning room maps into 3D rooms in <a href="ch03.xhtml#ch03">Chapter 3</a> with our code for extracting the room map from the game map. Then we can tour the space station and start to get our bearings.</p>
<p class="indent">The <em>Explorer</em> feature of our program will enable us to view all the rooms on the space station. We’ll give it its own <span class="literal">EXPLORER</span> section in the program. It’s a temporary measure to enable us to quickly see results. We’ll replace the <em>Explorer</em> with better code for viewing rooms in <a href="ch07.xhtml#ch07">Chapters 7</a> and <a href="ch08.xhtml#ch08">8</a>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_73"/>Add the code in <a href="ch04.xhtml#ch04list3">Listing 4-3</a> to the end of your program for <a href="ch04.xhtml#ch04list2">Listing 4-2</a>, after the instructions shown in gray. Then save the program as <em>listing4-3.py</em>. Remember to save it with your other programs for this book in the <em>escape</em> folder so the <em>images</em> folder is in the right place (see “<a href="intro.xhtml#lev8">Downloading the Game Files</a>” on <a href="intro.xhtml#page_7">page 7</a>).</p>
<p class="margin"><em>listing4-3.py</em></p>
<p class="programs">               <span class="gray">room_map[room_height-1][middle_column] = floor_type</span> <br/>               <span class="gray">room_map[room_height-1][middle_column + 1] = floor_type</span><br/>               <span class="gray">room_map[room_height-1][middle_column - 1] = floor_type</span><br/><br/>   <span class="red">###############</span><br/>   <span class="red">## EXPLORER  ##</span><br/>   <span class="red">###############</span><br/><br/>   <span class="orange">def</span> <span class="blue">draw</span>():<br/>       <span class="orange">global</span> room_height, room_width, room_map<br/><span class="ent">➊</span>     generate_map()<br/>       screen.clear()<br/><br/><span class="ent">➋</span>     <span class="orange">for</span> y <span class="orange">in</span> <span class="purple">range</span>(room_height):<br/>           <span class="orange">for</span> x <span class="orange">in</span> <span class="purple">range</span>(room_width):<br/>               image_to_draw = DEMO_OBJECTS[room_map[y][x]]<br/>               screen.blit(image_to_draw,<br/>                   (top_left_x + (x*30),<br/>                   top_left_y + (y*30) - image_to_draw.get_height()))<br/><br/><span class="ent">➌</span> <span class="orange">def</span> <span class="blue">movement</span>():<br/>       <span class="orange">global</span> current_room<br/>       old_room = current_room<br/><br/>       <span class="orange">if</span> keyboard.left:<br/>           current_room -= 1<br/>       <span class="orange">if</span> keyboard.right:<br/>           current_room += 1<br/>       <span class="orange">if</span> keyboard.up:<br/>           current_room -= MAP_WIDTH<br/>       <span class="orange">if</span> keyboard.down:<br/>           current_room += MAP_WIDTH<br/><br/><span class="ent">➍</span>     <span class="orange">if</span> current_room &gt; 50:<br/><span class="ent">➎</span>         current_room = 50<br/>       <span class="orange">if</span> current_room &lt; 1:<br/>           current_room = 1<br/><br/><span class="ent">➏</span>     <span class="orange">if</span> current_room != old_room:<br/><span class="ent">➐</span>         <span class="purple">print</span>(<span class="green">"Entering room:"</span> + <span class="purple">str</span>(current_room))<br/><br/><span class="ent">➑</span> clock.schedule_interval(movement, 0.1)</p>
<p class="listing" id="ch04list3"><em>Listing 4-3: The</em> Explorer <em>code</em></p>
<p class="indent">The new additions in <a href="ch04.xhtml#ch04list3">Listing 4-3</a> should look familiar to you. We call the <span class="literal">generate_map()</span> function to create the <span class="literal">room_map</span> data for the current <span epub:type="pagebreak" id="page_74"/>room <span class="ent">➊</span>. We then display it <span class="ent">➋</span> using the code we created in <a href="ch03.xhtml#ch03list5">Listing 3-5</a> in <a href="ch03.xhtml#ch03">Chapter 3</a>. We use keyboard controls to change the <span class="literal">current_room</span> variable <span class="ent">➌</span>, similar to how we changed the <em>x</em> and <em>y</em> position of our spacewalking astronaut in <a href="ch01.xhtml#ch01">Chapter 1</a> (see <a href="ch01.xhtml#ch01list4">Listing 1-4</a>). To go up or down a row in the map, we change the <span class="literal">current_room</span> number by the width of the game map. For example, to go up a row from room 32, we subtract 5 to go into room 27 (see <a href="ch04.xhtml#ch04fig1">Figure 4-1</a>). If the room number has changed, the program prints the <span class="literal">current_room</span> variable <span class="ent">➏</span>. The <span class="literal">str()</span> function converts the room number to a string <span class="ent">➐</span>, so it can be joined to the <span class="literal">"Entering room:"</span> string. Without using the <span class="literal">str()</span> function, you can’t join a number to a string.</p>
<p class="indent">Finally, we schedule the <span class="literal">movement</span> function to run at regular intervals <span class="ent">➑</span>, as we did in <a href="ch01.xhtml#ch01">Chapter 1</a>. This time, we have a longer gap between each time the function runs (0.1 seconds), so the keys are less responsive.</p>
<p class="indent">From the command line, navigate to your <em>escape</em> folder and run the program from the command line using <span class="codestrong">pgzrun listing4-3.py</span>.</p>
<p class="indent">The screen should be similar to <a href="ch04.xhtml#ch04fig4">Figure 4-4</a>, which shows the walls and doorways for room 31.</p>
<div class="image"><a id="ch04fig4"/><img src="../images/fig4-4.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 4-4: The</em> Explorer <em>shows your starting room in 3D.</em></p>
<p class="indent">Now you can use the arrow keys to explore the map. The program will draw a room for you and enable you to go to the neighboring rooms by pressing an arrow key. At this point, you only see the shell of the room: walls and floor. We’ll add more objects in the rooms and your character later.</p>
<p class="indent">At the moment, you can walk in any direction, including through walls: the program doesn’t check for any movement errors. If you walk off the left of the map, you’ll reappear on the right, a row higher. If you walk off the right, you’ll reappear on the left, a row lower. If you try to go off the top or <span epub:type="pagebreak" id="page_75"/>the bottom of the map, the program will return you to room 1 (at the top) or room 50 (at the bottom). For example, if the room number is more than (<span class="literal">&gt;</span>) 50 <span class="ent">➍</span> it’s reset to 50 <span class="ent">➎</span>. In this code, I’ve lowered the sensitivity of the keys to reduce the risk of whizzing through the rooms too fast. If you find the controls unresponsive or sluggish, you might need to press the keys for slightly longer.</p>
<p class="indent">Explore the space station and compare what you see on screen with the map in <a href="ch04.xhtml#ch04fig1">Figure 4-1</a>. If you see any errors, go back to the <span class="literal">GAME_MAP</span> data to check the data, and then take another look at the <span class="literal">generate_map()</span> function to make sure it’s been entered correctly. To help you follow the map, when you move to a new room, its number will appear in the command line window where you entered the <span class="literal">pgzrun</span> command, as shown in <a href="ch04.xhtml#ch04fig5">Figure 4-5</a>.</p>
<div class="image"><a id="ch04fig5"/><img src="../images/fig4-5.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 4-5: The command line window tells you which room you’re entering.</em></p>
<p class="indent">Also, check that exits exist from both sides: if you go through a door and it isn’t there when you look from the other side, <span class="literal">generate_map()</span> has been entered incorrectly. Follow along on the map first to make sure you’re not going off the edge of the map and coming back on the other side before you start debugging. It’s worth taking the time to make sure your map data and functions are all correct at this point, because broken map data can make it impossible to complete the <em>Escape</em> game!</p>
<div class="sidebar">
<p class="sidebart" id="ch04sb2"><strong>TRAINING MISSION #2</strong></p>
<p class="spara">To enjoy playing <em>Escape</em> and solving the puzzles, I recommend that you use the data I’ve provided for the game map. It’s best not to change the data until you’ve completed playing the game and have decided to redesign it. Otherwise, objects might be in locations you can’t reach, making the game impossible to complete.</p>
<p class="spara1">However, you can safely extend the map. The easiest way to do so is to add another row of rooms at the bottom of the map, making sure a door connects at least one of the new rooms to the existing bottom row of the map. Remember to change the <span class="literal">MAP_HEIGHT</span> variable. You’ll also need to change the number 50 in the <em>Explorer</em> code (<em>listing4-3.py</em>) to your highest room number (see <span class="ent">➍</span> and <span class="ent">➎</span>). Why not add a corridor now?</p>
</div>
<h3 class="h3" id="lev71"><span epub:type="pagebreak" id="page_76"/><strong>MAKING YOUR OWN MAPS</strong></h3>
<p class="noindent">After you’ve finished building and playing <em>Escape</em>, you can customize the map or design your own game layouts using this code.</p>
<p class="indent">If you want to add your own map data for rooms 1 to 25, delete the code that generates their data automatically (see <span class="ent">➏</span> in <a href="ch04.xhtml#ch04list1">Listing 4-1</a>). You can then add your own data for these rooms.</p>
<p class="indent">Alternatively, if you don’t want to use the planet surface locations, just block the exit to them. The exit onto the planet surface is in room 26. Change that room’s entry in the <span class="literal">GAME_MAP</span> list so it doesn’t have a top exit. You can use room numbers starting at room 26 and extend the map downward to make a game that is completely indoors. As a result, you won’t need to make any code changes to account for the planet surface.</p>
<p class="indent">If you remove a doorway from the <em>Escape</em> game map (including the one in room 26), you might also need to remove a door. Some of the exits at the top and bottom of the room will have doors that seal them off. (We’ll add doors to the <em>Escape</em> game in <a href="ch11.xhtml#ch11">Chapter 11</a>.)</p>
<h3 class="h3" id="lev72"><strong>ARE YOU FIT TO FLY?</strong></h3>
<p class="noindentb">Check the following boxes to confirm that you’ve learned the key lessons in this chapter.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  The <span class="literal">GAME_MAP</span> list stores the main map data for <em>Escape</em>.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  The <span class="literal">GAME_MAP</span> only needs to store the exit at the top and right of a room.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  When the player visits a room, the <span class="literal">generate_map()</span> function makes the <span class="literal">room_map</span> list for the current room. The <span class="literal">room_map</span> list describes where the walls and objects are in the room.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  Locations 1 to 25 are on the planet surface, and a loop generates their map data. Locations 26 to 50 are the space station rooms, and you need to input their data manually.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  We use comments to help us find our way around the <em>Escape</em> program listing.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  When adding data using a program in script mode, you can use the shell to check the contents of lists and variables to make sure the program is working correctly. Remember to run the program first to set up the data!</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  The <em>Explorer</em> code enables you to look at every room in the game map using the arrow keys.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  It’s important to make sure the game map matches <a href="ch04.xhtml#ch04fig1">Figure 4-1</a>. Otherwise, it might not be possible for players to complete the <em>Escape</em> game. You can use the <em>Explorer</em> program to do this.</p>
<div class="image" id="ch04sb3"><span epub:type="pagebreak" id="page_77"/><img src="../images/f0077-01.jpg" alt="image"/><span epub:type="pagebreak" id="page_78"/></div>
</body></html>