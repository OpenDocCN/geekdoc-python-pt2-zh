<html><head></head><body>
<h2 class="h2" id="ch12"><span epub:type="pagebreak" id="page_239"/><strong><span class="big">12</span><br/>SECURING YOUR NEST EGG</strong></h2>
<div class="image1"><img src="../images/common01.jpg" alt="image"/></div>
<p class="noindent">Baby boomers are Americans born between 1946 and 1964. They form a large demographic cohort—about 20 percent of the American population—so they’ve had a huge influence on all aspects of American culture. The financial industry was quick to cater to their needs, which for decades concerned investment growth. But in 2011, the oldest boomers reached age 65 and began retiring in droves, at the rate of 10,000 <em>per day</em>! With an average life span longer than that of preceding generations, a boomer may enjoy a retirement as long as their career. Funding this 30- to 40-year period is a big problem and a big business.</p>
<p class="indent">In the years when financial advisers were mainly focused on <em>growing</em> boomers’ wealth, they relied on the simple “4 Percent Rule” for retirement planning. Simply stated, for every year you’re retired, if you spend an amount no larger than 4 percent of the savings you had <em>in the first year of retirement</em>, you’ll never run out of money. But as Mark Twain observed, <span epub:type="pagebreak" id="page_240"/>“All generalizations are false, including this one!” The value of our investments and the amount we spend are constantly in flux, often due to forces outside of our control.</p>
<p class="indent">As a more sophisticated alternative to the 4 Percent Rule, the financial industry adopted Monte Carlo simulation (see <a href="ch11.xhtml#ch11">Chapter 11</a> for an overview of MCS). With MCS, you can test and compare retirement strategies over thousands of lifetimes. The goal is to identify how much money you can spend each year in retirement, given your life expectancy, without exhausting your savings.</p>
<p class="indent">The advantage of MCS over other methods increases as the sources of uncertainty increase. In <a href="ch11.xhtml#ch11">Chapter 11</a>, you applied MCS to a single variable with a simple probability distribution. Here you’ll look at uncertainty around life spans, while capturing the true cyclicity and interdependency of the stock and bond markets and inflation. This will allow you to evaluate and compare different strategies for achieving a secure and happy retirement.</p>
<h3 class="h3a" id="lev272"><strong>Project #20: Simulating Retirement Lifetimes</strong></h3>
<p class="indent">If you think you’re too young to worry about retirement, think again. The baby boomers thought the same thing, and now over half of them have insufficient savings for retirement. For most people, the difference between eating Kobe beef or dog food in retirement is how soon they start saving. Due to the magic of compounding interest, even modest savings can add up over decades. Knowing early the numbers you’ll need later enables you to set realistic goals for a painless transition to your golden years.</p>
<div class="sidebar">
<p class="sidebart"><strong>THE OBJECTIVE</strong></p>
<p class="spara">Build a Monte Carlo simulation for estimating the probability of running out of money in retirement. Treat years in retirement as a key uncertainty and use historical stock, bond, and inflation data to capture the observed cyclicity and dependency of these variables.</p>
</div>
<h3 class="h3" id="lev273"><strong>The Strategy</strong></h3>
<p class="noindent">To plan your project, don’t hesitate to check out the competition. Numerous nest-egg calculators are available online for free. If you play with these, you’ll see that they display a high level of input-parameter variability.</p>
<p class="indent">Calculators with many parameters may seem better (see <a href="ch12.xhtml#ch12fig1">Figure 12-1</a>), but with each added detail, you start going down rabbit holes, especially when it comes to the US’s complex tax code. When you’re predicting outcomes 30 to 40 years into the future, details can become noise. So, you’re better off keeping it simple, focusing on the most important and controllable issues. You can control when you retire, your investment asset allocation, how much you save, and how much you spend, but you can’t control the stock market, interest rates, and inflation.</p>
<div class="image"><span epub:type="pagebreak" id="page_241"/><a id="ch12fig1"/><img src="../images/f0241-01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-1: Example input panels for three online nest-egg calculators</em></p>
<p class="indent">When you can’t know the “correct” answer to a problem, looking at a range of scenarios and making decisions based on probabilities is best. For decisions that involve a “fatal error,” like running out of money, desirable solutions are those that lower the likelihood of that event.</p>
<p class="indent">Before you get started, you need to speak the language, so I put together a list of the financial terms you’ll use in this project:</p>
<p class="hang"><strong>Bonds</strong> A bond is debt investment in which you loan money to an entity—usually a government or corporation—for a set length of time. The borrower pays you an agreed-upon rate of interest (the bond’s <em>yield</em>) and, at the end of the term, returns the full value of the loan, assuming the issuing entity doesn’t go broke and default. The value of bonds can go up and down over time, so you may lose money if you sell a bond early. Bonds are appealing to retirees, as they offer safe, steady, predictable returns. Treasury bonds, issued by the US government, are considered the safest of all. Unfortunately, most bond returns tend to be low, so they are vulnerable to inflation.</p>
<p class="hang"><strong>Effective tax rate</strong> This is the average rate at which an individual or married couple is taxed. It includes local, state, and federal taxes. Taxes can be complicated, with large variances in state and local tax rates, many opportunities for deductions and adjustments, and variable rates for different types of income (such as short- versus long-term <span epub:type="pagebreak" id="page_242"/>capital gains). The tax code is also <em>progressive</em>, which means you pay proportionally more as your income increases. According to The Motley Fool, a financial services company, the average American’s overall income-based tax rate was 29.8 percent in 2015. And this excludes sales and property taxes! You can also count on Congress to tinker with these rates at least once in a 30-year retirement. Due to these complexities, for this project you should adjust your <em>withdrawal</em> (spending) parameter to account for taxes.</p>
<p class="hang"><strong>Index</strong> It is safest to invest in many assets, rather than putting all your (nest) eggs in one basket. An index is a hypothetical portfolio of securities, or group of baskets, designed to represent a broad part of a financial market. The Standard &amp; Poor (S&amp;P) 500, for example, represents the 500 largest US companies, which are mostly dividend-paying companies. Index-based investments—such as an index mutual fund—allow an investor to conveniently buy one thing that contains the stocks of hundreds of companies.</p>
<p class="hang"><strong>Inflation</strong> This is the increase in prices over time due to increasing demand, currency devaluation, rising energy costs, and so on. Inflation is an insidious destroyer of wealth. The inflation rate is variable, but has averaged about 3 percent annually since 1926. At that rate, the value of money is halved every 24 years. A little inflation (1 to 3 percent) generally indicates that the economy is growing and wages are going up. Higher inflation and negative inflation are both undesirable.</p>
<p class="hang"><strong>Number of cases</strong> These are the trials or runs performed during MCS; each case represents a single retirement lifetime and is simulated with a new set of randomly selected values. For the simulations you will be running, somewhere between 50,000 and 100,000 cases should provide a suitably repeatable answer.</p>
<p class="hang"><strong>Probability of ruin</strong> This is the probability of running out of money before the end of retirement. You can calculate it as the number of cases that end with no money divided by the total number of cases.</p>
<p class="hang"><strong>Start value</strong> The starting value is the total value of liquid investments, including checking accounts, brokerage accounts, tax-deferred Individual Retirement Accounts (IRAs), and so on, that are held at the start of retirement. It doesn’t equate to <em>net worth</em>, which includes assets like houses, cars, and Fabergé eggs.</p>
<p class="hang"><strong>Stocks</strong> A stock is a security that signifies ownership in a corporation and represents a claim on part of the corporation’s assets and earnings. Many stocks pay <em>dividends</em>, a regular payment similar to the interest paid by a bond or a bank account. For the average person, stocks are the quickest way to grow wealth, but they’re not without risk. The price of a stock can go up and down rapidly over a short time—both because of the company’s performance and because of speculation arising from investor greed or fear. Retirees tend to invest in the largest dividend-paying US companies because they offer regular income and a less volatile stock price than do smaller companies.</p>
<p class="hang"><span epub:type="pagebreak" id="page_243"/><strong>Total returns</strong> The sum of capital gains (changes in asset value, like stock price), interest, and dividends is considered the total return of an investment. It is usually quoted on an annual basis.</p>
<p class="hang"><strong>Withdrawal</strong> Also referred to as costs or spending, withdrawal is the pretax, gross income you’ll need to cover all expenses in a given year. For the 4 Percent Rule, this would represent 4 percent of the start value in the first year of retirement. This number should be adjusted for inflation in each subsequent year.</p>
<h4 class="h4" id="lev274"><strong><em>Historical Returns Matter</em></strong></h4>
<p class="noindent">Nest-egg simulators that use constant values for investment returns and inflation (see <a href="ch12.xhtml#ch12fig1">Figure 12-1</a>) grossly distort reality. Predictive ability is only as good as the underlying assumptions, and returns can be highly volatile, interdependent, and cyclical. This volatility impacts retirees the most when the start of retirement—or a large unexpected expense—coincides with the beginning of a big market downturn.</p>
<p class="indent">The chart in <a href="ch12.xhtml#ch12fig2">Figure 12-2</a> displays the annual returns for both the S&amp;P 500 index of the largest US companies and the 10-year Treasury bond, which is a reasonably safe, medium-risk, fixed-income investment. It also includes annual inflation rates and significant financial events like the Great Depression.</p>
<div class="image"><a id="ch12fig2"/><img src="../images/f0243-01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-2: Annual rate of inflation plus total returns for stock and bond markets, 1926 to 2013</em></p>
<p class="indent">Financial scholars’ long study of the trends in <a href="ch12.xhtml#ch12fig2">Figure 12-2</a> have led to some useful observations about US markets:</p>
<ul>
<li class="noindent">Upward-moving (bull) markets tend to last five times as long as downward-moving (bear) markets.</li>
<li class="noindent"><span epub:type="pagebreak" id="page_244"/>Harmful high inflation rates can persist for as long as a decade.</li>
<li class="noindent">Bonds tend to deliver low returns that struggle to keep up with inflation.</li>
<li class="noindent">Stock returns outpace inflation easily, but at the cost of great volatility in prices.</li>
<li class="noindent">Stock and bond returns are often inversely correlated; this means that bond returns decrease as stock returns increase, and vice versa.</li>
<li class="noindent">Neither the stocks of large companies nor Treasury bonds can guarantee you a smooth ride.</li>
</ul>
<p class="indent">Based on this information, financial advisers recommend that most retirees hold a diversified portfolio that includes multiple investment types. This strategy uses one investment type as a “hedge” against another, dampening the highs but raising the lows, theoretically reducing volatility.</p>
<p class="indent">In <a href="ch12.xhtml#ch12fig3">Figure 12-3</a>, annual investment returns are plotted using both the S&amp;P 500 and a hypothetical 40/50/10 percent blend of, respectively, the S&amp;P 500, the 10-year Treasury bond, and cash. The three-month Treasury bill, which is a very short-term bond with a stable price and low yield (like money stuffed in your mattress), represents cash.</p>
<div class="image"><a id="ch12fig3"/><img src="../images/f0244-01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-3: Annual returns of the S&amp;P 500 versus a blend of the S&amp;P 500, 10-year Treasury bond, and cash, 1926 to 2013</em></p>
<p class="indent">This diversified portfolio provides a smoother ride than the stock market alone, while still providing protection from inflation. But it will clearly produce different results than online calculators that assume returns are <em>always</em> constant and positive in value.</p>
<p class="indent"><span epub:type="pagebreak" id="page_245"/>By using historical data, you capture the true <em>measured</em> duration of good times and bad, along with the highest highs and the lowest lows. You also account for something completely ignored by the 4 Percent Rule: <em>the black swan</em>.</p>
<p class="indent">Black swans are consequential, improbable events. These can be good, like meeting your spouse, or bad, like Black Monday, the stock market crash of October 1987. An advantage of MCS is that it can factor in these unexpected events; a disadvantage is that you have to program them, and if they are truly unforeseeable, how can you know what to include?</p>
<p class="indent">Black swans that have already occurred, like the Great Depression, are captured in the annual values in lists of historical returns. So, a common approach is to use historical results and assume that nothing worse—or better—will occur in the future. When a simulation uses data from the Great Depression, the modeled portfolio will experience the same stock, bond, and inflation behavior as real portfolios at the time.</p>
<p class="indent">If using past data seems too restrictive, you can always edit the past results to reflect lower lows and higher highs. But most people are practical and are happier dealing with events they <em>know</em> have occurred—as opposed to zombie apocalypses or alien invasions—so true historical results offer a <em>credible</em> way to inject reality into financial planning.</p>
<p class="indent">Some economists argue that inflation and returns data before 1980 are of limited use, because the Federal Reserve now takes a more active role in monetary policy and the control of inflation. On the other hand, that is <em>exactly</em> the kind of thinking that leaves us exposed to black swans!</p>
<h4 class="h4" id="lev275"><strong><em>The Greatest Uncertainty</em></strong></h4>
<p class="noindent">The greatest uncertainty in retirement planning is the date you—or your surviving spouse—die, euphemistically referred to as “end of plan” by financial advisers. This uncertainty affects every retirement-related decision, such as when you retire, how much you spend in retirement, when you start taking Social Security, how much you leave your heirs, and so on.</p>
<p class="indent">Insurance companies and the government deal with this uncertainty with <em>actuarial life tables</em>. Based on the mortality experience of a population, actuarial life tables predict the life expectancy at a given age, expressed as the average remaining number of years expected prior to death. You can find the Social Security table at <em><a href="https://www.ssa.gov/oact/STATS/table4c6.html">https://www.ssa.gov/oact/STATS/table4c6.html</a></em>. Based on this table, a 60-year-old woman in 2014 would have a life expectancy of 24.48 years; this means end of plan would occur during her 84th year.</p>
<p class="indent">Actuarial tables work fine for large populations, but for individuals, they’re just a starting point. You should examine a range of values, tailored to family history and personal health issues, when preparing your own retirement plan.</p>
<p class="indent">To handle this uncertainty in your simulation, consider years in retirement a <em>random variable</em>, whose values are chosen at random from a frequency distribution. For example, you can enter the most likely, minimum, and maximum number of years you expect to be retired and use these <span epub:type="pagebreak" id="page_246"/>values to build a triangular distribution. The most-likely value can come from an actuarial table, but the endpoints should be based on your personal health outlook and family history.</p>
<p class="indent">An example outcome, based on a triangular distribution for years in retirement for a 60-year-old man, is shown in <a href="ch12.xhtml#ch12fig4">Figure 12-4</a>. The minimum retirement period was set to 20 years, the most likely to 22 years, and the maximum to 40 years. The number of draws from the distribution was 1,000.</p>
<div class="image"><a id="ch12fig4"/><img src="../images/f0246-01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-4: Number of lifetimes versus years in retirement based on 1,000 draws from a triangular distribution</em></p>
<p class="indent">As you can see, every possible time interval between the minimum and maximum values is available for simulation, but the intervals taper off in frequency from the most likely value to the maximum value, indicating that living to 100 is possible but unlikely. Note also that the plot is significantly skewed to the high side. This will ensure conservative results, since—from a financial perspective—dying early is an optimistic outcome and living longer than expected represents the greatest financial risk.</p>
<h4 class="h4" id="lev276"><strong><em>A Qualitative Way to Present Results</em></strong></h4>
<p class="noindent">An issue with MCS is making sense of thousands of runs and presenting the results in an easily digestible manner. Most online calculators present outcomes using a chart like the one in <a href="ch12.xhtml#ch12fig5">Figure 12-5</a>. In this example, for a 10,000-run simulation, the calculator plots a few selected outcomes with age on the x-axis and investment value on the y-axis. The curves converge on the left at the starting value of the investments at retirement, and they end on the right with their value at end of plan. The overall probability of the money’s lasting through retirement may also be presented. Financial advisers consider probabilities below 80 to 90 percent risky.</p>
<div class="image"><span epub:type="pagebreak" id="page_247"/><a id="ch12fig5"/><img src="../images/f0247-01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-5: Example display from a typical financial industry retirement simulator</em></p>
<p class="indent">The most important piece of information from this type of analysis is the probability of running out of money. It is also interesting to see the endpoint and average outcomes and a summary of the input parameters. In your Python simulator, you can print these in the interpreter window, as shown here:</p>
<pre>Investment type: bonds<br/>Starting value: $1,000,000<br/>Annual withdrawal: $40,000<br/>Years in retirement (min-ml-max): 17-25-40<br/>Number of runs: 20,000<br/><br/>Odds of running out of money: 36.1%<br/><br/>Average outcome: $883,843<br/>Minimum outcome: $0<br/>Maximum outcome: $7,607,789</pre>
<p class="indent">For a graphical presentation, rather than duplicate what others have done, let’s find a new way to present the outcomes. A subset of the results of each case—that is, the money remaining at the end of retirement—can be presented as a vertical line in a bar chart, as in <a href="ch12.xhtml#ch12fig6">Figure 12-6</a>.</p>
<div class="image"><span epub:type="pagebreak" id="page_248"/><a id="ch12fig6"/><img src="../images/f0248-01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-6: The outcomes of simulated retirement periods displayed as vertical columns in a bar chart</em></p>
<p class="indent">In this chart, each bar represents the retirement portion of a single simulated lifetime, and the height of each bar represents the money remaining at the end of that life. Because each bar represents an individual category rather than intervals for continuous measurement, you can arrange the bars in any order without affecting the data. Gaps, representing cases that ran out of money, can be included in the order they occurred in the simulation. With the quantitative statistics recorded in the interpreter window, this diagram provides a qualitative way to present the results.</p>
<p class="indent">The peaks and valleys of this chart represent the changing fortunes of many possible futures. In one lifetime, you can die destitute; in the next, you’re a multimillionaire. It’s evocative of the old saying “There but for the grace of God go I.” But, on the other hand, it reinforces General Eisenhower’s observation that “plans are useless, but planning is indispensable.” Through financial planning, you can “raise the valleys” in the chart and eliminate or greatly reduce your odds of going broke in retirement.</p>
<p class="indent">To make this chart, you’ll use <code>matplotlib</code>, a library that supports 2D plotting and rudimentary 3D plotting. To learn more about <code>matplotlib</code> and how to install it, see “<a href="ch10.xhtml#lev226">The Probability-of-Detection Code</a>” on <a href="ch10.xhtml#page_194">page 194</a>.</p>
<h3 class="h3" id="lev277"><strong>The Pseudocode</strong></h3>
<p class="noindent">Based on the preceding discussion, the program design strategy should be to focus on a few important retirement parameters and simulate outcomes using the historical behavior of the financial markets. Here’s the high-level pseudocode:</p>
<pre>Get user input for investment type (all stocks, all bonds, or a blend)<br/>Map investment type choice to a list of historical returns<br/>Get user input for the starting value of investments<br/>Get user input for the initial yearly withdrawal amount<br/>Get user input for the minimum, most likely, and maximum duration of retirement<br/>Get user input on number of cases to run<br/>Start list to hold outcomes<br/><span epub:type="pagebreak" id="page_249"/>Loop through cases:<br/>    For each case:<br/>        Extract random contiguous sample of returns list for duration period<br/>        Extract same interval from inflation list<br/>        For each year in sample:<br/>            If year not equal to year 1:<br/>                Adjust withdrawal for inflation<br/>            Subtract withdrawal from investments<br/>            Adjust investments for returns<br/>            If investments &lt;= 0:<br/>                Investments = 0<br/>                Break<br/>    Append investments value to outcomes list<br/>Display input parameters<br/>Calculate and display the probability of ruin<br/>Calculate and display statistics<br/>Display a subset of outcomes as a bar chart</pre>
<h3 class="h3" id="lev278"><strong>Finding Historical Data</strong></h3>
<p class="noindent">You can find returns and inflation information on numerous websites (see “<a href="ch12.xhtml#lev289">Further Reading</a>” on <a href="ch12.xhtml#page_263">page 263</a> for some examples), but I have already compiled the information you need as a series of downloadable text files. If you choose to compile your own lists, be aware that estimates of both inflation and returns may vary slightly from site to site.</p>
<p class="indent">For returns, I used three investment vehicles: the S&amp;P 500 stock index, the 10-year Treasury bond, and the three-month Treasury bill, all for the period 1926 to 2013 (1926–1927 values for the Treasury bill are estimates). I used this data to generate additional blended returns for the same period. The following list describes the filenames and contents:</p>
<p class="hang"><strong><em>SP500_returns_1926-2013_pct.txt</em></strong> Total returns for the S&amp;P 500 (1926–2013)</p>
<p class="hang"><strong><em>10-yr_TBond_returns_1926-2013_pct.txt</em></strong> Total returns for the 10-year Treasury bond (1926–2013)</p>
<p class="hang"><strong><em>3_mo_TBill_rate_1926-2013_pct.txt</em></strong> Rate of three-month Treasury bill (1926–2013)</p>
<p class="hang"><strong><em>S-B_blend_1926-2013_pct.txt</em></strong> 50/50 percent mix of S&amp;P 500 and 10-year Treasury bond (1926–2013)</p>
<p class="hang"><strong><em>S-B-C_blend_1926-2013_pct.txt</em></strong> 40/50/10 percent mix of S&amp;P 500, 10-year Treasury bond, three-month Treasury bill (1926–2013)</p>
<p class="hang"><strong><em>annual_infl_rate_1926-2013_pct.txt</em></strong> Average annual US inflation rate (1926–2013)</p>
<p class="indentt">Here’s an example of the first seven lines of the S&amp;P 500 text file:</p>
<pre>11.6<br/>37.5<br/>43.8<br/>-8.3<br/><span epub:type="pagebreak" id="page_250"/>-25.1<br/>-43.8<br/>-8.6</pre>
<p class="indent">The values are percentages, but you’ll change them to decimal values when you load them in the code. Note that years aren’t included, as the values are in chronological order. If all the files cover the same time interval, the actual years are irrelevant, though you should include them in the filename for good bookkeeping.</p>
<h3 class="h3" id="lev279"><strong>The Code</strong></h3>
<p class="noindent">Name your retirement nest-egg simulator <em>nest_egg_mcs.py</em>. You’ll need the text files described in “<a href="ch12.xhtml#lev278">Finding Historical Data</a>” on <a href="ch12.xhtml#page_249">page 249</a>. Download these files from <em><a href="https://www.nostarch.com/impracticalpython/">https://www.nostarch.com/impracticalpython/</a></em> and keep them in the same folder as <em>nest_egg_mcs.py</em>.</p>
<h4 class="h4" id="lev280"><strong><em>Importing Modules and Defining Functions to Load Data and Get User Input</em></strong></h4>
<p class="noindent"><a href="ch12.xhtml#ch12list1">Listing 12-1</a> imports modules and defines a function to read the historical returns and inflation data, as well as another function to get the user’s input. Feel free to alter or add to the historical data to conduct experiments after the program is up and running.</p>
<p class="margin"><em>nest_egg_mcs.py,</em> part 1</p>
<pre>   import sys<br/>
   import random<br/>
<span class="ent">➊</span> import matplotlib.pyplot as plt<br/>
<br/>
<span class="ent">➋</span> def read_to_list(file_name):<br/>
       """Open a file of data in percent, convert to decimal &amp; return a list."""<br/>
       <span class="ent">➌</span> with open(file_name) as in_file:<br/>
           <span class="ent">➍</span> lines = [float(line.strip()) for line in in_file]<br/>
           <span class="ent">➎</span> decimal = [round(line / 100, 5) for line in lines]<br/>
           <span class="ent">➏</span> return decimal<br/>
<br/>
<span class="ent">➐</span> def default_input(prompt, default=None):<br/>
       """Allow use of default values in input."""<br/>
<span class="ent">➑</span>     prompt = '{} [{}]: '.format(prompt, default)<br/>
<span class="ent">➒</span>     response = input(prompt)<br/>
<span class="ent">➓</span>     if not response and default:<br/>
           return default<br/>
       else:<br/>
           return response</pre>
<p class="listing" id="ch12list1"><em>Listing 12-1: Imports modules and defines functions to load data and get user input</em></p>
<p class="indent">The <code>import</code> statements should all be familiar. The <code>matplotlib</code> library is needed to build the bar chart of results. You only need the plotting functionality, as specified in the <code>import</code> statement <span class="ent">➊</span>.</p>
<p class="indent">Next, define a function called <code>read_to_list()</code> to load a data file and process its contents <span class="ent">➋</span>. You’ll pass it the name of the file as an argument.</p>
<p class="indent"><span epub:type="pagebreak" id="page_251"/>Open the file using <code>with</code>, which will automatically close it <span class="ent">➌</span>, and then use list comprehension to build a list of the contents <span class="ent">➍</span>. Immediately convert the list items, which are in percents, to decimal values rounded to five decimal places <span class="ent">➎</span>. Historical returns are usually presented to two decimal places at most, so rounding to five should be sufficient. You may notice more accuracy in the values of some of the data files used here, but that’s just the result of some preprocessing in Excel. End by returning the <code>decimal</code> list <span class="ent">➏</span>.</p>
<p class="indent">Now, define a function called <code>default_input()</code> to get the user’s input <span class="ent">➐</span>. The function takes a prompt and a default value as arguments. The prompt and default will be specified when the function is called, and the program will display the default in brackets <span class="ent">➑</span>. Assign a <code>response</code> variable to the user’s input <span class="ent">➒</span>. If the user enters nothing and a default value exists, the default value is returned; otherwise, the user’s response is returned <span class="ent">➓</span>.</p>
<h4 class="h4" id="lev281"><strong><em>Getting the User Input</em></strong></h4>
<p class="noindent"><a href="ch12.xhtml#ch12list2">Listing 12-2</a> loads the data files, maps the resulting lists to simple names using a dictionary, and gets the user’s input. The dictionary will be used to present the user with multiple choices for an investment type. Overall, user input consists of:</p>
<ul>
<li class="noindent">The type of investment to use (stocks, bonds, or a blend of both)</li>
<li class="noindent">The starting value of their retirement savings</li>
<li class="noindent">A yearly withdrawal, or spending, amount</li>
<li class="noindent">The minimum, most likely, and maximum number of years they expect to live in retirement</li>
<li class="noindent">The number of cases to run</li>
</ul>
<p class="margin"><em>nest_egg_mcs.py,</em> part 2</p>
<pre>   # load data files with original data in percent form<br/><span class="ent">➊</span> print("\nNote: Input data should be in percent, not decimal!\n")<br/>   try:<br/>       bonds = read_to_list('10-yr_TBond_returns_1926-2013_pct.txt')<br/>       stocks = read_to_list('SP500_returns_1926-2013_pct.txt')<br/>       blend_40_50_10 = read_to_list('S-B-C_blend_1926-2013_pct.txt')<br/>       blend_50_50 = read_to_list('S-B_blend_1926-2013_pct.txt')<br/>       infl_rate = read_to_list('annual_infl_rate_1926-2013_pct.txt')<br/>   except IOError as e:<br/>       print("{}. \nTerminating program.".format(e), file=sys.stderr)<br/>       sys.exit(1)<br/><br/>   # get user input; use dictionary for investment-type arguments<br/><span class="ent">➋</span> investment_type_args = {'bonds': bonds, 'stocks': stocks,<br/>                           'sb_blend': blend_50_50, 'sbc_blend': blend_40_50_10}<br/><br/><span class="ent">➌</span> # print input legend for user<br/>   print("   stocks = SP500")<br/>   print("    bonds = 10-yr Treasury Bond")<br/>   print(" sb_blend = 50% SP500/50% TBond")<br/>   print("sbc_blend = 40% SP500/50% TBond/10% Cash\n")<br/>   <span epub:type="pagebreak" id="page_252"/>print("Press ENTER to take default value shown in [brackets]. \n")<br/><br/>   # get user input<br/><span class="ent">➍</span> invest_type = default_input("Enter investment type: (stocks, bonds, sb_blend,"\<br/>                               " sbc_blend): \n", 'bonds').lower()<br/><span class="ent">➎</span> while invest_type not in investment_type_args:<br/>       invest_type = input("Invalid investment. Enter investment type " \<br/>                           "as listed in prompt: ")<br/><br/>   start_value = default_input("Input starting value of investments: \n", \<br/>                               '2000000')<br/><span class="ent">➏</span> while not start_value.isdigit():<br/>       start_value = input("Invalid input! Input integer only: ")<br/><br/><span class="ent">➐</span> withdrawal = default_input("Input annual pre-tax withdrawal" \<br/>                              " (today's $): \n", '80000')<br/>   while not withdrawal.isdigit():<br/>       withdrawal = input("Invalid input! Input integer only: ")<br/><br/>   min_years = default_input("Input minimum years in retirement: \n", '18')<br/>   while not min_years.isdigit():<br/>       min_years = input("Invalid input! Input integer only: ")<br/><br/>   most_likely_years = default_input("Input most-likely years in retirement: \n",<br/>                                     '25')<br/>   while not most_likely_years.isdigit():<br/>       most_likely_years = input("Invalid input! Input integer only: ")<br/><br/>   max_years = default_input("Input maximum years in retirement: \n", '40')<br/>   while not max_years.isdigit():<br/>       max_years = input("Invalid input! Input integer only: ")<br/><br/>   num_cases = default_input("Input number of cases to run: \n", '50000')<br/>   while not num_cases.isdigit():<br/>       num_cases = input("Invalid input! Input integer only: ")</pre>
<p class="listing" id="ch12list2"><em>Listing 12-2: Loads data, maps choices to lists, and gets user input</em></p>
<p class="indent">After printing a warning that input data should be in percent form, use the <code>read_to_list()</code> function to load the six data files <span class="ent">➊</span>. Use <code>try</code> when opening the files to catch exceptions related to missing files or incorrect filenames. Then handle the exceptions with an <code>except</code> block. If you need a refresher on <code>try</code> and <code>except</code>, refer to “<a href="ch02.xhtml#lev34">Handling Exceptions When Opening Files</a>” on <a href="ch02.xhtml#page_21">page 21</a>.</p>
<p class="indent">The user will have a choice of investment vehicles to test. To allow them to type in simple names, use a dictionary to map the names to the lists of data you just loaded <span class="ent">➋</span>. Later, you’ll pass a function this dictionary and its key to serve as an argument: <code>montecarlo(investment_type_args[invest_type])</code>. Before asking for input, print a legend to aid the user <span class="ent">➌</span>.</p>
<p class="indent">Next, get the user’s investment choice <span class="ent">➍</span>. Use the <code>default_input()</code> function and list the names of the choices, which are mapped back to the data lists. Set the default to <code>'bonds'</code>, in order to see how this supposedly “safe” choice performs.<span epub:type="pagebreak" id="page_253"/> Be sure to tack on the <code>.lower()</code> method in case the user accidently includes an uppercase letter or two. For other possible input errors, use a <code>while</code> loop to check the input versus the names in the <code>investment_type_args</code> dictionary; if you don’t find the input, prompt the user for a correct answer <span class="ent">➎</span>.</p>
<p class="indent">Continue gathering the input and use the default values to guide the user to reasonable inputs. For example, $80,000 is 4 percent of the starting value of $2,000,000; also, 25 years is a good most-likely value for women entering retirement at 60, a maximum value of 40 will allow them to reach 100, and 50,000 cases should quickly yield a good estimate of the probability of ruin.</p>
<p class="indent">For numerical inputs, use a <code>while</code> loop to check that the input is a digit, just in case the user includes a dollar sign ($) or commas in the number <span class="ent">➏</span>. And for the <code>withdrawal</code> amount, use the prompt to guide the user by letting them know to input <em>today’s</em> dollars and not to worry about inflation <span class="ent">➐</span>.</p>
<h4 class="h4" id="lev282"><strong><em>Checking for Other Erroneous Input</em></strong></h4>
<p class="noindent"><a href="ch12.xhtml#ch12list3">Listing 12-3</a> checks for additional input errors. The order of the minimum, most likely, and maximum years in retirement should be logical, and a maximum length of 99 years is enforced. Allowing for a long time in retirement permits the optimistic user to evaluate cases where medical science makes significant advances in anti-aging treatments!</p>
<p class="margin"><em>nest_egg_mcs.py,</em> part 3</p>
<pre>   # check for other erroneous input<br/><span class="ent">➊</span> if not int(min_years) &lt; int(most_likely_years) &lt; int(max_years) \<br/>       or int(max_years) &gt; 99:<br/>    <span class="ent">➋</span> print("\nProblem with input years.", file=sys.stderr)<br/>       print("Requires Min &lt; ML &lt; Max with Max &lt;= 99.", file=sys.stderr)<br/>       sys.exit(1)</pre>
<p class="listing" id="ch12list3"><em>Listing 12-3: Checks for errors and sets limits in the retirement years input</em></p>
<p class="indent">Use a conditional to ensure that the minimum years input is less than the most likely, the most likely is less than the maximum, and the maximum does not exceed 99 <span class="ent">➊</span>. If a problem is encountered, alert the user <span class="ent">➋</span>, provide some clarifying instructions, and exit the program.</p>
<h4 class="h4" id="lev283"><strong><em>Defining the Monte Carlo Engine</em></strong></h4>
<p class="noindent"><a href="ch12.xhtml#ch12list4">Listing 12-4</a> defines the first part of the function that will run the Monte Carlo simulation. The program uses a loop to run through each case, and the number of years in retirement inputs will be used to sample the historical data. For both the returns and inflation lists, the program chooses a starting year, or index, at random. The number of years in retirement, assigned to a <code>duration</code> variable, is drawn from a triangular distribution built from the user’s input. If 30 is chosen, then 30 is added to this starting index to create the ending index. The random starting year will determine the retiree’s financial fortunes for the rest of their life! Timing is everything, as they say.</p>
<p class="margin"><span epub:type="pagebreak" id="page_254"/><em>nest_egg_mcs.py,</em> part 4</p>
<pre><span class="ent">➊</span> def montecarlo(returns):<br/>       """Run MCS and return investment value at end-of-plan and bankrupt count."""<br/>    <span class="ent">➋</span> case_count = 0<br/>       bankrupt_count = 0<br/>       outcome = []<br/><br/>    <span class="ent">➌</span> while case_count &lt; int(num_cases):<br/>           investments = int(start_value)<br/>        <span class="ent">➍</span> start_year = random.randrange(0, len(returns))<br/>        <span class="ent">➎</span> duration = int(random.triangular(int(min_years), int(max_years),<br/>                                            int(most_likely_years)))<br/>        <span class="ent">➏</span> end_year = start_year + duration<br/>        <span class="ent">➐</span> lifespan = [i for i in range(start_year, end_year)]<br/>           bankrupt = 'no'<br/><br/>           # build temporary lists for each case<br/>        <span class="ent">➑</span> lifespan_returns = []<br/>           lifespan_infl = []<br/>           for i in lifespan:<br/>            <span class="ent">➒</span> lifespan_returns.append(returns[i % len(returns)])<br/>               lifespan_infl.append(infl_rate[i % len(infl_rate)])</pre>
<p class="listing" id="ch12list4"><em>Listing 12-4: Defines the Monte Carlo function and starts a loop through cases</em></p>
<p class="indent">The <code>montecarlo()</code> function takes a <code>returns</code> list as an argument <span class="ent">➊</span>. The first step is to start a counter to keep track of which case is being run <span class="ent">➋</span>. Remember that you don’t need to use actual dates; the first year in the lists is index 0, rather than 1926. In addition, start a counter for the number of cases that run out of money early. Then start an empty list to hold the outcomes of each run, which will be the amount of money remaining at the end of the run.</p>
<p class="indent">Begin the <code>while</code> loop that will run through the cases <span class="ent">➌</span>. Assign a new variable, called <code>investments</code>, to the starting investment value that the user specified. Since the <code>investments</code> variable will change constantly, you need to preserve the original input variable to reinitialize each case. And since all the user input came in as strings, you need to convert the values to integers before using them.</p>
<p class="indent">Next, assign a <code>start_year</code> variable and pick a value at random from the range of available years <span class="ent">➍</span>. To get the time spent in retirement for this simulated life, use the <code>random</code> module’s <code>triangular()</code> method to draw from a triangular distribution defined by the user’s <code>min_years</code>, <code>most_likely_years</code>, and <code>max_years</code> inputs <span class="ent">➎</span>. According to the documentation, <code>triangular()</code> returns a random floating-point number <em>N</em> such that low &lt;= <em>N</em> &lt;= high and with the specified <em>mode</em> between those bounds.</p>
<p class="indent">Add this <code>duration</code> variable to the <code>start_year</code> variable and assign the result to an <code>end_year</code> variable <span class="ent">➏</span>. Now, make a new list, named <code>lifespan</code>, that captures all the indexes between the starting year and the ending year <span class="ent">➐</span>. These indexes will be used to match the retirement period to the historical <span epub:type="pagebreak" id="page_255"/>data. Next, assign a <code>bankrupt</code> variable to <code>'no'</code>. Bankrupt means you’ve run out of money, and later this outcome will end the <code>while</code> loop early, using a <code>break</code> statement.</p>
<p class="indent">Use two lists to store the applicable returns and inflation data for the chosen <code>lifespan</code> <span class="ent">➑</span>. Populate these lists using a <code>for</code> loop that uses each item in <code>lifespan</code> as the index for the returns and inflation lists. If the <code>lifespan</code> index is out of range compared to the other lists, use the modulo (<code>%</code>) operator to wrap the indexes <span class="ent">➒</span>.</p>
<p class="indent">Let’s cover a little more background on this listing. The randomly selected <code>start_year</code> variable and the calculated <code>end_year</code> variable determine how the returns and inflation lists are sampled. The sample is a continuous piece of financial history and constitutes a case. Selecting an <em>interval</em> at random distinguishes this program from online calculators that select individual <em>years</em> at random and may use a <em>different year</em> for each asset class and inflation! Market results aren’t pure chaos; bull and bear markets are cyclic, as are inflationary trends. The same events that cause stocks to decline also impact the price of bonds and the rate of inflation. Picking years at random ignores this interdependency and disrupts known behaviors, leading to unrealistic results.</p>
<p class="indent">In <a href="ch12.xhtml#ch12fig7">Figure 12-7</a>, the retiree (known as Case 1) has chosen to retire in 1965—at the start of the Great Inflation—and to invest in bonds. Because the end year occurs before the end of the returns list, the retirement span fits nicely in the list. Both returns and inflation are sampled over the same interval.</p>
<div class="image"><a id="ch12fig7"/><img src="../images/f0255-01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-7: Graph of bond and inflation lists, with a retirement starting in 1965 annotated</em></p>
<p class="indent">In <a href="ch12.xhtml#ch12fig8">Figure 12-8</a>, the retiree, or Case 2, has chosen to retire in 2000. Because the list ends in 2013, the 30-year sample taken by the MCS function must “wrap around” and cover years 1926 through 1941. This forces the retiree to endure two recessions and a depression.</p>
<div class="image"><span epub:type="pagebreak" id="page_256"/><a id="ch12fig8"/><img src="../images/f0256-01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-8: Graph of bonds and inflation lists, with segments used in Case 2 annotated</em></p>
<p class="indent">The program will need to simulate the wrap-around segment you see in Case 2—hence the use of the modulo operator, which allows you to treat the lists as endless loops.</p>
<h4 class="h4" id="lev284"><strong><em>Simulating Each Year in a Case</em></strong></h4>
<p class="noindent"><a href="ch12.xhtml#ch12list5">Listing 12-5</a> continues the <code>montecarlo()</code> function and loops through each year of retirement for a given case, increasing or decreasing the investment value based on the returns for that year, subtracting the inflation-adjusted withdrawal amount from the investments, and checking whether the investments are exhausted. The program saves the final investment value—representing the savings remaining at death—to a list so that the overall probability of ruin can be calculated at the end.</p>
<p class="margin"><em>nest_egg_mcs.py,</em> part 5</p>
<pre>        # loop through each year of retirement for each case run<br/>        <span class="ent">➊</span> for index, i in enumerate(lifespan_returns):<br/>            <span class="ent">➋</span> infl = lifespan_infl[index]<br/><br/>            <span class="ent">➌</span> # don't adjust for inflation the first year<br/>               if index == 0:<br/>                   withdraw_infl_adj = int(withdrawal)<br/>               else:<br/>                   withdraw_infl_adj = int(withdraw_infl_adj * (1 + infl))<br/><br/>            <span class="ent">➍</span> investments -= withdraw_infl_adj<br/>               investments = int(investments * (1 + i))<br/><br/>            <span class="ent">➎</span> if investments &lt;= 0:<br/>                   bankrupt = 'yes'<br/>                   break<br/><br/>        <span class="ent">➏</span> if bankrupt == 'yes':<br/>               outcome.append(0)<br/>               bankrupt_count += 1<br/>           else:<br/><span epub:type="pagebreak" id="page_257"/>               outcome.append(investments)<br/><br/>        <span class="ent">➐</span> case_count += 1<br/><br/>    <span class="ent">➑</span> return outcome, bankrupt_count</pre>
<p class="listing" id="ch12list5"><em>Listing 12-5: Simulates results for each year in retirement (per case)</em></p>
<p class="indent">Start the <code>for</code> loop that will run through all the years in a case <span class="ent">➊</span>. Use <code>enumerate()</code> on the <code>returns</code> list and use the index that <code>enumerate()</code> produced to get the year’s average inflation value from the inflation list <span class="ent">➋</span>. Use a conditional to start applying inflation after the first year <span class="ent">➌</span>. This will slowly increase or decrease the withdrawal amount over time, depending on whether you’re in inflationary or deflationary times.</p>
<p class="indent">Subtract the inflation-adjusted withdrawal value from the <code>investments</code> variable, then adjust <code>investments</code> for the year’s returns <span class="ent">➍</span>. Check that the value of <code>investments</code> is greater than 0. If it’s not, set the <code>bankrupt</code> variable to <code>'yes'</code> and end the loop <span class="ent">➎</span>. For a bankrupt case, append 0 to the <code>outcome</code> list <span class="ent">➏</span>. Otherwise, the loop continues until the duration of retirement is reached, so you append the remaining value of <code>investments</code> to <code>outcome</code>.</p>
<p class="indent">A human life has just ended: 30 to 40 years’ worth of vacations, grandkids, bingo games, and illnesses gone in much less than a second. So, advance the case counter before looping through the next lifetime <span class="ent">➐</span>. End the function by returning the <code>outcome</code> and <code>bankrupt_count</code> variables <span class="ent">➑</span>.</p>
<h4 class="h4" id="lev285"><strong><em>Calculating the Probability of Ruin</em></strong></h4>
<p class="noindent"><a href="ch12.xhtml#ch12list6">Listing 12-6</a> defines a function that calculates the probability of running out of money, also known as the “probability of ruin.” If you’re risk averse or want to leave a sizeable sum to your heirs, you probably want this number to be less than 10 percent. Those with a greater appetite for risk may be content with up to 20 percent or more. After all, you can’t take it with you!</p>
<p class="margin"><em>nest_egg_mcs.py,</em> part 6</p>
<pre><span class="ent">➊</span> def bankrupt_prob(outcome, bankrupt_count):<br/>       """Calculate and return chance of running out of money &amp; other stats."""<br/>    <span class="ent">➋</span> total = len(outcome)<br/>    <span class="ent">➌</span> odds = round(100 * bankrupt_count / total, 1)<br/><br/>    <span class="ent">➍</span> print("\nInvestment type: {}".format(invest_type))<br/>       print("Starting value: ${:,}".format(int(start_value)))<br/>       print("Annual withdrawal: ${:,}".format(int(withdrawal)))<br/>       print("Years in retirement (min-ml-max): {}-{}-{}"<br/>             .format(min_years, most_likely_years, max_years))<br/>       print("Number of runs: {:,}\n".format(len(outcome)))<br/>       print("Odds of running out of money: {}%\n".format(odds))<br/>       print("Average outcome: ${:,}".format(int(sum(outcome) / total)))<br/>       print("Minimum outcome: ${:,}".format(min(i for i in outcome)))<br/>       print("Maximum outcome: ${:,}".format(max(i for i in outcome)))<br/><br/>    <span class="ent">➎</span> return odds</pre>
<p class="listing" id="ch12list6"><em>Listing 12-6: Calculates and displays the “probability of ruin” and other statistics</em></p>
<p class="indent"><span epub:type="pagebreak" id="page_258"/>Define a function called <code>bankrupt_prob()</code> that takes the <code>outcome</code> list and <code>bankrupt_count</code> variable returned from the <code>montecarlo()</code> function as arguments <span class="ent">➊</span>. Assign the length of the outcome list to a variable named <code>total</code> <span class="ent">➋</span>. Then, calculate the probability of running out of money as a percentage rounded to one decimal place by dividing the number of bankrupt cases by the total number of cases <span class="ent">➌</span>.</p>
<p class="indent">Now, display the input parameters and results of the simulation <span class="ent">➍</span>. You saw an example of this text printout in “<a href="ch12.xhtml#lev276">A Qualitative Way to Present Results</a>” on <a href="ch12.xhtml#page_246">page 246</a>. Finish by returning the <code>odds</code> variable <span class="ent">➎</span>.</p>
<h4 class="h4" id="lev286"><strong><em>Defining and Calling the main() Function</em></strong></h4>
<p class="noindent"><a href="ch12.xhtml#ch12list7">Listing 12-7</a> defines the <code>main()</code> function that calls the <code>montecarlo()</code> and <code>bankrupt_count()</code> functions and creates the bar chart display. The outcomes for the various cases can have a large variance—sometimes you go broke, and other times you’re a multimillionaire! If the printed statistics don’t make this clear, the bar chart certainly will.</p>
<p class="margin"><em>nest_egg_mcs.py,</em> part 7</p>
<pre><span class="ent">➊</span> def main():<br/>       """Call MCS &amp; bankrupt functions and draw bar chart of results."""<br/>    <span class="ent">➋</span> outcome, bankrupt_count = montecarlo(investment_type_args[invest_type])<br/>       odds = bankrupt_prob(outcome, bankrupt_count)<br/><br/>    <span class="ent">➌</span> plotdata = outcome[:3000]  # only plot first 3000 runs<br/><br/>    <span class="ent">➍</span> plt.figure('Outcome by Case (showing first {} runs)'.format(len(plotdata)),<br/>                  figsize=(16, 5))  # size is width, height in inches<br/>    <span class="ent">➎</span> index = [i + 1 for i in range(len(plotdata))]<br/>    <span class="ent">➏</span> plt.bar(index, plotdata, color='black')<br/>       plt.xlabel('Simulated Lives', fontsize=18)<br/>       plt.ylabel('$ Remaining', fontsize=18)<br/>    <span class="ent">➐</span> plt.ticklabel_format(style='plain', axis='y')<br/>    <span class="ent">➑</span> ax = plt.gca()<br/>       ax.get_yaxis().set_major_formatter(plt.FuncFormatter(lambda x, loc: "{:,}"<br/>                                                            .format(int(x))))<br/>       plt.title('Probability of running out of money = {}%'.format(odds),<br/>                 fontsize=20, color='red')<br/>    <span class="ent">➒</span> plt.show()<br/><br/>   # run program<br/><span class="ent">➓</span> if __name__ == '__main__':<br/>       main()</pre>
<p class="listing" id="ch12list7"><em>Listing 12-7: Defines and calls the</em> <span class="codeitalic">main()</span> <em>function</em></p>
<p class="indent">Define a <code>main()</code> function, which requires no arguments <span class="ent">➊</span>, and immediately call the <code>montecarlo()</code> function to get the <code>outcome</code> list and the <code>bankrupt_count()</code> function <span class="ent">➋</span>. Use the dictionary mapping of investment names to returns lists that you made in <a href="ch12.xhtml#ch12list2">Listing 12-2</a>. The argument you pass to the <code>montecarlo()</code> function is the dictionary name, <code>investment_type_args</code>, with the user’s input, <code>invest_type</code>, as the key. Feed the returned values to the <code>bankrupt_prob()</code> function to get the odds of running out of money.</p>
<p class="indent"><span epub:type="pagebreak" id="page_259"/>Assign a new variable, <code>plotdata</code>, to the first 3,000 items in the <code>outcome</code> list <span class="ent">➌</span>. The bar chart can accommodate many more items, but displaying them will be slow as well as unnecessary. As the results are stochastic, you won’t gain a lot of extra information by showing more cases.</p>
<p class="indent">Now you’ll use <code>matplotlib</code> to create and show the bar chart. Start by making a plot figure <span class="ent">➍</span>. The text entry will be the title of the new window. The <code>figsize</code> parameter is the width and height of the window, in inches. You can scale this by adding a dots-per-inch argument, such as <code>dpi=200</code>.</p>
<p class="indent">Next, use list comprehension to build indexes, starting with 1 for year one, based on the length of the <code>plotdata</code> list <span class="ent">➎</span>. The x-axis location of each vertical bar will be defined by the index, and the height of each bar will be the corresponding <code>plotdata</code> item, which represents the money remaining at the end of each simulated life. Pass these to the <code>plt.bar()</code> method and set the bar color to black <span class="ent">➏</span>. Note that there are additional display options for bars, such as changing the color of the bar outline (<code>edgecolor='black'</code>) or its thickness (<code>linewidth=0</code>).</p>
<p class="indent">Provide labels for the x- and y-axes and set the font size to 18. Outcomes can reach into the millions, and by default, <code>matplotlib</code> will use scientific notation when it annotates the y-axis. To override this, call the <code>ticklabel_format()</code> method and set the y-axis style to <code>'plain'</code> <span class="ent">➐</span>. This takes care of scientific notation, but there are no thousand separators, making the numbers hard to read. To fix this, first get the current axes using <code>plt.gca()</code> <span class="ent">➑</span>. Then, in the next line, get the y-axis and use the <code>set_major_formatter()</code> and <code>Func_Formatter()</code> methods and a lambda function to apply Python’s string-formatting technique for comma separators.</p>
<p class="indent">For the plot’s title, display the probability of running out of money—captured in the <code>odds</code> variable—with a large font in eye-catching red. Then draw the chart to the screen with <code>plt.show()</code> <span class="ent">➒</span>. Back in the global space, finish with the code that allows the program to be imported as a module or run in stand-alone mode <span class="ent">➓</span>.</p>
<h3 class="h3" id="lev287"><strong>Using the Simulator</strong></h3>
<p class="noindent">The <em>nest_egg_mcs.py</em> program greatly simplifies the complex world of retirement planning, but don’t hold that against it. Simple models add value by challenging assumptions, raising awareness, and focusing questions. It’s easy to get lost in the details of retirement planning—or any complex issue—so you’re better off starting with a lay of the land.</p>
<p class="indent">Let’s work an example that assumes a starting value of $2,000,000, a “safe and secure” bond portfolio, a 4 percent withdrawal rate (equal to $80,000 per year), a 29-30-31 retirement range, and 50,000 cases. If you run this scenario, you should get results similar to those in <a href="ch12.xhtml#ch12fig9">Figure 12-9</a>. You run out of money almost half the time! Because of relatively low yields, bonds can’t keep pace with inflation—remember, you can’t blindly apply the 4 Percent Rule, because your asset allocation matters.</p>
<div class="image"><span epub:type="pagebreak" id="page_260"/><a id="ch12fig9"/><img src="../images/f0260-01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-9: Bar chart made with</em> <span class="codeitalic">matplotlib</span> <em>to represent a Monte Carlo simulation of a bond-only portfolio</em></p>
<p class="indent">Note that the $80,000 withdrawal is <em>pretax</em>. Assuming a 25 percent effective tax rate, this leaves a net income of only $60,000. According to the Pew Research Center, the median disposable (after-tax) income of the American middle class is currently $60,884, so you’re hardly living high on the hog, despite being a millionaire. If you want $80,000 in <em>disposable</em> income, you must divide by 1 minus the effective tax rate; in this case, that’s $80,000 / (1 – 0.25) = $106,667. This requires withdrawing slightly over 5 percent per year, with a 20 to 70 percent chance of going broke, depending on the investment type!</p>
<p class="indent"><a href="ch12.xhtml#ch12tab1">Table 12-1</a> records the results of varying the previous scenario for asset type and withdrawal rate. Results that would be widely considered safe are shaded in gray. If you avoid an all-bond portfolio, the 4 Percent Rule holds up well. Above 4 percent, the growth potential of stocks offers the best chance—of the options considered—to reduce the probability of ruin, and with less risk than most people assume. That’s why financial advisers recommend including a healthy dose of stocks in your retirement portfolio.</p>
<p class="tabcap" id="ch12tab1"><strong>Table 12-1:</strong> Probability of Ruin by Asset Type and Withdrawal Rate for 30-Year Retirement</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Asset type</strong></p></td>
<td style="vertical-align: top;" class="table-h" colspan="4"><p class="tab_th"><strong>Annual (pretax) withdrawal percentage</strong></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"> </p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><strong>3%</strong></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><strong>4%</strong></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><strong>5%</strong></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><strong>6%</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">10-year Treasury bond</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.135</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.479</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.650</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.876</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">S&amp;P 500 stocks</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">0</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">0.069</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.216</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.365</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">50/50 blend</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">0</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">0.079</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.264</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.466</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ba"><p class="taba">40/50/10 blend</p></td>
<td style="vertical-align: top;" class="table-va"><p class="taba">0</p></td>
<td style="vertical-align: top;" class="table-va"><p class="taba">0.089</p></td>
<td style="vertical-align: top;" class="table-ba"><p class="taba">0.361</p></td>
<td style="vertical-align: top;" class="table-ba"><p class="taba">0.591</p></td>
</tr>
</tbody>
</table>
<p class="indent">Financial advisers also advise against overdoing it in the early years of retirement. A few cruises for the extended family, a posh new house, or an expensive new hobby can push you over the cliff in your later years. To investigate this, copy <em>nest_egg_mcs.py</em> and name the copy <em>nest_egg_mcs_1st_5yrs.py</em>; adjust the code as described in <a href="#ch12list8">Listings 12-8</a>, <a href="#ch12list9">12-9</a>, and <a href="#ch12list10">12-10</a>:</p>
<p class="margin"><span epub:type="pagebreak" id="page_261"/><em>nest_egg_mcs_1st_5yrs.py,</em> part 1</p>
<pre>   start_value = default_input("Input starting value of investments: \n", \<br/>                               '2000000')<br/>   while not start_value.isdigit():<br/>       start_value = input("Invalid input! Input integer only: ")<br/><br/><span class="ent">➊</span> withdrawal_1 = default_input("Input annual pre-tax withdrawal for " \<br/>                                 "first 5 yrs(today's $): \n", '100000')<br/>   while not withdrawal_1.isdigit():<br/>       withdrawal_1 = input("Invalid input! Input integer only: ")<br/><br/><span class="ent">➋</span> withdrawal_2 = default_input("Input annual pre-tax withdrawal for " \<br/>                                "remainder (today's $): \n", '80000')<br/>   while not withdrawal_2.isdigit():<br/>       withdrawal_2 = input("Invalid input! Input integer only: ")<br/><br/>   min_years = default_input("Input minimum years in retirement: \n", '18')</pre>
<p class="listing" id="ch12list8"><em>Listing 12-8: Breaks the user’s withdrawal input into two parts</em></p>
<p class="indent">In the user-input section, replace the original <code>withdrawal</code> variable with two withdrawal variables, and edit the prompt to request the first five years in the first <span class="ent">➊</span> and the remainder of retirement in the second <span class="ent">➋</span>. Set the defaults to indicate that the user should expect higher withdrawals in the first five years. Include the <code>while</code> loops that validate user input.</p>
<p class="indent">In the <code>montecarlo()</code> function, change the code that adjusts the withdrawal amount for inflation.</p>
<p class="margin"><em>nest_egg_mcs_1st_5yrs.py,</em> part 2</p>
<pre>            # don't adjust for inflation the first year<br/>
            if index == 0:<br/>
             <span class="ent">➊</span> withdraw_infl_adj_1 = int(withdrawal_1)<br/>
             <span class="ent">➋</span> withdraw_infl_adj_2 = int(withdrawal_2)<br/>
            else:<br/>
             <span class="ent">➌</span> withdraw_infl_adj_1 = int(withdraw_infl_adj_1 * (1 + infl))<br/>
             <span class="ent">➍</span> withdraw_infl_adj_2 = int(withdraw_infl_adj_2 * (1 + infl))<br/>
<br/>
         <span class="ent">➎</span> if index &lt; 5:<br/>
             <span class="ent">➏</span> withdraw_infl_adj = withdraw_infl_adj_1<br/>
            else:<br/>
                withdraw_infl_adj = withdraw_infl_adj_2<br/>
<br/>
            investments -= withdraw_infl_adj<br/>
            investments = int(investments * (1 + i))</pre>
<p class="listing" id="ch12list9"><em>Listing 12-9: Adjusts the two withdrawal variables for inflation and determines which to use</em></p>
<p class="indent">Set the inflation-adjusted withdrawal equal to the input withdrawal for just the first year <span class="ent">➊</span><span class="ent">➋</span>. Otherwise, adjust both for inflation <span class="ent">➌</span><span class="ent">➍</span>. This way, the second withdrawal amount will be “ready” when you switch to it after five years.</p>
<p class="indent">Use a conditional to specify when to apply each inflation-adjusted withdrawal <span class="ent">➎</span>. Assign these to the existing <code>withdraw_infl_adj</code> variable so you won’t have to alter any more code <span class="ent">➏</span>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_262"/>Finally, update the printed statistics in the <code>bankrupt_prob()</code> function to include the new withdrawal values, as shown in <a href="#ch12list10">Listing 12-10</a>. These should replace the old withdrawal print statement.</p>
<p class="margin"><em>nest_egg_mcs_1st_5yrs.py,</em> part 3</p>
<pre>    print("Annual withdrawal first 5 yrs: ${:,}".format(int(withdrawal_1)))<br/>    print("Annual withdrawal after 5 yrs: ${:,}".format(int(withdrawal_2)))</pre>
<p class="listing" id="ch12list10"><em>Listing 12-10: Prints the withdrawal values for the two withdrawal periods</em></p>
<p class="indent">You can now run the new experiment (see <a href="#ch12tab2">Table 12-2</a>).</p>
<p class="tabcap" id="ch12tab2"><strong>Table 12-2:</strong> Probability of Ruin by Asset Type and Multiple Withdrawal Rates for 30-Year Retirement</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Asset allocation</strong></p></td>
<td style="vertical-align: top;" class="table-h" colspan="4"><p class="tab_th"><strong>Annual (pretax) withdrawal percentage (first five years / remainder)</strong></p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"> </p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>4% / 4%</strong></p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>5% / 4%</strong></p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>6% / 4%</strong></p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>7% / 4%</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">10-year Treasury bond</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.479</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.499</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.509</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.571</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">S&amp;P 500 stocks</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">0.069</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">0.091</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.116</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.194</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">50/50 blend</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">0.079</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.115</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.146</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.218</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ba"><p class="taba">40/50/10 blend</p></td>
<td style="vertical-align: top;" class="table-va"><p class="taba">0.089</p></td>
<td style="vertical-align: top;" class="table-ba"><p class="taba">0.159</p></td>
<td style="vertical-align: top;" class="table-ba"><p class="taba">0.216</p></td>
<td style="vertical-align: top;" class="table-ba"><p class="taba">0.264</p></td>
</tr>
</tbody>
</table>
<p class="indent">Safe outcomes are shaded in gray in <a href="ch12.xhtml#ch12tab2">Table 12-2</a>, and the first column repeats the constant 4 percent results, as a control. With enough stocks in your portfolio, you can tolerate some early spending, and for this reason, some advisers replace the 4 Percent Rule with either the 4.5 Percent or 5 Percent Rule. But if you retire early—say, between age 55 and 60—your risk of going broke will be greater, whether you experience any high-spending years or not.</p>
<p class="indent">If you run the simulator for the 50/50 blend of stocks and bonds, using different years in retirement, you should get results similar to those in <a href="ch12.xhtml#ch12tab3">Table 12-3</a>. Only one outcome (shaded gray) has a probability of ruin below 10 percent.</p>
<p class="tabcap" id="ch12tab3"><strong>Table 12-3:</strong> Probability of Ruin vs. Retirement Duration for 4% Withdrawal Rate (50/50 Stock-Bond Blend)</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Years in retirement</strong></p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>4% withdrawal</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">30</p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">0.079</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">35</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.103</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">40</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">0.194</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ba"><p class="taba">45</p></td>
<td style="vertical-align: top;" class="table-ba"><p class="taba">0.216</p></td>
</tr>
</tbody>
</table>
<p class="indent">Running simulations like these forces people to face hard decisions and form realistic plans for a large segment of their lives. While the simulation “sells” assets every year to fund retirement, a better real-life solution is the <em>guardrail strategy</em>, where interest and dividends are spent first and a <span epub:type="pagebreak" id="page_263"/>cash reserve is maintained to avoid having to sell assets during market lows. Assuming you can remain disciplined as an investor, this strategy will allow you to stretch your withdrawals a bit beyond what the simulator calculates as safe.</p>
<h3 class="h3" id="lev288"><strong>Summary</strong></h3>
<p class="noindent">In this chapter, you wrote a Monte Carlo–based retirement calculator that realistically samples from historical financial data. You also used <code>matplotlib</code> to provide an alternative way of viewing the calculator output. While the example used could have been modeled deterministically, if you add more random variables—like future tax rates, Social Security payments, and health care costs—MCS quickly becomes the only practical approach for modeling retirement strategies.</p>
<h3 class="h3" id="lev289"><strong>Further Reading</strong></h3>
<p class="noindent"><em>The Intelligent Investor: The Definitive Book on Value Investing, Revised Edition</em> (HarperBusiness, 2006) by Benjamin Graham is considered by many, including billionaire investor Warren Buffet, the greatest book on investing ever written.</p>
<p class="indent"><em>Fooled by Randomness: The Hidden Role of Chance in Life and in the Markets, Revised Edition</em> (Random House Trade Paperbacks, 2005) by Nassim Nicholas Taleb is “an engaging look at the history and reasons for our predilection for self-deception when it comes to statistics.” It includes discussions on the use of Monte Carlo simulation in financial analysis.</p>
<p class="indent"><em>The Black Swan: The Impact of the Highly Improbable, 2nd Edition</em> (Random House Trade Paperbacks, 2010) by Nassim Nicholas Taleb is a “delightful romp through history, economics, and the frailties of human nature” that also includes discussion of the use of Monte Carlo simulation in finance.</p>
<p class="indent">You can find an overview of the 4 Percent Rule at <em><a href="https://www.investopedia.com/terms/f/four-percent-rule.asp">https://www.investopedia.com/terms/f/four-percent-rule.asp</a></em>.</p>
<p class="indent">Possible exceptions to the 4 Percent Rule are discussed at <em><a href="https://www.cnbc.com/2015/04/21/the-4-percent-rule-no-longer-applies-for-most-retirees.html">https://www.cnbc.com/2015/04/21/the-4-percent-rule-no-longer-applies-for-most-retirees.html</a></em>.</p>
<p class="indent">You can find historical financial data at the following websites:</p>
<ul>
<li class="noindent"><em><a href="http://pages.stern.nyu.edu/~adamodar/New_Home_Page/datafile/histretSP.html">http://pages.stern.nyu.edu/~adamodar/New_Home_Page/datafile/histretSP.html</a></em></li>
<li class="noindent"><em><a href="http://www.econ.yale.edu/~shiller/data.htm">http://www.econ.yale.edu/~shiller/data.htm</a></em></li>
<li class="noindent"><em><a href="http://www.moneychimp.com/features/market_cagr.htm">http://www.moneychimp.com/features/market_cagr.htm</a></em></li>
<li class="noindent"><em><a href="http://www.usinflationcalculator.com/inflation/historical-inflation-rates/">http://www.usinflationcalculator.com/inflation/historical-inflation-rates/</a></em></li>
<li class="noindent"><em><a href="https://inflationdata.com/Inflation/Inflation_Rate/HistoricalInflation.aspx">https://inflationdata.com/Inflation/Inflation_Rate/HistoricalInflation.aspx</a></em></li>
</ul>
<h3 class="h3" id="lev290"><span epub:type="pagebreak" id="page_264"/><strong>Challenge Projects</strong></h3>
<p class="noindent">Become a chartered Certified Financial Analyst (CFA)<sup><a href="footnote.xhtml#ch12fn1" id="ch12fn1a">1</a></sup> by completing these challenge projects.</p>
<h4 class="h4" id="lev291"><strong><em>A Picture Is Worth a Thousand Dollars</em></strong></h4>
<p class="noindent">Imagine you’re a CFA and your prospective client, a wealthy Texas oil prospector, doesn’t understand your MCS results on his $10 million portfolio. “Tarnation, boy! What kind of durn fool contraption could have me goin’ broke in one case and worth 80 million in the next?”</p>
<p class="indent">Make it clearer to him by editing the <em>nest_egg_mcs.py</em> program so it runs single, 30-year cases using historical intervals that will result in bad and good results, such as starting at the beginning of the Great Depression versus the end of WWII, but only run the extreme cases. For each year in each case, print out the year, the returns rate, the inflation rate, and the outcome. Even better, edit the bar chart display to use each <em>year’s</em> outcome rather than each <em>case’s</em> outcome, for a convincing visual explanation.</p>
<h4 class="h4" id="lev292"><strong><em>Mix and Match</em></strong></h4>
<p class="noindent">Edit <em>nest_egg_mcs.py</em> so that the user can generate their own blend of investments. Use the S&amp;P 500, 10-year Treasury bond, and three-month Treasury bill text files that I provided at the start of the chapter and add anything else you like, such as small-cap stocks, international stocks, or even gold. Just remember that the time intervals should be the same in each file or list.</p>
<p class="indent">Have the user pick the investment types and percentage of each. Make sure their input adds up to 100 percent. Then create a blended list by weighting and adding the returns for each year. Finish it off by displaying the investment types and percentages at the top of the bar chart display.</p>
<h4 class="h4" id="lev293"><strong><em>Just My Luck!</em></strong></h4>
<p class="noindent">Edit <em>nest_egg_mcs.py</em> to calculate the probability of encountering a Great Depression (1939–1949) or a Great Recession (2007–2009) during a 30-year retirement. You’ll need to identify which index numbers in the returns lists correspond to these events, then tally how many times they occur over however many cases are run. Display the results in the shell.</p>
<h4 class="h4" id="lev294"><strong><em>All the Marbles</em></strong></h4>
<p class="noindent">For a different way to view the results, copy and edit <em>nest_egg_mcs.py</em> so that the bar chart displays all the outcomes sorted from smallest to largest.</p>
</body></html>