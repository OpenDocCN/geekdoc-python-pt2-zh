<html><head></head><body><div id="sbo-rt-content"><h2 class="h2" id="ch15"><span epub:type="pagebreak" id="page_233"/><span class="big">15</span><br/>Creating Mr. Stick Man</h2>&#13;
<div class="image1"><img src="Images/common.jpg" alt="Image" width="600" height="230"/></div>&#13;
<p class="indent">In this chapter, we’ll create the main character of <em>Mr. Stick Man Races for the Exit</em>. This will require the most complicated coding we’ve done so far, because Mr. Stick Man needs to run left and right, jump, stop when he runs into a platform, and fall when he runs off the edge of a platform. We’ll use event bindings for the left and right arrow keys to make the stick figure run left and right, and we’ll have him jump when the player presses the spacebar.</p>&#13;
<h3 class="h3" id="ch15lev1sec1"><span epub:type="pagebreak" id="page_234"/>Initializing the Stick Figure</h3>&#13;
<p class="noindent">The <span class="literal">__init__</span> function for our new stick figure class will look a lot like those in the other classes in our game. We start by giving our new class a name—<span class="literal">StickFigureSprite</span>—and assign this class to a parent class, <span class="literal">Sprite</span>:</p>&#13;
<pre class="pre1"><span class="orange">class</span> StickFigureSprite(Sprite):&#13;
    <span class="orange">def</span> __init__(self, game):&#13;
        Sprite.__init__(self, game)</pre>&#13;
<p class="indent">This code looks similar to the <span class="literal">PlatformSprite</span> class in <a href="ch14.xhtml#ch14">Chapter 14</a>, except we’re not using any additional parameters (other than <span class="literal">self</span> and <span class="literal">game</span>). This is because, unlike the <span class="literal">PlatformSprite</span> class, only one <span class="literal">StickFigureSprite</span> object will be used in the game.</p>&#13;
<h3 class="h3" id="ch15lev1sec2">Loading the Stick Figure Images</h3>&#13;
<p class="indent">Because we have a lot of platform objects on the screen, we pass the platform image as a parameter of the <span class="literal">PlatformSprite</span>’s <span class="literal">__init__</span> function (kind of like saying, “Here, PlatformSprite, use this image when you draw yourself on the screen.”). But since there’s only one stick figure object, it doesn’t make sense to load the image outside the sprite and then pass it in as a parameter. The <span class="literal">StickFigureSprite</span> class will know how to load its own images.</p>&#13;
<div class="image"><img src="Images/f0234-01.jpg" alt="Image" width="263" height="308"/></div>&#13;
<p class="indent">The next few lines of the <span class="literal">__init__</span> function load the three left images (which we’ll use to animate the stick figure running left) and the three right images (used to animate the stick figure running right). We need to load these images now, because we don’t want to load them every time we display the stick figure on the screen (doing so would take too long and make our game run slowly):</p>&#13;
<pre class="pre1"><span class="orange">class</span> StickFigureSprite(Sprite):&#13;
    <span class="orange">def</span> __init__(self, game):&#13;
        Sprite.__init__(self, game)&#13;
     <span class="ent">➊</span> self.images_left = [&#13;
            PhotoImage(<span class="orange">file</span>=<span class="green">'figure-L1.gif'</span>),&#13;
            PhotoImage(<span class="orange">file</span>=<span class="green">'figure-L2.gif'</span>),&#13;
            PhotoImage(<span class="orange">file</span>=<span class="green">'figure-L3.gif'</span>)&#13;
        ]&#13;
     <span class="ent">➋</span> self.images_right = [&#13;
            PhotoImage(<span class="orange">file</span>=<span class="green">'figure-R1.gif'</span>),&#13;
            PhotoImage(<span class="orange">file</span>=<span class="green">'figure-R2.gif'</span>),&#13;
            PhotoImage(<span class="orange">file</span>=<span class="green">'figure-R3.gif'</span>)&#13;
        ]&#13;
     <span class="ent">➌</span> self.image = game.canvas.create_image(200, 470,&#13;
                image=self.images_left[0], anchor=<span class="green">'nw'</span>)</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_235"/>This code loads the three left images, which we’ll use to animate the stick figure running left, and the three right images, which we’ll use to animate the stick figure running right.</p>&#13;
<p class="indent">We create the object variables <span class="literal">images_left</span> <span class="ent">➊</span> and <span class="literal">images</span> <span class="literal">_right</span> <span class="ent">➋</span>. Each contains a list of the <span class="literal">PhotoImage</span> objects we created in <a href="ch10.xhtml#ch10">Chapter 10</a>, showing the stick figure facing left and right.</p>&#13;
<p class="indent">We draw the first image <span class="ent">➌</span> with <span class="literal">images_left[0]</span> using the canvas’s <span class="literal">create_image</span> function at position (<span class="literal">200, 470</span>), which puts the stick figure in the middle of the game screen, at the bottom of the canvas. The <span class="literal">create_image</span> function returns a number that identifies the image on the canvas. We store this identifier in the object variable <span class="literal">image</span> for later use.</p>&#13;
<h3 class="h3" id="ch15lev1sec3">Setting Up Variables</h3>&#13;
<p class="noindent">The next part of the <span class="literal">__init__</span> function sets up more variables we’ll use later in this code:</p>&#13;
<pre class="pre1">        <span class="gray">self.image = game.canvas.create_image(200, 470, &#13;
                image=self.images_left[0], anchor='nw')</span>&#13;
     <span class="ent">➊</span> self.x = -2&#13;
     <span class="ent">➋</span> self.y = 0&#13;
        self.current_image = 0&#13;
        self.current_image_add = 1&#13;
        self.jump_count = 0 &#13;
        self.last_time = time.time()&#13;
        self.coordinates = Coords()</pre>&#13;
&#13;
<p class="indent"><span epub:type="pagebreak" id="page_236"/>The object variables <span class="literal">x</span> <span class="ent">➊</span> and <span class="literal">y</span> <span class="ent">➋</span> will store the amount we’ll be adding to the stick figure’s horizontal (<em>x1</em> and <em>x2</em>) or vertical (<em>y1</em> and <em>y2</em>) coordinates when he is moving around the screen.</p>&#13;
<p class="indent">As you learned in <a href="ch11.xhtml#ch11">Chapter 11</a>, to animate something with the <span class="literal">tkinter</span> module, we add values to the object’s <span class="literal">x</span> or <span class="literal">y</span> position to move it around the canvas. By setting <span class="literal">x</span> to –2 and <span class="literal">y</span> to 0, we subtract 2 from the <span class="literal">x</span> position later in the code and add nothing to the vertical position, to make the stick figure run to the left.</p>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes">Note</span></p>&#13;
<p class="notep"><em>Remember that a negative <span class="literal">x</span> number means move left on the canvas, and a positive <span class="literal">x</span> number means move right. A negative <span class="literal">y</span> number means move up, and a positive <span class="literal">y</span> number means move down.</em></p>&#13;
</div>&#13;
<p class="indent">Next, we create the object variable <span class="literal">current_image</span> to store the image’s index position as currently displayed on the screen. Our list of left-facing images, <span class="literal">images_left</span>, contains <em>figure-L1.gif</em>, <em>figure-L2.gif</em>, and <em>figure-L3.gif</em>. Those are index positions 0, 1, and 2.</p>&#13;
<p class="indent">The <span class="literal">current_image_add</span> variable will contain the number we’ll add to that index position stored in <span class="literal">current_image</span> to get the next index position. For example, if the image at index position 0 is displayed, we add 1 to get the next image at index position 1, and then add 1 again to get the final image in the list at index position 2. (You’ll see how we use this variable for animation in the next chapter.)</p>&#13;
<p class="indent">The <span class="literal">jump_count</span> variable is a counter we’ll use while the stick figure is jumping. The <span class="literal">last_time</span> variable will record the last time we changed the image when animating our stick figure. We store the current time using the <span class="literal">time</span> function of the <span class="literal">time</span> module.</p>&#13;
<p class="indent">Finally, we set the <span class="literal">coordinates</span> object variable to an object of the <span class="literal">Coords</span> class, with no initialization parameters set (<span class="literal">x1</span>, <span class="literal">y1</span>, <span class="literal">x2</span>, and <span class="literal">y2</span> are all 0). Unlike with the platforms, the stick figure’s coordinates will change, so we’ll set these values later.</p>&#13;
<h3 class="h3" id="ch15lev1sec4"><span epub:type="pagebreak" id="page_237"/>Binding to Keys</h3>&#13;
<p class="noindent">In the final part of the <span class="literal">__init__</span> function, the <span class="literal">bind</span> functions bind a key to something in our code that needs to be run when the key is pressed:</p>&#13;
<pre class="pre1">        <span class="gray">self.jump_count = 0 &#13;
        self.last_time = time.time()&#13;
        self.coordinates = Coords()</span>&#13;
        game.canvas.bind_all(<span class="green">'&lt;KeyPress-Left&gt;'</span>, self.turn_left)&#13;
        game.canvas.bind_all(<span class="green">'&lt;KeyPress-Right&gt;'</span>, self.turn_right)&#13;
        game.canvas.bind_all(<span class="green">'&lt;space&gt;'</span>, self.jump)</pre>&#13;
<p class="indent">We bind <span class="literal">&lt;KeyPress-Left&gt;</span> to the <span class="literal">turn_left</span> function, <span class="literal">&lt;KeyPress-Right&gt;</span> to the <span class="literal">turn_right</span> function, and <span class="literal">&lt;space&gt;</span> to the <span class="literal">jump</span> function. Now we need to create those functions to make the stick figure move.</p>&#13;
<h3 class="h3" id="ch15lev1sec5">Turning the Stick Figure Left and Right</h3>&#13;
<p class="noindent">The <span class="literal">turn_left</span> and <span class="literal">turn_right</span> functions ensure the stick figure is not jumping, and then set the value of the object variable <span class="literal">x</span> to move him left and right. (Our game doesn’t allow us to change his direction in midair.)</p>&#13;
<div class="image"><img src="Images/f0237-01.jpg" alt="Image" width="196" height="228"/></div>&#13;
<pre class="pre1">        <span class="gray">game.canvas.bind_all('&lt;KeyPress-Left&gt;', self.turn_left)&#13;
        game.canvas.bind_all('&lt;KeyPress-Right&gt;', self.turn_right)&#13;
        game.canvas.bind_all('&lt;space&gt;', self.jump)</span>&#13;
&#13;
    <span class="orange">def</span> turn_left(self, evt):&#13;
        <span class="orange">if</span> self.y == 0:&#13;
         <span class="ent">➊</span> self.x = -2&#13;
&#13;
    <span class="orange">def</span> turn_right(self, evt):&#13;
        <span class="orange">if</span> self.y == 0:&#13;
         <span class="ent">➋</span> self.x = 2</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_238"/>Python calls the <span class="literal">turn_left</span> function when the player presses the left arrow key, and it passes an object with information about what the player did as a parameter. This object is called an <em>event object</em>, and we give it the parameter name <span class="literal">evt</span>.</p>&#13;
<div class="note">&#13;
<p class="notet"><span class="notes">Note</span></p>&#13;
<p class="notep"><em>The event object isn’t important for our purposes, but we need to include it as a parameter of our functions or we’ll get an error, because Python is expecting it to be there. The event object contains things like the</em> x <em>and</em> y <em>positions of the mouse (for a mouse event), a code identifying a particular key that has been pressed (for keyboard events), and other information. For this game, none of that information is useful, so we can safely ignore it.</em></p>&#13;
</div>&#13;
<p class="indent">To see if the stick figure is jumping, we check the value of the <span class="literal">y</span> object variable. If the value is not 0, the stick figure is jumping. In this code, if the value of <span class="literal">y</span> is 0, we set <span class="literal">x</span> to –2 to run left <span class="ent">➊</span> or we set it to 2 to run right <span class="ent">➋</span>. We use –2 and 2, because setting the value to –1 or 1 wouldn’t make the stick figure move across the screen fast enough.</p>&#13;
<p class="indent">Once you have the animation working for your stick figure, try changing this value to see what difference it makes.</p>&#13;
<h3 class="h3" id="ch15lev1sec6">Making the Stick Figure Jump</h3>&#13;
<p class="noindent">The <span class="literal">jump</span> function is very similar to the <span class="literal">turn_left</span> and <span class="literal">turn_right</span> functions:</p>&#13;
<pre class="pre1">    <span class="gray">def turn_right(self, evt):&#13;
        if self.y == 0:&#13;
            self.x = 2</span>&#13;
&#13;
    <span class="orange">def</span> jump(self, evt):&#13;
        <span class="orange">if</span> self.y == 0:&#13;
            self.y = -4&#13;
            self.jump_count = 0</pre>&#13;
<p class="noindent">This function again takes an <span class="literal">evt</span> parameter (the event object), which we can ignore because we don’t need any more information about the event (same as before). If this function is called, we know the spacebar was pressed.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_239"/>Because we want our stick figure to jump only if he is not already jumping, we check to see if <span class="literal">y</span> is equal to 0. If the stick figure is not jumping, we set <span class="literal">y</span> to –4 (to move him vertically up the screen), and set <span class="literal">jump_count</span> to 0. We’ll use <span class="literal">jump_count</span> to make sure the stick figure doesn’t keep jumping forever. Instead, we’ll let him jump for a specific count and then have him come back down again, as if gravity were pulling him. We’ll add this code in the next chapter.</p>&#13;
<div class="image"><img src="Images/f0239-01.jpg" alt="Image" width="181" height="237"/></div>&#13;
<h3 class="h3" id="ch15lev1sec7">What We Have So Far</h3>&#13;
<p class="noindent">Let’s review the definitions of the classes and functions in our game thus far, and where they should be in your file.</p>&#13;
<p class="indent">At the top of your program, you should have your <span class="literal">import</span> statements, followed by the <span class="literal">Game</span> and <span class="literal">Coords</span> classes. The <span class="literal">Game</span> class will be used to create an object that will be the main controller for our game, and objects of the <span class="literal">Coords</span> class are used to hold the positions of things in our game (like the platforms and Mr. Stick Man):</p>&#13;
<pre class="pre1"><span class="orange">from</span> tkinter <span class="orange">import</span> *&#13;
<span class="orange">import</span> random&#13;
<span class="orange">import</span> time&#13;
&#13;
<span class="orange">class</span> Game:&#13;
    --<span class="codeitalic1">snip</span>--&#13;
<span class="orange">class</span> Coords:&#13;
    --<span class="codeitalic1">snip</span>--</pre>&#13;
<p class="indent">Next, you should have the <span class="literal">within</span> functions (which tell whether the coordinates of one sprite are within the same area of another sprite), the <span class="literal">Sprite</span> parent class (which is the parent class of all the sprites in our game), the <span class="literal">PlatformSprite</span> class, and the beginning of the <span class="literal">StickFigureSprite</span> class. We used the <span class="literal">PlatformSprite</span> class to create platform objects, which our stick figure will jump across. We also created one object of the <span class="literal">StickFigureSprite</span> class, to represent the main character in our game:</p>&#13;
<pre class="pre1"><span class="orange">def</span> within_x(co1, co2):&#13;
     --<span class="codeitalic1">snip</span>--&#13;
<span class="orange">def</span> within_y(co1, co2):&#13;
     --<span class="codeitalic1">snip</span>--&#13;
<span class="orange">def</span> collided_left(co1, co2):&#13;
     --<span class="codeitalic1">snip</span>--&#13;
<span class="orange">def</span> collided_right(co1, co2):&#13;
     --<span class="codeitalic1">snip</span>--&#13;
<span class="orange">def</span> collided_top(co1, co2):&#13;
     --<span class="codeitalic1">snip</span>--&#13;
<span class="orange">def</span> collided_bottom(y, co1, co2):&#13;
     --<span class="codeitalic1">snip</span>--&#13;
<span class="orange">class</span> Sprite:&#13;
     --<span class="codeitalic1">snip</span>--&#13;
<span class="orange">class</span> PlatformSprite(Sprite):&#13;
     --<span class="codeitalic1">snip</span>--&#13;
<span class="orange">class</span> StickFigureSprite(Sprite):&#13;
     --<span class="codeitalic1">snip</span>--</pre>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_240"/>Finally, at the end of your program, you should have code that creates all the objects in our game so far: the game object itself and the platforms. The final line is where we call the <span class="literal">mainloop</span> function:</p>&#13;
<pre class="pre1">g = Game()&#13;
platform1 = PlatformSprite(g, PhotoImage(<span class="orange">file</span>=<span class="green">'platform1.gif'</span>),&#13;
                           0, 480, 100, 10)&#13;
...&#13;
g.sprites.append(platform1)&#13;
...&#13;
g.mainloop()</pre>&#13;
<p class="indent">If your code looks a bit different, or you’re having trouble getting it working, you can always skip ahead to the end of <a href="ch16.xhtml#ch16">Chapter 16</a> for the full listing of the entire game.</p>&#13;
<h3 class="h3" id="ch15lev1sec8"><span epub:type="pagebreak" id="page_241"/>What You Learned</h3>&#13;
<p class="noindent">In this chapter, we began working on the class for our stick figure. At the moment, if we created an object of this class, it wouldn’t really do much besides load the images it needs for animating the stick figure and set up a few object variables to be used later in the code. This class contains a couple of functions for changing the values in those object variables based on keyboard events (when the player presses the left or right arrow or the spacebar).</p>&#13;
<p class="indent">In the next chapter, we’ll finish our game. We’ll write the functions for the <span class="literal">StickFigureSprite</span> class to display and animate the stick figure and move him around the screen. We’ll also add the exit (the door) that Mr. Stick Man is trying to reach.<span epub:type="pagebreak" id="page_242"/></p>&#13;
</div></body></html>