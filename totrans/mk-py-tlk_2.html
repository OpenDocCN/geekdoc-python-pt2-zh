<html><head></head><body><div id="sbo-rt-content"><section>
<header>
<h1 class="part">
<span class="PartNumber"><span epub:type="pagebreak" title="53" id="Page_53"/>Part II</span><br/>
<span class="PartTitle">Learning to Talk</span></h1>
</header>
</section>
</div>
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="55" id="Page_55"/>3</span><br/>
<span class="ChapterTitle">Speech Recognition </span></h1>
</header>
<figure class="opener">
<img src="Images/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">In this chapter, we’ll begin interacting with Python through speech. We’ll first install the <em>SpeechRecognition</em> module; the installation process can be a source of frustration and will therefore require some careful attention. You’ll then create a script to let Python recognize your speech and print it out to ensure that the voice recognition function works smoothly on your computer.</p>
<p>You’ll use voice control to complete several tasks, including voice dictation, opening web browsers, opening files, and playing music on your computer. You’ll put all code related to speech recognition into a custom local module so the final script is concise and easy to read. </p>
<p>Before you begin, set up the folder <em>/mpt/ch03/</em> for this chapter. All scripts in this chapter are available at the book’s resources page, <a href="https://www.nostarch.com/make-python-talk/" class="LinkURL">https://www.nostarch.com/make-python-talk/</a>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="56" id="Page_56"/>new skills </h2>
<ul>
<li>Installing and customizing speech recognition tools</li>
<li>Using <code>try</code> and <code>except</code> to handle potential errors </li>
<li>Performing voice-controlled web search</li>
<li>Making cross-platform, portable code </li>
<li>Accessing operating system functionalities</li>
<li>Creating custom Python modules </li>
</ul>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c03-0001">	Install the SpeechRecognition Module</h2>
<p class="BodyFirst">Installing the <em>SpeechRecognition</em> module can be tricky, even to the point of frustration. Don’t panic; we’ll discuss how to install it in Windows, Mac, and Linux. Installing the <em>SpeechRecognition</em> module takes an extra step compared to most modules because it relies on the <em>pyaudio</em> module, which we’ll have to install manually. The <em>pyaudio</em> module provides bindings for the cross-platform audio input/output library <em>portaudio</em>. </p>
<p>You cannot <code>pip install</code> the <em>pyaudio</em> module in the Anaconda prompt either. Instead, you need to <code>conda install</code> it. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	Even though we have gone to great lengths to test the steps required to install these modules on a variety of hardware and software platforms, there is a chance that something might not work on your system. If this happens, be sure to check the errata page for updates, search the forums for the Python packages, or contact the author.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-501560c03-0001">In Windows</h3>
<p class="BodyFirst">First, you need to activate the virtual environment <em>chatting</em> from <span class="xref" itemid="xref_target_Chapter 2">Chapter 2</span>. Go to your Anaconda prompt and enter the following:</p>
<pre><code><b>conda activate chatting</b></code></pre>
<p>You should see a modified prompt:</p>
<pre><code>(chatting) c:\&gt;</code></pre>
<p>Note that the <code>(chatting)</code> in the prompt indicates that you are now in the virtual environment <em>chatting</em>. If the command hasn’t worked, return to <span class="xref" itemid="xref_target_Chapter 2">Chapter 2</span> for full instructions on how to create and activate a virtual environment. </p>
<p>Next, enter the following in the Anaconda prompt:</p>
<pre><code>(chatting) c:\&gt; <b>pip install SpeechRecognition</b> </code></pre>
<p><span epub:type="pagebreak" title="57" id="Page_57"/>If you then try to import it and run a script, Spyder will tell you that you need the <em>pyaudio</em> module for the <em>SpeechRecognition</em> module to run correctly. </p>
<p>With the virtual environment <em>chatting</em> activated, run the following in your Anaconda prompt:</p>
<pre><code>(chatting) c:\&gt; <b>conda install pyaudio</b> </code></pre>
<p>Follow the instructions all the way through.</p>
<h3 id="h2-501560c03-0002">In Mac or Linux</h3>
<p class="BodyFirst">First, activate the virtual environment <em>chatting</em>. Open a terminal and enter and execute the following:</p>
<pre><code><b>conda activate chatting</b></code></pre>
<p>Next, execute the following in the terminal:</p>
<pre><code><b>pip install SpeechRecognition </b></code></pre>
<p>If you now try to import <em>SpeechRecognition</em> and run a script, Spyder will tell you that you need <em>pyaudio</em> for <em>SpeechRecognition</em> to run correctly. With the virtual environment <em>chatting</em> activated, run the following command in your terminal:</p>
<pre><code><b>conda install pyaudio </b></code></pre>
<p>Follow the instructions all the way through.</p>
<h2 id="h1-501560c03-0002">	Test and Fine-Tune SpeechRecognition</h2>
<p class="BodyFirst">We’ll next test and fine-tune the <em>SpeechRecognition</em> module so Python can take your voice commands.</p>
<h3 id="h2-501560c03-0003">Import SpeechRecognition </h3>
<p class="BodyFirst">To import <em>SpeechRecognition</em> in your Python scripts, use the following command:</p>
<pre><code><b>import speech_recognition</b></code></pre>
<p>Note that there is a small difference in the module name when you install it and when you import it: one is <em>SpeechRecognition</em> and the other is <em>speech_recognition</em>. Make sure you don’t miss the underscore in the module name when you import it.</p>
<p>You also need to have a microphone plugged into the computer if you’re using a desktop. Most laptops come with a built-in microphone, but sometimes having an external one is convenient so you can speak close to the microphone and avoid ambient noise. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<span epub:type="pagebreak" title="58" id="Page_58"/><h2><span class="NoteHead">WARNING</span></h2>
<p>	If you have multiple microphone devices on your computer, make sure your Python script is using the right one as the input device. Better yet, make sure that your microphone is indeed working by testing it first with other applications on your computer (for example, Voice Recorder in Windows, Voice Memos or QuickTime Player in Mac, or Audacity in Linux).</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-501560c03-0004">Test SpeechRecognition </h3>
<p class="BodyFirst">Next, let’s test the hardware and software. Enter <a href="#listing3-1" id="listinganchor3-1">Listing 3-1</a> into your Spyder editor and save it as <em>sr.py</em>, or you can download the file from the book’s resources. </p>
<pre><code>import speech_recognition as sr
speech = sr.Recognizer()
print('Python is listening...')
with sr.Microphone() as source:
    speech.adjust_for_ambient_noise(source)
    audio = speech.listen(source)
    inp = speech.recognize_google(audio)
print(f'You just said {inp}.') </code></pre>
<p class="CodeListingCaption"><a id="listing3-1">Listing 3-1</a>: Testing <em>SpeechRecognition</em></p>
<p>We import the <em>SpeechRecognition</em> module. Next, we call <code>Recognizer()</code> to initiate a <em>Recognizer</em> instance from the module so that your script is ready to convert voice to text. We save it as the variable <code>speech</code>. We also print a message that lets you know the microphone is ready to receive speech input. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	If a module has a long name, writing out the full module name in the script is time-consuming (and can reduce the code’s readability). You can use a shorter alias instead. For example, <code>import speech_recognition as sr</code> allows you to use <code>sr</code> instead of <code>speech_recognition</code> whenever you refer to the module.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>We tell the script that the source of the audio comes from the microphone using <code>Microphone()</code>. We use the <code>adjust_for_ambient_noise()</code> method to reduce the impact of the ambient noise on your voice input. The script captures the voice input from the defined microphone, converts it into text, and saves in <code>inp</code>. We print out the value of <code>inp</code>. </p>
<p>Note in this script, the <em>Recognizer</em> instance uses <code>recognize_google()</code>for recognizing speech from the audio source. This method uses the Google Web Speech application programming interface (API) and requires a good internet connection. Other methods available to the <em>Recognizer</em> instance in the <em>SpeechRecognition</em> module include <code>recognize_bing()</code>, which uses Microsoft Bing Speech;<code> recognize_ibm()</code>, which uses IBM Speech to Text; and so on. The only method that works offline is <code>recognize_sphinx()</code>, which uses the services of CMU Sphinx. However, the accuracy with <code>recognize_sphinx()</code> is not nearly as good as with <code>recognize_google()</code>, so we’ll use <code>recognize_google()</code> throughout this book.</p>
<p><span epub:type="pagebreak" title="59" id="Page_59"/>Run <em>sr.py</em> and say something simple, like “Hello” or “How are you?”, to test if Python correctly prints out your voice input. You should see the following if you say, “How are you?”:</p>
<pre><code>Python is listening...
You just said <b>how are you</b>.</code></pre>
<p>If the script is working, you’ve successfully installed the speech recognition feature. If not, double-check the previous steps and make sure your microphone is connected properly. Also make sure that you are in a relatively quiet area with a good internet connection.</p>
<p>Notice that Python converts almost all voice input as lowercase text, which can be a good feature since string variables are case-sensitive. This way, Python won’t miss a command because of capitalization.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>sr.py</em> and try speaking a few simple phrases to the microphone to make sure the script understands you.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-501560c03-0005">Fine-Tune the Speech Recognition Feature</h3>
<p class="BodyFirst">Now you’ll fine-tune the speech recognition code to make it more user-friendly for the rest of the book. We’ll use <code>try</code> and <code>except</code> on a few common errors to allow the execution of the code to continue after encountering errors, instead of causing the script to crash.</p>
<p>The common error <code>UnknownValueError</code> happens when the Google speech recognition server cannot understand the audio, either because the speech isn’t clear or because of ambient noise. The error <code>RequestError</code> happens when the Google speech recognition request fails, either because of a bad internet connection or because the server is too busy. The error <code>WaitTimeoutError</code> happens when the script doesn’t detect any audio from the microphone for a long period. </p>
<p>Without using <code>try</code> and <code>except</code>, the script crashes, and you have to start the script all over again. By using the exception-handling constructs, the script will continue without crashing. The errors I mentioned aren’t harmful enough to be worth handling, so our scripts will just allow those errors to pass.</p>
<p><a href="#listing3-2" id="listinganchor3-2">Listing 3-2</a>, <em>stand_by.py</em>, uses an infinite loop to first stand by and then repeatedly take voice inputs and print them out. This way, we don’t have to rerun the script every time we want the script to take our voice inputs.</p>
<pre><code>import speech_recognition as sr

speech = sr.Recognizer()
while True:
    print('Python is listening...')
    inp = "" 
<span epub:type="pagebreak" title="60" id="Page_60"/>    with sr.Microphone() as source:
        speech.adjust_for_ambient_noise(source)
      <span class="CodeAnnotationCode" aria-label="annotation1">1</span> try:
            audio = speech.listen(source)
            inp = speech.recognize_google(audio)
        except sr.UnknownValueError:
            pass
        except sr.RequestError:
            pass        
        except sr.WaitTimeoutError:
            pass
  <span class="CodeAnnotationCode" aria-label="annotation2">2</span> print(f'You just said {inp}.')
    if inp == "stop listening":
        print('Goodbye!')
        break</code></pre>
<p class="CodeListingCaption"><a id="listing3-2">Listing 3-2</a>: Code for <em>stand_by.py</em></p>
<p>We start a <code>while</code> loop to put the script in standby. This way, after taking your voice input, the script prints out what you said and starts listening again. At each iteration, the script prints <code>Python is listening</code> so you know it’s ready. We define the variable <code>inp</code> as an empty string at the beginning of each iteration. Otherwise, if the user doesn’t say anything for a while, the script will retrieve the <code>inp</code> value from the previous iteration. By clearing the string, we avoid any potential mix-ups. </p>
<p>We use exception handling when connecting to the Google speech-recognition server <span class="CodeAnnotation" aria-label="annotation1">1</span>. If there is an <code>UnknownValueError</code>, a <code>RequestError</code>, or a <code>WaitTimeoutError</code>, we let the script continue without crashing. </p>
<p>At each iteration, the script prints what you said so that you can check if the speech recognition software has correctly captured your voice <span class="CodeAnnotation" aria-label="annotation2">2</span>.</p>
<p>Finally, we don’t want the script to run forever, so we add a condition to stop it. When you say, “Stop listening,” the <code>if</code> branch is activated, the script prints <code>Goodbye!</code>, and the <code>while</code> loop stops.</p>
<p>Here’s a sample output, with my voice input in bold:</p>
<pre><code>Python is listening...
You just said <b>hello</b>.
Python is listening...
You just said <b>how are you</b>.
Python is listening...
You just said <b>today is a Saturday</b>.
Python is listening...
You just said <b>stop listening</b>.
Goodbye!</code></pre>
<p>Next, you’ll put the speech recognition feature to use in several projects. Some are practical and useful, and others are for building up skills for later chapters. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	Sometimes the speech recognition takes a long time to process, especially if there is ambient noise and the internet connection is slow. Try to test the script in a quiet place with a good internet connection.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="61" id="Page_61"/>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>stand_by.py</em> and say two simple phrases. After that, say, “Stop listening” to end the script.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c03-0003">	Perform a Voice-Controlled Web Search</h2>
<p class="BodyFirst">Our first project is a script to navigate the web by using voice. You’ll learn to use the <em>webbrowser</em> module to open a browser on your computer. Then you’ll add voice-control functionality to open the browser and perform various searches online.</p>
<h3 id="h2-501560c03-0006">Use the webbrowser Module</h3>
<p class="BodyFirst">The <em>webbrowser</em> module gives you tools to open a website by using the default browser on your computer. The module is in the Python Standard Library, so no installation is needed.</p>
<p>To test the <em>webbrowser</em> module on your computer, enter the following lines of code in your Spyder editor and run them:</p>
<pre><code><b>import webbrowser</b>
<b>webbrowser.open("http://"+"wsj.com")</b></code></pre>
<p>We use <code>"http://"+</code> inside the <code>open()</code> function so that you need to input only the main body of the web address instead of the full URL. This is to prepare you for voice activation in the next section. The web browser will automatically correct the URL if it uses <em>https://</em> instead of <em>http://</em> or if <em>www</em> is in the full URL.</p>
<p>A new web browser window should open on the <em>Wall Street Journal</em> website. Microsoft Edge is the default browser on my computer, and the result is shown in <a href="#figure3-1" id="figureanchor3-1">Figure 3-1</a>.</p>
<figure>
<img src="Images/f03001.png" alt="f03001" width="694" height="310"/>
<figcaption><p><a id="figure3-1">Figure 3-1</a>: Result of using the <span class="LiteralInCaption"><code>webbrowser.open("http://"+"wsj.com")</code></span> command</p></figcaption>
</figure>
<h3 id="h2-501560c03-0007"><span epub:type="pagebreak" title="62" id="Page_62"/>Add Voice Control </h3>
<p class="BodyFirst">Now we’ll add the speech recognition feature. Save <a href="#listing3-3" id="listinganchor3-3">Listing 3-3</a> as <em>voice_browse.py</em>.</p>
<pre><code>import webbrowser
import speech_recognition as sr

speech = sr.Recognizer()
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> def voice_to_text():
    voice_input = "" 
    with sr.Microphone() as source:
        speech.adjust_for_ambient_noise(source)
        try:
            audio = speech.listen(source)
            voice_input = speech.recognize_google(audio)
        except sr.UnknownValueError:
            pass
        except sr.RequestError:
            pass        
        except sr.WaitTimeoutError:
            pass
    return voice_input 
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> while True:   
    print('Python is listening...')
    inp = voice_to_text()
    print(f'You just said {inp}.')
    if inp == "stop listening":
        print('Goodbye!')
        break
    elif "browser" in inp: 
        inp = inp.replace('browser ','')
        webbrowser.open("http://"+inp)
        continue</code></pre>
<p class="CodeListingCaption"><a id="listing3-3">Listing 3-3</a>: Code for <em>voice_browse.py</em></p>
<p>We import the two modules needed for this script: <em>webbrowser</em> and <em>SpeechRecognition</em>. At <span class="CodeAnnotation" aria-label="annotation1">1</span>, we define the <code>voice_to_text()</code> function, which contains most of the steps in <em>stand_by.py</em>: it starts with the empty string <code>voice_input</code>, converts the audio from the microphone to text, and puts it in <code>voice_input</code>. It also makes exceptions for the <code>UnknownValueError</code>, the <code>RequestError</code>, and the <code>WaitTimeoutError</code>. Once called, the function will return the value stored in <code>voice_input</code>. </p>
<p>The script starts an infinite loop to continuously take voice input <span class="CodeAnnotation" aria-label="annotation2">2</span>. At each iteration, it prints <code>Python is listening...</code> so you know it’s ready.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">WARNING</span></h2>
<p>	Don’t start speaking into the microphone before you see the message <code>Python is listening...</code>, or part (or even all) of your speech may not be captured by the speech recognition software. </p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p><span epub:type="pagebreak" title="63" id="Page_63"/>We call <code>voice_to_text()</code> to capture your voice input and save the converted text in <code>inp</code>. Note that I intentionally use a different variable name for the local variable <code>voice_input</code> and the global variable <code>inp</code> to avoid confusion.</p>
<p>If you say, “Stop listening” to the microphone, the <code>if</code> branch is activated. The script prints <code>Goodbye!</code> and stops running. If the word <em>browser</em> is in your voice command, the <code>elif</code> branch is activated. The script then puts <code>http://</code> and whatever you say next in the address bar and opens the web browser. For example, if you say “browser abc.com,” the <code>replace()</code> method will change “browser” and the space after it to an empty string, which effectively changes <code>inp</code> to <code>abc.com</code>.</p>
<p>Here’s one sample output, with my voice input in bold:</p>
<pre><code>Python is listening...
You just said <b>browser cnn.com</b>.
Python is listening...
You just said <b>browser pbs.org</b>.
Python is listening...
You just said <b>stop listening</b>.
Goodbye!</code></pre>
<p>The associated web browser pop-ups are as shown in <a href="#figure3-2" id="figureanchor3-2">Figure 3-2</a>.</p>
<figure>
<img src="Images/f03002.png" alt="f03002" width="680" height="379"/>
<figcaption><p><a id="figure3-2">Figure 3-2</a>: One of the sample outputs from <em>voice_browse.py</em></p></figcaption>
</figure>
<p>You use the word <em>browser</em> instead of <em>browse</em> to ensure that the script understands you: if you say “Browse” to your microphone, Python might convert it to <code>brows</code> instead. You may encounter several instances where slight adjustments will need to be made. Since everyone has a different voice, microphone, and diction (accent, inflection, and intonation), your adjustments will likely be different from mine.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="64" id="Page_64"/>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>voice_browse.py</em> and use it to visit <a href="http://nbc.com/" class="LinkURL">http://nbc.com/</a>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-501560c03-0008">Perform a Google Search </h3>
<p class="BodyFirst">We’ll now modify <em>voice_browse.py</em> so you can voice-activate a Google search. All you need to change is this one line of code from <em>voice_browse.py</em>:</p>
<pre><code>        webbrowser.open("http://"+inp)</code></pre>
<p class="BodyContinued">Change it to this:</p>
<pre><code>        webbrowser.open("http://<b>google.com/search?q=</b>"+inp)</code></pre>
<p class="BodyContinued">Then save the modified script as <em>voice_search.py</em>. (You can also download it from the book’s resources page.)</p>
<p>Here we are using the fact that whenever Google performs a search, it puts the search term after <em>http://google.com/search?q=</em> and uses it as the URL in the address bar. For example, when you search <code>how many liters are in a gallon</code> in Google, you get the same result as if you entered the URL <em>http://google.com/search?q=how many liters are in a gallon</em>. </p>
<p>Run <em>voice_search.py</em> in your Spyder editor. Ask a question, like “Browser yards in a mile,” into the microphone. The script should open your default browser, perform a Google search for <code>yards in a mile</code>, and show a result similar to <a href="#figure3-3" id="figureanchor3-3">Figure 3-3</a>. </p>
<figure>
<img src="Images/f03003.png" alt="f03003" width="566" height="333"/>
<figcaption><p><a id="figure3-3">Figure 3-3</a>: The result when you say “browser yards in a mile”</p></figcaption>
</figure>
<p>You can also use the script in any way you use Google, for example, as a voice-controlled dictionary. If you want to know the exact definition of the word <em>diligence</em>, you can say, “Browser define diligence.” </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="65" id="Page_65"/>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>voice_search.py</em> and find out how many liters are in a gallon.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c03-0004">	Open Files </h2>
<p class="BodyFirst">With the capability of speech recognition in a Python script, you can do many things with voice control. We’ll build a script to open various types of files, including text files, PDF files, and music files. </p>
<h3 id="h2-501560c03-0009">Use the os and pathlib Modules to Access and Open Files</h3>
<p class="BodyFirst">You can use the <em>os</em> and <em>pathlib</em> modules to access files and folders on your computer. The <em>os</em> module accesses operating system functionalities such as <em>go to a folder</em>, <em>open a file</em>, and so on. However, the commands differ across operating system. For example, to open a file, the command is <code>explorer</code> in Windows, <code>open</code> in Mac, and <code>xdg-open</code> in Linux. </p>
<p>To make your scripts portable cross-platform, we’ll use the <em>platform</em> module, which lets the script automatically identify your operating system and then choose the appropriate command for you. The <em>pathlib</em> module allows you to find out the file paths and specify a file or folder path. Luckily, <em>pathlib</em> is cross-platform, so you don’t have to worry about a forward slash or backslash. All three modules—<em>os</em>, <em>pathlib</em>, and <em>platform</em>—are in the Python Standard Library, so no installation is needed.</p>
<p>In your chapter folder, create a subfolder called <em>files</em> and save a file <em>example.txt</em> in it. Then enter <a href="#listing3-4" id="listinganchor3-4">Listing 3-4</a> in your Spyder editor and save it as <em>os_platform.py.</em></p>
<pre><code>import os
import pathlib
import platform

myfolder = pathlib.Path.cwd()
print(myfolder)
myfile = myfolder/'files'/'example.txt'
print(myfile)
if platform.system() == "Windows":
    os.system(f"explorer {myfile}") 
elif platform.system() == "Darwin":
    os.system(f"open {myfile}") 
else:
    os.system(f"xdg-open {myfile}") </code></pre>
<p class="CodeListingCaption"><a id="listing3-4">Listing 3-4</a>: Code for <em>os_platform.py</em></p>
<p><span epub:type="pagebreak" title="66" id="Page_66"/>We import the modules, then use <code>Path.cwd()</code> from <em>pathlib</em> to find the current working directory of the script. We’ll use this as the starting path to navigate from.</p>
<p>We then specify the path and name of the file we want to open. In the <em>pathlib</em> module, we use a forward slash to denote subfolders no matter what operating system you are using. The command <code>/'files'</code> tells the script to go to the subfolder <em>files</em>, and <code>/'example.txt'</code> indicates which file to define as <em>myfile</em>. </p>
<p>The <code>system()</code> method from the <em>os</em> module executes the command in a subshell. The <code>explorer</code> command opens a folder or a file on your computer in Windows. However, if you’re using Mac, the <code>system()</code> method in the <em>os</em> module uses the <code>open</code> command, and in Linux, the command is <code>xdg-open</code>. Therefore, the script opens the file <em>example.txt</em> in the subfolder <em>files</em>. </p>
<p>For example, say you’re using Windows and have saved the script in your chapter folder <em>C:\chat\mpt\ch03</em>. After running the script, you’ll have the following output in the IPython console:</p>
<pre><code>C:\chat\mpt\ch03
C:\chat\mpt\ch03\files\example.txt</code></pre>
<p>At the same time, the file <em>example.txt</em> should open. </p>
<h3 id="h2-501560c03-0010">Open Files via Voice Control</h3>
<p class="BodyFirst">We’ll now demonstrate how to open various file types, like MP3; Microsoft Word, PowerPoint, and Excel; and PDF files. Before running the following script, save an MP3 file, a Word file, a PowerPoint file, an Excel file, and a PDF file in the subfolder <em>files</em> you just created in your chapter folder. Name the five files <em>presentation.mp3, lessons.docx, graduation.pptx, book.xlsx, </em>and<em> desk.pdf</em>, respectively. It’s best if the files are not too large. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	You need to have proper software installed on your computer to open the five files. To make sure, you can double-click each one to see if it opens on your computer. If you don’t have software to open all file types, try only the ones that you can open.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p><a href="#listing3-5" id="listinganchor3-5">Listing 3-5</a> shows <em>voice_open_file.py</em>, which can also be downloaded from the book’s resources page.</p>
<pre><code>import os
import pathlib
import platform

import speech_recognition as sr 

speech = sr.Recognizer()
directory = pathlib.Path.cwd()

<span class="CodeAnnotationHang" aria-label="annotation1">1</span> def voice_to_text():
    voice_input = "" 
    with sr.Microphone() as source:
        speech.adjust_for_ambient_noise(source)
        try:
<span epub:type="pagebreak" title="67" id="Page_67"/>            audio = speech.listen(source)
            voice_input = speech.recognize_google(audio)
        except sr.UnknownValueError:
            pass
        except sr.RequestError:
            pass        
        except sr.WaitTimeoutError:
            pass
    return voice_input
def open_file(filename):
    if platform.system() == "Windows":
        os.system(f"explorer {directory}\\files\\{filename}") 
    elif platform.system() == "Darwin":
        os.system(f"open {directory}/files/{filename}") 
    else:
        os.system(f"xdg-open {directory}/files/{filename}")
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> while True:
    print('Python is listening...')
    inp = voice_to_text().lower()
    print(f'You just said {inp}.')
    if inp == "stop listening":
        print('Goodbye!')
        break
    elif "open pdf" in inp: 
        inp = inp.replace('open pdf ','')
        myfile = f'{inp}.pdf'
        open_file(myfile)
        continue
    elif "open word" in inp: 
        inp = inp.replace('open word ','')
        myfile = f'{inp}.docx'
        open_file(myfile)
        continue
    elif "open excel" in inp: 
        inp = inp.replace('open excel ','')
        myfile = f'{inp}.xlsx'
        open_file(myfile)
        continue
    elif "open powerpoint" in inp: 
        inp = inp.replace('open powerpoint ','')
        myfile = f'{inp}.pptx'
        open_file(myfile)
        continue
    elif "open audio" in inp: 
        inp = inp.replace('open audio ','')
        myfile = f'{inp}.mp3'
        open_file(myfile)
        continue</code></pre>
<p class="CodeListingCaption"><a id="listing3-5">Listing 3-5</a>: Code for <em>voice_open_file.py</em></p>
<p>As with <em>voice_browse.py</em>, we define <code>voice_to_text()</code> to convert your voice command to text <span class="CodeAnnotation" aria-label="annotation1">1</span>. We also define <code>open_file()</code> to identify your operating system and use the proper command, <code>explorer</code>, <code>open</code>, or <code>xdg-open</code>, to open the <span epub:type="pagebreak" title="68" id="Page_68"/>file on your computer. Note that while the Windows operating system uses a backward slash (<code>\</code>) to go to a subfolder, Mac and Linux use a forward slash (<code>/</code>) for that purpose.</p>
<p>The script is then put in standby mode by using a <code>while</code> loop <span class="CodeAnnotation" aria-label="annotation2">2</span>. Within the loop, the microphone first detects your voice and converts it into text. Since we put the <code>lower()</code> method after <code>voice_to_text()</code>, all letters in the variable <code>inp</code> will be lowercase to avoid mismatch due to capitalization. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	The <code>lower()</code> method will not affect the opening of files later in the script because the command in the <code>os.system()</code> method is not case-sensitive. For example, the file <em>presentation.mp3</em> will still open even if you use the filename <em>Presentation.MP3</em>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>If you say, “Stop listening,” the script prints <code>Goodbye!</code> and stops running. If the words <em>open pdf</em> are in your voice command, the first <code>elif</code> branch is activated. The script then replaces <code>open pdf</code> with an empty string so only the filename is left in <code>inp</code>. The script goes to the subfolder and opens the proper PDF file. For example, when you say, “Open PDF desk,” the file <em>desk.pdf</em> will open on your computer.</p>
<p>When you say, “Open Word lessons,” the second <code>elif</code> branch is activated. The same principle works for Excel files and PowerPoint files. And when you say, “Open audio presentation,” the audio file <em>presentation.mp3</em> will start playing on your computer, using the default MP3 player.</p>
<p>Here is the output from my interaction:</p>
<pre><code>Python is listening...
You just said <b>open pdf desk</b>.
Python is listening...
You just said <b>open word lessons</b>.
Python is listening...
You just said 
Python is listening...
You just said <b>open excel book</b>.
Python is listening...
You just said <b>open powerpoint graduation</b>.
Python is listening...
You just said <b>open audio presentation</b>.
Python is listening...
You just said <b>stop listening</b>.
Goodbye!</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>TRY IT out</h2>
<p class="BoxBodyFirst">Save a comma-separated values (CSV) file as <em>payments.csv</em> and an MP4 file as <em>recording.mp4</em> in the subfolder <em>files</em> in your chapter folder. Then add two additional <code>elif</code> branches in <em>voice_open_file.py</em> so that your computer will open the CSV file when you say, “Open data payments,” and will open the MP4 file when you say, “Open video recording.”</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c03-0005"><span epub:type="pagebreak" title="69" id="Page_69"/>	Create and Import a Local Module</h2>
<p class="BodyFirst">As you have probably noticed, the three scripts <em>voice_browse.py</em>, <em>voice_search.py</em>, and <em>voice_open_file.py</em> share a large chunk of the same code: the code to import the speech recognition module and define the <code>voice_to_text()</code> function.</p>
<p>To make our scripts more efficient, we’ll put all command lines related to speech recognition in a local module. We can then import the module in any script that uses the speech recognition feature. </p>
<h3 id="h2-501560c03-0011">Create the Local Module mysr</h3>
<p class="BodyFirst">Enter <a href="#listing3-6" id="listinganchor3-6">Listing 3-6</a> in your Spyder editor and save it as <em>mysr.py</em>. Alternatively, you can download it from the book’s resources page.</p>
<pre><code># Get rid of ALSA lib error messages in Linux
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> import platform
import speech_recognition as sr

if  platform.system() == "Linux":
    from ctypes import CFUNCTYPE, c_char_p, c_int, cdll
    
    # Define error handler
    error_handler = CFUNCTYPE\
    (None, c_char_p, c_int, c_char_p, c_int, c_char_p)
    # Don't do anything if there is an error message
  <span class="CodeAnnotationCode" aria-label="annotation2">2</span> def py_error_handler(filename, line, function, err, fmt):
      pass
    # Pass to C
    c_error_handler = error_handler(py_error_handler)
    asound = cdll.LoadLibrary('libasound.so')
    asound.snd_lib_error_set_handler(c_error_handler)

# Now define the voice_to_text() function for all platforms
<span class="CodeAnnotationHang" aria-label="annotation3">3</span> import speech_recognition as sr


def voice_to_text():
    voice_input = "" 
    with sr.Microphone() as source:
        speech.adjust_for_ambient_noise(source)
        try:
            audio = speech.listen(source)
            voice_input = speech.recognize_google(audio)
        except sr.UnknownValueError:
            pass
        except sr.RequestError:
            pass        
        except sr.WaitTimeoutError:
            pass
    return voice_input</code></pre>
<p class="CodeListingCaption"><a id="listing3-6">Listing 3-6</a>: Code for the self-made module <em>mysr</em></p>
<p><span epub:type="pagebreak" title="70" id="Page_70"/>You can ignore the first part of the code <span class="CodeAnnotation" aria-label="annotation1">1</span> if you aren’t using Linux. The Advanced Linux Sound Architecture (ALSA) configuration, which is coded in the C programming language, spits out warning messages like these every time the <em>pyaudio</em> module is imported:</p>
<pre><code>ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.rear
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.center_lfe
ALSA lib pcm.c:2212:(snd_pcm_open_noupdate) Unknown PCM cards.pcm.side
ALSA lib audio/pcm_bluetooth.c:1613:(audioservice_expect) 
BT_GET_CAPABILITIES failed : Input/output error(5)
ALSA lib audio/pcm_bluetooth.c:1613:(audioservice_expect) 
BT_GET_CAPABILITIES failed : Input/output error(5)
ALSA lib audio/pcm_bluetooth.c:1613:(audioservice_expect) 
BT_GET_CAPABILITIES failed : Input/output error(5)
ALSA lib audio/pcm_bluetooth.c:1613:(audioservice_expect) 
BT_GET_CAPABILITIES failed : Input/output error(5)
ALSA lib pcm_dmix.c:957:(snd_pcm_dmix_open) 
The dmix plugin supports only playback stream
ALSA lib pcm_dmix.c:1018:(snd_pcm_dmix_open) unable to open slave</code></pre>
<p>We create an error handler in Python <span class="CodeAnnotation" aria-label="annotation2">2</span> and pass it to C so that you won’t see any error messages when you import <em>pyaudio</em>. The details are beyond the scope of this book, so it’s okay if you don’t understand this part. Just leave the error handler in the module <em>mysr</em>, and it won’t affect your understanding for the rest of the book.</p>
<p>Starting at <span class="CodeAnnotation" aria-label="annotation3">3</span>, we import the <em>SpeechRecognition</em> module, initiate the <code>Recognizer()</code> class, and define the <code>voice_to_text()</code> function. </p>
<p>Note that if you run <em>mysr.py</em>, nothing will happen. This is because we just define <code>voice_to_text()</code> in this script and don’t call it.</p>
<h3 id="h2-501560c03-0012">Import mysr</h3>
<p class="BodyFirst">Let’s revisit <em>stand_by.py</em> and modify it to use <em>mysr</em>. Save <a href="#listing3-7" id="listinganchor3-7">Listing 3-7</a> as <em>stand_by1.py</em>.</p>
<pre><code># Make sure you put mysr.py in the same folder as this script
from mysr import voice_to_text

while True:
    print('Python is listening...')
  <span class="CodeAnnotationCode" aria-label="annotation1">1</span> inp = voice_to_text()
    print(f'You just said {inp}.')
    if inp == "stop listening":
        print('Goodbye!')
        break</code></pre>
<p class="CodeListingCaption"><a id="listing3-7">Listing 3-7</a>: Code for <em>stand_by1.py</em></p>
<p>We’ve replaced all speech recognition–related code with just one line: <code>from mysr import voice_to_text</code>. This line tells the script to go to the local module <em>mysr</em> and import <code>voice_to_text()</code> to be used in the current script. </p>
<p>Whenever you need to convert speech to text, you simply call <code>voice_to_text()</code> <span class="CodeAnnotation" aria-label="annotation1">1</span>. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="71" id="Page_71"/>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>stand_by1.py</em> and say two simple phrases as you did in the <span class="xref" itemid="xref_target_“Try It Out” exercise on page 61">“Try It Out” exercise on page 61</span> and see if you get the same results. After that, say, “Stop listening” to end the script.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c03-0006">	Summary</h2>
<p class="BodyFirst">In this chapter, we installed the <em>SpeechRecognition</em> module and used <code>try</code> and <code>except</code> to handle potential errors. In this way, we prevent the script from closing when we would rather it continue. We tested the voice control functionality with a few projects: voice-controlled web surfing and voice-controlled web search.</p>
<p>You learned how to use the <em>os </em>module to open files and the <em>pathlib</em> module to navigate through the file path, as well as the <em>platform</em> module to make your Python code cross-platform.</p>
<p>Finally, you put all code related to speech recognition into a self-made local module so that your scripts look concise, short, and clean. We’ll use this module throughout the rest of the book.</p>
<h2 id="h1-501560c03-0007">	End-of-Chapter Exercises</h2>
<ol class="decimal">
<li value="1">Modify <em>stand_by.py</em> so that you end the <code>while</code> loop by saying, “Quit the script” instead of “Stop listening,” and when the <code>while</code> loop ends, the script prints <code>Have a great day!</code> </li>
<li value="2">Modify <em>voice_open_file.py</em> so that when you say, “Open text filename,” <em>filename.txt</em> will open on your computer.</li>
<li value="3">Modify <em>voice_open_file.py</em> so that it imports <code>voice_to_text()</code> from the local <em>mysr</em> module.</li>
</ol>
<aside class="endnote" epub:type="rearnote">
</aside>

</section>
</div>
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="73" id="Page_73"/>4</span><br/>
<span class="ChapterTitle">Make Python Talk</span></h1>
</header>
<figure class="opener">
<img src="Images/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">In this chapter, you’ll learn how to make Python talk back to you in a human voice. You’ll first install the text-to-speech module based on your operating system and then teach Python to speak aloud whatever you enter on your computer. You’ll also add the speech recognition feature you learned in <span class="xref" itemid="xref_target_Chapter 3">Chapter 3</span> and get Python to repeat your own speech. Finally, you’ll build a real-world application to use voice inputs to ask Python to calculate the area of a rectangle and tell you the answer in a human voice.</p>
<p>To save space, you’ll put all text-to-speech-related code in a self-made module. Once you do that, you can import the module into any script that needs the text-to-speech feature.</p>
<p><span epub:type="pagebreak" title="74" id="Page_74"/>You’ll also learn how to ask Python to read a long text file, such as a news article, aloud. Before you begin, set up the folder <em>/mpt/ch04/</em> for this chapter. As in previous chapters, you can download the code for all the scripts from <a href="https://www.nostarch.com/make-python-talk/" class="LinkURL">https://www.nostarch.com/make-python-talk/</a>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>New Skills </h2>
<ul>
<li>Installing speech-related modules depending on your operating system</li>
<li>Adjusting properties of your text-to-speech module</li>
<li>Creating a module that is portable cross-platform</li>
<li>Combining the text-to-speech module with speech recognition so a computer can repeat what you said</li>
<li>Making the computer solve a problem and answer you in a human voice</li>
</ul>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c04-0001">	Install the Text-to-Speech Module</h2>
<p class="BodyFirst">Python has two commonly used text-to-speech modules: <em>pyttsx3</em> and <em>gTTS</em>. If you use Windows, you’ll install <em>pyttsx3 </em>and use it throughout the book. In the Windows operating system, the <em>pyttsx3 </em>module works offline, has a human-like voice, and lets you adjust the speech properties—namely, the speed, volume, and gender of the voice output. </p>
<p>However, the <em>pyttsx3 </em>module works differently in Mac and Linux. The voice sounds robotic, and the speech properties are not easily adjustable. Therefore, you’ll install <em>gTTS</em> if you use Mac or Linux. The <em>gTTS</em> module requires an internet connection since it uses the Google Translate text-to-speech API. Further, <em>gTTS</em> does not play the sound directly. It saves the voice as an audio file or file-like object. You’ll have to use your own audio player to hear the voice. The voice generated by <em>gTTS</em> is very human-like.</p>
<p>In <span class="xref" itemid="xref_target_Chapter 2">Chapter 2</span>, you built a virtual environment called <em>chatting</em>, which you then used for speech recognition in <span class="xref" itemid="xref_target_Chapter 3">Chapter 3</span>. You’ll install the <em>pyttsx3</em> or <em>gTTS</em> module in the same virtual environment so your script will have both the speech recognition and text-to-speech features. </p>
<h3 id="h2-501560c04-0001">Setup</h3>
<p class="BodyFirst">If you are using Windows, go to the “Install <em>pyttsx3</em> in Windows” section and skip the “Install <em>gTTS</em> in Mac or Linux” section. Otherwise, skip the “Install <em>pyttsx3</em> in Windows” section and go to the “Install <em>gTTS</em> in Mac or Linux” section.</p>
<h4 id="h3-501560c04-0001">Install pyttsx3 in Windows</h4>
<p class="BodyFirst">The <em>pyttsx3</em> module is not in the Python standard library, so you’ll need to install it via pip. </p>
<p><span epub:type="pagebreak" title="75" id="Page_75"/>If you haven’t already set up your <em>chatting</em> virtual environment, go back to <span class="xref" itemid="xref_target_Chapter 2">Chapter 2</span> now and follow the instructions to do so. Then activate the virtual environment <em>chatting </em>in the Anaconda prompt by executing the following:</p>
<pre><code>conda activate chatting</code></pre>
<p>With your <em>chatting</em> virtual environment activated, enter this:</p>
<pre><code>pip install pyttsx3</code></pre>
<p>Follow the instructions onscreen to finish the installation.</p>
<h4 id="h3-501560c04-0002">Install gTTS in Mac or Linux</h4>
<p class="BodyFirst">The <em>gTTS</em> module is not in the Python standard library, so you’ll need to install it via pip. </p>
<p>If you haven’t already set up your <em>chatting</em> virtual environment, go back to <span class="xref" itemid="xref_target_Chapter 2">Chapter 2</span> now and follow the instructions to do so. Then activate the virtual environment <em>chatting </em>in a terminal by executing the following:</p>
<pre><code>conda activate chatting</code></pre>
<p>With your <em>chatting</em> virtual environment activated in your terminal, enter this command:</p>
<pre><code>pip install gTTs</code></pre>
<p>Follow the instructions onscreen to finish the installation.</p>
<h3 id="h2-501560c04-0002">Test Your Text-to-Speech Module </h3>
<p class="BodyFirst">Before beginning, you’ll check that your text-to-speech module is properly installed and working. Based on your operating system, skip the sections that don’t apply to you. </p>
<h4 id="h3-501560c04-0003">Run a Sample Script in Windows </h4>
<p class="BodyFirst">With your virtual environment activated and Spyder open, copy the script <em>test_pyttsx3.py</em> into your editor and save it in your chapter folder. If you prefer, you can download the file from the book’s resources through <a href="https://www.nostarch.com/make-python-talk/" class="LinkURL">https://www.nostarch.com/make-python-talk/</a>.</p>
<pre><code>import pyttsx3
engine = pyttsx3.init()
engine.say("hello, how are you?")
engine.runAndWait()</code></pre>
<p>First, import the <em>pyttsx3 </em>module to the script. Then use <code>init()</code> to initiate a text-to-speech engine in the <em>pyttsx3 </em>module and call it <code>engine</code>. The <code>say()</code> function in the <em>pyttsx3 </em>module converts the text to a speech signal and <span epub:type="pagebreak" title="76" id="Page_76"/>prepares to send it to the speaker. The <code>runAndWait()</code> function then sends the actual speech signal to the speaker so you can hear the sound. The <code>runAndWait()</code> function also keeps the engine running so that when you want to convert text to speech later in the script, you don’t need to initiate the engine again.</p>
<p>To understand how each line of code functions, run <em>test_pyttsx3.py </em>line by line by using the F9 key. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	The <code>say()</code> function in the <em>pyttsx3</em> module only converts the text to a speech signal and prepares to send it to the speaker. It does not do the actual speaking. To hear the sound, use <code>runAndWait()</code>, which sends the speech signal to the speaker.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>If the module is correctly installed, when you finish running the whole script, you should hear a voice saying, “Hello, how are you?” If not, recheck the instructions and make sure that the speaker on your computer is working properly at the right volume. I’ll discuss later in this chapter how to customize the speed, volume, and voice gender associated with the <em>pyttsx3 </em>module. </p>
<h4 id="h3-501560c04-0004">Run a Sample Script in Mac or Linux </h4>
<p class="BodyFirst">You’ll use the gtts-cli tool (<em>cli</em> stands for <em>command line</em>) to convert text to speech, instead of converting text to an audio file, and then play it. The gtts-cli tool is faster than the alternative method. Once you install the <em>gTTS</em> module, the gtts-cli tool is available in the command line in your virtual environment. The gtts-cli tool converts the text to a file-like object, and you have to choose which audio player to play it. I find that the mpg123 player works well.</p>
<p>First, you need to install the mpg123 player on your computer. If you are using Mac, run the following command in a terminal:</p>
<pre><code>brew install mpg123</code></pre>
<p>If you are using Linux, run the following two commands on a terminal:</p>
<pre><code>sudo apt-get update
sudo apt-get install mpg123</code></pre>
<p>Once you’re finished, with your virtual environment activated, run the following command in a terminal:</p>
<pre><code>gtts-cli --nocheck "hello, how are you?" | mpg123 -q -</code></pre>
<p>If you have correctly installed everything, you should hear a voice saying, “Hello, how are you?” If not, recheck the instructions and make sure that the speaker on your computer is working properly at the right volume. Further, since you have installed the <em>gTTS</em> module in your virtual environment, you have to run the preceding command with your virtual environment activated. Otherwise, it won’t work.</p>
<p><span epub:type="pagebreak" title="77" id="Page_77"/>The <code>nocheck</code> option in this command is to speed up execution. The <code>q</code> flag instructs the module not to display copyright and version messages, even in an interactive mode. Make sure you don’t miss the hyphen at the end of the command. </p>
<p>Next, you’ll use the <em>os</em> module in Python to execute commands in a subshell. </p>
<p>Copy the <em>test_gtts.py</em> script into your Spyder editor and save it in your chapter folder. The script is also available at the book’s resources through <a href="https://www.nostarch.com/make-python-talk/" class="LinkURL">https://www.nostarch.com/make-python-talk/</a>.</p>
<pre><code>import os

os.system('gtts-cli --nocheck "hello, how are you?" | mpg123 -q -')</code></pre>
<p>First import the <em>os </em>module to the script. Then use <code>system()</code> to execute a command in a subshell to achieve the same effect as running the command in a terminal. As a result, the gtts-cli tool is used to convert text to a file-like object. After that, the mpg123 player plays the sound object so you can hear a human voice.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	You don’t need to explicitly import the <em>g</em><em>TTS</em> module in <em>test_gtts.py</em> because you use the gtts-cli tool in the command line, even though the <em>g</em><em>TTS</em> module is used.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>If you’ve done everything correctly, you should hear a voice saying, “Hello, how are you?” </p>
<h4 id="h3-501560c04-0005">Convert Text to Voice in Windows</h4>
<p class="BodyFirst">Now let’s practice converting written text input into a human voice in Windows. With your virtual environment activated and Spyder open, copy the script <em>tts_windows.py</em>, as shown in <a href="#listing4-1" id="listinganchor4-1">Listing 4-1</a>, into your editor and save and run it.</p>
<pre><code>import pyttsx3

engine = pyttsx3.init()
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> while True:
    inp = input("What do you want to covert to speech?\n")
    if inp == "done":
         print(f"You just typed in {inp}; goodbye!")
         engine.say(f"You just typed in {inp}; goodbye!")
         engine.runAndWait()        
         break
  <span class="CodeAnnotationCode" aria-label="annotation2">2</span> else:
        print(f"You just typed in {inp}")
        engine.say(f"You just typed in {inp}")
        engine.runAndWait()
        continue</code></pre>
<p class="CodeListingCaption"><a id="listing4-1">Listing 4-1</a>: Converting text to voice in Windows</p>
<p><span epub:type="pagebreak" title="78" id="Page_78"/>After importing the <em>pyttsx3 </em>module and initiating a text-to-speech engine, start an infinite loop to take user text input <span class="CodeAnnotation" aria-label="annotation1">1</span>. In each iteration, the script asks for text input at the IPython console. If you want to stop the script, enter <code>done</code>, and the script will print and say in a human voice, “You just typed in done; goodbye!” After that, the loop stops, and the script quits running.</p>
<p>If the text input is not <code>done</code>, the <code>else</code> branch runs <span class="CodeAnnotation" aria-label="annotation2">2</span>, and the script speaks your text input out loud in a human voice. After that, the script goes to the next iteration and takes your text input again.</p>
<p>The following is sample output from the script (user input is in bold):</p>
<pre><code>What do you want to covert to speech?
<b>Python is great!</b>
You just typed in Python is great!

What do you want to covert to speech?
<b>Hello, world!</b>
You just typed in Hello, world!

What do you want to covert to speech?
<b>done</b>
You just typed in done; goodbye!</code></pre>
<h4 id="h3-501560c04-0006">Convert Text to Voice in Mac or Linux</h4>
<p class="BodyFirst">Now we’ll practice converting written text input into a human voice in Mac or Linux. With your virtual environment activated and Spyder open, copy the script <em>tts_mac_linux.py</em> (<a href="#listing4-2" id="listinganchor4-2">Listing 4-2</a>) into your editor, and save and run it.</p>
<pre><code>import os

while True: <span class="CodeAnnotationCode" aria-label="annotation1">1</span>
    inp = input("What do you want to covert to speech?\n")
    if inp == "done":
        print(f"You just typed in {inp}; goodbye!")
        os.system(f'gtts-cli --nocheck "You just typed in {inp}; goodbye!" | mpg123 -q -')
        break
    else: <span class="CodeAnnotationCode" aria-label="annotation2">2</span>
        print(f"You just typed in {inp}")
        os.system(f'gtts-cli --nocheck "You just typed in {inp}" | mpg123 -q -')
        continue</code></pre>
<p class="CodeListingCaption"><a id="listing4-2">Listing 4-2</a>: Converting text to voice in Mac and Linux</p>
<p>After importing the <em>os </em>module so you can run commands in a subshell, start an infinite loop to take user text input <span class="CodeAnnotation" aria-label="annotation1">1</span>. In each iteration, the script asks for text input at the IPython console. If you want to stop the script, enter <code>done</code>, and the script will print and say in a human voice, “You just typed in done; goodbye!” After that, the loop stops, and the script quits running.</p>
<p><span epub:type="pagebreak" title="79" id="Page_79"/>If the text input is not <code>done</code>, the <code>else</code> branch runs <span class="CodeAnnotation" aria-label="annotation2">2</span>, and the script speaks your text input out loud in a human voice. After that, the script goes to the next iteration and takes your text input again.</p>
<p>The following is sample output from the script (user input is in bold):</p>
<pre><code>What do you want to covert to speech?
<b>Python is great!</b>
You just typed in Python is great!

What do you want to covert to speech?
<b>Hello, world!</b>
You just typed in Hello, world!

What do you want to covert to speech?
<b>done</b>
You just typed in done; goodbye!</code></pre>
<h2 id="h1-501560c04-0002">	Repeat After Me</h2>
<p class="BodyFirst">We’ll start with a simple script that hears what you say aloud and repeats it in a human voice. This script serves two purposes. First, you’ll learn how the script takes your voice inputs and which words are easiest for the script to understand—some uncommon words won’t be understood. Second, you’ll learn how to put both the speech recognition and text-to-speech features in the same script so you can communicate with the computer through human voices only.</p>
<p>We’ll also make the script portable cross-platform. The script will automatically choose the <em>pyttsx3</em> module if you are using Windows and the <em>gTTS</em> module otherwise.</p>
<p>Start a new script, name it <em>repeat_me.py</em>, and enter the code in <a href="#listing4-3" id="listinganchor4-3">Listing 4-3</a>. Make sure to save it in your chapter folder. You’ll also need to copy your <em>mysr.py</em> file from <span class="xref" itemid="xref_target_Chapter 3">Chapter 3</span> and paste it into the same folder, as you’ll need <code>voice_to_text()</code> from that script. </p>
<pre><code># Make sure you put mysr.py in the same folder as this script
from mysr import voice_to_text

import platform <span class="CodeAnnotationCode" aria-label="annotation1">1</span>
if platform.system() == "Windows":
    import pyttsx3
    engine = pyttsx3.init()
else:
    import os
    
while True:   
    print('Python is listening...')
    inp = voice_to_text() <span class="CodeAnnotationCode" aria-label="annotation2">2</span>
    if inp == "stop listening":
        print(f'You just said {inp}; goodbye!')
        if platform.system() == "Windows":
<span epub:type="pagebreak" title="80" id="Page_80"/>            engine.say(f'You just said {inp}; goodbye!')
            engine.runAndWait()
        else:
            os.system(f'gtts-cli --nocheck "You just said {inp}; goodbye!" | mpg123 -q -')
        break

    else:
        print(f'You just said {inp}')
        if platform.system() == "Windows": <span class="CodeAnnotationCode" aria-label="annotation3">3</span>
            engine.say(f'You just said {inp}')
            engine.runAndWait()
        else:
            os.system(f'gtts-cli --nocheck "You just said {inp}" | mpg123 -q -')
        continue</code></pre>
<p class="CodeListingCaption"><a id="listing4-3">Listing 4-3</a>: Repeating aloud</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">WARNING</span></h2>
<p>	Remember to put <em>mysr.py</em> in the same folder as <a href="#listing4-3">Listing 4-3</a>. Otherwise, the speech recognition feature won’t work! Yes, I’ve said this before, but it’s important enough to bear repeating.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>First, import the <code>voice_to_text()</code> function from the <em>mysr</em> module to convert voice commands into a string variable. Then, import the <em>platform</em> module, which lets the script automatically identify your operating system and choose the appropriate command for you <span class="CodeAnnotation" aria-label="annotation1">1</span>. If you are using Windows, the script imports the <em>pyttsx3 </em>module and initiates a text-to-speech engine. Otherwise, the script imports the <em>os </em>module so you can use the gtts-cli tool in a subshell. </p>
<p>You then start an infinite loop to take voice inputs. The script takes your voice command and converts it into a string variable called <code>inp</code> <span class="CodeAnnotation" aria-label="annotation2">2</span>. If you say, “Stop listening” into the microphone, the script will say aloud, “You just said stop listening; goodbye!” After that, the script stops. The script uses either the <em>pyttsx3 </em>module or the gtts-cli tool, depending on your operating system. </p>
<p>If you say anything else into the microphone, the loop will keep running. At each iteration, the script will repeat what you said out loud <span class="CodeAnnotation" aria-label="annotation3">3</span>. </p>
<p>The following is the output from the script after I said, “Hello,” “How are you,” and “Stop listening” into the microphone sequentially: </p>
<pre><code>Python is listening...
You just said <b>hello</b>
Python is listening...
You just said <b>how are you</b>
Python is listening...
You just said <b>stop listening</b>; goodbye!</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	If you pause often while the script stands by, the script may say, “You just said” in a human voice again and again when you are not speaking. To avoid that, you can modify <em>r</em><em>epeat_me</em><em>.py</em> by removing the <code>Y</code><code>ou just said</code> part (<span class="CodeAnnotation" aria-label="annotation3">3</span> in <a href="#listing4-3">Listing 4-3</a>).</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c04-0003"><span epub:type="pagebreak" title="81" id="Page_81"/>	Customize the Speech</h2>
<p class="BodyFirst">In this section, you’ll learn how to customize the speech produced by your text-to-speech module. You can adjust the speed and volume of the speech as well as the identity of the voice in the <em>pyttsx3</em> module in Windows. If you are using Mac or Linux, the only thing you can customize is the speed of the voice in the <em>gTTS</em> module. </p>
<p>Skip any of the following subsections that don’t apply to your operating system.</p>
<h3 id="h2-501560c04-0003">Retrieve Default Settings in the pyttsx3 Module in Windows</h3>
<p class="BodyFirst">First, you need to see the default values of the parameters for the speed, volume, and identity of the voice in the <em>pyttsx3</em> module in Windows.</p>
<p>This script will retrieve the default settings for your speech module. In Spyder, enter the code in <a href="#listing4-4" id="listinganchor4-4">Listing 4-4</a> and save it as <em>pyttsx3_property.py</em> in the chapter folder.</p>
<pre><code>import pyttsx3

engine = pyttsx3.init()
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> voices = engine.getProperty('voices')
for voice in voices:
    print(voice)
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> rate = engine.getProperty("rate")
print("the default speed of the speech is", rate)
vol = engine.getProperty("volume")
print("the default volume of the speech is", vol)</code></pre>
<p class="CodeListingCaption"><a id="listing4-4">Listing 4-4</a>: Retrieving the default settings</p>
<p>At <span class="CodeAnnotation" aria-label="annotation1">1</span>, you use <code>getProperty()</code> to obtain the properties of the voices used in the engine. You then iterate through all the voice objects in the list <code>voices</code> and print out individual voice objects. </p>
<p>You use <code>getProperty()</code> <span class="CodeAnnotation" aria-label="annotation2">2</span> to obtain the properties of the speed and print the default speed, then do the same for the default volume.</p>
<p>If you run this script in Windows, you’ll see the default settings for your speech script, similar to the following output:</p>
<pre><code>&lt;Voice id=HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Speech\Voices\Tokens\TTS_MS_EN-US_DAVID_11.0
          name=Microsoft David Desktop - English (United States)
          languages=[]
          gender=None
          age=None&gt;
&lt;Voice id=HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Speech\Voices\Tokens\TTS_MS_EN-US_ZIRA_11.0
          name=Microsoft Zira Desktop - English (United States)
          languages=[]
          gender=None
          age=None&gt;
the default speed of the speech is 200
the default volume of the speech is 1.0</code></pre>
<p><span epub:type="pagebreak" title="82" id="Page_82"/>Here you can see the two voices available to the <em>pyttsx3</em> module. The first voice, named <em>David</em>, has a male voice tone; the second voice, named <em>Zira</em>, has a female voice tone. The default voice tone is David—hence the male voice you hear in <em>test_pyttsx3.py</em>. </p>
<p>The default speech speed is 200 words per minute. The default volume is set at 1. You’ll learn how to adjust the speed, volume, and ID in the <em>pyttsx3</em> module in Windows next. </p>
<h3 id="h2-501560c04-0004">Adjust Speech Properties in the pyttsx3 Module in Windows</h3>
<p class="BodyFirst">This script will change the default settings so you can hear a voice with the speed, volume, and ID that you prefer. Save <a href="#listing4-5" id="listinganchor4-5">Listing 4-5</a> as <em>pyttsx3_adjust.py</em>. </p>
<pre><code>import pyttsx3
engine = pyttsx3.init()
voice_id = 1
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> voices = engine.getProperty('voices')
engine.setProperty('voice', voices[voice_id].id)
engine.setProperty('rate', 150)
engine.setProperty('volume', 1.2)
engine.say("This is a test of my speech id, speed, and volume.")
engine.runAndWait()</code></pre>
<p class="CodeListingCaption"><a id="listing4-5">Listing 4-5</a>: Adjusting some settings</p>
<p>Choose the second voice ID, which has a female voice. At <span class="CodeAnnotation" aria-label="annotation1">1</span>, the script obtains the voice objects available in the text-to-speech engine and saves them in a list called <code>voices</code>. Choose the second object in the list <code>voices</code>, which has a female voice tone, by giving the index <code>[1]</code>. The <code>setProperty()</code> function takes two arguments: the property to set and the value to set it to. Set the value to <code>voices[voice_id].id</code> to choose the <code>id</code> value of the female voice object in Windows, which is <em>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Speech\Voices\Tokens\TTS_MS_EN-US_ZIRA_11.0</em>. If you want to change to the male voice in Windows, you can use <code>voices[0].id</code> instead.</p>
<p>Next, you set the speech speed to 150 words per minute. Most of us speak at a rate of about 125 words per minute in everyday conversation. For faster speech, set <code>rate</code> to a number greater than 125, and for slower speech, set it to a number below 125.</p>
<p>Then, the volume is set to 1.2, which is louder than the default value of 1. You can set this to higher or lower than 1 based on your preference and speakers.</p>
<p>Finally, the script converts the text in <code>say()</code> into speech by using the adjusted properties. Try running this script multiple times with different combinations of parameters until you find the best combination for you. You can always come back to this script and make adjustments. </p>
<h3 id="h2-501560c04-0005">Customize the gTTS Module in Mac or Linux</h3>
<p class="BodyFirst">You can customize the speed, but not the volume or ID, of the voice in <em>gTTS</em>, according to the <em>gTTS</em> documentation; see, for example, <a href="https://buildmedia.readthedocs.org/media/pdf/gtts/latest/gtts.pdf" class="LinkURL">https://buildmedia.readthedocs.org/media/pdf/gtts/latest/gtts.pdf</a>. However, <em>gTTS</em> can convert text to <span epub:type="pagebreak" title="83" id="Page_83"/>speech in most major world languages including Spanish, French, German, and so on, which the <em>pyttsx3</em> module can’t do. You’ll use this feature of <em>gTTS</em> to build a voice translator in <span class="xref" itemid="xref_target_Chapter 16">Chapter 16</span>.</p>
<p>This script will change the default speed to slow for the <em>gTTS</em> module. In Spyder, enter the following code and save it as <em>gtts_slow.py</em> in the chapter folder:</p>
<pre><code>import os

os.system('gtts-cli --nocheck --slow "hello, how are you?" | mpg123 -q -')</code></pre>
<p>The script is the same as <em>test_gtts.py</em> you’ve created before except that it adds the <code>--slow</code> option. This changes the voice output to slower than normal. </p>
<p>If you run this script in Mac or Linux, you’ll hear the computer saying, “Hello, how are you?” slowly. </p>
<p>Since the default setting for the speed is <code>slow=False</code>, and that’s what we prefer, we won’t customize the <em>gTTS</em> module.</p>
<h2 id="h1-501560c04-0004">	Build the Local mysay Module</h2>
<p class="BodyFirst">In <span class="xref" itemid="xref_target_Chapter 3">Chapter 3</span>, you put all commands related to speech recognition in a local module named <em>mysr</em>. You’ll do the same here and put all text-to-speech-related commands in a local module.</p>
<h3 id="h2-501560c04-0006">Create mysay</h3>
<p class="BodyFirst">You’ll create a local module <em>mysay</em> and save it in the same folder as any script that uses the text-to-speech feature. That way, you can save space in the main script. This module has adjusted the properties for speed, volume, and gender of the speech set in <em>pyttsx3_adjust.py</em> if you are using Windows. If you are using Mac or Linux, the local module <em>mysay</em> will use the default properties in the <em>gTTS</em> module. You can modify these parameters based on your own preferences.</p>
<p>Enter the code in <a href="#listing4-6" id="listinganchor4-6">Listing 4-6</a> and save it as <em>mysay.py</em> in your chapter folder.</p>
<pre><code># Import the platform module to identify your OS
import platform

# If you are using Windows, use pyttsx3 for text to speech
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> if platform.system() == "Windows":
    import pyttsx3
  <span class="CodeAnnotationCode" aria-label="annotation2">2</span> try:
        engine = pyttsx3.init()
    except ImportError:
        pass
    except RuntimeError:
        pass    
    voices = engine.getProperty('voices')
    engine.setProperty('voice', voices[1].id)
    engine.setProperty('rate', 150)
    engine.setProperty('volume', 1.2)
<span epub:type="pagebreak" title="84" id="Page_84"/>    def print_say(txt):
        print(txt)
        engine.say(txt)
        engine.runAndWait()

# If you are using Mac or Linux, use gtts for text to speech
<span class="CodeAnnotationCode" aria-label="annotation3">3</span> if  platform.system() == "Darwin" or platform.system() == "Linux":
    import os

    def print_say(texts):
        print(texts)
        texts = texts.replace('"','')
        texts = texts.replace("'","")
        os.system(f'gtts-cli --nocheck "{texts}" | mpg123 -q -')</code></pre>
<p class="CodeListingCaption"><a id="listing4-6">Listing 4-6</a>: Building the module</p>
<p>You first import the platform module to identify your operating system. If you are using Windows <span class="CodeAnnotation" aria-label="annotation1">1</span>, the <em>pyttsx3 </em>module is imported. You use exception handling when initiating the text-to-speech engine <span class="CodeAnnotation" aria-label="annotation2">2</span> so that if you get an <code>ImportError</code> or <code>RuntimeError</code>, the script will keep running rather than crash. You then define <code>print_say()</code>, which prints the text and converts text to speech.</p>
<p>If you are using Mac or Linux <span class="CodeAnnotation" aria-label="annotation3">3</span>, the <em>os </em>module is imported to use the gtts-cli tool to run the command in a subshell. You then define a different <code>print_say()</code> function that prints the text and converts text to speech.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	If you are using Windows, the module <em>my</em><em>say</em> has adjusted the properties of the speed, volume, and gender of the speech. You can modify these parameters based on your own preferences.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-501560c04-0007">Import mysay </h3>
<p class="BodyFirst">With <em>mysay</em> prepared, you can simply import the module to your script to use the text-to-speech features. Let’s revisit the script <em>repeat_me.py</em> and modify it to use the <em>mysay</em> module. Save the following as <em>repeat_me1.py</em>: </p>
<pre><code># Put mysr.py and mysay.py in the same folder as this script
from mysr import voice_to_text
from mysay import print_say

while True:   
    print('Python is listening...')
    inp = voice_to_text()
    if inp == "stop listening":
        print_say(f'You just said {inp}; goodbye!')
        break
    else:
        print_say(f'You just said {inp}')
        continue</code></pre>
<p><span epub:type="pagebreak" title="85" id="Page_85"/>You first import <code>print_say()</code> from <em>mysay</em>. You also import <code>voice_to_text()</code> from the <em>mysr</em> module created in <span class="xref" itemid="xref_target_Chapter 3">Chapter 3</span>. You use <code>voice_to_text()</code> to convert your voice command into a variable <code>inp</code>. When you want to covert text to speech, you use <code>print_say()</code>. </p>
<p>Run the script and speak into the microphone to test it out. I said, “Hello again,” “This one is using a text-to-speech module,” and “Stop listening,” to the script in that order. Here is the output:</p>
<pre><code>Python is listening...
You just said <b>hello again</b>
Python is listening...
You just said <b>this one is using a text-to-speech module</b>
Python is listening...
You just said <b>stop listening</b>; goodbye!</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try It Yourself</h2>
<p class="BoxBodyFirst">Run <em>repeat_me1.py</em> and say three phrases into the microphone so that Python repeats after you, phrase by phrase. When it is finished, use the voice command “I am done” to exit the script (you need to modify the script slightly).</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c04-0005">	Build a Voice-Controlled Calculator</h2>
<p class="BodyFirst">You’ll use your text-to-voice and speech-parsing skills to build a calculator that you can speak commands to. The calculator finds the area of a rectangle and tells you the area in a human voice. </p>
<p>This script takes from you the width and length of a rectangle and speaks back its area. Save <a href="#listing4-7" id="listinganchor4-7">Listing 4-7</a> as <em>area_hs.py</em> in your chapter folder.</p>
<pre><code># Put mysr.py and mysay.py in the same folder as this script
from mysr import voice_to_text
from mysay import print_say

# Ask the length of the rectangle
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> print_say('What is the length of the rectangle?')
# Convert the voice input to a variable inp1
inp1 = voice_to_text()
print_say(f'You just said {inp1}.')
# Ask the width of the rectangle
print_say('What is the width of the rectangle?')
# Save the answer as inp2
inp2 = voice_to_text()
print_say(f'You just said {inp2}.')
# Calculate the area
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> area = float(inp1)*float(inp2)
# Print and speak the result
print_say(f'The area of the rectangle is {area}.')</code></pre>
<p class="CodeListingCaption"><a id="listing4-7">Listing 4-7</a>: Calculating the area of a rectangle</p>
<p><span epub:type="pagebreak" title="86" id="Page_86"/>You first import the text-to-speech and speech recognition functions from local modules. The script asks you about the length of the rectangle <span class="CodeAnnotation" aria-label="annotation1">1</span>. Speak a number into the microphone, and the script converts your voice input into text and saves it as the variable <code>inp1</code>. The script then asks you for the width of the rectangle. When you speak your answer, the script saves your voice input in the variable <code>inp2</code>.</p>
<p>Based on your inputs, the script calculates the area of the rectangle <span class="CodeAnnotation" aria-label="annotation2">2</span> by converting your voice inputs into float variables and multiplying them.</p>
<p>The script will speak the result aloud as well as print the interactions to the screen. Here is one interaction with the script:</p>
<pre><code>What is the length of the rectangle?
You just said <b>5.</b>
What is the width of the rectangle?
You just said <b>3.</b>
The area of the rectangle is 15.0.</code></pre>
<p>Once I told the script that the length of the rectangle was 5 and the width was 3, the script told me that the area was 15.0.</p>
<p>If you say something that isn’t a number, the script will not work. It’s safest to include the decimal in your response (for example, “five point zero”) so the script doesn’t accidentally convert your response into a string rather than a number type. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try It Yourself</h2>
<p class="BoxBodyFirst">Run <em>area_hs.py</em> to determine the area of a rectangle that has a length of 5.3 and width of 1.6.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c04-0006">	Read a File Aloud</h2>
<p class="BodyFirst">In this section, you’ll learn how to read a file into a script so Python can speak the text aloud. </p>
<p><a href="#listing4-8" id="listinganchor4-8">Listing 4-8</a> contains the short news article you’ll use.</p>
<pre><code>Storm Dorian likely to strengthen into hurricane

Thomson Reuters
BY BRENDAN O'BRIEN Aug 25th 2019 3:49PM

Tropical Storm Dorian was likely to strengthen into a hurricane during the next two days as it churned westward in the Caribbean Sea, putting Puerto Rico, the Lesser Antilles and the Virgin Islands on alert, forecasters said on Sunday.

<span epub:type="pagebreak" title="87" id="Page_87"/>The storm, 465 miles (750 km) east-southeast of Barbados, packed 40 mph winds as it headed west at 14 mph. It was forecast to be near the central Lesser Antilles late on Monday or early Tuesday, the National Hurricane Center (NHC) said in a midday advisory on Sunday.

"Right now, it's a tropical storm and we are expecting it to strengthen close to or reaching hurricane intensity as it approaches," NHC meteorologist Michael Brennan told Reuters.

Dorian was expected to turn toward the west-northwest on Monday and continue on that path through Tuesday night, the NHC said.

As of Sunday afternoon, Barbados was under a tropical storm warning while a tropical storm watch was in effect for St. Lucia and St. Vincent and the Grenadines.

The NHC was likely to issue additional watches for portions of the Windward and Leeward Islands on Sunday, Brennan said, noting that Puerto Rico, the Virgin Islands and Hispaniola should monitor Dorian's progress.

"We are approaching the peak of the hurricane season so everybody in the Caribbean and along the U.S. South, Gulf and East Coast needs to be aware and follow these systems," Brennan said. Dorian's winds could weaken as it passes south of Puerto Rico and approaches Hispaniola. Many Caribbean islands are likely to receive 2 to 4 inches (5 to 10 cm) of rain, but some part of the
Lesser Antilles islands could get 6 inches, the NHC said.</code></pre>
<p class="CodeListingCaption"><a id="listing4-8">Listing 4-8</a>: Content for the text file</p>
<p>Including this article as is in a script would clearly be inconvenient, so save it as a text file named <em>storm.txt</em> (you can download <em>storm.txt</em> with the rest of the book’s resources). You can first create a subfolder called <em>files</em> in your chapter folder and then save <em>storm.txt</em> in the subfolder.</p>
<p>Save <a href="#listing4-9" id="listinganchor4-9">Listing 4-9</a> as <em>newsfile.py </em>to have Python read the news article out loud. </p>
<pre><code># Put mysay.py in the same folder as this script
from mysay import print_say
import pathlib

# Open the file, and read the content of the text file
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> myfile = pathlib.Path.cwd() / 'files' / 'storm.txt'
with open(myfile,'r') as f:
      content = f.read()
    
# Let Python speak the text in the file
print_say(content)</code></pre>
<p class="CodeListingCaption"><a id="listing4-9">Listing 4-9</a>: Reading out the text file</p>
<p>You first let the script know where to find the news file <span class="CodeAnnotation" aria-label="annotation1">1</span>. You use <code>open()</code> to access <em>storm.txt</em> from the subfolder <em>files. </em>You then read the content of the file into a string variable called <code>content</code> by using <code>read()</code>. At the end, the script reads the file content out loud in a human voice. Simple!</p>
<p><span epub:type="pagebreak" title="88" id="Page_88"/>If you save <em>storm.txt</em> in the same folder as the preceding script, you don’t need to specify the file path. Python will automatically look in the folder the script is held in when a path is not specified.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try It Yourself</h2>
<p class="BoxBodyFirst">Select an online news article and save it as <em>mynews.txt</em> on your computer. Modify <em>newsfile.py</em> so that the script reads the news article out loud in a human voice. </p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c04-0007">	Summary</h2>
<p class="BodyFirst">In this chapter, you learned how to install the text-to-speech module to make Python talk. You moved crucial text-to-speech features into the module <em>mysay</em> to import into scripts. </p>
<p>You have also learned how to have Python repeat what you say. You applied your new skills to a real-world application: using voice inputs to ask Python to calculate the area of a rectangle and tell you the answer in a human voice.</p>
<p>Now that you know how to make Python talk and listen, in <span class="xref" itemid="xref_target_Chapter 5">Chapter 5</span> you’ll learn how to apply both features to several interesting real-world applications.</p>
<h2 id="h1-501560c04-0008">	End-of-Chapter Exercises</h2>
<ol class="decimal">
<li value="1">If you are using Windows, in <em>pyttsx3_adjust.py</em>, modify the code as follows:
<ol class="upper-alpha">
<li value="1">The voice is a male voice.</li>
<li value="2">The speed of the speech is 160 words per minute.</li>
<li value="3">The volume is 0.8.</li>
</ol></li>
<li value="2">Modify the script <em>area_hs.py</em> to calculate the area of a triangle when you say the triangle’s height and base length. </li>
</ol>
</section>
</div>
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="89" id="Page_89"/>5</span><br/>
<span class="ChapterTitle">Speaking Applications</span></h1>
</header>
<figure class="opener">
<img src="Images/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">Now that you know how to make Python talk and listen, we’ll create several real-world applications that utilize those skills. But before that, you’ll create a local package. Since you’ll use the <em>mysr</em> and <em>mysay</em> local modules in every chapter for the reminder of the book, you’ll create a Python package to contain all local modules. This way, you don’t need to copy and paste these modules to the folders of individual chapters. This also helps keep the code consistent throughout the book. You’ll learn how a Python package works and how to create one yourself along the way.</p>
<p>In the first application, you’ll build a Guess the Number game that takes voice commands and talks back to you in a human voice. </p>
<p><span epub:type="pagebreak" title="90" id="Page_90"/>You’ll then learn how to parse text to extract news summaries from National Public Radio (NPR) and have Python read them out to you. You’ll also build a script to extract information from Wikipedia based on your voice inquiries and to speak the answers out.</p>
<p>Finally, you’ll learn how to traverse files in a folder with your voice, with the aim of building your very own Alexa. You’ll be able to say to the script, “Python, play Selena Gomez,” and a song by Selena Gomez that’s saved on your computer will start playing.</p>
<p>As usual, you can download all the code for all the scripts from <a href="https://www.nostarch.com/make-python-talk/" class="LinkURL">https://www.nostarch.com/make-python-talk/</a>. Before you begin, set up the folder <em>/mpt/ch05/</em> for this chapter. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>New Skills </h2>
<ul>
<li>Learning how Python packages work</li>
<li>Creating your self-made local Python package</li>
<li>Parsing the source code of a news website to extract news summaries</li>
<li>Extracting answers to your queries from Wikipedia and converting them to voice</li>
<li>Traversing files in a folder on your computer by using the <em>os</em> module</li>
</ul>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c05-0001">	Create Your Self-Made Local Python Package</h2>
<p class="BodyFirst">In Chapter 3, you built a self-made local module <em>mysr</em> to contain all speech recognition–related code. Whenever you need to use the speech-recognition feature, you import <code>voice_to_text() </code>from the module. Similarly, you built a self-made local module <em>mysay</em> in <span class="xref" itemid="xref_target_Chapter 4">Chapter 4</span> to contain all text-to-speech-related code. You import <code>print_say()</code> from the module whenever you use the text-to-speech feature.</p>
<p>You’ll use these two self-made local modules in this chapter and other chapters in this book. To make these modules work, you need to put the module files (namely, <em>mysr.py</em> and <em>mysay.py</em>) in the same directory as the script that uses these two modules. This means you’d potentially have to copy and paste these files into the directory of almost every chapter in this book. You may wonder: is there a more efficient way to do this?</p>
<p>The answer is yes, and that’s what Python packages are for.</p>
<p>Next, you’ll first learn what a Python package is and how it works. You’ll then learn how to create your self-made local package. Finally, you’ll use a Python script to test and import your package. </p>
<h3 id="h2-501560c05-0001">What’s a Python Package?</h3>
<p class="BodyFirst">Many people think that Python modules and Python packages are the same. They’re not.</p>
<p><span epub:type="pagebreak" title="91" id="Page_91"/>A Python <em>module</em> is a single file with the <em>.py</em> extension. In contrast, a Python <em>package</em> is a collection of Python modules contained in a single directory. The directory must have a file named <em>__init__.py</em> to distinguish it from a directory that happens to have <em>.py</em> extension files in it.</p>
<p>I’ll guide you through the process of creating a local package step-by-step. </p>
<h3 id="h2-501560c05-0002">Create Your Own Python Package</h3>
<p class="BodyFirst">To create a local Python package, you need to create a separate directory for it and place all related files into it. In this section, you’ll create a local package to contain both our speech recognition and text-to-speech module files—namely, <em>mysr.py</em> and <em>mysay.py</em>. </p>
<h4 id="h3-501560c05-0001">Create a Package Directory</h4>
<p class="BodyFirst">First, you need to create a directory for the package. </p>
<p>In this book, you use a separate directory for each chapter. For example, all Python scripts and related files in this chapter are placed in the directory <em>/mpt/ch05/</em>. Since you are creating a package to be used for all chapters in this book, you’ll create a directory parallel to all chapters. Specifically, you’ll use the directory <em>/mpt/mptpkg/</em>, where <em>mptpkg</em> is the package name. The diagram in <a href="#figure5-1" id="figureanchor5-1">Figure 5-1</a> explains the position of the package relative to the book chapters. </p>
<figure>
<img src="Images/f05001.png" alt="f05001" width="602" height="134"/>
<figcaption><p><a id="figure5-1">Figure 5-1</a>: The position of the <em>m</em><em>pt</em><em>pkg</em> package relative to the chapter folders</p></figcaption>
</figure>
<p>As you can see, the package directory is parallel to the chapter directories, which are all contained in the directory for the book, <em>/mpt</em>, as in <em>Make Python Talk</em>.</p>
<h4 id="h3-501560c05-0002">Create Necessary Files for Your Package</h4>
<p class="BodyFirst">Next, you need to create and place necessary files in the package. </p>
<p>First, copy and paste the two modules you created in Chapters <span class="xref" itemid="xref_target_3">3</span> and <span class="xref" itemid="xref_target_4">4</span>, <em>mysr.py</em> and <em>mysay.py</em>, in the package directory <em>/mpt/mptpkg/</em>. Do not make any changes to the two files.</p>
<p>Then save the following script, <em>__init__.py</em>, in the package directory <em>/mpt/mptpkg/</em> (or you can download it from the book’s resources):</p>
<pre><code>from .mysr import voice_to_text
from .mysay import print_say</code></pre>
<p><span epub:type="pagebreak" title="92" id="Page_92"/>The purpose of this file is twofold: it imports <code>voice_to_text()</code> and <code>print_say()</code> so you can use those functions at the package level, and it also tells Python that the directory is a package, not a folder that happens to have Python scripts in it.</p>
<p>Finally, save the following script, <em>setup.py</em>, in the book directory <em>/mpt</em>, one level above the package directory <em>/mpt/mptpkg/</em>. The script is also available from the book’s resources.</p>
<pre><code>from setuptools import setup
setup(name='mptpkg',
version='0.1',
description='Install local package for Make Python Talk',
author='Mark Liu',
author_email='mark.liu@uky.edu',
packages=['mptpkg'],
zip_safe=False)</code></pre>
<p>The file provides information about the package, such as the package name, author, version, descriptions, and so on.</p>
<p>You’ll learn how to install this local package on your computer next.</p>
<h4 id="h3-501560c05-0003">Install Your Package</h4>
<p class="BodyFirst">Because you’ll modify the local package and add more features to it later in the book, it’s better to install the package in editable mode. </p>
<p>Open your Anaconda prompt (Windows) or a terminal (Mac or Linux) and activate your virtual environment for this book, <em>chatting</em>. Run the following command:</p>
<pre><code><b>pip install -e </b><var class="bold">path-to-mpt</var></code></pre>
<p>Replace <var>path-to-mpt</var> with the actual directory path of <em>/mpt</em>. For example, the book directory <em>/mpt</em> is <em>C:\mpt </em>on my office computer that runs the Windows operating system, so I installed the local package using this command: </p>
<pre><code>pip install -e C:\mpt</code></pre>
<p>On my Linux machine, the path to the <em>/mpt </em>directory is <em>/home/mark/Desktop/mpt</em>, so I installed the local package using this command: </p>
<pre><code>pip install -e /home/mark/Desktop/mpt</code></pre>
<p>The <code>-e</code> option tells the Python to install the package in editable mode so that you can modify the package anytime you need to.</p>
<p>With that, the local package is installed on your computer.</p>
<h3 id="h2-501560c05-0003">Test Your Package</h3>
<p class="BodyFirst">Now that you have installed your self-made local package, you’ll learn how to import it. </p>
<p>You’ll write a Python script to test the package you just created.</p>
<p><span epub:type="pagebreak" title="93" id="Page_93"/>Let’s revisit the script <em>repeat_me1.py</em> from <span class="xref" itemid="xref_target_Chapter 4">Chapter 4</span>. Enter the following lines of code in your Spyder editor and save it as <em>repeat_me2.py</em> in your <span class="xref" itemid="xref_target_Chapter 5">Chapter 5</span> directory <em>/mpt/ch05/</em>: </p>
<pre><code># Import functions from the local package mptpkg
from mptpkg import voice_to_text
from mptpkg import print_say

while True:
    print('Python is listening...')
    inp = voice_to_text()
    if inp == "stop listening":
        print_say(f'you just said {inp}; goodbye!')
        break
    else:
        print_say(f'you just said {inp}')
        continue</code></pre>
<p>First, import the functions <code>voice_to_text()</code> and <code>print_say()</code> from the <em>mptpkg</em> package directly. Recall that in the script <em>__init__.py</em>, you’ve already imported the two functions from the modules <em>.mysr</em> and <em>.mysay</em> to the package. As a result, here you can directly import the two functions from the package. </p>
<p>The rest of the script is the same as that in <em>repeat_me1.py</em>. It repeats what you say. If you say, “Stop listening,” the script stops.</p>
<p>The following is an interaction with <em>repeat_me2.py</em>, with my voice input in bold:</p>
<pre><code>Python is listening...
you just said <b>how are you</b>
Python is listening...
you just said <b>I am testing a python package</b>
Python is listening...
you just said <b>stop listening</b>; goodbye! </code></pre>
<p>As you can see, the script is working properly, which means you’ve successfully imported functions from the local package. </p>
<h3 id="h2-501560c05-0004">More on Python Packages</h3>
<p class="BodyFirst">Before you move on, I want to mention a couple of things about Python packages.</p>
<p>First, you can add more modules to your package. Later in this book, you’ll add more modules to the existing local package <em>mptpkg</em>. You’ll use just one local package for the whole book. This will reduce the number of directories and help organize your files. </p>
<p>Second, if you have an interesting package that you want to share with the rest of the world, you can easily do so. You just need to add a few more files, such as the license, a README file, and so on. For a tutorial on how to distribute your Python packages, see, for example, the Python Packaging Authority website, <a href="https://packaging.python.org/tutorials/packaging-projects/" class="LinkURL">https://packaging.python.org/tutorials/packaging-projects/</a>.</p>
<h2 id="h1-501560c05-0002"><span epub:type="pagebreak" title="94" id="Page_94"/>Interactive Guess the Number Game</h2>
<p class="BodyFirst"><em>Guess the Number</em> is a popular game in which one player writes down a number and asks the other player to guess it in a limited number of attempts. After each guess, the first player tells whether the guess is correct, too high, or too low.</p>
<p>Various versions of the game are available online and in books, and we’ll look at our own version to guess a number between one and nine. Start a new script and save it as <em>guess_hs.py</em>; the <em>hs</em> stands for <em>hear and say</em>. </p>
<p>Because the script is relatively long, I’ll break it into three parts and explain them one by one. <a href="#listing5-1" id="listinganchor5-1">Listing 5-1</a> gives the first part.</p>
<pre><code><span class="CodeAnnotationHang" aria-label="annotation1">1</span> import time
import sys

# Import functions from the local package mptpkg
from mptpkg import voice_to_text
from mptpkg import print_say

# Print and announce the rules of the game in a human voice
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> print_say('''Think of an integer, 
      bigger or equal to 1 but smaller or equal to 9,
      and write it on a piece of paper''')
print_say("You have 5 seconds to write your number down")
# Wait for five seconds for you to write down the number
time.sleep(5)
print_say('''Now let's start. I will guess a number and you can say: 
    too high, that is right, or too small''')
# The script asks in a human voice whether the number is 5
print_say("Is it 5?")
# The script is trying to get your response and save it as re1
# Your response has to be 'too high', 'that is right', or 'too small'
<span class="CodeAnnotationHang" aria-label="annotation3">3</span> while True:
    re1 = voice_to_text()
    print_say(f"You said {re1}")
    if re1 in ("too high", "that is right", "too small"):
        break
# If you say "that is right", game over
    if re1 == "that is right":
        print_say("Yay, lucky me!")
        sys.exit
<var>--snip--</var></code></pre>
<p class="CodeListingCaption"><a id="listing5-1">Listing 5-1</a>: Part 1 of the Guess the Number game</p>
<p>We start the script by importing needed modules <span class="CodeAnnotation" aria-label="annotation1">1</span>. We import the <em>time</em> module so we can pause the script for a period of time. We also import the <em>sys</em> module to exit the script when it is finished. </p>
<p>As discussed in the previous section, we import <code>voice_to_text() </code>and <code>print_say() </code>from the local package <em>mptpkg</em> to convert voice to text as well as to print out and speak the text message. </p>
<p><span epub:type="pagebreak" title="95" id="Page_95"/>The script then speaks and prints out the rules of the game <span class="CodeAnnotation" aria-label="annotation2">2</span>. Since the instructions span several lines, we put them in triple quotation marks to make them more readable. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	When you have text that spans multiple lines and you want to print it or convert it to speech, use triple quotation marks; for example: </p>
<pre><code>    print(''' Line 1 text, 
                 line 2 text, 
                 line 3 text''')</code></pre><div class="bottom hr"><hr/></div>
</section>
</aside>
<p>The script announces that you have five seconds to write down a number then pauses for five seconds by using <code>sleep()</code> to give you time to write your number.</p>
<p>The script then begins to guess; it will ask in a human voice whether the number is five. At <span class="CodeAnnotation" aria-label="annotation3">3</span>, we start an infinite loop to take your voice input. When you speak into the microphone, the computer converts your voice input into a text string variable named <code>re1</code>. The script repeats what you said back to you. Your response needs to be one of three phrases: “too high,” “that is right,” or “too small.” If it isn’t, the script will keep asking you for a response until it matches one of the phrases. This gives you a chance to have a correct response before the script moves on to the next step. </p>
<p>If your response is “that is right,” the computer will say, “Yay, lucky me!” and exit the script. We’ll enter the behavior for the response “too high” next. <a href="#listing5-2" id="listinganchor5-2">Listing 5-2</a> shows the middle part of the <em>guess_hs.py</em> script.</p>
<pre><code><var>--snip--</var>
# If you say "too high", the computer keeps guessing 
elif re1 == "too high":
    # The computer guesses 3 the second round
    print_say("Is it 3?")
    # The computer is trying to get your response to the second guess
    while True:
        re2 = voice_to_text()
        print_say(f"You said {re2}")
        if re2 in ("too high", "that is right", "too small"):
            break
    # If the second guess is right, game over
    if re2 == "that is right":
        print_say("Yay, lucky me!")
        sys.exit
    # If the second guess is too small, the computer knows it's 4
    elif re2 == "too small":
        print_say("Yay, it is 4!")
        sys.exit
    # If the second guess is too high, the computer guesses the third time
    elif re2 == "too high":
        # The third guess is 1
        print_say("Is it 1?")
        # The computer is getting your response to the third guess
        while True:
            re3 = voice_to_text()
            print_say(f"You said {re3}")
<span epub:type="pagebreak" title="96" id="Page_96"/>            if re3 in ("too high", "that is right", "too small"):
                break
        # If the third guess is too small, the computer knows it's 2
        if re3 == "too small":
            print_say("It is 2!")
            sys.exit
        # If the third guess is right, game over
        elif re3 == "that is right":
            print_say("Yay, lucky me!")
            sys.exit
<var>--snip--</var></code></pre>
<p class="CodeListingCaption"><a id="listing5-2">Listing 5-2</a>: The “too high” behavior </p>
<p>If your response is “too high,” the computer will keep guessing, this time a lower number. The second guess from the computer will be three because guessing three reduces the number of attempts the computer needs to find out the answer. The script will detect and catch your response to the second guess.</p>
<p>Here are the options for your response to the second guess: If it’s “that is right,” the computer will say “Yay, lucky me!” and exit the script. If it’s “too small,” the computer will know that the number is four and say so. If it’s “too high,” the computer will make a third guess of one.</p>
<p>Then, the computer captures your response to the third guess. If your response is “too small,” the computer will know that the number is two. If your response is “that is right,” the computer will say, “Yay, lucky me!” and exit.</p>
<p>Now let’s look at the final section of <em>guess_hs.py</em>, which handles a “too small” response to the first guess. <a href="#listing5-3" id="listinganchor5-3">Listing 5-3</a> shows the code.</p>
<pre><code><var>--snip--</var>
# If you say "too small", the computer keeps guessing 
elif re1 == "too small":
    # The computer guesses 7 the second round
    print_say("Is it 7?")
    # The computer is trying to get your response to the second guess
    while True:
        re2 = voice_to_text()
        print_say(f"You said {re2}")
        if re2 in ("too high", "that is right", "too small"):
            break
    # If the second guess is right, game over
    if re2 == "that is right":
        print_say("Yay, lucky me!")
        sys.exit
    # If the second guess is too high, the computer knows it's 6
    elif re2 == "too high":
        print_say("Yay, it is 6!")
        sys.exit
    # If the second guess is too small, the computer guesses the third time
    elif re2 == "too small":
        # The third guess is 8
<span epub:type="pagebreak" title="97" id="Page_97"/>        print_say("Is it 8?")
        while True:
            re3 = voice_to_text ()
            print_say(f"You said {re3}")
            if re3 in ("too high", "that is right", "too small"):
                break
        # If the third guess is too small, the computer knows it's 9
        if re3 == "too small":
            print_say("It is 9!")
            sys.exit
        # If the third guess is right, game over
        elif re3 == "that is right":
            print_say("Yay, lucky me!")
            sys.exit</code></pre>
<p class="CodeListingCaption"><a id="listing5-3">Listing 5-3</a>: The “too small” behavior </p>
<p>The final section of the script is similar to the middle section. If you tell the computer that the first guess of five is “too small,” the computer will give you a second guess of seven. The script will then catch your response to the second guess.</p>
<p>If you respond “that is right,” the computer will say, “Yay, lucky me!” and exit the script. If you say “too high,” the computer will know that the number is six. If your response is “too small,” the computer will make a third guess of eight.</p>
<p>The computer then captures your response to the third guess. If your response is “too small,” the computer will know that the number is nine. If your response is “that is right,” the computer will say, “Yay, lucky me!” and exit the script.</p>
<p>If you have a good internet connection in a fairly quiet environment, you can have close-to-perfect communication with the computer. The internet connection is important because we use the Google Web Speech API to convert voice input into text. The <em>SpeechRecognition</em> module has an offline method called <code>recognize_sphinx()</code>, but it makes a lot of mistakes, so we use the online method.</p>
<p>Here’s the written output from the script when my number was 8 (my voice input is in bold):</p>
<pre><code>Please think of an integer,
bigger or equal to 1 but smaller or equal to 9,
and write on a piece of paper
You have 5 seconds to write it down
Now let's start. I will guess a number and you can say:
too high, that is right, or too small
Is it 5?
You said <b>too small</b>
Is it 7?
You said <b>too small</b>
Is it 8?
You said <b>that is right</b>
Yay, lucky me!</code></pre>
<p><span epub:type="pagebreak" title="98" id="Page_98"/>The script understood every word I said perfectly. This is, of course, partly because I chose certain words to avoid ambiguity. When building your own projects, you’ll want to use voice commands that are unique or put the words in context to get consistently correct results. Since each voice command is usually short, the Python script may have difficulty grasping the context of your voice input and returning the right words. </p>
<p>For example, if you say “too large” into the microphone, the script may return “two large,” which is a phrase that does make sense. That is why we use “too high” instead of “too large” in <em>guess_hs.py</em>. </p>
<p>Similarly, when I spoke “too low” into the microphone, the script returned “tulo” from time to time. When I use “too small,” I get the correct response each time.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>guess</em><em>_hs</em><em>.py</em> and play a few rounds. See if Python can understand each of your responses on the first try.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c05-0003">Speaking Newscast</h2>
<p class="BodyFirst">In this project, we’ll scrape the NPR News website to collect the latest news summary and have Python read it out loud. This project is split into two scripts: one to scrape and organize the news, another to handle the speech recognition and text-to-speech features. Let’s start with the web scraping. </p>
<h3 id="h2-501560c05-0005">Scrape the News Summary</h3>
<p class="BodyFirst">First, we need to scrape the information from the news site and compile it into a clean and readable format.</p>
<p>Different news sites arrange their content differently, so the methods for scraping are often slightly different. You can refer to <span class="xref" itemid="xref_target_Chapter 6">Chapter 6</span> for the basics of web scraping. If you’re interested in scraping other news sites, you’ll need to adjust this code based on the features of the website. Let’s first look at the site and the corresponding source code.</p>
<p>The news we’re interested in is on the front page of the NPR News website, shown in <a href="#figure5-2" id="figureanchor5-2">Figure 5-2</a>.</p>
<p>One handy feature of this page is the short news summaries. As you can see, the front page lists the latest news with a short summary for each news article. </p>
<p>You want to extract the news title and the teaser of each news article and print them out. To do this, you need to locate the corresponding tags in the HTML program. </p>
<span epub:type="pagebreak" title="99" id="Page_99"/><figure>
<img src="Images/f05002.png" alt="f05002" width="632" height="393"/>
<figcaption><p><a id="figure5-2">Figure 5-2</a>: News summaries on the NPR News front page</p></figcaption>
</figure>
<p>While on the web page, press <span class="KeyCaps">ctrl</span>-U on your keyboard. The source code for the web page should appear. You can see that it’s almost 2,000 lines long. To locate the tags you need, press <span class="KeyCaps">ctrl</span>-F to open a search box at the top-right corner. Because the title of the first news article starts with “Answering Your Coronavirus Questions,” as shown in <a href="#figure5-2">Figure 5-2</a>, you should enter <code class="bold">Answering Your Coronavirus Questions</code> and click <b>Search</b>. Then skip to the corresponding HTML code, shown in <a href="#listing5-4" id="listinganchor5-4">Listing 5-4</a>.</p>
<pre><code><var>--snip--</var>
<span class="CodeAnnotationCode" aria-label="annotation1">1</span> &lt;div class="item-info"&gt;
    &lt;div class="slug-wrap"&gt;
    &lt;h3 class="slug"&gt;
&lt;a href="https://www.npr.org/series/821003492/the-national-conversation-with-
all-things-considered"&gt;The National Conversation With All Things Considered
&lt;/a&gt;
&lt;/h3&gt;
    &lt;/div&gt;
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> &lt;h2 class="title"&gt;
&lt;a href="https://www.npr.org/2020/04/28/847585398/answering-your-coronavirus-
questions-new-symptoms-economy-and-virtual-celebratio" data-
metrics='{"action":"Click Featured Story Headline 1-
3","category":"Aggregation"}' &gt;Answering Your Coronavirus Questions: New 
Symptoms, Economy And Virtual Celebrations
&lt;/a&gt;
&lt;/h2&gt;
<span class="CodeAnnotationHang" aria-label="annotation3">3</span> &lt;p class="teaser"&gt;
&lt;a href="https://www.npr.org/2020/04/28/847585398/answering-your-coronavirus-
questions-new-symptoms-economy-and-virtual-celebratio"&gt;&lt;time datetime="2020-
04-28"&gt;&lt;span class="date"&gt;April 28, 2020 &amp;#149; &lt;/span&gt;&lt;/time&gt;On this 
broadcast of &lt;em&gt;The National Conversation, &lt;/em&gt;we answer your questions 
about the economy, mental health and new symptoms of COVID-19. We'll also 
look at how people are celebrating big life events.

<span epub:type="pagebreak" title="100" id="Page_100"/>&lt;/a&gt;
&lt;/p&gt;
&lt;/div&gt;
<var>--snip--</var></code></pre>
<p class="CodeListingCaption"><a id="listing5-4">Listing 5-4</a>: Part of the source code for the NPR News front page</p>
<p>Notice that all the title and teaser information are encapsulated in a parent <code>&lt;div&gt;</code> tag with a <code>class</code> attribute of <code>item-info</code> <span class="CodeAnnotation" aria-label="annotation1">1</span>. Information for the news title is held in a child <code>&lt;h2&gt;</code> tag with a <code>class</code> attribute of <code>title</code> <span class="CodeAnnotation" aria-label="annotation2">2</span>. The information for the teaser is held in a child <code>&lt;p&gt;</code> tag with a <code>class</code> attribute of <code>teaser</code> <span class="CodeAnnotation" aria-label="annotation3">3</span>.</p>
<p>We’ll use these patterns to write a Python script to extract the information we need. The script <em>news.py</em> will scrape the information and organize all titles and summaries in a clean and concise way. I’ve added comments in places that need more detailed explanations. </p>
<p>The script will compile the news summary and print it out in text. Enter <a href="#listing5-5" id="listinganchor5-5">Listing 5-5</a> and save it as <em>news.py</em>.</p>
<pre><code># Import needed modules
import requests
import bs4

# Obtain the source code from the NPR news website
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> res = requests.get('https://www.npr.org/sections/news/')
res.raise_for_status()
# Use beautiful soup to parse the code
soup = bs4.BeautifulSoup(res.text, 'html.parser')
# Get the div tags that contain titles and teasers
div_tags = soup.find_all('div',class_="item-info")
# Index different news
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> news_index = 1
# Go into each div tag to retrieve the title and the teaser
<span class="CodeAnnotationHang" aria-label="annotation3">3</span> for div_tag in div_tags:
    # Print the news index to separate different news
    print(f'News Summary {news_index}')
    # Retrieve and print the h2 tag that contains the title
    h2tag = div_tag.find('h2', class_="title")
    print(h2tag.text)
    # Retrieve and print the p tag that contains the teaser
    ptag = div_tag.find('p', class_="teaser")
    print(ptag.text)
    # Limit to the first 10 news summaries
    news_index += 1
    if news_index&gt;10:
        break</code></pre>
<p class="CodeListingCaption"><a id="listing5-5">Listing 5-5</a>: Python code to scrape the NPR News front page</p>
<p>We start by importing the needed modules <em>bs4</em> and <em>requests </em>(<em>bs4</em> is the newest version of the Beautiful Soup library). Follow the three steps in <span class="xref" itemid="xref_target_Chapter 2">Chapter 2</span> for installing these modules if you need to.</p>
<p><span epub:type="pagebreak" title="101" id="Page_101"/>At <span class="CodeAnnotation" aria-label="annotation1">1</span>, we obtain the source code for the NPR News front page, which is in HTML format. We then use the <em>bs4</em> module to parse HTML files. Because the information we need is encapsulated in <code>&lt;div&gt;</code> tags with a <code>class</code> attribute of <code>item-info</code>, we find all such tags and put them in a list called <em>div_tags</em>. To separate different news summaries, we create a variable <em>news_index</em> to mark them <span class="CodeAnnotation" aria-label="annotation2">2</span>. </p>
<p>We then go into each individual <code>&lt;div&gt;</code> tag we’ve collected <span class="CodeAnnotation" aria-label="annotation3">3</span>. First, we print out the news summary index to separate out individual news items. Second, we extract the <code>&lt;h2&gt;</code> tag that contains the news title and print it out. Third, we extract the <code>&lt;p&gt;</code> tag that contains the news summary and print it out. Finally, we stop if the news index exceeds 10 so that we limit the printout to 10 news summaries. </p>
<p>If you run <em>news.py</em>, the output will look like <a href="#listing5-6" id="listinganchor5-6">Listing 5-6</a>.</p>
<pre><code>News Summary 1
Answering Your Coronavirus Questions: New Symptoms, Economy And Virtual Celebrations
April 28, 2020 • On this broadcast of The National Conversation, we answer your questions 
about the economy, mental health and new symptoms of COVID-19. We'll also look at how people 
are celebrating big life events.
News Summary 2
More Essential Than Ever, Low-Wage Workers Demand More
April 28, 2020 • In this lockdown, low-wage workers have been publicly declared "essential" —
up there with doctors and nurses. But the workers say their pay, benefits and protections 
don't reflect it.
News Summary 3
We Asked All 50 States About Their Contact Tracing Capacity. Here's What We Learned
April 28, 2020 • To safely reopen without risking new COVID-19 outbreaks, states need enough 
staffing to do the crucial work of contact tracing. We surveyed public health agencies to 
find out how much they have.
News Summary 4
Coronavirus Has Now Killed More Americans Than Vietnam War
April 28, 2020 • The number of lives taken by COVID-19 in the U.S. has reached a grim 
milestone: More people have died of the disease than the 58,220 Americans who perished in the 
Vietnam War.
<var>--snip--</var></code></pre>
<p class="CodeListingCaption"><a id="listing5-6">Listing 5-6</a>: News summary scraped from the NPR News front page</p>
<p>Now we’ll get Python to read the news to us. </p>
<h3 id="h2-501560c05-0006">Add the Text-to-Speech Features </h3>
<p class="BodyFirst">The next step is to have the text-to-speech module convert the news summary into spoken words. Add <a href="#listing5-7" id="listinganchor5-7">Listing 5-7</a> into a new file and save it as <em>news_hs.py</em>.</p>
<pre><code># Import needed modules
import requests
import bs4
import sys

# Import functions from the local package mptpkg
from mptpkg import voice_to_text
<span epub:type="pagebreak" title="102" id="Page_102"/>from mptpkg import print_say
# Define the news_teaser() function
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> def news_teaser():
<var>    --snip--</var>
      <span class="CodeAnnotationCode" aria-label="annotation2">2</span> print_say(f'News Summary {news_index}')
        h2tag = div_tag.find('h2', class_="title")
        print_say(h2tag.text)
        ptag = div_tag.find('p', class_="teaser")
        print_say(ptag.text)
        <var>--snip--</var>
# Print and ask you if you like to hear the news summary
print_say("Would you like to hear the NPR news summary?")
# Capture your voice command
inp = voice_to_text().lower()
# If you answer yes, activate the newscast
if inp == "yes":
    news_teaser()
# Otherwise, exit the script
else: 
    sys.exit</code></pre>
<p class="CodeListingCaption"><a id="listing5-7">Listing 5-7</a>: Python code for a voice-activated newscast</p>
<p>We first import the usual modules, and we import <code>voice_to_text()</code> and <code>print_say()</code> from the self-made <em>mptpkg</em> package. </p>
<p>We then define a function called <code>news_teaser()</code> <span class="CodeAnnotation" aria-label="annotation1">1</span>, which accomplishes whatever <em>news.py</em> does. The only exception is that instead of just printing out the news index, title, and teaser, it both prints and speaks them <span class="CodeAnnotation" aria-label="annotation2">2</span>. We then set the script to ask, “Would you like to hear the NPR news summary?” The <code>voice_to_text()</code> function captures your voice response and converts it into a string variable with all lowercase letters. If you say yes, Python will start broadcasting the news. If you answer anything other than yes, the script will exit. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>news</em><em>_hs</em><em>.py</em> and hear news from NPR. To save time, modify the script so that you’ll hear only the first 5 news summaries instead of 10.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c05-0004">Voice-Controlled Wikipedia</h2>
<p class="BodyFirst">We’ll build a talking Wikipedia in this section. Unlike with the newscaster project, we’ll use the <em>wikipedia</em> module to get the information we need directly. After that, we’ll get the script to understand questions you ask, retrieve the answer, and read it aloud. </p>
<h3 id="h2-501560c05-0007"><span epub:type="pagebreak" title="103" id="Page_103"/>Access Wikipedia</h3>
<p class="BodyFirst">Python has a <em>wikipedia</em> module that does the work of delving into topics you want to know about, so we don’t have to code that part ourselves. The module is not in the Python standard library or the Anaconda navigator. You should install it with pip. Open the Anaconda prompt (in Windows) or a terminal (in Mac or Linux) and run the following command:</p>
<pre><code><b>pip install wikipedia</b></code></pre>
<p>Next, run the following script as <em>wiki.py</em>: </p>
<pre><code>import wikipedia

my_query = input("What do you want to know?\n")
answer = wikipedia.summary(my_query)
print(answer)</code></pre>
<p>After the script is running, in the IPython console in the lower-right panel, enter the name of a topic you want to know about. The script will save your inquiry as the variable <em>my_query</em>. The <code>summary()</code> function will produce a summary answer to your question. Finally, the script prints out the answer from Wikipedia.</p>
<p>I entered <code>U.S. China trade war</code> and got the following result:</p>
<pre><code>What do you want to know? 
<b>U.S. China trade war</b>
China and the United States have been engaged in a trade war through increasing tariffs and other measures since 2018. Hong Kong economics professor Lawrence J. Lau argues that a major cause is the growing battle between China and the U.S. for global economic and technological dominance. He argues, "It is also a reflection of the rise of populism, isolationism, nationalism and protectionism almost everywhere in the world, including in the US."</code></pre>
<p>This answer is relatively short. Most searches in Wikipedia will have a much longer result. If you want to limit the length of the responses to, say, the first 200 characters, you can enter <code>[0:200]</code> after <code>answer</code>.</p>
<h3 id="h2-501560c05-0008">Add Speech Recognition and Text to Speech</h3>
<p class="BodyFirst">We’ll now add the speech recognition and text-to-speech features to the script. Enter <a href="#listing5-8" id="listinganchor5-8">Listing 5-8</a> as <em>wiki_hs.py</em>.</p>
<pre><code>import wikipedia

# Import functions from the local package mptpkg
from mptpkg import voice_to_text
from mptpkg import print_say

<span epub:type="pagebreak" title="104" id="Page_104"/># Ask what you want to know
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> print_say("What do you want to know?")
# Capture your voice input
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> my_query = voice_to_text()
print_say (f"you said {my_query}")
# Obtain answer from Wikipedia
ans = wikipedia.summary(my_query)
# Say the answer in a human voice
print_say(ans[0:200])</code></pre>
<p class="CodeListingCaption"><a id="listing5-8">Listing 5-8</a>: Python code for a voice-controlled talking Wikipedia</p>
<p>Once you start the script, a voice asks, “What do you want to know?” <span class="CodeAnnotation" aria-label="annotation1">1</span>. At <span class="CodeAnnotation" aria-label="annotation2">2</span>, the script calls <code>voice_to_text()</code> to convert your voice input into text. Then, the script retrieves the response to your question from Wikipedia, saves it as a string variable <em>ans</em>, and converts it to a human voice. </p>
<p>After running the script, if you say to the microphone, “US Federal Reserve Bank,” you’ll get a result similar to this:</p>
<pre><code>What do you want to know? 
you said <b>U.S. federal reserve bank</b> 
The Federal Reserve System (also known as the Federal Reserve or simply the 
Fed) is the central banking system of the United States of America. It was 
created on December 23,
1913, with the enactment</code></pre>
<p>I’ve added the <code>[0:200]</code> character limit behind the variable <code>ans</code>, so only the first 200 characters of the result are printed and spoken.</p>
<p>And just like that, you have your own voice-controlled talking Wikipedia. Ask away!</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>wiki</em><em>_hs</em><em>.py</em> and ask Wikipedia about the city you live in now (or the state if the city is not in Wikipedia). See what the output is like.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c05-0005">Voice-Activated Music Player</h2>
<p class="BodyFirst">Here you’ll learn how to get Python to play a certain artist or genre of music just by asking for it with a phrase like “Python, play Selena Gomez.” You’ll speak the name of the artist you want to listen to, and the script will receive that as keywords and then search for those keywords in a particular folder. To do this, you need to be able to traverse files and folders. </p>
<h3 id="h2-501560c05-0009"><span epub:type="pagebreak" title="105" id="Page_105"/>Traverse Files in a Folder</h3>
<p class="BodyFirst">Suppose you have a subfolder <em>chat</em> in your chapter folder. If you want to list all files in the subfolder, you can use this <em>traverse.py</em> script:</p>
<pre><code>import os

with os.scandir("./chat") as files:
    for file in files:
        print(file.name)</code></pre>
<p>First, the script imports the <em>os</em> module. This module gives the script access to functionalities that are dependent on the operating system, such as accessing all files in a folder. </p>
<p>Next, you put all files in the subfolder <em>chat</em> into a list called <em>files</em>. The script goes through all items in the list, and prints out the name of each item.</p>
<p>The output from the preceding script is as follows after I run it on my computer:</p>
<pre><code>book.xlsx 
desk.pdf 
storm.txt 
graduation.pptx
<var>--snip--</var>
HilaryDuffSparks.mp3 
country
classic
lessons.docx
SelenaGomezWolves.mp3
TheHeartWantsWhatItWantsSelenaGomez.mp3</code></pre>
<p>As you can see, we can traverse all the files and subfolders in a folder and print out their names. Filenames include the file extension. Subfolders have no extension after the subfolder name. For example, I have two folders, <em>country</em> and <em>classic</em>, in the folder <em>chat</em>. As a result, you see <code>country</code> and <code>classic</code> in the preceding output.</p>
<p>Next, you’ll use this feature to select a song you want to play. </p>
<h3 id="h2-501560c05-0010">Python, Play Selena Gomez</h3>
<p class="BodyFirst">The script in <a href="#listing5-9" id="listinganchor5-9">Listing 5-9</a>, <em>play_selena_gomez.py</em>, can pick out a song by whatever artist you name (for example, Selena Gomez) and play it. Either save your songs in the subfolder <em>chat</em> or replace the file path with a path to somewhere on your computer that you keep music. </p>
<pre><code># Import the required modules
import os
import random
from pygame import mixer

<span epub:type="pagebreak" title="106" id="Page_106"/># Import functions from the local package mptpkg
from mptpkg import voice_to_text
from mptpkg import print_say

# Start an infinite loop to take your voice commands
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> while True:
    print_say("how may I help you?")
    inp = voice_to_text()
    print_say(f"you just said {inp}")
    # Stop the script if you say 'stop listening'
    if inp == "stop listening":
        print_say("Goodbye! ")
        break
    # If 'play' is in voice command, music mode is activated
  <span class="CodeAnnotationCode" aria-label="annotation2">2</span> elif "play" in inp:
        # Remove the word play from voice command
      <span class="CodeAnnotationCode" aria-label="annotation3">3</span> inp = inp.replace('play ','')
        # Separate first and last names
        names = inp.split()
        # Extract the first name
        Firstname = names[0]
        # Extract the last name
        if len(names)&gt;1:
            lastname = names[1]
        # If no last name, use the first name as last name;  
        else:
            lastname = firstname
        # Create a list to contain songs 
        mysongs = []
        # If either first name or last name in the file name, put in list
        with os.scandir("./chat") as files:
            for file in files:
          <span class="CodeAnnotationCode" aria-label="annotation4">4</span> if (firstname in file.name or lastname in file.name) \
and "mp3" in file.name:
                mysongs.append(file.name)
        # Randomly select one from the list and play
      <span class="CodeAnnotationCode" aria-label="annotation5">5</span> mysong = random.choice(mysongs)
        print_say(f"play the song {mysong} for you")
        mixer.init()
        mixer.music.load(f'./chat/{mysong}')
        mixer.music.play()
        break</code></pre>
<p class="CodeListingCaption"><a id="listing5-9">Listing 5-9</a>: Python code to voice activate a song by an artist on your computer</p>
<p>We first import the needed modules. In particular, we import the <em>os</em> module to traverse files and the <em>random</em> module to randomly select a song from a list the script will build. We use <code>mixer()</code> in the <em>pygame</em> module to play the music file.</p>
<p>We then start an infinite loop <span class="CodeAnnotation" aria-label="annotation1">1</span> to put the script in standby mode to wait for your voice commands. If the script detects the word <em>play</em> in your voice command, the music mode is activated <span class="CodeAnnotation" aria-label="annotation2">2</span>. We then replace the word <code>play</code> and the whitespace behind it with an empty string <span class="CodeAnnotation" aria-label="annotation3">3</span> so that your command “Play Selena Gomez” becomes <code>Selena Gomez</code>. The next command <span epub:type="pagebreak" title="107" id="Page_107"/>separates the first name and the last name. For artists who are known by just their first names (such as Madonna, Prince, or Cher), we put their first name as a placeholder in the variable <code>lastname</code>. </p>
<p>We then traverse through all files in the subfolder <em>chat</em>. If a file has the <em>mp3</em> extension and contains either the first or the last name <span class="CodeAnnotation" aria-label="annotation4">4</span>, it will be added to the list <em>mysongs</em>. We use <code>choice()</code> from the <em>random</em> module to randomly select a song in the list <em>mysongs</em> <span class="CodeAnnotation" aria-label="annotation5">5</span> and load it with <code>mixer.music.load()</code>. After that, we use <code>mixer.music.play()</code> to play it.</p>
<p>As a result, once you say to the script, “Play Selena Gomez,” one of the two songs in the subfolder <em>chat</em>, <em>SelenaGomezWolves.mp3</em> or <em>TheHeartWantsWhatItWantsSelenaGomez.mp3</em>, will start playing.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	We use the <em>pygame</em> module to play music files in this book. Depending on which operating system you are using, other modules, such as <em>playsound</em> or <em>vlc</em>, can also play music files in Python. Alternatively, you can use <code>os.system()</code> to open music files in your computer’s default music player, as discussed in <span class="xref" itemid="xref_target_Chapter 3">Chapter 3</span>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Save several songs by your favorite artist, making sure that the filenames contain the artist’s first and last name. Then edit and run <em>p</em><em>lay</em><em>_s</em><em>elena</em><em>_g</em><em>omez.py</em> so that when you say, “Python, play <em>Firstname</em><var> </var><em>Lastname</em>,” one of your songs will start playing.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-501560c05-0011">Python, Play a Country Song</h3>
<p class="BodyFirst">What we’ll do now is similar to interacting with the script <em>play_selena_gomez.py</em>, but here you’ll learn how to access different subfolders by using the <em>os</em> module as well as a different way of playing music files.</p>
<p>Suppose you’ve organized your songs by genre. You put all classical music files in the subfolder <em>classic</em>, and all country music files in the folder <em>country</em>, and so on. You’ve placed these subfolders in the folder <em>chat</em> you just created.</p>
<p>We want to write a script so that when you say, “Python, play a country song,” the script will randomly select a song from the folder <em>country</em> and play it. Enter the code in <a href="#listing5-10" id="listinganchor5-10">Listing 5-10</a> and save it as <em>play_genre.py</em>.</p>
<pre><code># Import needed modules
import os
import random
from pygame import mixer

# Import functions from the local package mptpkg
from mptpkg import voice_to_text
from mptpkg import print_say

<span epub:type="pagebreak" title="108" id="Page_108"/>while True:
    print_say("how may I help you?")
    inp = voice_to_text().lower()
    print_say(f'you just said {inp}')
    if inp == "stop listening":
        print_say('Goodbye!')
        break
    elif "play a" in inp and "song" in inp:
        # Remove 'play a' and 'song' so that only the genre name is left
      <span class="CodeAnnotationCode" aria-label="annotation1">1</span> inp = inp.replace('play a ','')
      <span class="CodeAnnotationCode" aria-label="annotation2">2</span> inp = inp.replace(' song','')

        # Go to the genre folder and randomly select a song
        with os.scandir(f"./chat/{inp}") as entries:
            mysongs = [entry.name for entry in entries]
        # Use pygame mixer to play the song
      <span class="CodeAnnotationCode" aria-label="annotation3">3</span> mysong = random.choice(mysongs)
        print_say(f"play the song {mysong} for you")
        mixer.init()
        mixer.music.load(f"./chat/{inp}/{mysong}")
        mixer.music.play()
        break</code></pre>
<p class="CodeListingCaption"><a id="listing5-10">Listing 5-10</a>: Python code to voice activate a song by genre</p>
<p>Python checks for the terms <em>play a</em> and <em>song</em> in the voice command and activates the music mode if it finds them. The script then replaces <code>play a</code> <span class="CodeAnnotation" aria-label="annotation1">1</span> and <code>song</code> <span class="CodeAnnotation" aria-label="annotation2">2</span> as well as the whitespace behind them with an empty string, leaving only the genre—<code>country</code>, in this case—in the voice command. This is used as the folder for the script to search: in this case, <em>./chat/country</em>. Finally, the script randomly selects a song from the folder <span class="CodeAnnotation" aria-label="annotation3">3</span> and plays it.</p>
<p>Note that we use <code>lower()</code> after <code>voice_to_text()</code> in the script so that the voice command is all lowercase. We do this because the script sometimes converts the voice command into <code>play A Country Song</code>. We can avoid mismatch due to capitalization. On the other hand, the path and filenames are not case sensitive, so even if you have capital letters in your path or filenames, there will not be any mismatch.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Organize your music into various categories. Save a few songs in the subfolder <em>classic</em> in the <em>chat</em> folder you created. If you say, “Play a classic song,” see if a song in the folder will start playing.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c05-0006"><span epub:type="pagebreak" title="109" id="Page_109"/>	Summary</h2>
<p class="BodyFirst">In this chapter, you first learned to create a Python package to contain the local text-to-speech and speech recognition modules. After that, you built several real-world applications that can understand voice commands, react, and speak. </p>
<p>You created a voice-controlled, talking Guess the Number game. In the game, you pick a number between one and nine and interact with the script to let it guess. Then you learned how to parse text to extract a news summary from the NPR website, adding the speech recognition and text-to-speech features to make a voice-controlled newscast. </p>
<p>You learned how to use the <em>wikipedia</em> module to obtain answers to your inquiries. </p>
<p>You traversed files in a folder on your computer by using the <em>os</em> module, and then created a script that plays a genre or artist when you ask it to.</p>
<p>Now that you know how to make Python talk and listen, you’ll apply both features to many other interesting situations throughout the rest of the book so that you can interact with your computer via voice only.</p>
<h2 id="h1-501560c05-0007">	End-of-Chapter Exercises</h2>
<ol class="decimal">
<li value="1">Modify <em>guess_hs.py</em> so that the third guess of the script is two instead of one.</li>
<li value="2">Change <em>wiki.py</em> so that it prints out the first 300 characters of the result from Wikipedia.</li>
<li value="3">Modify <em>play_genre.py</em> so that the script plays music by using the <em>os</em> module and your default music player on your computer, instead of the <em>pygame</em> module.</li>
<li value="4">Suppose the music files on your computer are not in MP3 format but in WAV format. How can you modify <em>play_selena_gomez.py</em> so that the script still works?</li>
</ol>
</section>
</div>
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="111" id="Page_111"/>6</span><br/>
<span class="ChapterTitle">Web Scraping Podcasts, Radios, and Videos</span></h1>
</header>
<figure class="opener">
<img src="Images/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">In this chapter, you’ll build on the web-scraping basics from <span class="xref" itemid="xref_target_Chapter 5">Chapter 5</span>. You’ll use these skills to voice-activate podcasts, live radio broadcasts, and videos on different websites.</p>
<p>You’ll also learn how HyperText Markup Language (HTML) works and how the various types of HTML tags construct web pages. You’ll learn how to use Python’s Beautiful Soup library to parse HTML files and extract information. </p>
<p>With all these skills, you’ll build three apps to do the following: </p>
<ul>
<li>Parse the source file of online podcasts, locate an MP3 file, and play the podcast.</li>
<li>Use voice control to play online live radio. </li>
<li>Play online videos, such as NBC’s <em>Nightly News with Lester Holt</em>. </li>
</ul>
<p>Before you begin, set up the folder <em>/mpt/ch06/</em> for this chapter. As usual, you can download all the code for all the scripts from <a href="https://www.nostarch.com/make-python-talk/" class="LinkURL">https://www.nostarch.com/make-python-talk/</a>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="112" id="Page_112"/>New Skills </h2>
<ul>
<li>Learning how various HTML tags work</li>
<li>Parsing an HTML file and extracting information from it</li>
<li>Using the <em>pygame</em> module to pause or stop an audio file while it’s playing</li>
<li>Using the <em>selenium</em> module to control websites, online podcasts, and online videos</li>
<li>Accessing an online radio station</li>
</ul>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c06-0001">	A Primer on Web Scraping</h2>
<p class="BodyFirst">The Beautiful Soup library is designed to extract information from websites. We’ll use it often in this book, just as many Python programmers do in the real world. </p>
<p>I’ll first discuss the basics of HTML markup and how different types of tags form various blocks on a website. You’ll then learn to use the Beautiful Soup library to extract information from websites by parsing their source code.</p>
<h3 id="h2-501560c06-0001">What Is HTML?</h3>
<p class="BodyFirst">As noted at the start of the chapter, <em>HTML</em> stands for <em>HyperText Markup Language</em>, the programming language that tells browsers how to construct and display web page content. HTML uses various types of tags to build the structure of web pages. </p>
<h4 id="h3-501560c06-0001">Anatomy of an HTML Tag</h4>
<p class="BodyFirst"><a href="#table6-1" id="tableanchor6-1">Table 6-1</a> lists some of the commonly used tags and their main functions.</p>
<figure>
<figcaption class="TableTitle"><p><a id="table6-1">Table 6-1</a>: Commonly Used HTML Tags</p></figcaption>
<table id="table-501560c06-0001" border="1">
<thead>
<tr>
<td><b>Tag name</b></td>
<td><b>Description</b></td>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;html&gt; </code></td>
<td>The root-level tag of an HTML document. It encapsulates all other HTML tags.</td>
</tr>
<tr>
<td><code>&lt;head&gt;</code></td>
<td>The head section of an HTML document that contains metadata about the page.</td>
</tr>
<tr>
<td><code>&lt;title&gt; </code></td>
<td>The title of the web page, to be displayed on the tab of the browser.</td>
</tr>
<tr>
<td><code>&lt;body&gt; </code></td>
<td>The body of an HTML document, with all displayed content.</td>
</tr>
<tr>
<td><code>&lt;h1&gt; </code></td>
<td>A level-1 heading, for example, the title of a news article.</td>
</tr>
<tr>
<td><code>&lt;p&gt;</code></td>
<td>A paragraph of displayed content. </td>
</tr>
<tr>
<td><code>&lt;div&gt; </code></td>
<td>A container used for page elements that divide the HTML document into sections.</td>
</tr>
<tr>
<td><code>&lt;a&gt; </code></td>
<td>A hyperlink to link one page to another.</td>
</tr>
<tr>
<td><code>&lt;li&gt; </code></td>
<td>A list item.</td>
</tr>
</tbody>
</table>
</figure>
<p><span epub:type="pagebreak" title="113" id="Page_113"/>All tags start with <code>&lt; &gt;</code> and end with <code>&lt;/ &gt;</code> so that the browser can identify separate tags. For example, paragraph tags start with <code>&lt;p&gt;</code> and close with <code>&lt;/p&gt;</code>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	A complete list of all HTML tags and their uses can be found at <a href="https://html.spec.whatwg.org/multipage/" class="LinkURL">https://html.spec.whatwg.org/multipage/</a><em>.</em></p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>Let’s use <code>&lt;a&gt;</code> to illustrate the components of HTML tags. Here’s an example of creating a hyperlink by using an <code>&lt;a&gt;</code> tag:</p>
<pre><code>&lt;a class="suprablue" href="http://libraries.uky.edu"&gt;Libraries&lt;/a&gt;</code></pre>
<p>This hyperlink has optional attributes in the opening tag: <code>&lt;a class="suprablue" href="http://libraries.uky.edu"&gt;</code>. The <code>class</code> attribute tells the browser which style to use from the Cascading Style Sheets (CSS), where the class name <code>suprablue</code> is predefined (you’ll learn how to define a class in the following section). The <code>href</code> attribute specifies the destination of the hyperlink, <a href="http://libraries.uky.edu/" class="LinkURL">http://libraries.uky.edu/</a>. The content of the tag that will be displayed on the page is between the opening and closing tags: <code>Libraries</code>. </p>
<h4 id="h3-501560c06-0002">From HTML Tags to Web Pages</h4>
<p class="BodyFirst">To understand how HTML uses tags to construct a web page, let’s look at an extremely simplified example. Enter the script in <a href="#listing6-1" id="listinganchor6-1">Listing 6-1</a> and save it as <em>UKYexample.html</em> in your chapter folder, or you can download the file from the book’s resources page. All HTML files need the extension <em>.html</em> or <em>.htm</em>.</p>
<pre><code>  <span class="CodeAnnotationCode" aria-label="annotation1">1</span> &lt;html&gt; 
      &lt;head&gt; 
    &lt;title&gt;Example: University of Kentucky&lt;/title&gt;
&lt;style&gt;
.redtext {
  color: red;
}
.leftmargin {
  margin-left: 10px;
}
&lt;/style&gt;
  &lt;/head&gt;
  <span class="CodeAnnotationCode" aria-label="annotation2">2</span> &lt;body&gt; 
    &lt;p&gt;Below are some links:&lt;/p&gt;
      &lt;p&gt;&lt;a class="redtext" href="http://libraries.uky.edu/"&gt;
      University of Kentucky Libraries&lt;/a&gt;&lt;/p&gt; 
      &lt;p&gt;&lt;a class="leftmargin" href="https://directory.uky.edu/"&gt;
      University of Kentucky Directory&lt;/a&gt;&lt;/p&gt; 
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing6-1">Listing 6-1</a>: HTML code for a simple web page</p>
<p><span epub:type="pagebreak" title="114" id="Page_114"/>Before I explain the code, let’s see how the actual web page looks. Go to your chapter folder and open <em>UKYexample.html</em> with your preferred web browser. I use Google Chrome, and the web page comes out as in <a href="#figure6-1" id="figureanchor6-1">Figure 6-1</a>.</p>
<figure>
<img src="Images/f06001.png" alt="f06001" width="437" height="258"/>
<figcaption><p><a id="figure6-1">Figure 6-1</a>: A simple web page</p></figcaption>
</figure>
<p>Now let’s link the HTML code to the web page display. </p>
<p>At <span class="CodeAnnotation" aria-label="annotation1">1</span>, we start an opening <code>&lt;html&gt;</code> tag to contain all the code in the script. Then, we have a <code>&lt;title&gt;</code> tag nested in a <code>&lt;head&gt;</code> tag. The <code>&lt;head&gt;</code> tag is usually used to contain metadata, such as the document title or CSS styles. The content of the <code>&lt;title&gt;</code> tag is <code>Example: University of Kentucky</code>, which sets the title of the web page shown in the browser tab at the top-left corner in <a href="#figure6-1">Figure 6-1</a>. </p>
<p>The content inside the <code>&lt;style&gt;</code> tag is to define two classes: <code>redtext</code> and <code>leftmargin</code>. The first one tells the HTML to display the content in red, while the second tells the HTML to leave a 10-pixel left margin. You can specify multiple styles such as background color, padding, or margins in one class. </p>
<p>At <span class="CodeAnnotation" aria-label="annotation2">2</span>, we start the body HTML that will be displayed on the page. Inside this we have three nested <code>&lt;p&gt;</code> tags. A <code>&lt;p&gt;</code> tag defines a separate paragraph in an HTML document; adding a new <code>&lt;p&gt;</code> tag starts a new paragraph. The first <code>&lt;p&gt;</code> tag contains the message <code>Below are some links:</code>.</p>
<p>We then provide two hyperlinks, each in in an <code>&lt;a&gt;</code> tag nested in a <code>&lt;p&gt;</code> tag. We put each <code>&lt;a&gt;</code> tag in a separate <code>&lt;p&gt;</code> tag so the links are displayed as two different paragraphs instead of side by side on the same line. If you click the first link, it will bring you to the University of Kentucky Libraries. If you click the second link, you’ll be directed to the University of Kentucky Directory. The first tag has a class attribute of <code>redtext</code>, displaying the text in red, as defined in the <code>&lt;style&gt;</code> tag previously. Similarly, the second tag has a class attribute of <code>leftmargin</code>, and as a result, a 10-pixel margin precedes the text <code>University of Kentucky Library</code>.</p>
<h3 id="h2-501560c06-0002">Extract Information with Beautiful Soup</h3>
<p class="BodyFirst">Now that you understand how a few basic HTML tags work, you’ll use the Beautiful Soup library to parse the HTML code and extract the information you want. I’ll first discuss how to parse a locally saved HTML file. Then you’ll learn how to extract information from a live web page.</p>
<p><span epub:type="pagebreak" title="115" id="Page_115"/>Let’s revisit the simple example <em>UKYexample.html</em> saved in your chapter folder. Suppose you want to extract some web addresses from a web page. You can use <a href="#listing6-2" id="listinganchor6-2">Listing 6-2</a>, <em>parse_local.py</em>, to accomplish the task. </p>
<pre><code># Import the Beautiful Soup library
from bs4 import BeautifulSoup
# Open the local HTML file as a text file
<span class="CodeAnnotationCode" aria-label="annotation1">1</span> textfile = open("UKYexample.html", encoding='utf8')
# Use the findAll() function to locate all &lt;p&gt; tags
soup = BeautifulSoup(textfile, "html.parser")
ptags = soup.findAll("p")
# Print out &lt;p&gt; tags
print(ptags)
# Find the &lt;a&gt; tag nested in the third &lt;p&gt; tag
<span class="CodeAnnotationCode" aria-label="annotation2">2</span> atag = ptags[2].find('a')
print(atag)
# Print the web address of the hyperlink
print(atag['href'])
# Print the content of the &lt;a&gt; tag
print(atag.text)</code></pre>
<p class="CodeListingCaption"><a id="listing6-2">Listing 6-2</a>: Parsing a local HTML file</p>
<p>First, we import <code>BeautifulSoup()</code> from the <em>bs4</em> module, the latest version of Beautiful Soup. At <span class="CodeAnnotation" aria-label="annotation1">1</span>, we open the local HTML file as a text file by using the built-in Python function <code>open()</code>. We then use <code>findAll()</code> to locate all <code>&lt;p&gt;</code> tags in the HTML file, and we put them in the list <code>ptags</code>. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	<a href="#listing6-2">Listing 6-2</a> assumes you’ve put the file <em>UKYexample.html</em> in the same folder as the script <em>p</em><em>arse</em><em>_l</em><em>ocal.py</em>. If the file is elsewhere, you must specify its path at <span class="CodeAnnotation" aria-label="annotation1">1</span>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>There are three <code>&lt;p&gt;</code> tags in the list <code>ptags</code>: </p>
<pre><code>[<b>&lt;p&gt;</b>Below are some links:&lt;/p&gt;, 
<b>&lt;p&gt;</b>&lt;a class="redtext" href="http://libraries.uky.edu/"&gt;
University of Kentucky Libraries&lt;/a&gt;&lt;/p&gt;, 
<b>&lt;p&gt;</b>&lt;a class="leftmargin" href="https://directory.uky.edu/"&gt;
University of Kentucky Directory&lt;/a&gt;&lt;/p&gt;]</code></pre>
<p>Let’s use the third tag as an example. At <span class="CodeAnnotation" aria-label="annotation2">2</span>, we locate the <code>&lt;a&gt;</code> tag nested in the third <code>&lt;p&gt;</code> tag. We then print out the <code>href</code> attribute of the <code>&lt;a&gt;</code> tag: </p>
<pre><code>https://directory.uky.edu/</code></pre>
<p>Finally, we print out the content of the <code>&lt;a&gt;</code> tag:</p>
<pre><code>University of Kentucky Directory</code></pre>
<p>The output for the whole script is as follows: </p>
<pre><code>[&lt;p&gt;Below are some links:&lt;/p&gt;, 
&lt;p&gt;&lt;a class="redtext" href="http://libraries.uky.edu/"&gt;
<span epub:type="pagebreak" title="116" id="Page_116"/>University of Kentucky Libraries&lt;/a&gt;&lt;/p&gt;, 
&lt;p&gt;&lt;a class="leftmargin" href="https://directory.uky.edu/"&gt;
University of Kentucky Directory&lt;/a&gt;&lt;/p&gt;]
&lt;a class="leftmargin" href="https://directory.uky.edu/"&gt;
University of Kentucky Directory&lt;/a&gt;
https://directory.uky.edu/
University of Kentucky Directory</code></pre>
<h2 id="h1-501560c06-0002">Scrape Live Web Pages</h2>
<p class="BodyFirst">Now let’s scrape a live web page. The HTML markup for a live web page is much more complicated than our simple static version and might be thousands of lines long, so you’ll need to learn to quickly locate the lines of code you want.</p>
<p>Suppose you want to extract the contact information from the University of Kentucky Libraries website. Go to <a href="http://libraries.uky.edu/" class="LinkURL">http://libraries.uky.edu/</a><em>. </em>Then scroll to the bottom of the page and you’ll see the contact information for various areas, as shown in <a href="#figure6-2" id="figureanchor6-2">Figure 6-2</a>.</p>
<figure>
<img src="Images/f06002.png" alt="f06002" width="695" height="178"/>
<figcaption><p><a id="figure6-2">Figure 6-2</a>:  Information you want from a live web page</p></figcaption>
</figure>
<p>You want to extract the department name, phone number, and email address for each of the three departments shown in <a href="#figure6-2">Figure 6-2</a>: Circulation, Reference, and Interlibrary Loan. First you need to locate the corresponding tags in the HTML document. </p>
<p>While on the web page, press <span class="KeyCaps">ctrl</span>-U on your keyboard (or right-click and choose <b>View</b><span class="MenuArrow">▶</span><b>Source</b>). The source code for the web page should appear. You can see that it’s more than 2,000 lines long. To locate the tags you need, press <span class="KeyCaps">ctrl</span>-F to access a search box at the top-right corner. Enter <code class="bold">Circulation</code> and click <b>Search</b> to skip to the corresponding HTML code, shown in <a href="#listing6-3" id="listinganchor6-3">Listing 6-3</a>.</p>
<pre><code><var>--snip--</var>
<span class="CodeAnnotationCode" aria-label="annotation1">1</span> &lt;div class="sf-middle"&gt; 
            <span class="CodeAnnotationCode" aria-label="annotation2">2</span> &lt;div class="dashing-li"&gt; 
          &lt;span class="contact_area"&gt;Circulation:&lt;/span&gt;
          &lt;span class="contact_methods"&gt;
              &lt;div class="contact_phone"&gt;&lt;a class="suprablue"
               href="tel:8592181881"&gt;(859) 218-1881&lt;/a&gt;&lt;/div&gt;
              &lt;div class="contact_email"&gt;&lt;a class="suprablue"
               href="mailto:lib.circdesk@email.uky.edu"&gt;
<span epub:type="pagebreak" title="117" id="Page_117"/>               lib.circdesk@email.uky.edu&lt;/a&gt;&lt;/div&gt;
          &lt;/span&gt;
      &lt;/div&gt;
    <span class="CodeAnnotationCode" aria-label="annotation3">3</span> &lt;div class="dashing-li"&gt; 
          &lt;span class="contact_area"&gt;Reference:&lt;/span&gt;
          &lt;span class="contact_methods"&gt;
              &lt;div class="contact_phone"&gt;&lt;a class="suprablue" 
               href="tel:8592182048"&gt;(859) 218-2048&lt;/a&gt;&lt;/div&gt;
              &lt;div class="contact_email"&gt;&lt;a class="suprablue" 
               href="mailto:refdesk@uky.edu"&gt;refdesk@uky.edu&lt;/a&gt;&lt;/div&gt;
          &lt;/span&gt;
      &lt;/div&gt;
    <span class="CodeAnnotationCode" aria-label="annotation4">4</span> &lt;div class="dashing-li"&gt; 
          &lt;span class="contact_area"&gt;Interlibrary Loan:&lt;/span&gt;
          &lt;span class="contact_methods"&gt;
              &lt;div class="contact_phone"&gt;&lt;a class="suprablue" 
               href="tel:8592181880"&gt;(859) 218-1880&lt;/div&gt;
              &lt;div class="contact_email"&gt;&lt;a class="suprablue" 
               href="mailto:ILLBorrowing@uky.edu"&gt;
               ILLBorrowing@uky.edu&lt;/a&gt;&lt;/div&gt;
          &lt;/span&gt;
      &lt;/div&gt;
      &lt;div class="dashing-li-last"&gt;
          &lt;span class="featured_area"&gt;All Other Questions &amp; Comments:
          &lt;/span&gt;
          &lt;span class="featured_email"&gt;&lt;a class="suprablue" 
           href="mailto:webadmin@lsv.uky.edu"&gt;
           WebAdmin@lsv.uky.edu&lt;/a&gt;&lt;/span&gt;
      &lt;/div&gt;
  &lt;/div&gt;
<var>--snip--</var></code></pre>
<p class="CodeListingCaption"><a id="listing6-3">Listing 6-3</a>: Part of the source code for a live web page</p>
<p>Notice that all the information is encapsulated in a parent <code>&lt;div&gt;</code> tag with <code>class</code> attribute of <code>sf-middle</code> <span class="CodeAnnotation" aria-label="annotation1">1</span>. Information for the Circulation department (name, phone number, and email address) is held in a child <code>&lt;div&gt;</code> tag with class attribute of <code>dashing-li</code> <span class="CodeAnnotation" aria-label="annotation2">2</span>. The information for the other two areas, Reference <span class="CodeAnnotation" aria-label="annotation3">3</span> and Interlibrary Loan <span class="CodeAnnotation" aria-label="annotation4">4</span>, is held in two other child <code>&lt;div&gt;</code> tags within the parent tag. Within each child tag, subtags each contain a piece of the following information: department name, phone number, and email address. </p>
<p>These patterns are important to notice when writing a Python script to extract the information you need. Next, I’ll explain how to use these patterns to extract the information from the HTML file.</p>
<p>Download <em>scrape_live_web.py</em> from the book’s resources page and save it in your chapter folder. The first part of the script is shown in <a href="#listing6-4" id="listinganchor6-4">Listing 6-4</a>, which locates the <code>&lt;div&gt;</code> tags for each of the three areas.</p>
<pre><code>from bs4 import BeautifulSoup
import requests
# Provide the web address of the live web
url = 'http://libraries.uky.edu'
<span epub:type="pagebreak" title="118" id="Page_118"/># Obtain information from the live web
<span class="CodeAnnotationCode" aria-label="annotation1">1</span> page = requests.get(url)
# Parse the page to obtain the parent div tag
soup = BeautifulSoup(page.text, "html.parser")
div = soup.find('div', class_="sf-middle")
# Locate the three child div tags
<span class="CodeAnnotationCode" aria-label="annotation2">2</span> contacts = div.find_all("div", class_="dashing-li")
# Print out the first child div tag to examine it
print(contacts[0])
<var>--snip--</var></code></pre>
<p class="CodeListingCaption"><a id="listing6-4">Listing 6-4</a>: Python code to scrape a live web page</p>
<p>We import the <em>requests</em> module to obtain the source code from the live web page. The address of the web page is defined in the variable <code>url</code>. At <span class="CodeAnnotation" aria-label="annotation1">1</span>, we use <code>get()</code> to fetch the HTML code. Then, we find the <code>&lt;div&gt;</code> tag with the class value of <code>sf-middle</code> and use it as the parent tag.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">WARNING</span></h2>
<p>	Be careful not to miss the trailing underscore in <code>class</code><code>_="</code><code>sf</code><code>-</code><code>middle</code><code>"</code> or <code>class_="dashing-li"</code>.<code> </code>We must use the trailing underscore because the name <code>class</code> is a Python keyword and cannot be used as a variable name. See <span class="xref" itemid="xref_target_Chapter 1">Chapter 1</span> for Python rules.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>At <span class="CodeAnnotation" aria-label="annotation2">2</span>, we locate the three child <code>&lt;div&gt;</code> tags with the class value of <code>dashing-li</code> and put them in the list <code>contacts</code>, because each child <code>&lt;div&gt;</code> tag contains all the contact information for one department. Each element in the list corresponds to one of the departments. For example, the first element contains all the information for the Circulation department, and we print it out in <a href="#listing6-5" id="listinganchor6-5">Listing 6-5</a>.</p>
<pre><code>&lt;div class="dashing-li"&gt;
&lt;span class="contact_area"&gt;Circulation:&lt;/span&gt;
&lt;span class="contact_methods"&gt;
&lt;div class="contact_phone"&gt;&lt;a class="suprablue" href="tel:8592181881"&gt;
(859) 218-1881&lt;/a&gt;&lt;/div&gt;
&lt;div class="contact_email"&gt;&lt;a class="suprablue" 
href="mailto:lib.circdesk@email.uky.edu"&gt;lib.circdesk@email.uky.edu
&lt;/a&gt;&lt;/div&gt;
&lt;/span&gt;
&lt;/div&gt;</code></pre>
<p class="CodeListingCaption"><a id="listing6-5">Listing 6-5</a>: Source code for the Circulation department on the live web page</p>
<p>The second part of <em>scrape_live_web.py</em> will print out the detailed information for each of the three areas. It is shown in <a href="#listing6-6" id="listinganchor6-6">Listing 6-6</a>.</p>
<pre><code><var>--snip--</var>
# Obtain information from each child tag
for contact in contacts:
    # Obtain the area name
    area = contact.find('span', class_="contact_area")
    print(area.text)
<span epub:type="pagebreak" title="119" id="Page_119"/>    # Obtain the phone and email
    atags = contact.find_all('a', href = True)
    for atag in atags:
        print(atag.text)</code></pre>
<p class="CodeListingCaption"><a id="listing6-6">Listing 6-6</a>: Python code to print out the scraped information</p>
<p>We go into each element in the list <code>contacts</code>. To print out the department name, we locate the <code>&lt;span&gt;</code> tag with the class attribute of <code>contact_area</code>. The content of the tag is the department name. The two <code>&lt;a&gt;</code> tags contain the phone number and the email address of each department, and we also print them out. The output is shown here:</p>
<pre><code>Circulation:
(859) 218-1881
lib.circdesk@email.uky.edu
Reference:
(859) 218-2048
refdesk@uky.edu
Interlibrary Loan:
(859) 218-1880
ILLBorrowing@uky.edu</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	The Beautiful Soup library often provides more than one way of accomplishing the same task. For example, <code>findAll()</code> and <code>find_all()</code> work the same, and <code>find('span', class_="contact_area")</code> and <code>find('span', {"class":"contact_area"})</code> produce the same result. Many Python modules or libraries have different versions over time, and the old functions are carried over to newer versions to maintain backward compatibility.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c06-0003">Voice-Activated Podcasts</h2>
<p class="BodyFirst">In this project, our goal is to write a script that enables you to say, “Python, tell me the latest news,” and the script will broadcast a brief from an NPR news podcast. You’ll first learn how to extract the MP3 file associated with the podcast and play it, and then you’ll add the speech recognition feature to the script so that you can voice-activate it. Because the news brief is about five minutes long, you’ll also learn how to stop the podcast via voice control while the news is playing.</p>
<h3 id="h2-501560c06-0003">Extract and Play Podcasts</h3>
<p class="BodyFirst">First, find a website with a newscast you like. For this, we’ll use <em>NPR News Now</em> because it’s free and updated every hour, 24/7. The web address is <a href="https://www.npr.org/podcasts/500005/npr-news-now/" class="LinkURL">https://www.npr.org/podcasts/500005/npr-news-now/</a>. </p>
<p>Go to the site, and you should see something like <a href="#figure6-3" id="figureanchor6-3">Figure 6-3</a>.</p>
<span epub:type="pagebreak" title="120" id="Page_120"/><figure>
<img src="Images/f06003.png" alt="f06003" width="511" height="476"/>
<figcaption><p><a id="figure6-3">Figure 6-3</a>: Front page of <em>NPR News Now</em></p></figcaption>
</figure>
<p>As you can see, the latest news brief for me was updated at 7 <span class="KeyCaps">am</span> ET on Feb 9, 2021. Below it, you can also see news briefs from 6 <span class="KeyCaps">am</span>, 5 <span class="KeyCaps">am</span>, and so on. </p>
<p>To locate the MP3 file that contains the news briefs, right-click anywhere on the page and, from the menu that appears, select the <b>View page source</b> option (or press <span class="KeyCaps">ctrl</span>-U). You should see the source code, as in <a href="#figure6-4" id="figureanchor6-4">Figure 6-4</a>.</p>
<figure>
<img src="Images/f06004.png" alt="f06004" width="695" height="262"/>
<figcaption><p><a id="figure6-4">Figure 6-4</a>: Source code for <em>NPR News Now</em></p></figcaption>
</figure>
<p>You’ll notice that the MP3 files are contained in <code>&lt;a&gt;</code> tags. We need to use the Beautiful Soup library to extract all <code>&lt;a&gt;</code> tags that contain MP3 files and then extract the link from the first tag, which will contain the latest news brief. If you wanted to, you could listen to previous news briefs as well; for example, the second and the third tags contain the news briefs from 6 <span class="KeyCaps">am</span> and 5 <span class="KeyCaps">am</span> in <a href="#figure6-3">Figure 6-3</a>. </p>
<p><span epub:type="pagebreak" title="121" id="Page_121"/>Next, we need to extract the link, remove unwanted components, and use the <em>webbrowser</em> module to open the URL of the MP3 file so that the podcast can start playing. The script <em>npr_news.py</em>, in <a href="#listing6-7" id="listinganchor6-7">Listing 6-7</a>, shows how to accomplish this.</p>
<pre><code># Import needed modules
import requests
import bs4
import webbrowser

# Locate the website for the NPR news brief
url = 'https://www.npr.org/podcasts/500005/npr-news-now'
# Convert the source code to a soup string
response = requests.get(url)
<span class="CodeAnnotationCode" aria-label="annotation1">1</span> soup = bs4.BeautifulSoup(response.text, 'html.parser')
# Locate the tag that contains the mp3 files
<span class="CodeAnnotationCode" aria-label="annotation2">2</span> casts = soup.findAll('a', {'class': 'audio-module-listen'})
print(casts)
# Obtain the weblink for the mp3 file related to the latest news brief
<span class="CodeAnnotationCode" aria-label="annotation3">3</span> cast = casts[0]['href']
print(cast)
# Remove the unwanted components in the link
<span class="CodeAnnotationCode" aria-label="annotation4">4</span> pos = cast.find('?')
print(cast[0:pos])
# Extract the mp3 file link, and play the file
mymp3 = cast[0:pos]
webbrowser.open(mymp3)</code></pre>
<p class="CodeListingCaption"><a id="listing6-7">Listing 6-7</a>: A script to play online podcasts</p>
<p>We first use <code>get()</code> from the <em>requests</em> module to obtain the source code of the <em>NPR News Now</em> website and save it in the variable <code>response</code>. At <span class="CodeAnnotation" aria-label="annotation1">1</span>, we use the Beautiful Soup library to parse the text and the <code>html.parser</code> option to specify that the source code is in HTML. We saw in <a href="#figure6-4">Figure 6-4</a> that the MP3 files are held in <code>&lt;a&gt;</code> tags with a <code>class</code> attribute of <code>audio-module-listen</code>. Therefore, at <span class="CodeAnnotation" aria-label="annotation2">2</span> we use <code>findAll()</code> from Beautiful Soup to get all those tags and put them in the list <code>casts</code>. <a href="#listing6-8" id="listinganchor6-8">Listing 6-8</a> shows the content of <code>casts</code>.</p>
<pre><code>[&lt;a class="audio-module-listen" 
href="https://play.podtrac.com/500005/edge1.pod.npr.org/anon.npr-
mp3/npr/newscasts/2021/02/09/newscast070736.mp3?dl=1&amp;amp;
siteplayer=true&amp;amp;size=4500000&amp;amp;awCollectionId=500005&amp;amp;
awEpisodeId=965747474&amp;amp;dl=1"&gt;
&lt;b class="audio-module-listen-inner"&gt;
&lt;b class="audio-module-listen-icon icn-play"&gt;&lt;/b&gt;
&lt;b class="audio-module-listen-text"&gt;
&lt;b class="audio-module-cta"&gt;Listen&lt;/b&gt;
&lt;b class="audio-module-listen-duration"&gt;
&lt;span&gt;· &lt;/span&gt;
&lt;span&gt;5:00&lt;/span&gt;
&lt;/b&gt;
&lt;/b&gt;
&lt;/b&gt;
&lt;/a&gt;, &lt;a class="audio-module-listen" 
<span epub:type="pagebreak" title="122" id="Page_122"/>href="https://play.podtrac.com/500005/edge1.pod.npr.org/anon.npr-
mp3/npr/newscasts/2021/02/09/newscast060736.mp3?dl=1&amp;amp;
siteplayer=true&amp;amp;size=4500000&amp;amp;awCollectionId=500005&amp;amp;
awEpisodeId=965731320&amp;amp;dl=1"&gt;
&lt;b class="audio-module-listen-inner"&gt;
&lt;b class="audio-module-listen-icon icn-play"&gt;&lt;/b&gt;
&lt;b class="audio-module-listen-text"&gt;
&lt;b class="audio-module-cta"&gt;Listen&lt;/b&gt;
&lt;b class="audio-module-listen-duration"&gt;
&lt;span&gt;· &lt;/span&gt;
&lt;span&gt;5:00&lt;/span&gt;
&lt;/b&gt;
&lt;/b&gt;
&lt;/b&gt;
&lt;/a&gt;, &lt;a class="audio-module-listen" 
href="https://play.podtrac.com/500005/edge1.pod.npr.org/anon.npr-
mp3/npr/newscasts/2021/02/09/newscast050736.mp3?dl=1&amp;amp;
siteplayer=true&amp;amp;size=4500000&amp;amp;awCollectionId=500005&amp;amp;
awEpisodeId=965721223&amp;amp;dl=1"&gt; 
<var>--snip--</var>
&lt;/a&gt;]</code></pre>
<p class="CodeListingCaption"><a id="listing6-8">Listing 6-8</a>: All <code>&lt;a&gt;</code> tags with a <code>class</code> attribute of <code>audio-module-listen</code></p>
<p>As you can see, multiple <code>&lt;a&gt;</code> tags contain MP3 files. At <span class="CodeAnnotation" aria-label="annotation3">3</span>, we extract the first <code>&lt;a&gt;</code> tag in the list and obtains the <code>href</code> attribute of the tag (the link to the MP3 file), saving it to <code>cast</code>. The link is as follows:</p>
<pre><code>https://play.podtrac.com/500005/edge1.pod.npr.org/anon.npr-
mp3/npr/newscasts/2021/02/09/newscast070736.mp3?dl=1&amp;siteplayer=true&amp;size=450
0000&amp;awCollectionId=500005&amp;awEpisodeId=965747474&amp;dl=1 </code></pre>
<p>We trim the link so that it ends with the <em>.mp3</em> extension. To do that, we use the fact that the <em>?</em> character is right after <em>.mp3</em> in the link and then use the string method <code>find()</code> to locate the position of <em>?</em> in the link <span class="CodeAnnotation" aria-label="annotation4">4</span>. We then trim the link accordingly and print it out. The trimmed link is as follows:</p>
<pre><code>https://play.podtrac.com/500005/edge1.pod.npr.org/anon.npr-
mp3/npr/newscasts/2021/02/09/newscast070736.mp3</code></pre>
<p>Finally, we extract the link to the online MP3 file and use <code>open()</code> in the <em>webbrowser</em> module to open and play the MP3 file.</p>
<p>If you run the script, you should hear the latest NPR news brief playing in your default web browser.</p>
<h3 id="h2-501560c06-0004">Voice-Activate Podcasts</h3>
<p class="BodyFirst">Next, we’ll add speech recognition to the script so you can voice-activate the podcast. Further, since the podcast is about five minutes long, being able to stop it with your voice is useful. To achieve that, we need to install the <em>pygame</em> module because it allows the Python script to stop the audio file while the audio is playing. The <em>webbrowser</em> module does not have that functionality.</p>
<p><span epub:type="pagebreak" title="123" id="Page_123"/>Installing <em>pygame</em> is straightforward in Windows. Execute this line of code in an Anaconda prompt with your virtual environment activated:</p>
<pre><code><b>pip install pygame</b></code></pre>
<p>Then follow the instructions. </p>
<p>If you are using Mac, recent versions of macOS require the installation of Pygame 2. To install it, execute this line of code in a terminal with your virtual environment activated:</p>
<pre><code><b>pip install pygame==2.0.0</b></code></pre>
<p>Then follow the instructions. </p>
<p>If you are using Linux, execute the following three lines of code in a terminal with your virtual environment activated:</p>
<pre><code><b>sudo apt-get install python3-pip python3-dev</b>
<b>sudo pip3 install pygame</b>
<b>pip install pygame</b></code></pre>
<p>See <span class="xref" itemid="xref_target_Appendix A">Appendix A</span> at the end of this book for further detail. If the installation is not successful, you can use the <em>vlc</em> module as an alternative. </p>
<p>The script <em>news_brief_hs.py</em> in <a href="#listing6-9" id="listinganchor6-9">Listing 6-9</a> shows how to use voice control to activate the <em>NPR News Now</em> podcast and stop it whenever you want.</p>
<pre><code>from io import BytesIO

import requests
import bs4
from pygame import mixer

# Import functions from the local package
from mptpkg import voice_to_text, print_say

<span class="CodeAnnotationCode" aria-label="annotation1">1</span> def news_brief():
    # Locate the website for the NPR news brief
    url = 'https://www.npr.org/podcasts/500005/npr-news-now'
    # Convert the source code to a soup string
    response = requests.get(url)
    soup = bs4.BeautifulSoup(response.text, 'html.parser')
    # Locate the tag that contains the mp3 files
    casts = soup.findAll('a', {'class': 'audio-module-listen'})
    # Obtain the web link for the mp3 file
    cast = casts[0]['href']
    # Remove the unwanted components in the link
    mp3 = cast.find("?")
    mymp3 = cast[0:mp3]
    # Play the mp3 using the pygame module
    mymp3 = requests.get(mymp3)
    Voice = BytesIO()
    voice.write(mymp3.content)
    voice.seek(0)
    mixer.init()
<span epub:type="pagebreak" title="124" id="Page_124"/>    mixer.music.load(voice)
    mixer.music.play()
<span class="CodeAnnotationCode" aria-label="annotation2">2</span> while True:
    print_say('Python is listening…')
    inp = voice_to_text().lower()
    print_say(f'you just said: {inp}')
    if inp == "stop listening":
        print_say('Goodbye!')
        break
    # If "news" in your voice command, play news brief
    <span class="CodeAnnotationCode" aria-label="annotation3">3</span> elif "news" in inp: 
        news_brief()
        # Python listens in the background
        while True:
            background = voice_to_text().lower()
            # Stops playing if you say "stop playing"
            if "stop playing" in background:
                mixer.music.stop()
                break
        continue </code></pre>
<p class="CodeListingCaption"><a id="listing6-9">Listing 6-9</a>: Python script to voice-activate <em>NPR News Now</em></p>
<p>We import needed modules first. In particular, we import <code>BytesIO()</code> from the <em>io</em> module to create a temporary file to contain the news brief audio file. This prevents crashes that could occur if the script had to overwrite the file when you rerun it. </p>
<p>We define <code>news_brief()</code> <span class="CodeAnnotation" aria-label="annotation1">1</span>. This function accomplishes what we did in <em>npr_news.py </em>with a few exceptions. We download the MP3 file and save it to the temporary file <em>voice</em>. After that, we use the <em>pygame</em> module to play the latest news brief from <em>NPR News Now</em>. </p>
<p>At <span class="CodeAnnotation" aria-label="annotation2">2</span>, we start an infinite loop. At each iteration, the script captures your voice. When the word <em>news</em> is in your voice command <span class="CodeAnnotation" aria-label="annotation3">3</span>, the script will call <code>news_brief()</code> and start playing the latest NPR news brief. While the news is playing, the script is constantly listening to your voice command in the background. When you say, “Stop playing,” anytime while or after the news plays, the loop will break and go back to the main menu. If you want to end the script, simply say, “Stop listening.”</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>TRY IT YOURSELF</h2>
<p class="BoxBodyFirst"><em>Wait Wait</em><em> </em><em>. . . </em><em>Don’t Tell Me!</em> is a weekly radio show, and recent episodes are available as podcasts at <a href="https://www.npr.org/programs/wait-wait-dont-tell-me/" class="LinkURL">https://www.npr.org/programs/wait-wait-dont-tell-me/</a>. Its source code is similar to that of <em>NPR News Now</em>. Create a script similar to <em>new_brief_hs</em><em>.py</em> to voice-activate the latest episode of the online broadcast.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c06-0004"><span epub:type="pagebreak" title="125" id="Page_125"/>Voice-Activated Radio Player</h2>
<p class="BodyFirst">Our goal in this project is to write a script to play online live radio using voice control. When you say, “Python, play online radio,” the script will go to the website and click the Play button so that the live radio starts playing on your computer. </p>
<p>We’ll be using the <em>selenium</em> module to automate web browser interaction from Python. We’ll then add voice control to the script to achieve voice activation.</p>
<h3 id="h2-501560c06-0005">Install the selenium Module</h3>
<p class="BodyFirst">The <em>selenium</em> module is not in the Python standard library, so first we’ll install it. Open your Anaconda prompt (Windows) or a terminal (Mac or Linux), activate your virtual environment, and execute this command: </p>
<pre><code><b>conda install selenium </b></code></pre>
<p>Follow the onscreen instructions to finish the installation.</p>
<h3 id="h2-501560c06-0006">Control Web Pages</h3>
<p class="BodyFirst">The <em>selenium</em> module allows you to automate web browser interactions with Python. </p>
<p>Online Radio Box (<em>https://onlineradiobox.com/us/</em>) will serve as our radio station platform. You can change this to any online radio station you like, such as Magic 106.7 or NPR online radio stations. </p>
<p>Go to the website and you should see a screen similar to that shown in <a href="#figure6-5" id="figureanchor6-5">Figure 6-5</a>.</p>
<figure>
<img src="Images/f06005.png" alt="f06005" width="695" height="435"/>
<figcaption><p><a id="figure6-5">Figure 6-5</a>: Front page of Online Radio Box</p></figcaption>
</figure>
<p><span epub:type="pagebreak" title="126" id="Page_126"/>When the web page loads, live radio is not playing. You need to use <em>selenium</em> to interact with the web browser to click the Play button (the triangle-shaped white button at the bottom in <a href="#figure6-5">Figure 6-5</a>).</p>
<p>Now you’ll learn how to locate the XPath of the Play button on the website. <em>XPath</em> is short for <em>Extensible Markup Language (XML) path</em>. It is the syntax for finding an element on the web page by using an XML path expression. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	We use the Chrome browser because it supports all major operating systems. Websites for other browsers and other operating systems are on the Selenium website (<a href="https://www.selenium.dev/" class="LinkURL">https://www.selenium.dev/</a>).</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>Here are the steps to find the XPath of the Play button:</p>
<ol class="decimal">
<li value="1">Open the web page of Online Radio Box, shown in <a href="#figure6-5">Figure 6-5</a>, using the Chrome browser.</li>
<li value="2">Put your mouse cursor on the Play button (do not click). Then right-click and choose <b>Inspect</b> from the pop-up menu. The source code will show at the right side of the web page, as shown in <a href="#figure6-6" id="figureanchor6-6">Figure 6-6</a>.</li>
<li value="3">Right-click the highlighted line of code at the right side of the page and select <b>Copy</b><span class="MenuArrow">▶</span><b>XPath</b>. </li>
<li value="4">Paste the XPath in a blank file to be used later. In this example, the XPath for the Play button is <code>//*[@id="b_top_play"]</code>.</li>
</ol>
<figure>
<img src="Images/f06006.png" alt="f06006" width="695" height="508"/>
<figcaption><p><a id="figure6-6">Figure 6-6</a>: Locate the XPath of the Play button</p></figcaption>
</figure>
<p><span epub:type="pagebreak" title="127" id="Page_127"/>Next, you need to download the web driver for a specific browser. If you’d like to learn more about the Selenium project, an abundance of information is on its website. </p>
<p>Follow the instructions at <a href="https://chromedriver.chromium.org/downloads/" class="LinkURL">https://chromedriver.chromium.org/downloads/</a> and download the executable file appropriate to your operating system. In Windows, this is <em>chromedriver_win32.zip</em>; extract the ZIP file and place the executable file in the chapter folder. On Unix-based operating systems, the executable file is called <em>chromedriver</em>. On Windows, the executable file is <em>chromedriver.exe</em>. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">WARNING</span></h2>
<p>	The XPath of a link may change constantly on many sites. You may have to get the most updated XPath before you run a script.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>As the final step, save <em>play_live_radio.py </em>in your chapter folder and run it. The script, also available at the book’s resources page, is shown in <a href="#listing6-10" id="listinganchor6-10">Listing 6-10</a>.</p>
<pre><code># Put your web driver in the same folder as this script 
from selenium import web driver
browser = webdriver.Chrome(executable_path='./chromedriver')
browser.get("https://onlineradiobox.com/us/")
button = browser.find_element_by_xpath('//*[@id="b_top_play"]')
button.click()</code></pre>
<p class="CodeListingCaption"><a id="listing6-10">Listing 6-10</a>: Python code to automate online live radio</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	For Windows, it’s important to put <em>chromedriver.exe</em> in the same folder as <em>p</em><em>lay_live_radio.py</em> and have Chrome installed on your computer. On Linux with Firefox, the Gecko web driver needs to be on the system path. Otherwise, the <em>selenium</em> module will not be able to automate the web browser. You can find further installation details on the Chromium website or on sites such as Stack Overflow.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>We first import <code>webdriver()</code> from the <em>selenium</em> module. First, the script launches the web browser. Then, the <code>get()</code> function brings us to the live radio site based on the web address provided. We then define the Play button as a variable button, using the XPath that we’ve generated . Finally, we use <code>click()</code> in the <em>selenium</em> module to activate the Play button on the website. Consequently, if everything is installed and configured correctly, when you run the script, the web browser will open and the online live radio will start playing. </p>
<p>It’s educational to run the script line by line by using the F9 key. You will see that after the first line is run, the Chrome browser opens on your computer, and after the second, the browser brings you to the Online Radio Box site. With the final two lines, the Play button is being activated. You will then hear the live radio playing. </p>
<h3 id="h2-501560c06-0007"><span epub:type="pagebreak" title="128" id="Page_128"/>Voice-Activate Live Radio</h3>
<p class="BodyFirst">We’ll add speech recognition and text-to-speech functionality to the script so you can voice-activate the online live radio. The script <em>voice_live_radio.py </em>in <a href="#listing6-11" id="listinganchor6-11">Listing 6-11</a> shows you how to accomplish that.</p>
<pre><code># Put web driver in the same folder as this script 
# Import the web driver function from selenium
from selenium import webdriver
from selenium.webdriver.chrome.options import Options

# Import functions from the local package
from mptpkg import voice_to_text, print_say

<span class="CodeAnnotationCode" aria-label="annotation1">1</span> def live_radio():
    global button
    chrome_options = Options()  
    chrome_options.add_argument("—headless") 
    browser = webdriver.Chrome\
    (executable_path = './chromedriver',chrome_options = chrome_options)
    browser.get("https://onlineradiobox.com/us/")
    button = browser.find_element_by_xpath('//*[@id="b_top_play"]')
    button.click()

  <span class="CodeAnnotationCode" aria-label="annotation2">2</span> while True:
        print_say("how may I help you?")
      <span class="CodeAnnotationCode" aria-label="annotation3">3</span> inp = voice_to_text().lower() 
        print_say(f'you just said {inp}')
      <span class="CodeAnnotationCode" aria-label="annotation4">4</span> if inp == "stop listening": 
            print_say('Goodbye!')
            break
      <span class="CodeAnnotationCode" aria-label="annotation5">5</span> elif "radio" in inp: 
            print_say('OK, play live radio online for you!')
            live_radio()
            while True:
                background = voice_to_text().lower()
                if "stop playing" in background:
                    button.click()
                    break
                else:
                    continue</code></pre>
<p class="CodeListingCaption"><a id="listing6-11">Listing 6-11</a>: Python code to voice-activate online live radio</p>
<p>We first import all needed modules. Since we need the speech recognition and text-to-speech features, we import <code>voice_to_text()</code> from the local <code>mptpkg</code> package to convert speech to text. We also import <code>print_say()</code> from the local <code>mptpkg</code> package to convert text to human speech.</p>
<p>We then define <code>live_radio()</code> to accomplish what <em>play_live_radio.py</em> does with a few modifications <span class="CodeAnnotation" aria-label="annotation1">1</span>. When the function is activated, the script will go to the online live radio station and click the Play button so that live radio starts playing. We use the <code>headless</code> option so you won’t see a web browser pop up. We also make the variable <code>button</code> a global variable so we can use the variable later in the script.</p>
<p><span epub:type="pagebreak" title="129" id="Page_129"/>At <span class="CodeAnnotation" aria-label="annotation2">2</span>, an infinite loop begins. At each iteration, the script asks, “How may I help you?” After you speak into the microphone, <code>voice_to_text()</code> converts your speech to text and saves it as the string variable <code>inp</code>. The <code>lower()</code> function converts all characters to lowercase to avoid mismatch due to letter capitalization <span class="CodeAnnotation" aria-label="annotation3">3</span>.</p>
<p>When you say, “Stop listening,” the <code>if</code> branch of the code is activated <span class="CodeAnnotation" aria-label="annotation4">4</span>. The script prints <code>Goodbye</code>, the loop breaks, and the script ends. When the word <em>radio</em> is in your voice command, the <code>elif</code> branch of the code is activated <span class="CodeAnnotation" aria-label="annotation5">5</span>. As a result, <code>live_radio()</code> is called, and the online live radio starts playing. While the radio is playing, the script is quietly listening to you in the background. If you say, “Stop playing” anytime when the radio is playing, the button will click again and the radio will change from Play to Stop. After that, the script exits the radio mode and returns to the main menu. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>TRY IT YOURSELF</h2>
<p class="BoxBodyFirst">Magic 106.7 FM is a radio station in Boston (<a href="https://www.radio.com/magic1067/listen" class="LinkURL">https://www.radio.com/magic1067/listen</a><a href="http:///" class="LinkURL">/</a>). Write a script similar to <em>v</em><em>oice_live_radio.py</em> to voice-activate the live radio on this site.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c06-0005">	Voice-Activated Videos</h2>
<p class="BodyFirst">You can apply the method you learned in the preceding section to voice-activate prerecorded online videos or even online live TV. </p>
<p>NBC’s<em> Nightly News with Lester Holt</em> provides prerecorded videos at <a href="https://www.nbcnews.com/nightly-news-full-episodes/" class="LinkURL">https://www.nbcnews.com/nightly-news-full-episodes/</a>, shown in <a href="#figure6-7" id="figureanchor6-7">Figure 6-7</a>.</p>
<figure>
<img src="Images/f06007.png" alt="f06007" width="656" height="435"/>
<figcaption><p><a id="figure6-7">Figure 6-7</a>: Front page of NBC’s <em>Nightly News</em></p></figcaption>
</figure>
<p><span epub:type="pagebreak" title="130" id="Page_130"/>We’ll use Python to interact with the web browser to click the Play button that activates the online video. You can see a triangle-shaped Play button on the video frame. Follow the steps in <span class="xref" itemid="xref_target_“Control Web Pages” on page 125">“Control Web Pages” on page 125</span> to find the XPath of the button.</p>
<p>The script <em>voice_online_video.py</em> in <a href="#listing6-12" id="listinganchor6-12">Listing 6-12</a> shows how to voice-activate the online video.</p>
<pre><code># Import functions from the local package
from mptpkg import voice_to_text, print_say 

# Import the web driver function from selenium
from selenium import webdriver
def online_video(): 
    browser = webdriver.Chrome(executable_path='./chromedriver')
    browser.get("https://www.nbcnews.com/nightly-news-full-episodes")
    button = browser.find_element_by_xpath\
('//*[@id="content"]/div[6]/div/div[3]/div/\ 
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> section[2]/div[2]/div/div[1]/article/div[1]/h2/a[2]/span') 
    button.click() 
<span class="CodeAnnotationCode" aria-label="annotation2">2</span> while True: 
    print_say("how may I help you?")
    inp = voice_to_text().lower() 
    print_say(f'you just said {inp}')
    if inp == "stop listening": 
        print('Goodbye!')
        break
    elif "video" in inp:
        print_say('OK, play online video for you!')
        online_video()
        break</code></pre>
<p class="CodeListingCaption"><a id="listing6-12">Listing 6-12</a>: A script to voice-activate online video</p>
<p>The logic is the same as when dealing with live radio. We first define <code>online_video()</code> to be called later. When the function is activated, the script will go to the site, locate the XPath of the Play button <span class="CodeAnnotation" aria-label="annotation1">1</span>, and click it so the video will start playing. </p>
<p>An infinite loop starts at <span class="CodeAnnotation" aria-label="annotation2">2</span>. At each iteration, the script asks, “How may I help you?” After you speak into the microphone, <code>voice_to_text()</code> converts your speech to text and saves it as an all-lowercase string variable <code>inp</code>. </p>
<p>When you say, “Stop listening,” the <code>if</code> branch of the code is activated. The script prints <code>Goodbye!</code>, the loop breaks, and the script ends. When the word <em>video</em> is in your voice command, the <code>elif</code> branch of the code is activated. As a result, <code>online_video()</code> is called, and the online video starts playing.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="131" id="Page_131"/>TRY IT YOURSELF</h2>
<p class="BoxBodyFirst">Vimeo provides a music video by Katy Perry at <a href="https://vimeo.com/160883302" class="LinkURL">https://vimeo.com/160883302</a><a href="http:///" class="LinkURL">/</a>. Write a script to voice-activate the online music video (try the XPath <code>//*[@id="160883302"]/div[7]/div[3]/button</code> if you have trouble locating it).</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c06-0006">	 Summary</h2>
<p class="BodyFirst">In this chapter, you learned the basics of web scraping: how HTML works, including the different types and uses of HTML tags, and how to use the Beautiful Soup library to parse HTML files and scrape the information you need. </p>
<p>Armed with these techniques, you learned how to parse a source file of the podcast <em>NPR News Now</em> and locate its MP3 file. You then used the <em>webbrowser</em> module to play the online MP3. You also learned how to voice activate online podcasts, using the <em>pygame</em> module to play the audio file so that you can stop it anytime via voice commands.</p>
<p>You then learned to voice activate an Online Radio Box station. Specifically, you learned how to use the Selenium web driver to interact with a web browser. You directed Python to click the Play button to activate the live radio broadcast. You also learned to use voice control to accomplish these tasks.</p>
<p>Finally, you applied the same idea to online videos, such as NBC’s <em>Nightly News with Lester Holt</em>. </p>
<h2 id="h1-501560c06-0007">	End-of-Chapter Exercises</h2>
<ol class="decimal">
<li value="1">Modify <em>parse_local.py</em> to print out the <code>class</code> attribute value and the web address of the <code>&lt;a&gt;</code> tag for the University of Kentucky Libraries.</li>
<li value="2">Modify <em>scrape_live_web.py</em> to print out the information for the site area All Other Questions &amp; Comments, as shown in <a href="#figure6-2">Figure 6-2</a>.</li>
<li value="3">This URL points to a podcast by Gwyneth Paltrow and Oprah Winfrey: <em>https://goop.com/the-goop-podcast/gwyneth-x-oprah-power-perception-soul-purpose/.</em> Write a script to voice activate the online podcast.</li>
</ol>
<aside class="endnote" epub:type="rearnote">
</aside>

</section>
</div>
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="133" id="Page_133"/>7</span><br/>
<span class="ChapterTitle">Building a Virtual Personal Assistant</span></h1>
</header>
<figure class="opener">
<img src="Images/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">In this and the next chapter, you’ll learn how to create your own virtual personal assistant (VPA), similar to Amazon’s Alexa. You’ll first have an overview of your VPA and its functionalities. You’ll then import all needed modules at once so you can start to run your VPA right away. You’ll create a script to make your VPA stand by 24/7 without disturbing you. Whenever you need assistance, you can say, “Hello Python” to wake it up, and when you want it to stand by again, you can use a voice command to put it in standby mode. </p>
<p>After that, you’ll examine various functionalities to add to your VPA. The first two are a timer and an alarm clock. </p>
<p>The third functionality enables your VPA to tell jokes. When you say, “Tell me a joke,” the script will randomly select a joke from a list and speak it out loud to you.</p>
<p><span epub:type="pagebreak" title="134" id="Page_134"/>The fourth functionality sends email. If you say, “Send Jessica an email,” the script will activate the email feature, retrieve Jessica’s email address from your recipient list, and ask you for the subject line and content, which you can dictate before telling the VPA to send.</p>
<p>In <span class="xref" itemid="xref_target_Chapter 8">Chapter 8</span>, you’ll learn how to make your VPA capable of answering (almost) any question. Before you begin, set up the folder <em>/mpt/ch07/</em> for this chapter. As always, all scripts in this chapter are available at the book’s resources page, <a href="https://www.nostarch.com/make-python-talk" class="LinkURL">https://www.nostarch.com/make-python-talk</a>/.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>New Skills </h2>
<ul>
<li>Creating a standby mode to silently wait for your commands 24/7</li>
<li>Using the time-out option in the speech recognition module to make it more responsive</li>
<li>Setting a timer or an alarm clock</li>
<li>Voice-activating a joke-telling functionality</li>
<li>Asking Python to send an email by using the <em>smtplib</em> module</li>
</ul>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c07-0001">	An Overview of Your VPA</h2>
<p class="BodyFirst">Before you learn about the functionalities of your VPA, let’s explore its structure. You’ll start by downloading needed files and installing a third-party module.</p>
<h3 id="h2-501560c07-0001">Download VPA Files</h3>
<p class="BodyFirst">Let’s download the needed files. Go to the book’s resources website <a href="https://www.nostarch.com/make-python-talk/%20" class="LinkURL">https://www.nostarch.com/make-python-talk/ </a>and download the following files from the <em>/mpt/mptpkg/ </em>directory: <em>mywakeup.py</em>, <em>mytimer.py</em>, <em>myalarm.py</em>, <em>myjoke.py</em>, and <em>myemail.py</em>. Put them in the same directory on your computer where you place your self-made local package files. Refer to <span class="xref" itemid="xref_target_Chapter 5">Chapter 5</span> for instructions. I’ll explain the purpose of these files later in this chapter.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	The files <em>mywakeup.py</em>, <em>mytimer.py</em>, and so on are local module files to be put in the local package <em>m</em><em>ptpkg</em>. As a result, they should be placed in the package folder <em>/mpt/mptpkg</em><em>/</em> instead of the chapter folder <em>/mpt/ch07</em><em>/</em>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>Next, open the script <em>__init__.py</em> in the package directory <em>/mpt/mptpkg/</em> on your computer. As you may recall from <span class="xref" itemid="xref_target_Chapter 5">Chapter 5</span>, you’ve already placed the following two lines of code in it:</p>
<pre><code>from .mysr import voice_to_text
from .mysay import print_say</code></pre>
<p><span epub:type="pagebreak" title="135" id="Page_135"/>Add the five lines of code in <a href="#listing7-1" id="listinganchor7-1">Listing 7-1</a> to the end of <em>__init__.py</em>.</p>
<pre><code>from .mywakeup import wakeup
from .mytimer import timer
from .myalarm import alarm
from .myjoke import joke
from .myemail import email</code></pre>
<p class="CodeListingCaption"><a id="listing7-1">Listing 7-1</a>: Importing functions from local modules to the local package</p>
<p>This code imports the five functions <code>wakeup()</code>, <code>timer()</code>, <code>alarm()</code>, <code>joke()</code>, and <code>email()</code> from the five modules to the local package so you can later import them at the package level. More on this point soon.</p>
<p>Next, go to the book’s resources website and download <em>vpa.py</em> from the chapter directory <em>/mpt/ch07/</em>. Save it on your computer where you place this chapter’s Python scripts. The code for <em>vpa.py</em> is shown in <a href="#listing7-2" id="listinganchor7-2">Listing 7-2</a>.</p>
<pre><code># Import functions from the local package
from mptpkg import voice_to_text, print_say, wakeup, timer, alarm, joke, email

# Put the script in standby
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> while True:
    # Capture your voice command quietly in standby
    wake_up = wakeup()
    # You can wake up the VPA by saying "Hello Python"
    while wake_up == "Activated":
        print_say("How may I help you?")
        inp = voice_to_text().lower()
        print_say(f'You just said {inp}.')
        if "back" in inp and "stand" in inp:
            print_say('OK, back to standby; let me know if you need help!')
            break
        # Activate the timer
      <span class="CodeAnnotationCode" aria-label="annotation2">2</span> elif "timer for" in inp and ("hour" in inp or "minute" in inp):
            timer(inp)
            continue
        # Activate the alarm clock
        elif "alarm for" in inp and ("a.m." in inp or "p.m." in inp):
            alarm(inp)
            continue
        # Activate the joke-telling functionality
        elif "joke" in inp and "tell" in inp:
            joke()
            continue
        # Activate the email-sending functionality
        elif "send" in inp and "email" in inp:
            email()
            continue
        else:     
            continue
    # End the script by including "stop" in your voice command
<span epub:type="pagebreak" title="136" id="Page_136"/>    if wake_up == "ToQuit":
        print_say("OK, exit the script; goodbye!")
        break</code></pre>
<p class="CodeListingCaption"><a id="listing7-2">Listing 7-2</a>: Python code for a VPA </p>
<p>We first import the seven functions (<code>voice_to_text()</code>, <code>print_say()</code>, <code>wakeup()</code>, and so on) from the local package <em>mptpkg</em>. The code in <a href="#listing7-1">Listing 7-1</a> already imported the five functions (<code>wakeup()</code>, <code>timer()</code>, and so on) from the local modules to <em>mptpkg,</em> so here we import the functions at the package level directly. </p>
<p>We start the script by creating an infinite loop <span class="CodeAnnotation" aria-label="annotation1">1</span>. At each iteration, the VPA listens to your voice command quietly in the background. You can say, “Hello Python” to wake up the VPA. After it wakes up, the VPA asks, “How may I help you?” and takes your voice command. You can activate one of the four functionalities of the VPA <span class="CodeAnnotation" aria-label="annotation2">2</span>: setting a timer, setting an alarm clock, telling a joke, or sending an email. </p>
<p>You can put the VPA back on standby when you are finished by including “back” and “standby” in your voice input. While the script is in standby, you can terminate the script by saying, “Stop the script” or “Stop listening.”</p>
<p>Before running <em>vpa.py</em>, you need to install a third-party module.</p>
<h3 id="h2-501560c07-0002">Install the arrow Module</h3>
<p class="BodyFirst">We’ll first install the <em>arrow</em> module to tell the time and date for the timer and alarm clock functionalities in the VPA.</p>
<p>The Python standard library has several modules that can tell the time and date, including the well-known <em>time</em> and <em>datetime</em>. However, they are not very user-friendly, with complicated formatting. Further, you need to use several modules in the Python standard library to achieve what we try to accomplish in this chapter. As a result, we’ll use the third-party module <em>arrow</em>, which offers a more convenient way to deal with times. </p>
<p>You can install <em>arrow</em> in your Anaconda prompt (Windows) or a terminal (Mac or Linux) by using the following command, with the virtual environment <em>chatting</em> activated:</p>
<pre><code><b>conda install arrow</b></code></pre>
<h2 id="h1-501560c07-0002">	Manage the Standby Mode</h2>
<p class="BodyFirst">Here you’ll set up the standby mode for your VPA. At the end of this section, you’ll be able to activate the VPA by saying, “Hello Python.” The VPA will respond, “How may I help you?” </p>
<p>If you then say, “Go back to standby,” the script will return to standby mode and keep quiet. While it’s in standby, you can even choose to end the script by including <em>stop</em> in your voice command.</p>
<h3 id="h2-501560c07-0003"><span epub:type="pagebreak" title="137" id="Page_137"/>Create the Local Module mywakeup</h3>
<p class="BodyFirst">First, you’ll set the script to recognize certain commands. Open <em>mywakeup.py</em> you just downloaded in your Spyder editor. This script is based on <em>mysr.py</em> from <span class="xref" itemid="xref_target_Chapter 3">Chapter 3</span>, with some significant modifications. <a href="#listing7-3" id="listinganchor7-3">Listing 7-3</a> highlights the differences.</p>
<pre><code>import speech_recognition as sr

speech = sr.Recognizer()
# Define a wakeup() function to determine the status of the VPA
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> def wakeup():
    wakeup = "StandBy"
    voice_input = "" 
    with sr.Microphone() as source:
        speech.adjust_for_ambient_noise(source)
        try:
          <span class="CodeAnnotationCode" aria-label="annotation2">2</span> audio = speech.listen(source,timeout=3)
            voice_input = speech.recognize_google(audio).lower()
        except sr.UnknownValueError:
            pass
        except sr.RequestError:
            pass
        except sr.WaitTimeoutError:
            pass
    if "hello" in voice_input and "python" in voice_input:
        wakeup = "Activated" 
    elif "stop" in voice_input:
        wakeup = "ToQuit"
    return wakeup</code></pre>
<p class="CodeListingCaption"><a id="listing7-3">Listing 7-3</a>: Python code for the <em>my</em><em>w</em><em>akeup</em> module </p>
<p>We first import <code>speech_recognition</code> and define <code>wakeup()</code> <span class="CodeAnnotation" aria-label="annotation1">1</span>. We create a variable <code>wakeup</code> and set the default value as <code>StandBy</code>. We then capture the voice input from the microphone. </p>
<p>Here I did a little tweaking to make the script more responsive: the <code>timeout=3</code> option in the <code>listen()</code> method tells the script to time out every three seconds and analyze the voice input <span class="CodeAnnotation" aria-label="annotation2">2</span>, meaning it checks for a voice command every three seconds. Without this option, the script may wait too long to respond, and you may have to say, “Hello Python” a couple of times before you catch the script’s attention.</p>
<p>We convert all text to lowercase to avoid mismatch due to capitalization. We also use exception handling to prevent the script from crashing.</p>
<p>When a voice command is captured, the script checks whether <em>hello</em> and <em>Python</em> are in the voice input. If yes, the variable <code>wakeup</code> changes its value to <code>Activated</code>. Similarly, if you say, “Stop listening” or “Stop the script,” the variable <code>wakeup</code> changes to <code>ToQuit</code>. When the function is called, it will return whatever value is stored in the variable <code>wakeup</code>.</p>
<h3 id="h2-501560c07-0004"><span epub:type="pagebreak" title="138" id="Page_138"/>Set Some Responses</h3>
<p class="BodyFirst">Now that you know how the <em>mywakeup</em> module works, let’s learn how to manage standby mode.</p>
<p>Run <em>vpa.py</em> in your Spyder editor. You’ll notice that when the script is running, nothing happens. However, your VPA is quietly listening in the background. You can activate the VPA by saying, “Hello Python.” Once the job is done, you can put it back to standby.</p>
<p>The following output is from one interaction with the script, with my voice input in bold:</p>
<pre><code><b>hello Python</b>
How may I help you?
<b>go back to standby</b>
You just said go back to standby.<b> </b>
OK, back to standby; let me know if you need help!
<b>hello Python</b>
How may I help you?
<b>go back to standby</b>
You just said go back to standby.
OK, back to standby; let me know if you need help!
<b>stop listening</b>
OK, exit the script; goodbye!</code></pre>
<p>As you can see, I activated the VPA and then put it back to standby. I activated the VPA and then returned it to standby a second time. After that, I said, “Stop listening” to end the script. </p>
<p>Run the script several times to ensure that you can voice-activate the VPA, put it on standby, and end the script. Next, we’ll examine the individual functionalities of the VPA one by one.</p>
<h2 id="h1-501560c07-0003">	Ask Your VPA to Set a Timer </h2>
<p class="BodyFirst">Let’s explore the first feature: setting a timer. To do that, you’ll first learn how to tell time in Python. We’ll use the <em>arrow</em> module to tell time in Python and then create a timer that takes written commands. Finally, we’ll create a <code>timer()</code> function in the local module <em>mytimer</em> that we’ll import into the VPA script; this will allow us to set a timer by using voice commands.</p>
<h3 id="h2-501560c07-0005">Tell the Time with Python </h3>
<p class="BodyFirst">Let’s first learn how to tell time with Python. </p>
<p>The following script, <em>get_time.py,</em> shows how to retrieve the current time for your time zone in different formats. This is just an example so you can familiarize yourself with the <em>arrow</em> module; it’s not part of the VPA script. </p>
<pre><code>import arrow

# Current time in HH:MM:SS format
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> current_time = arrow.now().format('H:m:s')
<span epub:type="pagebreak" title="139" id="Page_139"/>print('the current time is', current_time)
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> current_time12 = arrow.now().format('hh:mm:ss A')
print('the current time is', current_time12)
# We can also print out hour, minute, and second individually
<span class="CodeAnnotationHang" aria-label="annotation3">3</span> print("the current hour is",arrow.now().format('H'))
print("the current minute is",arrow.now().format('m'))
print("the current second is",arrow.now().format('s'))</code></pre>
<p>We first import the <em>arrow</em> module. Its <code>now()</code> function gives you the current local date and time, but you need to use <code>format()</code> to let the script know the format and level of detail of that information. </p>
<p><a href="#table7-1" id="tableanchor7-1">Table 7-1</a> lists some commonly used formats and the meanings associated with the <code>format()</code> function in <em>arrow</em>. For example, the uppercase <code>HH</code> and <code>H</code> generate the current hour value in a 24-hour clock, with and without a leading 0, respectively, whereas <code>hh</code> and <code>h</code> do the same in a 12-hour clock. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	For a complete list of all formats and their meanings associated with <code>format</code><code>()</code> in the <em>arrow</em> module, go to <a href="https://arrow.readthedocs.io/en/latest/" class="LinkURL">https://arrow.readthedocs.io/en/latest/</a>.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>At <span class="CodeAnnotation" aria-label="annotation1">1</span>, we retrieve the current time in <code>H:m:s</code> format on a 24-hour clock and then print it out. At <span class="CodeAnnotation" aria-label="annotation2">2</span>, we obtain the time on a 12-hour clock, followed by <span class="KeyCaps">AM</span> or <span class="KeyCaps">PM</span>, in the format <code>hh:mm:ss</code>. Finally we print out just the hour value of the current time <span class="CodeAnnotation" aria-label="annotation3">3</span>. You can do the same for the minute value or the second value.</p>
<p>If you run this script, you’ll have output similar to the following:</p>
<pre><code>the current time is 8:35:46
the current time is 08:35:46,AM
the current hour is 8
the current minute is 35
the current second is 46</code></pre>
<figure>
<figcaption class="TableTitle"><p><a id="table7-1">Table 7-1</a>: Some Commonly Used Formats for the <code>format()</code> Method of the <em>arrow</em> Module</p></figcaption>
<table id="table-501560c07-0001" border="1">
<thead>
<tr>
<td><b>Format code</b></td>
<td><b>Meaning</b></td>
</tr>
</thead>
<tbody>
<tr>
<td><code>dddd</code></td>
<td>Full weekday name</td>
</tr>
<tr>
<td><code>ddd</code></td>
<td>Abbreviated weekday name</td>
</tr>
<tr>
<td><code>MMM</code></td>
<td>Abbreviated month name</td>
</tr>
<tr>
<td><code>MMMM</code></td>
<td>Full month name</td>
</tr>
<tr>
<td><code>YYYY</code></td>
<td>Year in normal form (for example, 2021)</td>
</tr>
<tr>
<td><code>HH</code></td>
<td>Hour (24-hour clock) as a decimal number with leading zero</td>
</tr>
<tr>
<td><code>hh</code></td>
<td>Hour (12-hour clock) as a decimal number with leading zero</td>
</tr>
<tr>
<td><code>A</code></td>
<td><span class="KeyCaps">AM</span> or <span class="KeyCaps">PM</span></td>
</tr>
<tr>
<td><code>mm</code></td>
<td>Minute as a decimal number with leading zero</td>
</tr>
<tr>
<td><code>ss</code></td>
<td>Second as a decimal number with leading zero</td>
</tr>
</tbody>
</table>
</figure>
<p><span epub:type="pagebreak" title="140" id="Page_140"/>You can also use the <em>arrow</em> module to get today’s date and weekday information, shown here in the <em>get_date.py</em> script:</p>
<pre><code>import arrow

# Get today's date
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> today_date = arrow.now()

# Print today's date in different formats
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> print("today is", today_date.format('MMMM DD, YYYY'))
print("today is", today_date.format('MMM D, YYYY'))
print("today is", today_date.format('MM/DD/YYYY'))
# Print today's weekday in different formats
<span class="CodeAnnotationHang" aria-label="annotation3">3</span> print("today is", today_date.format('dddd'))
print("today is", today_date.format('ddd'))</code></pre>
<p>At <span class="CodeAnnotation" aria-label="annotation1">1</span>, we use <code>now()</code> to generate the current date and time and save it in a string variable <code>today_date</code>. At <span class="CodeAnnotation" aria-label="annotation2">2</span>, we print out the date in the format of January 01, 2021, with an abbreviated form of the month name, and in numbers using the pattern MM/DD/YYYY. At <span class="CodeAnnotation" aria-label="annotation3">3</span>, we print out the day of the week and then again in abbreviated form.</p>
<p>This script generates output similar to the following:</p>
<pre><code>today is March 01, 2021
today is Mar 01, 2021
today is 03/01/2021
today is Monday
today is Mon</code></pre>
<p>Now that you know how to tell time in Python, you’ll learn how to set a timer.</p>
<h3 id="h2-501560c07-0006">Build a Timer</h3>
<p class="BodyFirst">We’ll use our new <em>arrow</em> module skills with the <code>sleep()</code> function from the <em>time</em> module to build a timer that takes written commands. You won’t use this in your VPA script, but you’ll learn the skills needed to build a timer that takes voice commands.</p>
<p>We’ll restrict the input to take hours only, minutes only, or hours and minutes (the script won’t take seconds). So you can set the timer to go off in 2 hours, or in 1 hour 30 minutes, or in 20 minutes—but not in 1 hour 30 minutes 20 seconds. </p>
<p>Before we go into the details of the script, let’s understand the logic behind it. Your written command should be in the form of <code>set a timer for 1 hour 20 minutes</code>, <code>set a timer for 2 hours</code>, or <code>set a timer for 25 minutes</code>. The script then saves your written command in the string variable <code>inp</code>. </p>
<p>The string method <code>find()</code> returns a value of <code>-1</code> if the characters you’re looking for are not in the string. We’ll use this feature to extract the hour and minute values in <code>inp</code>.</p>
<p><span epub:type="pagebreak" title="141" id="Page_141"/>There are three cases:</p>
<ul>
<li>The value of <code>inp.find("hour")</code> is not <code>-1</code>, while the value of <code>inp.find("minute")</code> is <code>-1</code>. This means <code>minute</code> is not in the variable <code>inp</code> but <code>hour</code> is. You’ve set the timer in the form of <code>set a timer for 2 hours</code>. We extract the hour value between <code>timer for</code> and <code>hour</code> and set the minute value to <code>0</code>.</li>
<li>The value of <code>inp.find("hour")</code> is <code>-1</code>, and the value of <code>inp.find("minute")</code> is not <code>-1</code>. This means <code>minute</code> is in the variable <code>inp</code> but not <code>hour</code>. You’ve set the timer in the form of <code>set a timer for 25 minutes</code>. We extract the minute value between <code>timer for</code> and <code>minute</code> and set the hour value to <code>0</code>.</li>
<li>Neither the value of <code>inp.find("hour")</code> nor the value of <code>inp.find("minute")</code> is <code>-1</code>. This means both <code>hour</code> and <code>minute</code> are in the variable <code>inp</code>. You’ve set the timer in the form of <code>set a timer for 1 hour 20 minutes</code>. We extract the hour value between <code>timer for</code> and <code>hour</code> and the minute value between <code>hour</code> and <code>minute</code>.</li>
</ul>
<p>We’ll add that amount of time to the current time to determine when the timer should go off. We then check the time every 0.5 seconds to make sure we don’t miss when the timer should go off. When the time reaches the preset time, the timer goes off.</p>
<p>The timer is set in <em>timer.py</em> in <a href="#listing7-4" id="listinganchor7-4">Listing 7-4</a>.</p>
<pre><code>import time
import arrow

# Tell you the format to set the timer
print('''set your timer; you can set it to the number of hours,
      number of minutes, 
      or a combination of both ''')
# Set the timer
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> inp = input("How long do you want to set your timer for?\n")
# Find the positions of "timer for" and "hour" and "minute"
pos1 = inp.find("timer for")
pos2 = inp.find("hour")
pos3 = inp.find("minute")
# Handle the case "set a timer for hours only"
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> if pos3 == -1:
    Addhour = inp[pos1+len("timer for"):pos2]
    Addminute = 0
# Handle the case "set a timer for minutes only"
<span class="CodeAnnotationHang" aria-label="annotation3">3</span> elif pos2 == -1:
    addhour=0
    addminute = inp[pos1+len("timer for"):pos3]
# Handle the case for "set a timer for hours and minutes"
<span class="CodeAnnotationHang" aria-label="annotation4">4</span> else:
    Addhour = inp[pos1+len("timer for"):pos2]
    Addminute = inp[pos2+len("hour"):pos3]
# Current hour, minute, and second
startHH = arrow.now().format('H')
startmm = arrow.now().format('m')
<span epub:type="pagebreak" title="142" id="Page_142"/>startss = arrow.now().format('s')
# Obtain the time for the timer to go off
newHH = int(startHH)+int(addhour)
newmm = int(startmm)+int(addminute)
<span class="CodeAnnotationHang" aria-label="annotation5">5</span> if newmm&gt;59:
    newmm -= 60
    newHH += 1
newHH = newHH%24
end_time = str(newHH)+":"+str(newmm)+":"+startss
print("Your timer will go off at "+end_time)
while True:
    timenow = arrow.now().format('H:m:s')
    if timenow == end_time:
       print("Your timer has gone off!")
       break
    time.sleep(0.5)</code></pre>
<p class="CodeListingCaption"><a id="listing7-4">Listing 7-4</a>: The script to set a timer </p>
<p>We first print out the instructions. At <span class="CodeAnnotation" aria-label="annotation1">1</span>, the script takes the user’s written input specifying how long to set the timer, then saves this to the variable <code>inp</code>.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">WARNING</span></h2>
<p>	In <em>t</em><em>imer.py</em>, we use <code>int()</code> to convert the number of minutes or hours to an integer. Therefore, your input must be a natural number such as 2, 5, or 10. You can’t use a decimal number such as 2.5 hours or 8.6 minutes because <code>int()</code> can’t convert those to an integer. </p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>We then check whether the input included <code>hour</code> and <code>minute</code>. If <code>minute</code> is not in the input <span class="CodeAnnotation" aria-label="annotation2">2</span>, we set the value of <code>addminute</code> to <code>0</code> and set the value of <code>addhour</code> to whatever number is between <code>timer for</code> and <code>hour</code>. We use similar methods to handle cases when <code>hour</code> is not in the written command <span class="CodeAnnotation" aria-label="annotation3">3</span> or when both <code>hour</code> and <code>minute</code> are in the written command <span class="CodeAnnotation" aria-label="annotation4">4</span>.</p>
<p>The function <code>now()</code> from the <em>arrow</em> module obtains the current time in hour, minute, and second values. We add the values of <code>addminute</code> and <code>addhour</code> to the current time to obtain the time when the timer should go off. At <span class="CodeAnnotation" aria-label="annotation5">5</span>, we adjust for the cases when the minute value exceeds 59 or the hour value exceeds 23. We then set the time the alarm should go off in the <code>H:m:s</code> format. </p>
<p>We start an infinite <code>while</code> loop to check the current time every 0.5 seconds. When the current time reaches the alarm time, we set off the alarm. The script prints <code>Your timer has gone off!</code> and the script ends.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">WARNING</span></h2>
<p>	The script <em>timer.py</em> is written to build up your skill set. It won’t be used in the final VPA script, so we don’t use exception handling. As a result, the script is easy to break. </p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<p>Here’s an example interaction with <em>timer.py</em>, with user input in bold:</p>
<pre><code>   set your timer; you can set it to the number of hours,
      number of minutes, 
      or a combination of both

<span epub:type="pagebreak" title="143" id="Page_143"/>How long do you want to set your timer for?
<b>set a timer for 1 minute</b>
Your timer will go off at 21:9:15
Your timer has gone off!</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>t</em><em>imer</em><em>.py</em> and set the timer to go off in two minutes.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-501560c07-0007">Create the mytimer Module</h3>
<p class="BodyFirst">Now we’ll create a <code>timer()</code> function that’s similar to the <em>timer.py</em> script, but we’ll use a voice command instead of a written one.</p>
<p>Open the file <em>mytimer.py</em> you just downloaded from the book’s resources website and open it in your Spyder editor. The module will define the function <code>timer()</code> that your VPA will use, shown in <a href="#listing7-5" id="listinganchor7-5">Listing 7-5</a>. </p>
<pre><code>import time

import arrow

from mptpkg import print_say

def timer(v_inp):
    # Find the positions of "timer for" and "hour" and "minute"
    pos1= v_inp.find("timer for")
    pos2= v_inp.find("hour")
<var>--snip--</var>
    print_say("Your timer will go off at "+end_time)
<var>--snip--</var>
           print_say("Your timer has gone off!")
<var>--snip--</var></code></pre>
<p class="CodeListingCaption"><a id="listing7-5">Listing 7-5</a>: The script for the local <em>mytimer</em> module </p>
<h3 id="h2-501560c07-0008">Set the Timer </h3>
<p class="BodyFirst">Now you’ll test the first functionality of your VPA. Let’s zoom in to the part where you can activate the timer in your VPA script:</p>
<pre><code><var>--snip--</var>
from mptpkg import timer
<var>--snip--</var>
        # Activate the timer
        elif "timer for" in inp and ("hour" in inp or "minute" in inp):
            timer(inp)
            continue        
<var>--snip--</var></code></pre>
<p><span epub:type="pagebreak" title="144" id="Page_144"/>First, we’ve imported the <code>timer()</code> function to the script. Second, the <code>elif</code> branch between the <code>if</code> branch and <code>else</code> branch in the inner <code>while</code> loop is where you can set a timer. </p>
<p>If you run <em>vpa.py</em>, it will start in standby mode. You can wake it up by saying, “Hello Python.” Then you can set a timer by saying, “Set a timer for 1 hour 20 minutes” or “Set a timer for 2 hours.”</p>
<p>The following output is from one interaction with the script, with my voice input in bold:</p>
<pre><code><b>hello Python</b>
How may I help you?
<b>set a timer for 1 minute</b>
You just said set a timer for 1 minute<b> </b>
Your timer will go off at 21:37:46
Your timer has gone off!
How may I help you?
<var>--snip--</var></code></pre>
<p>As you can see, I first activate the VPA and then set a timer for one minute. The VPA tells me, “Your timer will go off at 21:37:46.” After one minute, the timer goes off. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it out</h2>
<p class="BoxBodyFirst">Run <em>VPA.py</em>, wake the VPA up, and set the timer to go off in two minutes. After the timer goes off, ask the VPA to go back to standby.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c07-0004">	Ask Your VPA to Set an Alarm Clock</h2>
<p class="BodyFirst">Now you’ll learn how to ask your VPA to set an alarm clock. You’ll first use written commands to set the alarm clock. You’ll then create a <em>myalarm</em> module, in which you define an <code>alarm()</code> function. Finally, you’ll import <code>alarm()</code> to the VPA script to set the alarm clock by using voice commands.</p>
<h3 id="h2-501560c07-0009">Build an Alarm Clock</h3>
<p class="BodyFirst">Building an alarm clock is similar to setting a timer, except that we specify the time the alarm should go off rather than saying it should go off a certain time from now. You can either specify an hour value alone, such as 8 <span class="KeyCaps">pm</span>, or an hour and minute value, such as 7:25 <span class="KeyCaps">am</span>.</p>
<p>The script will take written commands for now. The script <em>alarm_clock.py</em> is shown in <a href="#listing7-6" id="listinganchor7-6">Listing 7-6</a>.</p>
<pre><code>import time

import arrow

<span epub:type="pagebreak" title="145" id="Page_145"/># Tell you the format to set the timer
print('''set your alarm clock\nyou can use the format of:\n 
      \tset an alarm for 7 a.m., or
      \tset an alarm for 2:15 p.m.''')
# Set the alarm
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> inp = input("What time would you like to set your alarm for?\n")
# Find the positions of the four indicators
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> p1 = inp.find("alarm for") 
p2 = inp.find("a.m.") 
p3 = inp.find("p.m.") 
p4 = inp.find(":")
# Handle the four different cases
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> if p2 != -1 and p4 != -1: 
    inp=inp[p1+len("alarm for")+1:p2]+"AM"
elif p3 != -1 and p4 != -1: 
    inp=inp[p1+len("alarm for")+1:p3]+"PM" 
elif p2 != -1 and p4 == -1: 
    inp=inp[p1+len("alarm for")+1:p2-1]+":00 AM"
elif p3 != -1 and p4 == -1: 
    inp=inp[p1+len("alarm for")+1:p3-1]+":00 PM"
print(f"OK, your alarm will go off at {inp}!")
<span class="CodeAnnotationHang" aria-label="annotation3">3</span> while True:
    # Obtain time and change it to "7:25 AM" format
    tm = arrow.now().format('h:mm A')
    time.sleep(5)
    # If the clock reaches alarm time, the alarm clock goes off
    if inp == tm:
        print("Your alarm has gone off!")
        break</code></pre>
<p class="CodeListingCaption"><a id="listing7-6">Listing 7-6</a>: The script to set an alarm clock </p>
<p>First, the script captures our written input and saves it as the string variable <code>inp</code>. We then look for the positions of the four indicators: <code>alarm for</code>, <code>a.m.</code>, <code>p.m.</code>, and <code>:</code> <span class="CodeAnnotation" aria-label="annotation1">1</span>. If you include the colon in your input, the script knows to check for a minute value. </p>
<p>Depending on what you pass at <span class="CodeAnnotation" aria-label="annotation2">2</span>, one of four scenarios results:</p>
<ul>
<li>You input <code>a.m.</code> and specify hour and minute values. We extract the preset time value between <code>set alarm for</code> and <code>a.m.</code>, convert it to a string, and add <code>AM</code> at the end. For example, if you input <code>set an alarm for 7:34 a.m.</code>, the returned string value is <code>7:34 AM</code>. </li>
<li>You input <code>p.m.</code> and specify the hour and minute value. We extract the preset time value, convert it to a string, and add <code>PM</code> at the end. For example, if you input <code>set an alarm for 2:55 p.m.</code>, the returned string value is <code>2:55 PM</code>. </li>
<li>You input <code>a.m.</code> but specify only an hour value. We extract the preset time value, convert it to a string, and add <code>:00 AM</code> at the end. For example, if you input <code>set an alarm for 7 a.m.</code>, the returned string value is <code>7:00 AM</code>. </li>
<li>You input <code>p.m.</code> but specify only an hour value. We extract the preset time value, convert it to a string, and add <code>:00 PM</code> at the end. For example, if you input <code>set an alarm for 3 p.m.</code>, the returned string value is <code>3:00 PM</code>. </li>
</ul>
<p><span epub:type="pagebreak" title="146" id="Page_146"/>Once we’ve extracted the time when the alarm should go off, we start an infinite loop <span class="CodeAnnotation" aria-label="annotation3">3</span>. At each iteration, we check the current time every five seconds in the 7:25 <span class="KeyCaps">AM</span> format.</p>
<p>Finally, we check whether the time we set for the alarm clock matches the current time. If the times match, the alarm clock goes off, and the script prints <code>Your alarm has gone off!</code>. </p>
<p>Run the script and use it to set an alarm clock for yourself. Try all four cases: with and without the minute value, with either <code>a.m.</code> or <code>p.m.</code> at the end. Next, we’ll create an alarm clock module based on this script.</p>
<h3 id="h2-501560c07-0010">Create the Alarm Clock Module</h3>
<p class="BodyFirst">Now we’ll create the <code>alarm()</code> function that will use the <em>alarm_clock.py</em> code. This code will take voice input instead of written input and give both voice and text output.</p>
<p>Open <em>myalarm.py</em>, which you just downloaded from the book’s resources website, and open it in your Spyder editor. The script will define the function <code>alarm()</code> that your VPA will use, shown in <a href="#listing7-7" id="listinganchor7-7">Listing 7-7</a>. </p>
<pre><code>import time

import arrow

from mptpkg import print_say

# Define the Alarm() function
def alarm(v_inp):
    # Find the positions of the four indicators
    p1 = v_inp.find("alarm for") 
<var>--snip--</var></code></pre>
<p class="CodeListingCaption"><a id="listing7-7">Listing 7-7</a>: The script for the local <em>myalarm</em> module </p>
<h3 id="h2-501560c07-0011">Set an Alarm </h3>
<p class="BodyFirst">Now you can ask your VPA to set an alarm clock for you. Let’s zoom in on the part of <em>vpa.py</em> that can set an alarm clock: </p>
<pre><code><var>--snip--</var>
from mptpkg import alarm
<var>--snip--</var>
        # Activate the alarm clock
        elif "alarm for" in inp and ("a.m." in inp or "p.m." in inp):
            alarm(inp)
            continue
<var>--snip--</var></code></pre>
<p>First, we’ve imported the <code>alarm()</code> function in the local <em>myalarm</em> module to the script from the self-made package <em>mptpkg</em>. Second, an <code>elif</code> branch is in the inner <code>while</code> loop, where you can activate the alarm clock by including <em>alarm for</em> and either <em>a.m.</em> or <em>p.m.</em> in your voice command. </p>
<p><span epub:type="pagebreak" title="147" id="Page_147"/>Run <em>vpa.py</em>. You can set an alarm clock after waking up your VPA. The following output is from one interaction with the script, with my voice input in bold:</p>
<pre><code><b>hello Python</b>
How may I help you?
<b>set an alarm for 8:38 a.m.</b>
You just said set an alarm for 8:38 a.m.<b> </b>
OK, your alarm will go off at 8:38 AM!
Your alarm has gone off!
How may I help you?
<var>--snip--</var></code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>vpa</em><em>.py</em>, wake up your VPA, and set an alarm clock to go off in one minute.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c07-0005">	Ask Your VPA to Tell a Joke</h2>
<p class="BodyFirst">In this section, you’ll learn how to ask your VPA to tell a joke. You’ll find a good joke list to pull from, then create a joke module and import it to your main script so that your VPA can tell you jokes in a human voice.</p>
<h3 id="h2-501560c07-0012">Create Your Joke List</h3>
<p class="BodyFirst">You can create a joke list from many resources. I’m using the Quick, Funny Jokes! website (<a href="https://www.quickfunnyjokes.com/math.html" class="LinkURL">https://www.quickfunnyjokes.com/math.html</a>).</p>
<p>I selected 15 jokes and saved them in a file called <em>jokes.txt</em> in the chapter folder <em>/mpt/ch07/ </em>on my computer. You can use as many jokes as you like, as long as you also save them in a separate text file as we are doing here. Here are my 15 jokes:</p>
<pre><code>There are three kinds of people in the world—those who can count and those who can't. 

Without geometry, life is pointless.

Write the expression for the volume of a thick-crust pizza with height "a" and radius "z". 

Two random variables were talking in a bar. They thought they were being discrete, but I heard their chatter continuously. 

3 out of 2 people have trouble with fractions. 

Parallel lines have so much in common . . . it's a shame they'll never meet. 

Math is like love; a simple idea, but it can get complicated. 

<span epub:type="pagebreak" title="148" id="Page_148"/>Dear Math, please grow up and solve your own problems; I'm tired of solving them for you. 

Dear Algebra, Please stop asking us to find your X. She's never coming back, and don't ask Y. 

Old mathematicians never die; they just lose some of their functions. 

I strongly dislike the subject of math; however, I am partial to fractions. 

Zenophobia is the irrational fear of convergent sequences. 

Philosophy is a game with objectives and no rules. Mathematics is a game with rules and no objectives. 

Classification of mathematical problems as linear and nonlinear is like classification of the universe as bananas and non-bananas.

A circle is just a round straight line with a hole in the middle.</code></pre>
<p>Next, you’ll learn in detail how to create the joke-telling module.</p>
<h3 id="h2-501560c07-0013">Create a Joke Module</h3>
<p class="BodyFirst">In this section, you’ll create a <code>joke()</code> function. When the function is called, it will go to the file <em>jokes.txt</em> on your computer, access its content, and break it into individual jokes and put them in a list. It will then randomly select a joke from the list and read it out loud to you.</p>
<p>We’ll import the script <em>myjoke.py</em>, shown in <a href="#listing7-8" id="listinganchor7-8">Listing 7-8</a>, as a local module in your VPA. </p>
<pre><code><span class="CodeAnnotationHang" aria-label="annotation1">1</span> import random

from mptpkg import print_say

# Define the joke() function
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> def joke():
    # Read the content from the file jokes.txt
    with open('../ch07/jokes.txt','r') as f:
        content = f.read()
    # Split the content at double line breaks
  <span class="CodeAnnotationCode" aria-label="annotation3">3</span> jokelist = content.split('\n\n')
    # Randomly select a joke from the list
    joke = random.choice(jokelist)
    print_say(joke)</code></pre>
<p class="CodeListingCaption"><a id="listing7-8">Listing 7-8</a>: The script to create a <em>joke</em> module </p>
<p>First, we import the <em>random</em> module, which we’ll use to randomly select a joke from the list. At <span class="CodeAnnotation" aria-label="annotation1">1</span>, we start the definition of <code>joke()</code>. </p>
<p><span epub:type="pagebreak" title="149" id="Page_149"/>We then read the content from <em>jokes.txt</em> and put the content in the string variable <code>content</code> <span class="CodeAnnotation" aria-label="annotation2">2</span>. Note that since we put <em>jokes.txt</em> in a different directory from the module script <em>myjoke.py</em>, we need to specify the path of the file, and <code>../ch07/</code> tells Python that the file is in a parallel folder called <em>mptpkg</em>. This way, we can use the joke-telling functionality in other chapters as well, which we will do in Chapter 17. </p>
<p>We know that individual jokes are separated by double line breaks, so we use <code>split()</code> to separate the content of the file into individual strings and put them in the list <code>jokelist</code> <span class="CodeAnnotation" aria-label="annotation3">3</span>. We then randomly select a joke by using <code>choice()</code> from the <em>random</em> module. Finally, the script prints out and speaks aloud the selected joke. </p>
<h3 id="h2-501560c07-0014">Tell a Joke</h3>
<p class="BodyFirst">Now you’ll import the joke module you just created to your VPA so that it can tell you jokes in a human voice. Let’s zoom in on the part of <em>vpa.py</em> that can tell a joke: </p>
<pre><code><var>--snip--</var>
from mptpkg import joke
<var>--snip--</var>
        # Activate the joke-telling functionality
        elif "joke" in inp and "tell" in inp:
            joke()
            continue
<var>--snip--</var></code></pre>
<p>We first import the <code>joke()</code> function in our newly made <em>myjoke</em> module from the local <em>mptpkg</em> package. In the inner <code>while</code> loop section of the VPA code is an <code>elif</code> branch, in which we tell the VPA that if <em>tell</em> and <em>joke</em> are in your voice command, the joke-telling functionality is activated.</p>
<p>Here’s the outcome from one interaction with the script <em>vpa.py</em>, with my input in bold:</p>
<pre><code><b>hello Python</b>
How may I help you?
<b>tell me a joke</b>
You just said tell me a joke
I strongly dislike the subject of math; however, I am partial to fractions. 
How may I help you?
<var>--snip--</var></code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">The HuffPost website has a list of motivational quotes: <a href="https://www.huffpost.com/entry/100-motivational-quotes-t_b_4505356/" class="LinkURL">https://www.huffpost.com/entry/100-motivational-quotes-t_b_4505356/</a>. Create a quote module to provide you with uplifting quotes, similar to the joke module you created.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c07-0006"><span epub:type="pagebreak" title="150" id="Page_150"/>	Send Hands-Free Email </h2>
<p class="BodyFirst">In this section, we’ll examine the functionality of sending email 100 percent hands-free. You’ll first learn how to send an email by using written commands in Python; this will give you the skill set to create an email module that takes voice commands. After that, you’ll import the email module to your VPA so you can send email with your voice. </p>
<h3 id="h2-501560c07-0015">Send Email with Written Commands </h3>
<p class="BodyFirst">Before moving on, you need to prepare a few things.</p>
<p>First, you need an email account from which to send email via Python. This example uses my Gmail account, <a href="mailto:ukmarkliu@gmail.com">ukmarkliu@gmail.com</a>, which you should replace with your own email address. </p>
<p>Gmail and many other email providers require you to apply for a separate application password, which is different from your regular email password. For example, the Google Account Help page shows how to set up your Gmail app password; see <a href="https://support.google.com/accounts/answer/185833/" class="LinkURL">https://support.google.com/accounts/answer/185833/</a>.</p>
<p>Sending email in Python requires a few steps. You’ll first need to connect to your email provider’s Simple Mail Transfer Protocol (SMTP) server. SMTP is an internet standard for sending email. Once the connection is established, you’ll need to log in using your email address and password. You’ll then provide the recipient’s email address, the subject line, and the email content. Finally, you’ll ask Python to send the actual email. </p>
<p>The <em>smtplib</em> module is in the Python standard library, so no installation is needed. You also need at least one email as the recipient’s address. You can use another one of your own email addresses or ask for a friend’s. </p>
<p>The script <em>emails.py</em> can take your written commands and send out email using Python, as shown in <a href="#listing7-9" id="listinganchor7-9">Listing 7-9</a>.</p>
<pre><code>import smtplib

# Build a dictionary of names and emails
emails = {'mark':'mark.liu@uky.edu',
         'sarah':'Sarah email address here',
         'chris':'Chris email address here'}
# Different email providers have different domain names and port numbers
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> mysmt = smtplib.SMTP('smtp.gmail.com', 587)
mysmt.ehlo()
mysmt.starttls()
# Use your own login info; you may need an app password
mysmt.login('<var>ukmarkliu@gmail.com</var>', '<var>{Your password here}</var>')
# Ask for the name of the recipient
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> name = input('Who do you want to send the email to?\n')
email = emails[name]
print(f"You just said {name}.")
# Ask for the subject line
subline = input('What is the subject line?\n')
print(f"You just said {subline}.")
# Ask for the email content
content = input('What is the email content?\n')
print(f"You just said {content}.")
<span epub:type="pagebreak" title="151" id="Page_151"/># Send the actual email
<span class="CodeAnnotationHang" aria-label="annotation3">3</span> mysmt.sendmail('<var>ukmarkliu@gmail.com</var>', email, 
               f'Subject: {subline}.\nHello, {content}.')
{}
print('Ok, email sent')
mysmt.quit()</code></pre>
<p class="CodeListingCaption"><a id="listing7-9">Listing 7-9</a>: The script to send an email using Python </p>
<p>We import the <em>smtplib</em> module and create a dictionary <em>emails</em> to match names with email addresses. This way, when you type in a person’s name, the script will retrieve the corresponding email from the dictionary.</p>
<p>At <span class="CodeAnnotation" aria-label="annotation1">1</span>, we connect to the Gmail SMTP. If you aren’t using Gmail, you’ll need to search for the domain name and port number of your email provider. No change is needed if you are using Gmail.</p>
<p>We then start the communication with your email server and the Transport Layer Security (TLS) encryption. The TLS encryption is needed by the script for security reasons. Once the connection is established, you need to log in using your email address and password, so make sure to replace <var>ukmarkliu@gmail.com</var> with your own email address. I’ve blocked out my Gmail password in the code. </p>
<p>The script then requests several pieces of information in order to send the email <span class="CodeAnnotation" aria-label="annotation2">2</span>. It first requests the name of the recipient, which you must already have stored in the dictionary <code>emails</code> for the script to retrieve. With the name, the script retrieves the email from the dictionary. It will then also ask you for the email subject line and email content, which you enter in the IPython console at the lower-right corner of your computer screen. </p>
<p>At <span class="CodeAnnotation" aria-label="annotation3">3</span>, we send out the email with <code>sendmail()</code>, which takes three inputs: your email address; the recipient’s email address; and the subject line and the email content, separated by the line break escape character \<code>n</code>.</p>
<p>Once done, the script will confirm that the email has been sent. Try this script yourself and make sure that you can send email using Python.</p>
<p>Next, we’ll create the module to send email using Python and then add it to your VPA.</p>
<h3 id="h2-501560c07-0016">Create the Email Module</h3>
<p class="BodyFirst">We first need to create the script <em>myemail.py</em> to use as a local module in your VPA. In the module, we define an <code>email()</code> function. Once called, it will connect to your email server and ask you for voice inputs—the recipient’s name, the subject line, and the email content—before sending out the actual email. </p>
<p>The content of <em>myemail.py</em> is similar to that of <em>emails.py</em>, with a few differences: the script will ask you for input using voice as well as printed messages, and you need to use voice input instead of written input. The differences are highlighted in <a href="#listing7-10" id="listinganchor7-10">Listing 7-10</a>.</p>
<pre><code><var>--snip--</var>
from mptpkg import voice_to_text, print_say

<span epub:type="pagebreak" title="152" id="Page_152"/># Define the email() function
def email():
    # Build a dictionary of names and emails
<var>--snip--</var>
    # Voice input the name of the recipient
    print_say('Who do you want to send the email to?')
    name = voice_to_text().lower()
    email = emails[name]
    print_say(f"You just said {name}.")
    # Voice input the subject line
    print_say('What is the subject line?')
    subline = voice_to_text()
    print_say(f"You just said {subline}.")
    # Voice input the email content
    print_say('What is the email content?')
    content = voice_to_text()
    print_say(f"You just said {content}.")
    # Send the actual email
    mysmt.sendmail('ukmarkliu@gmail.com', email, 
                   f'Subject: {subline}.\nHello, {content}.')
    {}
    print_say('Ok, email sent.')
    mysmt.quit()</code></pre>
<p class="CodeListingCaption"><a id="listing7-10">Listing 7-10</a>: The script to create a local <em>myemail</em> module </p>
<p>As you can see, you need to import <code>voice_to_text()</code> from your local <em>mptpkg</em> package to capture your voice input to dictate the recipient’s name, email subject line, and content. You also need <code>print_say()</code> from your local <em>mptpkg</em> package to print and speak messages. </p>
<p>Now the module is ready to be imported to the VPA script.</p>
<h3 id="h2-501560c07-0017">Add the Email Functionality </h3>
<p class="BodyFirst">Next, you need to import <code>email()</code> from <em>myemail.py</em> into your VPA so that you can send email 100 percent hands-free. Let’s zoom in to the part of <em>vpa.py</em> that can send an email: </p>
<pre><code><var>--snip--</var>
from mptpkg import email
<var>--snip--</var>
        # Activate the email-sending functionality
        elif "email" in inp and "send" in inp:
            email()
            continue
<var>--snip--</var></code></pre>
<p>We import the <code>email()</code> function in the local <em>myemail</em> module from the local <em>mptpkg</em> package. There’s an <code>elif</code> branch in which you can activate the email-sending feature.</p>
<p><span epub:type="pagebreak" title="153" id="Page_153"/>Here’s an example interaction with <em>vpa.py</em>, with my voice input in bold. All output is printed as well as spoken out loud.</p>
<pre><code><b>hello Python</b>
How may I help you?
<b>send an email</b>
You just said send an email
Who do you want to send the email to?
<b>mark</b>
You just said mark.
What is the subject line?
<b>this is from python</b>
You just said this is from python.
What is the email content?
<b>this email is sent using the Python programming language</b>
You just said this email is sent using the Python programming language
Ok, email sent
How may I help you?
<var>--snip--</var></code></pre>
<p>First, you should wake up your VPA. After you say, “Send an email,” the email feature is activated. The VPA then asks you for the recipient’s name—I gave my own name, and my University of Kentucky (UKY) email address was matched to it. It also asks for the subject line and email content. Once the information is collected, the email is sent, and the script exits the email functionality.</p>
<p><a href="#figure7-1" id="figureanchor7-1">Figure 7-1</a> shows the email I received as a result in my UKY email account.</p>
<figure>
<img src="Images/f07007.png" alt="f07007" width="463" height="183"/>
<figcaption><p><a id="figure7-1">Figure 7-1</a>: An email sent using a Python script 100 percent hands-free</p></figcaption>
</figure>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Put your own email account and password in <em>myemail</em><em>.py</em>. Then place a legitimate email in the dictionary <code>emails</code>. Wake up your VPA and ask it to send an email to one of your friends. </p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c07-0007"><span epub:type="pagebreak" title="154" id="Page_154"/>	Summary</h2>
<p class="BodyFirst">In this chapter, you learned how to create a VPA that can set an alarm and timer, tell jokes, and even send email hands-free! You wake your VPA with “Hello Python” and then give it an instruction to activate one of the four functionalities. This chapter taught you how to create a new feature, make it into a local module, and use it in your main script. </p>
<p>In the next chapter, you’ll learn how to use the WolframAlpha API to tap into the vast knowledge space on the website so that your VPA will be able to answer (almost) any question.</p>
<h2 id="h1-501560c07-0008">	End-of-Chapter Exercises</h2>
<ol class="decimal">
<li value="1">Write a script to print out a message and speak aloud today’s date and time, formatted as “Today is September 8, 2021, and the time now is 09:03:07 <span class="KeyCaps">AM</span>.” </li>
<li value="2">Modify <em>mywakeup.py</em> so that the only way to end the script <em>vpa.py</em> is by saying, “Quit the script.” </li>
</ol>
<aside class="endnote" epub:type="rearnote">
</aside>

</section>
</div>
<div id="sbo-rt-content"><section>
<header>
<h1 class="chapter">
<span class="ChapterNumber"><span epub:type="pagebreak" title="155" id="Page_155"/>8</span><br/>
<span class="ChapterTitle">Know-It-All VPA</span></h1>
</header>
<figure class="opener">
<img src="Images/chapterart.png" alt="" width="200" height="200"/>
</figure>
<p class="ChapterIntro">The VPA we created in <span class="xref" itemid="xref_target_Chapter 7">Chapter 7</span> can set a timer or an alarm clock for you, tell you jokes, or send your email. Now we’ll upgrade it so you can ask it about nearly anything—including daily news and weather, gas prices, and travel information—and tap into its nearly unlimited knowledge of science, math, history, and society.</p>
<p>In this chapter, you’ll access the storehouse of information in the computational engine WolframAlpha and use Wikipedia as a backup if WolframAlpha can’t provide an answer. If neither site can answer, your VPA will tell you, “I am still learning, and I don’t know the answer to that yet.” Your VPA will be complete and capable of answering almost any question.</p>
<p>Before you begin, set up the folder <em>/mpt/ch08/</em> for this chapter. As always, all scripts in this chapter are available at the book’s resources page.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="156" id="Page_156"/>New Skills </h2>
<ul>
<li>Using APIs with your Python code</li>
<li>Exploring areas of knowledge in WolframAlpha</li>
<li>Using <code>try</code> and <code>except</code> to use one source as the backup of another source</li>
<li>Creating a know-it-all functionality for your VPA</li>
</ul>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c08-0001">	Get Answers from WolframAlpha</h2>
<p class="BodyFirst"><em>WolframAlpha</em> is a computational knowledge engine that provides an online service for factual queries, with a focus on numerical and computational capabilities, especially in the areas of science and technology. In this section, you’ll learn how to get answers from WolframAlpha through its API and then write a Python script to retrieve information.</p>
<h3 id="h2-501560c08-0001">Apply for an API Key</h3>
<p class="BodyFirst">The first step is to apply for an API key. WolframAlpha gives you up to 2,000 noncommercial API calls per month at no charge. Go to <a href="https://account.wolfram.com/login/create/" class="LinkURL">https://account.wolfram.com/login/create/</a> and complete the steps to create an account, as shown in <a href="#figure8-1" id="figureanchor8-1">Figure 8-1</a>. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">NOTE</span></h2>
<p>	The WolframAlpha website is subject to change. What you see, and the API application process, may be slightly different from the instructions here. Please follow the instructions you find at the website.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<figure>
<img src="Images/f08001.png" alt="f08001" width="404" height="448"/>
<figcaption><p><a id="figure8-1">Figure 8-1</a>: Create your free Wolfram ID.</p></figcaption>
</figure>
<p><span epub:type="pagebreak" title="157" id="Page_157"/>Click <b>Create Wolfram ID</b> and then log in. The Wolfram ID itself gives you only browser access, so you need to get an AppID to gain query access using Python. Apply for an API at <a href="https://products.wolframalpha.com/api/" class="LinkURL">https://products.wolframalpha.com/api/</a><em> </em>and click<em> </em><b>Get API Access</b> in the bottom left, as shown in <a href="#figure8-2" id="figureanchor8-2">Figure 8-2</a>.</p>
<figure>
<img src="Images/f08002.png" alt="f08002" width="695" height="385"/>
<figcaption><p><a id="figure8-2">Figure 8-2</a>: Apply for an API at WolframAlpha.</p></figcaption>
</figure>
<p>A small dialog should pop up, as shown in <a href="#figure8-3" id="figureanchor8-3">Figure 8-3</a>. </p>
<figure>
<img src="Images/f08003.png" alt="f08003" width="471" height="295"/>
<figcaption><p><a id="figure8-3">Figure 8-3</a>: The Get a New AppID window at WolframAlpha</p></figcaption>
</figure>
<p>Fill in the Application name and Description<em> </em>information, then click <b>Get AppID</b>. For example, you might enter <code class="bold">Virtual assistant</code> as the application name and <code class="bold">Learn to build my own virtual personal assistant in Python</code> in the description field. </p>
<p>After that, your AppID should appear in a pop-up window. You need to click <b>OK</b> to activate the AppID. The key will be a long, unique string of characters to distinguish you from other users, something like <code>HG**************YQ</code> (I’ve blocked out the middle characters). Save your AppID in a safe place; you’ll need it later.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<span epub:type="pagebreak" title="158" id="Page_158"/><h2><span class="NoteHead">Note</span></h2>
<p>	Don’t simply copy and try to use your AppID in Python before clicking the OK button on the pop-up window. Your AppID is not activated unless you click the OK button.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-501560c08-0002">Retrieve Information </h3>
<p class="BodyFirst">Once you have your WolframAlpha API, you can use a Python script to send queries and obtain answers from WolframAlpha. You must first install the third-party <em>wolframalpha</em> module on your computer. Go to your Anaconda prompt (Windows) or a terminal (Mac or Linux) and activate the virtual <em>chatting </em>environment; then run the following at the command line:</p>
<pre><code><b>pip install wolframalpha </b></code></pre>
<p>Follow the instructions to finish the installation.</p>
<p>The <em>wolfram.py</em> script in <a href="#listing8-1" id="listinganchor8-1">Listing 8-1</a> retrieves information from WolframAlpha by using text input. </p>
<pre><code># Import the wolframalpha module
import wolframalpha

# Enter your own WolframAlpha APIkey below
APIkey = "<var>{your WolframAlpha APIkey}</var>" 
wolf = wolframalpha.Client(APIkey)
# Enter your query 
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> inp = input("What do you want to know from WolframAlpha?\n")
# Send your query to WolframAlpha and get a response
<span class="CodeAnnotationHang" aria-label="annotation2">2</span> response = wolf.query(inp)
# Retrieve the text from the response
res = next(response.results).text 
# Print out the response
print(res) </code></pre>
<p class="CodeListingCaption"><a id="listing8-1">Listing 8-1</a>: Python code for the script <em>w</em><em>olfram</em><em>.</em><em>py</em></p>
<p>We first import the <em>wolframalpha</em> module. Enter the API key you retrieved earlier as the value of the <code>APIkey</code> variable. Without it, the script won’t work.</p>
<p>We then create the client with your AppID. At <span class="CodeAnnotation" aria-label="annotation1">1</span>, the script asks the user for a query to send to WolframAlpha, which the user will enter in the IPython console at the lower-right panel of the Spyder IDE. </p>
<p>At <span class="CodeAnnotation" aria-label="annotation2">2</span>, we send the query to WolframAlpha and retrieve the <code>result</code> object, saving it in the variable <code>response</code>. The <code>result</code> object contains a collection of results in a generator object. <em>Generator functions</em> are a convenient shortcut to building iterators, sometimes used to avoid keeping large amounts of data in short-term memory (RAM). You can learn more about generators from authoritative online sources (for example, <a href="https://wiki.python.org/moin/Generators" class="LinkURL">https://wiki.python.org/moin/Generators</a>). This is why we use the built-in function <code>next()</code> to iterate through different answer groups from WolframAlpha in the <code>result</code> object and obtain <span epub:type="pagebreak" title="159" id="Page_159"/>the text part of the answer. For a detailed description of how the querying process works with the <em>wolframalpha</em> module, see <a href="https://pypi.org/project/wolframalpha/" class="LinkURL">https://pypi.org/project/wolframalpha/</a>. Finally, the extracted text is printed out. </p>
<p>Here’s a simple exchange with <em>wolfram.py</em>, with my text input in bold:</p>
<pre><code>What do you want to know from WolframAlpha?
<b>How many states are in the USA?</b>
50 </code></pre>
<p>As you can see, WolframAlpha has given me a correct and succinct answer. </p>
<h3 id="h2-501560c08-0003">Explore Different Areas of Knowledge </h3>
<p class="BodyFirst">WolframAlpha can provide information on a variety of topics, so we’ll put <em>wolfram.py</em> through its paces with questions about weather, general knowledge, science, and math before adding the API to your VPA. </p>
<h4 id="h3-501560c08-0001">Real-Time Information</h4>
<p class="BodyFirst">WolframAlpha provides real-time information, such as the current temperature in your area. Here’s one interaction with the script <em>wolfram.py</em>, with my written input in bold:</p>
<pre><code>What do you want to know from WolframAlpha?
<b>What is the temperature outside right now?</b>
87 °F
(2 hours 21 minutes ago)</code></pre>
<p>The script tells you the temperature in Fahrenheit and the length of time that has passed since the information was obtained. WolframAlpha gets your local information by looking at the location associated with your IP address. If you have an active virtual private network (VPN), your local information will be for the location of your VPN provider.</p>
<p>You can also obtain a weather forecast for a specific day in a certain location like so:</p>
<pre><code>What do you want to know from WolframAlpha?
<b>What is the weather forecast for Chicago in 2 days?</b>
between 70 °F and 74 °F
rain (very early morning) | clear (all day)</code></pre>
<p>You can check other real-time information such as local gas price or US inflation rate:</p>
<pre><code>What do you want to know from WolframAlpha?
<b>What is the current gas price?</b>
$2.548/gal (US dollars per gallon) (Monday, February 8, 2021)</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="160" id="Page_160"/>Try it Out</h2>
<p class="BoxBodyFirst">Use <em>w</em><em>olfram.py</em> to find out the following:</p>
<ul>
<li>The temperature where you live</li>
<li>The population of the state you are in</li>
<li>The gas price in your area</li>
</ul>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h4 id="h3-501560c08-0002">General Questions</h4>
<p class="BodyFirst">You can ask general knowledge questions, such as how many teaspoons are in a cup, how to convert Fahrenheit to Celsius, the regional sales tax rate, a state capital, and so on:</p>
<pre><code>What do you want to know from WolframAlpha?
<b>How many yards are in a mile?</b>
1760 yards

What do you want to know from WolframAlpha?
<b>What's the capital of West Virginia?</b>
Charleston, West Virginia, United States

What do you want to know from WolframAlpha?
<b>What is the calorie expenditure walking an hour at 5 miles per hour?</b>
energy expenditure | 366 Cal (dietary calories)
fat burned | 0.1 lb (pounds)
oxygen consumption | 19.3 gallons
metabolic equivalent | 4.8 metabolic equivalents
(estimates based on CDC standards)

What do you want to know from WolframAlpha?
<b>What is the speed of light?</b>
2.998×10^8 m/s (meters per second)</code></pre>
<p>WolframAlpha has gathered information from various sources such as the CIA’s <em>The World Fact Book</em> and <em>The United States Geological Survey</em>, so it has comprehensive historical data. You can ask questions about events, people, or facts, such as when the vehicle airbag was invented:</p>
<pre><code>What do you want to know from WolframAlpha?
<b>When was the airbag invented</b>
1941</code></pre>
<p>You can even use WolframAlpha as a dictionary by using <em>define</em>, like so:</p>
<pre><code>What do you want to know from WolframAlpha?
<b>Define obliterate</b>
1 | verb | mark for deletion, rub off, or erase
<span epub:type="pagebreak" title="161" id="Page_161"/>2 | verb | make undecipherable or imperceptible by obscuring or concealing
3 | verb | remove completely from recognition or memory
4 | verb | do away with completely, without leaving a trace
5 | adjective | reduced to nothingness
(5 meanings)</code></pre>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Use <em>w</em><em>olfram.py</em> to find out the following:</p>
<ul>
<li>The number of liters in a gallon</li>
<li>The capital of the state you are in now </li>
<li>The meaning of the word <em>diligence</em></li>
<li>The net worth of Bill Gates</li>
<li>The countries that participated in World War I</li>
</ul>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h4 id="h3-501560c08-0003">Math Calculations</h4>
<p class="BodyFirst">WolframAlpha can answer your questions in the fields of mathematics, science, and technology, ranging from elementary math to calculus to differential equations. </p>
<p>For example, if you want to convert 125 to binary, you can use <em>wolfram.py</em> as follows:</p>
<pre><code>What do you want to know from WolframAlpha?
<b>convert 125 to binary</b>
1111101_2</code></pre>
<p>The <code>2</code> at the end of the output indicates that the response is in binary format. Wolfram Alpha can also answer your personal finance questions on topics such as mortgage payments, credit card calculations, and state taxes. For example, to calculate your monthly mortgage payment, you just need to provide three pieces of information—loan amount, interest rate, and loan term—and you’ll get the answer:</p>
<pre><code>What do you want to know from WolframAlpha?
<b>mortgage $150,000 6.5% 30 years</b>
monthly payment | $948</code></pre>
<p>Using the keyword <code>mortgage</code>, you tell the script the loan amount <code>$150,000</code>, the interest rate <code>6.5%</code>, and the term <code>30 years</code>. Know that the formatting of your query doesn’t really matter—you don’t need a comma in the number and you could provide the arguments in any order, and the script should understand.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2><span epub:type="pagebreak" title="162" id="Page_162"/>Try it Out</h2>
<p class="BoxBodyFirst">Use <em>w</em><em>olfram.py</em> to find the following:</p>
<ul>
<li>The monthly mortgage payment if the loan amount is $350,000, the interest rate is 3%, and the term is 15 years</li>
<li>The state sales tax rate where you live</li>
<li>All the prime numbers below 100 </li>
<li>The heaviest metal in the periodic table</li>
</ul>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c08-0002">	Add a Know-It-All Functionality to Your VPA</h2>
<p class="BodyFirst">Our goal here is to add a know-it-all functionality to the VPA you created in <span class="xref" itemid="xref_target_Chapter 7">Chapter 7</span>. We will rely mainly on WolframAlpha to answer your questions, but there are questions WolframAlpha can’t answer. In that case, we’ll search in Wikipedia. If Wikipedia can’t provide an answer either, the VPA will let you know that it doesn’t have an answer.</p>
<p>To make use of the next script, be sure to install the following package with your virtual environment activated:</p>
<pre><code><b>pip install wikipedia </b></code></pre>
<h3 id="h2-501560c08-0004">What WolframAlpha Cannot Answer</h3>
<p class="BodyFirst">Even though WolframAlpha has a vast knowledge base, it doesn’t know the answers to all questions. Wikipedia can provide more answers than Wolfram Alpha in certain areas, especially for general reference questions. For example, if you enter <code class="bold">University of Kentucky</code> as a query in <em>wolfram.py</em>, the script will raise a <code>StopIteration</code> exception. This is because <code>next()</code> cannot find a result in any answer group. </p>
<p>On the other hand, if you run the script <em>wiki.py</em> from <span class="xref" itemid="xref_target_Chapter 5">Chapter 5</span> and enter <code class="bold">University of Kentucky</code> as a query, you’ll get the following output:</p>
<pre><code>The University of Kentucky (UK) is a public university in Lexington,
 Kentucky. Founded in 1865 by John Bryan Bowman as the Agricultural and
 Mechanical College of Kentucky
<var>--snip--</var></code></pre>
<p>Wikipedia can’t answer all your questions, either. For example, if you enter <code class="bold">how many people live outside the earth</code> as a query in <em>wiki.py</em>, the API will raise a <code>PageError</code> exception that causes this version of the script to abruptly end with an error status. </p>
<p>We’ll improve our VPA by writing a script that queries WolframAlpha first and, if no results are found, will query Wikipedia. If you can’t get an answer there, the script will print out the message <code>I am still learning. I <span epub:type="pagebreak" title="163" id="Page_163"/>don't know the answer to your question yet.</code> We’ll handle the errors raised by these external APIs by enclosing the calls in a <code>try</code> block and handling the exceptions in an <code>except</code> block. </p>
<p>Go to the book’s resources page, download <em>know_all.py</em>, and save it in your chapter folder. This script is shown in <a href="#listing8-2" id="listinganchor8-2">Listing 8-2</a>.</p>
<pre><code>import wolframalpha
import wikipedia

# You must put your WolframApha APIkey below
<span class="CodeAnnotationHang" aria-label="annotation1">1</span> APIkey = "{your WolframAlpha appID here}" 
wolf = wolframalpha.Client(APIkey)

while True:
    # Put your question here 
    Inp = input("What do you want to know?\n")
    # Stop the loop if you type in "done"
    if inp == "done":
        break
    # Look for answer in Wolfram Alpha
    res = wolf.query(inp)
    # Use try and except to handle errors
    try:
        print(next(res.results).text)
    except:
    # If no answer, try Wikipedia
        try:
            ans = wikipedia.summary(inp)
            print(ans[0:200])
        except:
        # If still no answer
            print('I am still learning. I don\'t know the answer to your question yet')</code></pre>
<p class="CodeListingCaption"><a id="listing8-2">Listing 8-2</a>: Python code for the script <em>k</em><em>now_all</em><em>.py</em></p>
<p>We first import the two modules <em>wolframalpha</em> and <em>wikipedia</em>. At <span class="CodeAnnotation" aria-label="annotation1">1</span>, you should put your own WolframAlpha AppID in the script for it to work. We then put the script in an infinite <code>while</code> loop. At each iteration, it takes your text input as a query. If you key in the word <code>done</code>, the <code>while</code> loop stops and the script ends.</p>
<p>The script sends the query first to WolframAlpha. We use <code>try</code> and <code>except</code> to handle any errors that the API from WolframAlpha might raise. If Wolfram Alpha doesn’t return an answer, the script directs the same query to Wikipedia. If there’s no answer found from Wikipedia, the script prints <code>I am still learning. I don't know the answer to your question yet.</code></p>
<p>Now, if you run the script <em>know_all.py</em> and enter <code class="bold">University of Kentucky</code> and <code class="bold">How many people live outside the earth?</code> as the two queries, you’ll get the following output:</p>
<pre><code>What do you want to know?
<b>University of Kentucky</b>
The University of Kentucky (UK) is a public university in Lexington, Kentucky. <span epub:type="pagebreak" title="164" id="Page_164"/>Founded in 1865 by John Bryan Bowman as the Agricultural and Mechanical College of Kentucky, the university is one of the

What do you want to know?
<b>How many people live outside the earth?</b>

I am still learning. I don't know the answer to your question yet

What do you want to know?
<b>done</b></code></pre>
<p>As you can see, the script never crashes, and it provides a result for the first query but not the second.</p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Try asking three questions by using the two scripts <em>wiki.py</em> and <em>w</em><em>olfram.py</em>: one with an answer in WolframAlpha, one with an answer in Wikipedia but not WolframAlpha, and one with an answer in neither. Run the script <em>k</em><em>now_all</em><em>.py</em>, enter the three questions as queries, and see what happens.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h3 id="h2-501560c08-0005">Create the myknowall Module</h3>
<p class="BodyFirst">Now we’ll create the <code>know_all()</code> function that will use the script <em>myknowall.py</em>, but<em> </em>this time will take voice commands instead of written commands and will both print and speak the response instead of just printing out messages.</p>
<p>Download <em>myknowall.py</em> from the book’s resources and save it in your local package folder <em>/mpt/mptpkg/</em>. Since we’ll use this as one of the local modules in the local package, be sure to save it in the local package folder instead of the chapter folder. The script will define the function <code>know_all()</code> that your VPA will use, shown in an abbreviated format in <a href="#listing8-3" id="listinganchor8-3">Listing 8-3</a>. </p>
<pre><code><var>--snip--</var>
# Import the print_say() function from the local package
from mptpkg import print_say
<var>--snip--</var>
def know_all(v_inp):
    #look for answer in Wolfram Alpha
    res = wolf.query(v_inp)
<var>--snip--</var>
            print_say('I am still learning. I don\'t know the answer to your question yet')</code></pre>
<p class="CodeListingCaption"><a id="listing8-3">Listing 8-3</a>: The script for the local <em>myk</em><em>nowall</em> module </p>
<p>The content of <code>know_all()</code> is similar to the script <em>know_all.py</em> except that the input and output include voice. </p>
<h3 id="h2-501560c08-0006"><span epub:type="pagebreak" title="165" id="Page_165"/>A VPA That Can Answer (Almost) Any Question for You</h3>
<p class="BodyFirst">Now you’ll make your VPA capable of answering (almost) any question, using the <em>know_all.py</em> module. </p>
<p>First, open the script <em>__init__.py</em> in the package directory <em>/mpt/mptpkg/</em> on your computer. Add the following line of code at the end of the file and save the change:</p>
<pre><code><b>from .myknowall import know_all</b></code></pre>
<p>This code imports <code>know_all()</code> from the <em>myknowall</em> module to the local package so you can later import it at the package level.</p>
<p>Next, open <em>vpa.py</em> from the previous chapter, add the following to the script, and save it as <em>vpa.py</em> in this chapter’s folder. You’ll need to delete the original <code>else</code> branch in the inner <code>while</code> loop and replace it with the following:</p>
<pre><code># Import the know_all() function from the local package
from mptpkg import know_all
<var>--snip--</var>
        # Activate the Know-It-All functionality
        else:
            if len(inp)&gt;6:
                know_all(inp)
            continue        
<var>--snip--</var></code></pre>
<p>We import <code>know_all()</code> from the local <em>mptpkg</em> package and replace the original <code>else</code> branch. In <em>vpa.py</em> in <span class="xref" itemid="xref_target_Chapter 7">Chapter 7</span>, if none of the four functionalities is activated, the script goes to the next iteration. In the new script <em>vpa.py</em>, if none of the four functionalities is activated, the know-it-all functionality is activated, and by default the script searches for answers in WolframAlpha and Wikipedia.</p>
<p>Note here that we’ve added a condition <code>if len(inp)&gt;6</code> before we call <code>know_all()</code>. Without the condition, if you don’t say anything for a long period of time, the script treats the input as an empty string. As a result, you’ll keep hearing the answer <code>I am still learning. I don't know the answer to your question yet.</code> With the condition, if you don’t say anything, the script goes to the next iteration without doing anything because the length of an empty string is 0.</p>
<p>Run <em>vpa.py</em> and wake it up by saying, “Hello Python.” After that, you can ask any question you want. Here’s the output from an example interaction with the script, with my voice input in bold:</p>
<pre><code><b>hello Python</b>
how may I help you?
<b>who was us president in 1981</b>
you just said who was us president in 1981
Jimmy Carter (from January 20, 1977 to January 20, 1981)
Ronald Reagan (from January 20, 1981 to January 20, 1989)

how may I help you?
<b>coronavirus</b>
<span epub:type="pagebreak" title="166" id="Page_166"/>you just said coronavirus
Coronaviruses are a group of related RNA viruses that cause diseases in mammals and birds. In humans, these viruses cause respiratory tract infections that can range from mild to lethal. Mild illness
<var>--snip--</var></code></pre>
<p>As you can see, after activating the VPA, I first asked who the US president was in 1981. The answer includes two presidents, because the transition of power was in January 1981. After that, I asked about the coronavirus. The VPA provided a detailed answer to the question. </p>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="note">
<h2><span class="NoteHead">Note</span></h2>
<p>	The condition <code>if len(inp)&gt;6</code> means your query must contain at least seven characters. You can change the cutoff value in the condition from 6 to a smaller number such as 5 or 3 if you want <code>know_all()</code> to be called even if you send a short query such as “wolf” or “Python.”</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<aside epub:type="sidebar">
<div class="top hr"><hr/></div>
<section class="box">
<h2>Try it Out</h2>
<p class="BoxBodyFirst">Run <em>vpa.py</em>, wake it up, and ask via voice the same three questions you used in the preceding <span class="xref" itemid="xref_target_Try It Out on page 164">Try It Out on page 164</span>, and see what happens.</p>
<div class="bottom hr"><hr/></div>
</section>
</aside>
<h2 id="h1-501560c08-0003">	Summary</h2>
<p class="BodyFirst">In this chapter, you upgraded the VPA from <span class="xref" itemid="xref_target_Chapter 7">Chapter 7</span> so you can ask it just about anything—including for up-to-date information about weather, gas prices, and travel conditions, as well as nearly unlimited facts about science, math, history, and society.</p>
<p>You learned to apply for an API and gain access to the vast knowledge base in the computational engine WolframAlpha, and you can use Wikipedia as a backup when WolframAlpha can’t provide an answer. If neither site can answer, your VPA tells you as much. With that, your VPA is complete and capable of answering almost any question for you. Using APIs like this is an incredibly powerful skill.</p>
<p>In the next couple of chapters, you’ll learn how to create your own voice-controlled graphical games that can speak to you.</p>
</section>
</div></body></html>