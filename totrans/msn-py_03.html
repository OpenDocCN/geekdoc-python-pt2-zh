<html><head></head><body>
<h2 class="h2" id="ch03"><span epub:type="pagebreak" id="page_47"/><strong><span class="blue"><span class="big">3</span></span><br/>REPEAT AFTER ME</strong></h2>
<div class="image1"><img src="../images/common01.jpg" alt="image"/></div>
<p class="noindent">Everyone talks about the heroism and glamour of space travel, but some of it is routine, repetitive work. When you’re cleaning, gardening in the space station greenhouse, or exercising to keep your strength up, you’re following detailed plans designed to keep the team safe and the space station operating. Luckily, robots take care of some of the drudgery, and they never complain about having to repeat themselves.</p>
<p class="indent">Whether you’re programming robots or building games, the loop is one of your basic programming building blocks. A <em>loop</em> is a section of a program that repeats: sometimes it repeats a set number of times, and sometimes it continues until a particular event takes place. Sometimes, you’ll even set a loop to keep going forever. In this chapter, you’ll learn how to use loops to <span epub:type="pagebreak" id="page_48"/>repeat instructions a certain number of times in your programs. You’ll use loops, along with your knowledge of lists, to display a map and draw a 3D room image.</p>
<h3 class="h3" id="lev50"><strong>DISPLAYING MAPS WITH LOOPS</strong></h3>
<p class="noindent">In the <em>Escape</em> game, we’ll use loops extensively. Often, we’ll use them to pull information from a list and perform some action on it.</p>
<p class="indent">Let’s start by using loops to display a text map.</p>
<h4 class="h4" id="lev51"><strong>MAKING THE ROOM MAP</strong></h4>
<p class="noindent">We’ll make a new map for the example in this chapter and use <span class="literal">1</span> to represent a wall and <span class="literal">0</span> to represent a floor space. Our room has a wall all the way around the edge and a pillar near the middle. The pillar is the same as a section of wall, so it’s also marked with a 1. I’ve chosen its position so it looks good when we draw a 3D room later in this chapter. The room doesn’t have any other objects, so we won’t use any other numbers at this time.</p>
<p class="indent">In IDLE, open a new Python program, and enter the code in <a href="ch03.xhtml#ch03list1">Listing 3-1</a>, saving it as <em>listing3-1.py</em>:</p>
<p class="margin"><em>listing3-1.py</em></p>
<p class="programs">room_map = [ [1, 1, 1, 1, 1],<br/>             [1, 0, 0, 0, 1],<br/>             [1, 0, 1, 0, 1],<br/>             [1, 0, 0, 0, 1],<br/>             [1, 0, 0, 0, 1],<br/>             [1, 0, 0, 0, 1],<br/>             [1, 1, 1, 1, 1]<br/>           ]<br/><span class="purple">print</span>(room_map)</p>
<p class="listing" id="ch03list1"><em>Listing 3-1: Adding the room map data</em></p>
<p class="indent">This program creates a list called <span class="literal">room_map</span> that contains seven other lists. Each list starts and ends with square brackets and is separated from the next list with a comma. As you learned in <a href="ch02.xhtml#ch02">Chapter 2</a>, the last list doesn’t need a comma after it. Each list represents a row of the map. Run the program by clicking <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong> and you should see the following in the shell window:</p>
<p class="programs"><span class="blue">[[1, 1, 1, 1, 1], [1, 0, 0, 0, 1], [1, 0, 1, 0, 1], [1, 0, 0, 0, 1], [1, 0, 0, 0, 1], [1, 0, 0,<br/>0, 1], [1, 1, 1, 1, 1]]</span></p>
<p class="indent">As you saw in <a href="ch02.xhtml#ch02">Chapter 2</a>, printing the map list shows you all the rows run together, which isn’t a useful way to view a map. We’ll use a loop to display the map in a way that is much easier to read.</p>
<h4 class="h4" id="lev52"><span epub:type="pagebreak" id="page_49"/><strong>DISPLAYING THE MAP WITH A LOOP</strong></h4>
<p class="noindent">To display the map in rows and columns, delete the last line of your program and add the two new lines shown in <a href="ch03.xhtml#ch03list2">Listing 3-2</a>. As before, don’t type in the grayed-out lines—just use them to find your place in the program. Save your program as <em>listing3-2.py</em>.</p>
<p class="margin"><em>listing3-2.py</em></p>
<p class="programs">   <span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>             <span class="gray">[1, 0, 0, 0, 1],</span><br/>             <span class="gray">[1, 1, 1, 1, 1]</span><br/>           <span class="gray">]</span><br/><span class="ent">➊</span> <span class="orange">for</span> y <span class="orange">in</span> <span class="purple">range</span>(7):<br/><span class="ent">➋</span>     <span class="purple">print</span>(room_map[y])</p>
<p class="listing" id="ch03list2"><em>Listing 3-2: Using a loop to display the room map</em></p>
<div class="note">
<p class="notet"><strong><span class="notes">RED ALERT</span></strong></p>
<p class="notep"><em>Remember to place a colon at the end of the first new line! The program won’t work without it. The second new line should be indented with four spaces to show Python which instructions you want to repeat. If you add the colon at the end of the</em> <span class="codeitalic">for</span> <em>line, the spaces are added automatically for you when you press <small>ENTER</small> to go to the next line.</em></p>
</div>
<p class="indent">When you run the program again, you should see the following in the shell:</p>
<p class="programs"><span class="blue">[1, 1, 1, 1, 1]</span><br/><span class="blue">[1, 0, 0, 0, 1]</span><br/><span class="blue">[1, 0, 1, 0, 1]</span><br/><span class="blue">[1, 0, 0, 0, 1]</span><br/><span class="blue">[1, 0, 0, 0, 1]</span><br/><span class="blue">[1, 0, 0, 0, 1]</span><br/><span class="blue">[1, 1, 1, 1, 1]</span></p>
<p class="indent">That’s a more useful way to view a map. Now you can easily see that a wall (represented by <span class="literal">1</span>s) runs all around the edge. So how does the code work? The <span class="literal">for</span> command <span class="ent">➊</span> is the engine here. It’s a loop command that tells Python to repeat a piece of code a certain number of times. <a href="ch03.xhtml#ch03list2">Listing 3-2</a> tells Python to repeat the <span class="literal">print()</span> instruction for each item in our <span class="literal">room_map</span> list <span class="ent">➋</span>. Each item in <span class="literal">room_map</span> is a list containing one row of the map, so printing them separately displays our map one row at a time, resulting in this organized display.</p>
<p class="indent">Let’s break down the code in more detail. We use the <span class="literal">range()</span> function to create a sequence of numbers. With <span class="literal">range(7)</span>, we tell Python to generate a sequence of numbers up to, but not including, 7. Why does it leave out the last number? That’s just how the <span class="literal">range()</span> function works! If we give the <span class="literal">range()</span> function just one number, Python assumes we want to start counting at <span class="literal">0</span>. So <span class="literal">range(7)</span> creates the sequence of numbers 0, 1, 2, 3, 4, 5, and 6.</p>
<p class="indent"><span epub:type="pagebreak" id="page_50"/>Each time the code repeats, the variable in the <span class="literal">for</span> command takes the next item from the sequence. In this case, the <span class="literal">y</span> variable takes on the values <span class="literal">0</span>, <span class="literal">1</span>, <span class="literal">2</span>, <span class="literal">3</span>, <span class="literal">4</span>, <span class="literal">5</span>, and <span class="literal">6</span> in turn. This matches the index numbers in <span class="literal">room_map</span> perfectly.</p>
<p class="indent">I’ve chosen <span class="literal">y</span> as the variable name because we’re using it to represent which map row we want to display, and the row on the map is referred to as the y-coordinate.</p>
<p class="indent">The <span class="literal">print(room_map[y])</span> command <span class="ent">➋</span> is indented four spaces, telling Python that this is the chunk of code we want our <span class="literal">for</span> loop <span class="ent">➊</span> to repeat.</p>
<p class="indent">The first time through the loop, <span class="literal">y</span> has a value of <span class="literal">0</span>, so <span class="literal">print(room_map[y])</span> prints the first item in <span class="literal">room_map</span>, which is a list containing the data for the first row of the map. The second time through, <span class="literal">y</span> has a value of <span class="literal">1</span>, so <span class="literal">print(room_map[y])</span> prints the second row. The code repeats until it’s printed all seven lists inside <span class="literal">room_map</span>.</p>
<div class="sidebar">
<p class="sidebart" id="ch03sb1"><strong>TRAINING MISSION #1</strong></p>
<p class="spara">In an emergency situation on the space station, you might need to issue a distress signal. Write a simple program to print the word <em>Mayday!</em> three times only, using a loop.</p>
<p class="spara1">If you’re stuck, start with <a href="ch03.xhtml#ch03list2">Listing 3-2</a>, used for printing the map. You just need to change what the program prints and how many times it loops the print code.</p>
</div>
<h3 class="h3" id="lev53"><strong>LOOP THE LOOP</strong></h3>
<p class="noindent">Our map output is getting better, but it still has a couple of limitations. One is that the commas and brackets make it look cluttered. The other limitation is that we can’t do anything with the individual wall panels or spaces in the room. We’ll need to be able to handle whatever is at each position in the room separately, so we can display its image correctly. To do that, we’ll need to use more loops.</p>
<h4 class="h4" id="lev54"><strong>NESTING LOOPS TO GET ROOM COORDINATES</strong></h4>
<p class="noindent">The <em>listing3-2.py</em> program uses a loop to extract each row of the map. Now we need to use another loop to examine each position in the row, so we can access the objects there individually. Doing so will enable us to have full control over how the items are displayed.</p>
<p class="indent">You just saw that we can repeat a piece of code inside a loop. We can also put a loop inside another loop, which is known as a <em>nested loop</em>. To see how this works, we’ll first use this technique to print the coordinates for each space in the room. Edit your code to match <a href="ch03.xhtml#ch03list3">Listing 3-3</a>:</p>
<p class="margin"><em>listing3-3.py</em></p>
<p class="programs">   <span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>             <span class="gray">[1, 0, 0, 0, 1],</span><br/>             <span class="gray">[1, 1, 1, 1, 1]</span><br/>           <span class="gray">]</span><br/><span epub:type="pagebreak" id="page_51"/><span class="ent">➊</span> <span class="orange">for</span> y <span class="orange">in</span> <span class="purple">range</span>(7):<br/><span class="ent">➋</span>     <span class="orange">for</span> x <span class="orange">in</span> <span class="purple">range</span>(5):<br/><span class="ent">➌</span>         <span class="purple">print</span>(<span class="green">"y="</span>, y, <span class="green">"x="</span>, x)<br/><span class="ent">➍</span>     <span class="purple">print</span>()</p>
<p class="listing" id="ch03list3"><em>Listing 3-3: Printing the coordinates</em></p>
<div class="note">
<p class="notet"><strong><span class="notes">RED ALERT</span></strong></p>
<p class="notep"><em>As every astronaut knows, space can be dangerous. Spaces can, too. If the indentation in a loop is wrong, the program won’t work correctly. Indent the first</em> <span class="codeitalic">print()</span> <em>command</em> <span class="ent">➌</span> <em>with eight spaces so it’s part of the inner</em> <span class="codeitalic">x</span> <em>loop. Make sure the final</em> <span class="codeitalic">print()</span> <em>instruction</em> <span class="ent">➍</span> <em>is lined up with the second</em> <span class="codeitalic">for</span> <em>command</em> <span class="ent">➋</span> <em>(with four spaces of indentation) so it stays in the outer loop. When you start a new line, Python indents it the same as the previous one, but you can delete the indentation when you no longer need it.</em></p>
</div>
<p class="indent">Save your program as <em>listing3-3.py</em> and run the program by clicking <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong>. You’ll see the following output:</p>
<p class="programs"><span class="blue">y= 0 x= 0</span><br/><span class="blue">y= 0 x= 1</span><br/><span class="blue">y= 0 x= 2</span><br/><span class="blue">y= 0 x= 3</span><br/><span class="blue">y= 0 x= 4</span><br/><br/><span class="blue">y= 1 x= 0</span><br/><span class="blue">y= 1 x= 1</span><br/><span class="blue">y= 1 x= 2</span><br/><span class="blue">y= 1 x= 3</span><br/><span class="blue">y= 1 x= 4</span><br/><br/><span class="blue">y= 2 x= 0</span><br/><span class="blue">y= 2 x= 1</span><br/><span class="blue">y= 2 x= 2</span><br/>--<span class="codeitalic1">snip</span>--</p>
<p class="indent">The output continues and ends on <span class="literal">y= 6 x= 4</span>.</p>
<p class="indent">We’ve set up the <span class="literal">y</span> loop the same as before so it repeats seven times <span class="ent">➊</span>, once for each number from <span class="literal">0</span> to <span class="literal">6</span>, putting that value into the <span class="literal">y</span> variable. This is what is different in our program this time: inside the <span class="literal">y</span> loop, we start a new <span class="literal">for</span> loop that uses the <span class="literal">x</span> variable and gives it a <span class="literal">range</span> of five values, from <span class="literal">0</span> to <span class="literal">4</span> <span class="ent">➋</span>. The first time through the <span class="literal">y</span> loop, <span class="literal">y</span> is <span class="literal">0</span>, and <span class="literal">x</span> then takes the values <span class="literal">0</span>, <span class="literal">1</span>, <span class="literal">2</span>, <span class="literal">3</span>, and <span class="literal">4</span> in turn while <span class="literal">y</span> is <span class="literal">0</span>. The second time through the <span class="literal">y</span> loop, <span class="literal">y</span> is <span class="literal">1</span>. We start a new <span class="literal">x</span> loop, and it takes the values <span class="literal">0</span>, <span class="literal">1</span>, <span class="literal">2</span>, <span class="literal">3</span>, and <span class="literal">4</span> again while <span class="literal">y</span> is <span class="literal">1</span>. This looping keeps going until <span class="literal">y</span> is <span class="literal">6</span> and <span class="literal">x</span> is <span class="literal">4</span>.</p>
<p class="indent">You can see how the loops work when you look at the program’s output: inside the <span class="literal">x</span> loop, we print the values for <span class="literal">y</span> and <span class="literal">x</span> each time the <span class="literal">x</span> loop repeats <span class="ent">➌</span>. When the <span class="literal">x</span> loop finishes, we print a blank line <span class="ent">➍</span> before the next repeat of the <span class="literal">y</span> loop. We do this by leaving the <span class="literal">print()</span> function’s parentheses empty. The blank line breaks up where the <span class="literal">y</span> loop repeats, and the <span epub:type="pagebreak" id="page_52"/>output shows you what the values of <span class="literal">x</span> and <span class="literal">y</span> are each time through the inner <span class="literal">x</span> loop. As you can see, this program outputs the y- and x-coordinates of every position in the room.</p>
<div class="sidebar1">
<p class="sidebart"><strong>TIP</strong></p>
<p class="spara">We’ve used the variable names <span class="literal">y</span> and <span class="literal">x</span> in our loops, but those variable names don’t affect the way the program runs. You could call them <span class="literal">sausages</span> and <span class="literal">eggs</span>, and the program would work just the same. It wouldn’t be as easy to understand, though. Because we’re getting x- and y-coordinates, it makes sense to use <span class="literal">x</span> and <span class="literal">y</span> for our variable names.</p>
</div>
<h4 class="h4" id="lev55"><strong>CLEANING UP THE MAP</strong></h4>
<p class="noindent">We’ll use the coordinates in the loops to print our map without any brackets and commas. Edit your program to change the inner nested loop as shown in <a href="ch03.xhtml#ch03list4">Listing 3-4</a>:</p>
<p class="margin"><em>listing3-4.py</em></p>
<p class="programs"><span class="gray">--<span class="codeitalic1">snip</span>--</span><br/><span class="gray">for y in range(7):</span><br/>    <span class="gray">for x in range(5):</span><br/>        <span class="purple">print</span>(room_map[y][x], end=<span class="green">""</span>)<br/>    <span class="gray">print()</span></p>
<p class="listing" id="ch03list4"><em>Listing 3-4: Tidying up the map display</em></p>
<p class="indent">Save your program as <em>listing3-4.py</em> and run the program by clicking <strong>Run</strong> <span class="ent">▸</span> <strong>Run Module</strong>. You should see the following in the shell:</p>
<p class="programs"><span class="blue">11111</span><br/><span class="blue">10001</span><br/><span class="blue">10101</span><br/><span class="blue">10001</span><br/><span class="blue">10001</span><br/><span class="blue">10001</span><br/><span class="blue">11111</span></p>
<p class="indent">That map is much cleaner and easier to understand. It works by going through the coordinates in the same way the program in <a href="ch03.xhtml#ch03list3">Listing 3-3</a> did. It takes each row in turn using the <span class="literal">y</span> loop, and then uses the <span class="literal">x</span> loop to get each position in that row. This time, instead of printing the coordinates, we look at what is in the <span class="literal">room_map</span> at each position, and print that. As you learned in <a href="ch02.xhtml#ch02">Chapter 2</a>, you can pull any item out of the map using coordinates in the form <span class="literal">room_map[y coordinate][x coordinate]</span>.</p>
<p class="indent">The way we’ve formatted the output means the map resembles the room: we put all the numbers from one row together, and only start a new line on the screen when we start a new row of the map (a new repeat of the <span class="literal">y</span> loop).</p>
<p class="indent"><span epub:type="pagebreak" id="page_53"/>The <span class="literal">print()</span> instruction inside the <span class="literal">x</span> loop finishes with <span class="literal">end=""</span> (with no space between the quote marks) to stop it from starting a new line after each number. Otherwise, by default, the <span class="literal">print()</span> function would end each piece of output by adding a code that starts a new line. But instead, we tell it to put nothing (<span class="literal">""</span>) at the end. As a result, all the items from one complete run of the <span class="literal">x</span> loop (from <span class="literal">0</span> to <span class="literal">4</span>) appear on the same line.</p>
<p class="indent">After each row is printed, we use an empty <span class="literal">print()</span> command to start a new line. Because we indent this command with only four spaces, it belongs to the <span class="literal">y</span> loop and is not part of the code that repeats in the <span class="literal">x</span> loop. That means it runs only once each time through the <span class="literal">y</span> loop, after the <span class="literal">x</span> loop has finished printing a row of numbers.</p>
<div class="sidebar">
<p class="sidebart" id="ch03sb2"><strong>TRAINING MISSION #2</strong></p>
<p class="spara">The final <span class="literal">print()</span> command is indented using four spaces. See what happens when you indent it eight spaces, and then see what happens if you don’t indent it at all. In each case, record how many times it runs and how the indentation changes the output.</p>
</div>
<h3 class="h3" id="lev56"><strong>DISPLAYING A 3D ROOM IMAGE</strong></h3>
<p class="noindent">You now know enough about maps to display a 3D room image. In <a href="ch01.xhtml#ch01">Chapter 1</a>, you learned how to use Pygame Zero to place images on the screen. Let’s combine that knowledge with your newfound skills in getting data from the <span class="literal">room_map</span>, so we can display our map with images instead of <span class="literal">0</span>s and <span class="literal">1</span>s.</p>
<p class="indent">Click <strong>File</strong> <span class="ent">▸</span> <strong>New File</strong> to start a new file in Python, and then enter the code in <a href="ch03.xhtml#ch03list5">Listing 3-5</a>. You can copy the <span class="literal">room_map</span> data from your most recent program for this chapter.</p>
<p class="margin"><em>listing3-5.py</em></p>
<p class="programs">   room_map = [ [1, 1, 1, 1, 1],<br/>                [1, 0, 0, 0, 1],<br/>                [1, 0, 1, 0, 1],<br/>                [1, 0, 0, 0, 1],<br/>                [1, 0, 0, 0, 1],<br/>                [1, 0, 0, 0, 1],<br/>                [1, 1, 1, 1, 1]<br/>              ]<br/><br/><span class="ent">➊</span> WIDTH = 800 <span class="red"># window size</span><br/><span class="ent">➋</span> HEIGHT = 800<br/>   top_left_x = 100<br/>   top_left_y = 150<br/><br/><span class="ent">➌</span> DEMO_OBJECTS = [images.floor, images.pillar]<br/><br/>   room_height = 7<br/>   room_width = 5<br/><br/><span epub:type="pagebreak" id="page_54"/><span class="ent">➍</span> <span class="orange">def</span> <span class="blue">draw</span>():<br/>       <span class="orange">for</span> y <span class="orange">in</span> <span class="purple">range</span>(room_height):<br/>           <span class="orange">for</span> x <span class="orange">in</span> <span class="purple">range</span>(room_width):<br/><span class="ent">➎</span>             image_to_draw = DEMO_OBJECTS[room_map[y][x]]<br/><span class="ent">➏</span>             screen.blit(image_to_draw,<br/>                     (top_left_x + (x*30),<br/>                     top_left_y + (y*30) - image_to_draw.get_height()))</p>
<p class="listing" id="ch03list5"><em>Listing 3-5: Code for displaying the room in 3D</em></p>
<p class="indent">Save the program as <em>listing3-5.py</em>. You need to save it in your <em>escape</em> folder, because the program will use the files inside the <em>images</em> folder stored there. Don’t save your file <em>inside</em> the <em>images</em> folder: your file should be alongside it instead. If you haven’t downloaded the <em>Escape</em> game files yet, see “<a href="intro.xhtml#lev8">Downloading the Game Files</a>” on <a href="intro.xhtml#page_7">page 7</a> for download instructions.</p>
<p class="indent">The <em>listing3-5.py</em> program uses Pygame Zero, so you need to go to the command line and enter the instruction <span class="codestrong">pgzrun listing3-5.py</span> to run the program. See “<a href="intro.xhtml#lev12">Running the Game</a>” on <a href="intro.xhtml#page_9">page 9</a> for advice on running programs that use Pygame Zero, including the final <em>Escape</em> game.</p>
<p class="indent">The <em>listing3-5.py</em> program uses the <em>Escape</em> game’s image files to create an image of a room. <a href="ch03.xhtml#ch03fig1">Figure 3-1</a> shows the room with its single pillar. The <em>Escape</em> game uses a simplified 3D perspective where we can see the front and top surfaces of an object. Objects at the front and back of the room are drawn at the same size.</p>
<p class="indent">When you created the spacewalk simulator in <a href="ch01.xhtml#ch01">Chapter 1</a>, you saw how the order in which objects are drawn determines which ones are in front of the others. In the <em>Escape</em> game and <a href="ch03.xhtml#ch03list5">Listing 3-5</a>, the objects are drawn from the back of the room to the front, enabling us to create the 3D effect. Objects nearer to the viewer (sitting at their computer) appear to be in front of those at the back of the room.</p>
<div class="image"><a id="ch03fig1"/><img src="../images/fig3-1.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 3-1: Your first 3D room (left) and the same room with the parts labeled (right)</em></p>
<h3 class="h3" id="lev57"><span epub:type="pagebreak" id="page_55"/><strong>UNDERSTANDING HOW THE ROOM IS DRAWN</strong></h3>
<p class="noindent">Now let’s look at how the <em>listing3-5.py</em> program works. Much of the program will be familiar to you from <a href="ch01.xhtml#ch01">Chapters 1</a> and <a href="ch02.xhtml#ch02">2</a>. The <span class="literal">WIDTH</span> <span class="ent">➊</span> and <span class="literal">HEIGHT</span> <span class="ent">➋</span> variables hold the size of the window, and we use the <span class="literal">draw()</span> function to tell Pygame Zero what to draw onscreen <span class="ent">➍</span>. The <span class="literal">y</span> and <span class="literal">x</span> loops come from <a href="ch03.xhtml#ch03list4">Listing 3-4</a> earlier in this chapter and give us coordinates for each space in the room.</p>
<p class="indent">Instead of using numbers in the <span class="literal">range()</span> functions to tell Python how many times to repeat our <span class="literal">y</span> and <span class="literal">x</span> loops, we’re using the new variables <span class="literal">room_height</span> and <span class="literal">room_width</span>. These variables store the size of our room map and tell Python how many times to repeat the loops. For example, if we changed the <span class="literal">room_height</span> variable to 10, the <span class="literal">y</span> loop would repeat 10 times and work through 10 rows of the map. The <span class="literal">room_width</span> variable controls how many times the <span class="literal">x</span> loop repeats in the same way, so we can display wider rooms.</p>
<div class="note">
<p class="notet"><strong><span class="notes">RED ALERT</span></strong></p>
<p class="notep"><em>If you use room widths and heights that are bigger than the actual</em> <span class="codeitalic">room_map</span> <em>data, you’ll cause an error.</em></p>
</div>
<p class="indent">The <em>listing3-5.py</em> program uses two images from the <em>images</em> folder: a floor tile (with the filename <em>floor.png</em>) and a wall pillar (called <em>pillar.png</em>), as shown in <a href="ch03.xhtml#ch03fig2">Figure 3-2</a>. A <em>PNG (Portable Network Graphics)</em> is a type of image file that Pygame Zero can use. PNG enables parts of the image to be see-through, which is important for our 3D game perspective. Otherwise, we wouldn’t be able to see the background scenery through the gaps in a plant, for example, and the astronaut would look like they had a square halo around them.</p>
<div class="image"><a id="ch03fig2"/><img src="../images/fig3-2.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 3-2: The images used to make your first 3D room</em></p>
<p class="indent">Inside the <span class="literal">draw()</span> function <span class="ent">➍</span>, we use <span class="literal">y</span> and <span class="literal">x</span> loops to look at each position in the room map in turn. As you saw earlier, we can find the number at each position in the map by accessing <span class="literal">room_map</span><span class="literal">[y][x]</span>. In this map, that number will be either <span class="literal">1</span> for a wall pillar or <span class="literal">0</span> for an empty floor space. Instead of printing the number onscreen, as we did before, we use the number to look up an image of the item in the <span class="literal">DEMO_OBJECTS</span> list <span class="ent">➎</span>. That list contains our two images <span class="ent">➌</span>: the floor tile is at index position <span class="literal">0</span>, and the wall pillar is at index position <span class="literal">1</span>. If the <span class="literal">room_map</span> contains a <span class="literal">1</span> at the position we’re looking at, for example, we’ll take the item at list index <span class="literal">1</span> in the <span class="literal">DEMO_OBJECTS</span> list, which is the wall pillar image. We store that image in the variable <span class="literal">image_to_draw</span> <span class="ent">➎</span>.</p>
<p class="indent">We then use <span class="literal">screen.blit()</span> to draw this image onscreen, giving it the <span class="literal">x</span> and <span class="literal">y</span> coordinate of the pixel on the screen where we want to draw it <span class="ent">➏</span>. This instruction extends over three lines to make it easier to read. The amount of indentation on the second and third lines doesn’t matter, because these lines are surrounded by the <span class="literal">screen.blit()</span> parentheses.</p>
<h3 class="h3" id="lev58"><span epub:type="pagebreak" id="page_56"/><strong>WORKING OUT WHERE TO DRAW EACH ITEM</strong></h3>
<p class="noindent">To figure out where to draw each image that makes up the room, we need to do a calculation at <span class="ent">➏</span>. We’ll look at how that calculation works, but before we do, I’ll explain how the space station was designed. All the images are designed to fit a grid. The units we use for measuring images on a computer are called <em>pixels</em> and are the size of the smallest dot you can see on your screen. We’ll call each square of the grid a <em>tile</em>. Each tile is 30 pixels across the screen and 30 pixels down the screen. It’s the same size as one floor tile. We position objects in terms of tiles, so a chair might be 4 tiles down and 4 tiles across, measured from the top-left corner.</p>
<p class="indent"><a href="ch03.xhtml#ch03fig3">Figure 3-3</a> shows the room we’ve just created with a grid laid on top. Each floor tile and pillar is one tile wide. The pillar is tall, so it covers three tile spaces: the front surface of the wall pillar is two tiles tall, and the top surface of the pillar covers another tile space.</p>
<div class="image"><a id="ch03fig3"/><img src="../images/fig3-3.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 3-3: The tile grid overlaid on your first room</em></p>
<p class="indent">The <span class="literal">top_left_x</span> and <span class="literal">top_left_y</span> variables store the coordinates at which we want to start drawing the first image of the room in the window. We never change these variables in this chapter. I’ve chosen to start drawing where <span class="literal">x</span> is 100 and <span class="literal">y</span> is 150 so we have a bit of a border around the room image.</p>
<p class="indent">To work out where to draw a piece of wall or floor, we need to convert our map positions (which range from <span class="literal">0</span> to <span class="literal">4</span> in the <span class="literal">x</span> direction, for example) into pixel positions in the window.</p>
<p class="indent">Each tile space is 30 pixels square, so we multiply the <span class="literal">x</span> loop number by <span class="literal">30</span> and add it to the <span class="literal">top_left_x</span> position to get the x-coordinate for the image. In Python, the <span class="literal">*</span> symbol is for multiplication. The <span class="literal">top_left_x</span> value is <span class="literal">100</span>, so the first image is drawn at <span class="literal">100 + (0 * 30)</span>, which is <span class="literal">100</span>. The second image is drawn at <span class="literal">100 + (1 * 30)</span>, which is <span class="literal">130</span>, one tile position to the right of the first. The third image is drawn at <span class="literal">100 + (2 * 30)</span>, which is <span class="literal">160</span>. These positions ensure that the images sit perfectly side by side.</p>
<p class="indent">The <em>y</em> position is calculated in a similar way. We use <span class="literal">top_left_y</span> as the starting position vertically and add <span class="literal">y * 30</span> to it to make the images join together precisely. The difference is that we subtract the height of the image we’re drawing, so we ensure that the images align at the same point at the bottom. As a result, tall objects can rise out of a tile space and obscure any scenery or floor tiles behind them, making the room display look three-dimensional. If we didn’t align the images at the bottom, they would all align at the top, which would destroy the 3D effect. The second and third rows of floor tiles would cover up the front surface of the back wall, for example.</p>
<div class="sidebar">
<p class="sidebart" id="ch03sb3"><span epub:type="pagebreak" id="page_57"/><strong>TRAINING MISSION #3</strong></p>
<p class="spara">Now that you know how to display a 3D room, try to adjust the map to change the room layout, adding new pillars or floor spaces. You can edit the <span class="literal">room_map</span> data to add new rows or columns to the map. Remember to change the <span class="literal">room_height</span> and <span class="literal">room_width</span> variables too.</p>
<p class="spara1">Perhaps try making a room with more rows and adding a doorway by replacing the 1s used for pillars with 0s. In the final <em>Escape</em> game, each doorway will be three spaces. For best results, design rooms with an odd width and height so you can center the door in the wall.</p>
<p class="spara1"><a href="ch03.xhtml#ch03fig4">Figure 3-4</a> shows a room I designed with a width and height of 9. You can try copying my design if you like. I’ve added a grid to make it easier to work out the data for the <span class="literal">room_map</span> list. The wall pillars rise two tiles out of the floor, so the grid shown is 11 tiles high. Look at the bottoms of the pillars, not the tops, to work out where to position them. See the end of the chapter for the code to make this room.</p>
<div class="image"><a id="ch03fig4"/><img src="../images/fig3-4.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 3-4: One possible new room design</em></p>
</div>
<p class="indent">In the real <em>Escape</em> game, the tall wall pillars will only be used at the edges of the rooms. They can look a bit odd in the middle of the room, especially if they touch the back wall. When we add shadows to the game later in the book, objects in the middle of the room won’t look like they’re floating in space, which is a risk of this way of simulating a 3D perspective.</p>
<h3 class="h3" id="lev59"><strong>ARE YOU FIT TO FLY?</strong></h3>
<p class="noindentb">Check the following boxes to confirm that you’ve learned the key lessons in this chapter.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  The <span class="literal">for</span> loop repeats a section of code a set number of times.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  The <span class="literal">range()</span> function creates a sequence of numbers.</p>
<p class="square"><span epub:type="pagebreak" id="page_58"/><img src="../images/box.jpg" alt="Images"/>  You can use <span class="literal">range()</span> to tell a <span class="literal">for</span> loop how many times to repeat.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  The colon at the end of the <span class="literal">for</span> line is essential.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  To show Python which lines to repeat in the loop, indent the lines using four spaces.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  A loop inside another loop is called a <em>nested loop.</em></p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  Images are aligned at the bottom to create a 3D illusion with tall objects rising up from the floor.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  The <span class="literal">room_height</span> and <span class="literal">room_width</span> variables store the room size in <em>Escape</em> and are used to set up the loop that displays the room.</p>
<div class="image" id="ch03b4"><img src="../images/f0058-01.jpg" alt="image"/></div>
</body></html>