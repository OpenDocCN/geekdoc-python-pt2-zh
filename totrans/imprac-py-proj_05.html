<html><head></head><body>
<h2 class="h2" id="ch05"><span epub:type="pagebreak" id="page_91"/><strong><span class="big">5</span><br/>ENCODING ENGLISH CIVIL WAR CIPHERS</strong></h2>
<div class="image1"><img src="../images/common01.jpg" alt="image"/></div>
<p class="noindent">In 1587, Mary, Queen of Scots, lost her head due to a scrap of paper. Fifty-five years later, Sir John Trevanion, a supporter of another beheaded monarch, Charles the First, had his head saved by a scrap of paper. What made the difference? Steganography.</p>
<p class="indent"><em>Steganography</em> is the time-tested practice of concealing messages so well that their existence isn’t even suspected. The name is based on the Greek words for “covered writing,” and a very literal Grecian example was to take wax-covered wooden tablets used for writing, scrape off the wax, write on the wood, and then cover the board with a new coating of smooth wax. A modern-day example is to embed a message in an image by subtly altering its color components. Even a simple 8-bit JPEG image contains more colors than the human eye can detect, so without digital processing or filtering, the message is essentially invisible.</p>
<p class="indent">In this chapter, you’ll work with the <em>null cipher</em>, which isn’t a cipher at all but a steganographic technique for concealing plaintext within other <span epub:type="pagebreak" id="page_92"/>strings of noncipher material. <em>Null</em> means “none,” so with a null cipher, you have chosen not to encrypt the message. The following is an example of a null cipher using the first letter in every word:</p>
<p class="bq"><strong>N</strong><span class="gray">ice</span> <strong>u</strong><span class="gray">ncles</span> <strong>l</strong><span class="gray">ive</span> <strong>l</strong><span class="gray">onger.</span> <strong>C</strong><span class="gray">ruel,</span> <strong>i</strong><span class="gray">nsensitive</span> <strong>p</strong><span class="gray">eople</span> <strong>h</strong><span class="gray">ave</span> <strong>e</strong><span class="gray">ternal</span> <strong>r</strong><span class="gray">egrets.</span></p>
<p class="indent">First, you’ll write code that finds the hidden message that saved Sir John, and then you’ll accomplish the much more difficult task of writing a null cipher. Finally, you’ll get the opportunity to write a program that might have saved Mary’s head, had she used the output.</p>
<h3 class="h3a" id="lev115"><strong>Project #10: The Trevanion Cipher</strong></h3>
<p class="noindent">Queen Mary relied on both steganography and encryption to protect her messages. The strategy was sound, but her application was flawed. Unknowingly, she relied on a double agent named Gilbert Gifford to smuggle her messages. Gifford first delivered them to Queen Elizabeth’s spymaster, who cracked the cipher and replaced it with a forged message that enticed Mary to incriminate herself. The rest, as they say, is history.</p>
<p class="indent">For John Trevanion, the outcome was rosier. Sir John, a distinguished cavalier who aided Charles I against Oliver Cromwell in the English Civil War, was captured and imprisoned in Colchester Castle. The day before his execution, he received a letter from one of his friends. The letter was not smuggled in but delivered straight into the hands of his jailors, who examined it but didn’t notice any deception. After reading it, Sir John asked for some time alone to pray in the chapel. When his jailors came back to fetch him, he had vanished.</p>
<p class="indent">Here is the message Sir John received:</p>
<p class="bqc">Worthie Sir John: Hope, that is the beste comfort of the afflicted, cannot much, I fear me, help you now. That I would saye to you, is this only: if ever I may be able to requite that I do owe you, stand not upon asking me. 'Tis not much I can do: but what I can do, bee you verie sure I wille. I knowe that, if deathe comes, if ordinary men fear it, it frights not you, accounting for it for a high honour, to have such a rewarde of your loyalty. Pray yet that you may be spared this soe bitter, cup. I fear not that you will grudge any sufferings; onlie if bie submission you can turn them away, 'tis the part of a wise man. Tell me, an if you can, to do for you anythinge that you wolde have done. The general goes back on Wednesday. Restinge your servant to command. R.T.</p>
<p class="indent">As you have probably guessed, this seemingly innocent letter contains a hidden message, revealed below in bold:</p>
<p class="bqc"><span class="gray">Worthie Sir John: Ho</span><strong>p</strong><span class="gray">e, th</span><strong>a</strong><span class="gray">t is the beste comfort of the afflicted, ca</span><strong>n</strong><span class="gray">not much, I f</span><strong>e</strong><span class="gray">ar me, he</span><strong>l</strong><span class="gray">p you now. Th</span><strong>a</strong><span class="gray">t I would saye to you, is</span> <strong>t</strong><span class="gray">his only: if</span> <strong>e</strong><span class="gray">ver I may be able to requite that I do owe you, st</span><strong>a</strong><span class="gray">nd not upon asking me. 'Ti</span><strong>s</strong> <span class="gray">not much I can do: bu</span><strong>t</strong> <span class="gray">what I can do, be</span><strong>e</strong> <span class="gray">you verie sure I wille. I k</span><strong>n</strong><span class="gray">owe that, if</span> <strong>d</strong><span class="gray">eathe comes,</span> <span epub:type="pagebreak" id="page_93"/><span class="gray">if</span> <strong>o</strong><span class="gray">rdinary men fear it, it</span> <strong>f</strong><span class="gray">rights not you, ac</span><strong>c</strong><span class="gray">ounting for it for a high honour, to</span> <strong>h</strong><span class="gray">ave such a rewarde of your loyalty. Pr</span><strong>a</strong><span class="gray">y yet that you may be spared this soe bitter, cu</span><strong>p</strong><span class="gray">. I f</span><strong>e</strong><span class="gray">ar not that you will grudge any sufferings; on</span><strong>l</strong><span class="gray">ie if bie submission you can turn them away, 'ti</span><strong>s</strong> <span class="gray">the part of a wise man. Te</span><strong>l</strong><span class="gray">l me, an</span> <strong>i</strong><span class="gray">f you can, to</span> <strong>d</strong><span class="gray">o for you anythinge that you wolde have done. Th</span><strong>e</strong> <span class="gray">general goes back on Wednesday. Re</span><strong>s</strong><span class="gray">tinge your servant to command. R.T.</span></p>
<p class="indent">This null cipher uses every third letter after a punctuation mark to let Sir John know that a “panel at east end of chapel slides.” It’s rumored that the remains of a narrow stairway were later discovered in a recess in a wall in the castle. The passage was blocked at the time of discovery, but it may have been Sir John’s escape route around 1642.</p>
<p class="indent">This last-minute escape would not have been possible with a traditional cipher. Only by expertly concealing the message with steganography was its author able to get it so quickly into Sir John’s hands. And the beauty of a null cipher is that, even if Sir John didn’t know the pattern but suspected a message was present, he could have found it fairly quickly.</p>
<p class="indent">If Sir John’s friend had been more careful, concealing encrypted ciphertext instead of plaintext, Sir John probably wouldn’t have deciphered the message in the short time he had remaining—unless he’d been informed beforehand of the cipher type and key.</p>
<div class="sidebar">
<p class="sidebart"><strong>THE OBJECTIVE</strong></p>
<p class="spara">Write code that finds the letters hidden after punctuation marks in a null cipher and lets the user choose the number of letters after a punctuation mark to search for a solution.</p>
</div>
<h4 class="h4" id="lev116"><strong><em>Strategy and Pseudocode</em></strong></h4>
<p class="noindent">Null ciphers rely on a repeating pattern known to both the sender and receiver. For example, every third word may be part of the real message or, better, the last letter of every third word. In the Trevanion cipher, it’s the third letter after a punctuation mark.</p>
<p class="indent">To find the Trevanion cipher, assume punctuation marks are the signal to begin counting, and then write code that locates every <em>n</em>th letter after the mark and saves those letters to a string or list. Once you’ve worked out how to do this, you can easily edit the code to work with any starting point, such as every capitalized word, every second letter per word, or the starting letter of every third word.</p>
<p class="indent">The only real point of contention involves punctuation marks. For instance, did the null cipher’s writer <em>want</em> punctuation marks to be included in the plaintext? How do you handle a second punctuation mark within the desired count range? What happens if two punctuation marks occur in succession?</p>
<p class="indent">If you take a close look at the Trevanion cipher, you should see that there are double punctuations caused by the repeated use of the word <em>’tis</em>. <span epub:type="pagebreak" id="page_94"/>There is also a jumble of punctuation marks at the end of the message, where the writer provides his initials. To deal with this, Sir John and his friend may have established some rules before Sir John’s incarceration, or Sir John just used trial and error to work them out.</p>
<p class="indent">Based on the end of the message, punctuation marks aren’t included in the letter count. If Sir John’s friend had intended them to be, then the hidden message would end with a capital <em>T</em>, because the <em>T</em> is three <em>characters</em> after a punctuation mark, and crucially not three <em>letters</em> after. This means that, if the reader encounters a punctuation mark within the count limit, they have to restart their count.</p>
<p class="indent">So these are the rules:</p>
<ul>
<li class="noindent">Initiate a letter count with every punctuation mark.</li>
<li class="noindent">Reset the count if a punctuation mark is encountered.</li>
<li class="noindent">Punctuation marks cannot be part of the plaintext message.</li>
</ul>
<p class="indent">Since you may not know what the letter count should be, write the code so that it checks all counts up through a limit the user provides. The pseudocode is fairly straightforward:</p>
<pre>Load a text file and strip it of whitespace<br/>Get user input on how many letters after punctuation to look ahead and examine<br/>Loop through number of letters from 1 to this lookahead value<br/>    Start an empty string to hold the translation<br/>    Start a counter<br/>    Start a <span class="ent">➊</span>first-found marker and set to False<br/>    Loop through characters in the text<br/>        If character is punctuation<br/>            Counter = 0<br/>            First-found = True<br/>        Otherwise, if <span class="ent">➋</span>first-found is True<br/>            Counter + 1<br/>        If counter = lookahead value<br/>            Add character to translation string<br/>    Display translation for this lookahead value</pre>
<p class="indent">Note that the first-found variable <span class="ent">➊</span> will remain <code>False</code> until a punctuation mark is encountered, after which it will be set to <code>True</code> <span class="ent">➋</span>. This prevents the program from counting until the first punctuation mark is found.</p>
<p class="indent">Now you’re ready to write the code!</p>
<h4 class="h4" id="lev117"><strong><em>The Trevanion Cipher Code</em></strong></h4>
<p class="noindent">The code in this section will find a Trevanion-type null cipher encoded with a specific number of letters after each punctuation mark. You will also need the text file containing the Trevanion cipher. You can download both the script and the text file from <em><a href="https://www.nostarch.com/impracticalpython/">https://www.nostarch.com/impracticalpython/</a></em> as <em>null_cipher_finder.py</em> and <em>trevanion.txt</em>, respectively. Keep these files in the same folder.</p>
<h5 class="h5" id="lev118"><span epub:type="pagebreak" id="page_95"/><strong>Loading the Text</strong></h5>
<p class="noindent"><a href="ch05.xhtml#ch05list1">Listing 5-1</a> imports some useful modules and loads the text file containing the null cipher.</p>
<p class="margin"><em>null_cipher_finder.py,</em> part 1</p>
<pre><span class="ent">➊</span> import sys<br/>   import string<br/><br/><span class="ent">➋</span> def load_text(file):<br/>       """Load a text file as a string."""<br/>    <span class="ent">➌</span> with open(file) as f:<br/>        <span class="ent">➍</span> return f.read().strip()</pre>
<p class="listing" id="ch05list1"><em>Listing 5-1: Imports modules and loads the null cipher text</em></p>
<p class="indent">First, import the now-familiar <code>sys</code> module so you can handle exceptions that may occur during user input <span class="ent">➊</span>. Also import the <code>string</code> module to gain access to useful collections of constants, like letters and punctuation marks.</p>
<p class="indent">Next, define a function to load the text file containing the null cipher <span class="ent">➋</span>. This function is similar to the one you used to load a dictionary file in <a href="ch02.xhtml#ch02">Chapter 2</a>. It will be called by the <code>main()</code>function later to actually load the file.</p>
<p class="indent">Start the <code>load_text()</code> function by using <code>with</code> to open the file <span class="ent">➌</span>. By using <code>with</code>, you know the file will be automatically closed after it is loaded. Use <code>read()</code> to load the contents and <code>strip()</code> to remove leading and trailing whitespace. Note that you can do this on the same line with the <code>return</code> statement <span class="ent">➍</span>.</p>
<h5 class="h5" id="lev119"><strong>Finding the Hidden Message</strong></h5>
<p class="noindent"><a href="ch05.xhtml#ch05list2">Listing 5-2</a> defines the function that finds the hidden message. It takes two arguments. The first is the message, which is the original text file as a string stripped of whitespace, and the second is the number of letters to check after a punctuation mark. This check value is obtained from the user as part of the <code>main()</code> function.</p>
<p class="margin"><em>null_cipher_finder.py,</em> part 2</p>
<pre>def solve_null_cipher(message, lookahead):<br/>    """Solve a null cipher based on number of letters after punctuation mark.<br/><br/>    message = null cipher text as string stripped of whitespace<br/>    lookahead = endpoint of range of letters after punctuation mark to examine<br/>    """<br/> <span class="ent">➊</span> for i in range(1, lookahead + 1):<br/>        <span class="ent">➋</span> plaintext = ''<br/>           count = 0<br/>           found_first = False<br/>        <span class="ent">➌</span> for char in message:<br/>            <span class="ent">➍</span> if char in string.punctuation:<br/>                   count = 0<br/>                   found_first = True<br/>            <span class="ent">➎</span> elif found_first is True:<br/>                   count += 1<br/>            <span class="ent">➏</span> if count == i:<br/>                   plaintext += char<br/><span epub:type="pagebreak" id="page_96"/>        <span class="ent">➐</span> print("Using offset of {} after punctuation = {}".<br/>                 format(i, plaintext))<br/>           print()</pre>
<p class="listing" id="ch05list2"><em>Listing 5-2: Searches for hidden letters</em></p>
<p class="indent">Treat the <code>lookahead</code> value as the endpoint of a range in a <code>for</code> loop so that you can check all the intervening letters in the message for the presence of a hidden message. Set the range as <code>(1, lookahead + 1)</code> <span class="ent">➊</span>; that way, you start with the first letter after a punctuation mark and include the user’s choice in the evaluation.</p>
<p class="indent">Now, assign a few variables <span class="ent">➋</span>. First, initialize an empty string to hold the translated plaintext. Then set a counter to <code>0</code>. Finally, set a <code>found_first</code> variable to <code>False</code>. Remember that the program uses this variable to defer counting until the first punctuation mark is encountered.</p>
<p class="indent">Next, begin looping through the characters in the message <span class="ent">➌</span>. If you encounter a punctuation mark, reset the counter to <code>0</code> and set <code>found_first</code> to <code>True</code> <span class="ent">➍</span>. If you’ve found a punctuation mark already and the current character isn’t punctuation, advance the counter by 1 <span class="ent">➎</span>. If you’ve found the letter you’re looking for—meaning the count has reached the current <code>lookahead</code> value (<code>i</code>)—add the letter to the plaintext string <span class="ent">➏</span>.</p>
<p class="indent">When you’ve examined all the characters in the message for the current <code>lookahead</code> value, display the current key and the translation <span class="ent">➐</span>.</p>
<h5 class="h5" id="lev120"><strong>Defining the main() Function</strong></h5>
<p class="noindent"><a href="ch05.xhtml#ch05list3">Listing 5-3</a> defines the <code>main()</code> function. You may remember from <a href="ch03.xhtml#ch03">Chapter 3</a> that the <code>main()</code> function is like your program’s project manager: it takes input, keeps track of progress, and tells the other functions when to work.</p>
<p class="margin"><em>null_cipher_finder.py,</em> part 3</p>
<pre>def main():<br/>    """Load text, solve null cipher."""<br/>    # load &amp; process message:<br/> <span class="ent">➊</span> filename = input("\nEnter full filename for message to translate: ")<br/> <span class="ent">➋</span> try:<br/>        loaded_message = load_text(filename)<br/>    except IOError as e:<br/>        print("{}. Terminating program.".format(e), file=sys.stderr)<br/>        sys.exit(1)<br/> <span class="ent">➌</span> print("\nORIGINAL MESSAGE =")<br/>    print("{}".format(loaded_message), "\n")<br/>    print("\nList of punctuation marks to check = {}".<br/>          format(string.punctuation), "\n")   <br/><br/>    # remove whitespace:<br/> <span class="ent">➍</span> message = ''.join(loaded_message.split())<br/><br/>    # get range of possible cipher keys from user:<br/> <span class="ent">➎</span> while True:<br/>     <span class="ent">➏</span> lookahead = input("\nNumber of letters to check after " \<br/>                          "punctuation mark: ")<br/>     <span class="ent">➐</span> if lookahead.isdigit():<br/><span epub:type="pagebreak" id="page_97"/>            lookahead = int(lookahead)<br/>            break<br/>        else:<br/>         <span class="ent">➑</span> print("Please input a number.", file=sys.stderr)<br/>    print()<br/><br/>    # run function to decode cipher<br/> <span class="ent">➒</span> solve_null_cipher(message, lookahead)</pre>
<p class="listing" id="ch05list3"><em>Listing 5-3: Defines the</em> <span class="codeitalic">main()</span> <em>function</em></p>
<p class="indent">Start by asking the user for the name of the file (name + extension) <span class="ent">➊</span>, and then use <code>try</code> to call the <code>load_text()</code> function <span class="ent">➋</span>. If the file can’t be found, print the error in red—for those using the IDLE window—and exit the program using <code>sys.exit(1)</code>, where the <code>1</code> indicates termination with an error.</p>
<p class="indent">Print the message followed by the list of punctuation marks in the <code>string</code> module <span class="ent">➌</span>. Only the characters in this list will be recognized by the program as punctuation.</p>
<p class="indent">Next, take the loaded message and remove all spaces <span class="ent">➍</span>. You’re going to count only letters and punctuation marks, so spaces would just get in the way. Start a <code>while</code> loop that keeps asking the user for input in the event they enter a bad value <span class="ent">➎</span>. Ask the user for the number of letters to check after a punctuation mark <span class="ent">➏</span>. This will be treated as a range, starting with 1 and ending with the user’s choice plus 1. If the input value is a digit <span class="ent">➐</span>, turn it into an integer, since <code>input</code> returns a string. Then, use <code>break</code> to exit the loop.</p>
<p class="indent">If the user enters an invalid value, like “Bob,” use a <code>print</code> statement to request a number and, for shell users, make the font red using <code>sys.stderr</code> <span class="ent">➑</span>. The <code>while</code> loop will then repeat the request for input.</p>
<p class="indent">Pass the <code>lookahead</code> variable, along with the <code>message</code>, to the <code>solve_null_cipher</code> function <span class="ent">➒</span>. Now all that’s left is to call the <code>main()</code> function.</p>
<h5 class="h5" id="lev121"><strong>Running the main() Function</strong></h5>
<p class="noindent">Back in the global space, complete the code by calling <code>main()</code>—but only if the program is run in stand-alone mode versus being imported into another program (<a href="ch05.xhtml#ch05list4">Listing 5-4</a>).</p>
<p class="margin"><em>null_cipher_finder.py,</em> part 4</p>
<pre>if __name__ == '__main__':<br/>    main()</pre>
<p class="listing" id="ch05list4"><em>Listing 5-4: Calls the</em> <span class="codeitalic">main()</span> <em>function</em></p>
<p class="indent">The following is example output from the completed program, using the Trevanion cipher as input:</p>
<pre>Enter full filename for message to translate: <span class="codestrong1">trevanion.txt</span><br/><br/>ORIGINAL MESSAGE =<br/>Worthie Sir John: Hope, that is the beste comfort of the afflicted, cannot<br/>much, I fear me, help you now. That I would saye to you, is this only: if ever<br/>I may be able to requite that I do owe you, stand not upon asking me. 'Tis not<br/>much I can do: but what I can do, bee you verie sure I wille. I knowe that,<br/><span epub:type="pagebreak" id="page_98"/>if deathe comes, if ordinary men fear it, it frights not you, accounting for<br/>it for a high honour, to have such a rewarde of your loyalty. Pray yet that<br/>you may be spared this soe bitter, cup. I fear not that you will grudge any<br/>sufferings; onlie if bie submission you can turn them away, 'tis the part of a<br/>wise man. Tell me, an if you can, to do for you anythinge that you wolde have<br/>done. The general goes back on Wednesday. Restinge your servant to command.<br/>R.T.<br/><br/><br/>List of punctuation marks to check = !"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\]^_`{|}~<br/><br/><br/>Number of letters to check after punctuation mark: 4<br/><br/>Using offset of 1 after punctuation = HtcIhTiisTbbIiiiatPcIotTatTRRT<br/><br/>Using offset of 2 after punctuation = ohafehsftiuekfftcorufnienohe<br/><br/>Using offset of 3 after punctuation = panelateastendofchapelslides<br/><br/>Using offset of 4 after punctuation = etnapthvnnwyoerroayaitlfogt</pre>
<p class="indent">In this output, the program has checked up to the fourth letter after a punctuation mark, but as you can see, it finds the solution using three letters after a punctuation mark.</p>
<h3 class="h3a" id="lev122"><strong>Project #11: Writing a Null Cipher</strong></h3>
<p class="noindent">Here is an unfinished example of a very weak null cipher based on the start of each word. Take a minute and try to complete the sentence:</p>
<p class="center">H__________ e__________ l__________ p__________ m__________ e__________.</p>
<p class="indent">You probably found it difficult, because whether you use letters or even whole words, it takes hard work and time to produce a null cipher that doesn’t read awkwardly and arouse suspicion. The heart of the problem is context. If the cipher is encapsulated within correspondence, that correspondence has to be coherent to avoid suspicion. That means it has to address a relevant topic and stay true to that topic for a reasonable number of sentences. As you probably saw, drafting even one sentence on any topic is no easy task!</p>
<p class="indent">The key is to credibly avoid context, and a good way to do this is with a list. No one expects a shopping list to be rigidly organized or make sense. Lists can also be tailored to the receiver. For example, correspondents might get into a discussion of books or movies and exchange lists of their favorites. A prisoner might start studying a foreign language and receive regular vocabulary lists from their tutor. A businessperson might get monthly inventories from one of their warehouses. With lists, context is honored even while words are shuffled so the correct letter is found in the correct place.</p>
<div class="sidebar">
<p class="sidebart"><span epub:type="pagebreak" id="page_99"/><strong>THE OBJECTIVE</strong></p>
<p class="spara">Write code that hides a null cipher within a list of words.</p>
</div>
<h4 class="h4" id="lev123"><strong><em>The List Cipher Code</em></strong></h4>
<p class="noindent">The <em>list_cipher.py</em> code, in <a href="ch05.xhtml#ch05list5">Listing 5-5</a>, embeds a null cipher within a list of dictionary words under the deception of vocabulary training. You’ll also need the <em>load_dictionary.py</em> program you used in <a href="ch02.xhtml#ch02">Chapters 2</a> and <a href="ch03.xhtml#ch03">3</a>. You can download this file, along with the following script, from <em><a href="https://www.nostarch.com/impracticalpython/">https://www.nostarch.com/impracticalpython/</a></em>. Finally, you’ll need one of the dictionary files you used in <a href="ch02.xhtml#ch02">Chapters 2</a> and <a href="ch03.xhtml#ch03">3</a>. You can find a list of suitable online dictionaries in <a href="ch02.xhtml#ch02tab1">Table 2-1</a> on <a href="ch02.xhtml#page_20">page 20</a>. All of the aforementioned files should be kept in the same folder.</p>
<p class="margin"><em>list_cipher.py</em></p>
<pre><span class="ent">➊</span> from random import randint<br/>   import string<br/>   import load_dictionary<br/><br/>   # write a short message that doesn't contain punctuation or numbers!<br/>   input_message = "Panel at east end of chapel slides"<br/><br/>   message = ''<br/>   for char in input_message:<br/>    <span class="ent">➋</span> if char in string.ascii_letters:<br/>           message += char<br/>   print(message, "\n")<br/><span class="ent">➌</span> message = "".join(message.split())<br/><br/><span class="ent">➍</span> # open dictionary file<br/>   word_list = load_dictionary.load('2of4brif.txt')<br/><br/>   # build vocabulary word list with hidden message<br/><span class="ent">➎</span> vocab_list = []<br/><span class="ent">➏</span> for letter in message:<br/>       size = randint(6, 10)<br/>    <span class="ent">➐</span> for word in word_list:<br/>           if len(word) == size and word[2].lower() == letter.lower()\<br/>           and word not in vocab_list:<br/>               vocab_list.append(word)<br/>               break<br/><br/><span class="ent">➑</span> if len(vocab_list) &lt; len(message):<br/>       print("Word List is too small. Try larger dictionary or shorter message!")<br/>   else:<br/>       print("Vocabulary words for Unit 1: \n", *vocab_list, sep="\n")</pre>
<p class="listing" id="ch05list5"><em>Listing 5-5: Hides null cipher in a list</em></p>
<p class="indent"><span epub:type="pagebreak" id="page_100"/>Start by importing the <code>random</code> module’s <code>randint()</code> function <span class="ent">➊</span>. This permits the (pseudo)random selection of an integer value. Then load the <code>string</code> module, for access to ASCII letters. Finish by importing your <code>load_dictionary</code> module.</p>
<p class="indent">Next, write a short secret message. Note that the associated comment forbids punctuation marks or numbers. Trying to use these with a dictionary file’s contents would be problematic. So, filter out everything but letters by checking for membership in <code>string.ascii_letters</code>, which contains both uppercase and lowercase letters <span class="ent">➋</span>:</p>
<pre>'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'</pre>
<p class="indent">Display the message and then remove the whitespace <span class="ent">➌</span>. Load your dictionary file <span class="ent">➍</span> and start an empty list to hold the vocabulary words <span class="ent">➎</span>.</p>
<p class="indent">Use a <code>for</code> loop to go through each letter in the message <span class="ent">➏</span>. Name a <code>size</code> variable and assign it a random value between 6 and 10 using the <code>randint()</code> function. This variable will ensure the words are long enough to be credible as vocabulary words. You can set the maximum value higher if you wish.</p>
<p class="indent">Nest another <code>for</code> loop and use it to go through the dictionary words <span class="ent">➐</span>, checking their length against the <code>size</code> variable and comparing the (lowercase) letter at index 2—the word’s third letter—to the current (lowercase) letter in the message loop. You can change the index value on the word, but make sure it doesn’t exceed the lowest possible <code>size</code> variable minus 1! A final comparison prevents the same word from being used twice. If the word passes the tests, append it to <code>vocab_list</code> and move on to the next letter in the message.</p>
<p class="indent">A typical dictionary file should contain enough words to encrypt a short message. But, to be safe, use a conditional to check that the length of <code>vocab_list</code> is not shorter than the length of the message <span class="ent">➑</span>. If it’s shorter, then you ran out of words before reaching the end of the message, and you need to print a warning for the user. Otherwise, print the list of words.</p>
<h4 class="h4" id="lev124"><strong><em>The List Cipher Output</em></strong></h4>
<p class="noindent">Here is the output from the code (I’ve highlighted every third letter for readability, though the message is pretty easy to spot without any aid):</p>
<pre>Panelateastendofchapelslides
<br/><br/>Vocabulary words for Unit 1:<br/><br/>al<span class="codestrong1">p</span>habets<br/>ab<span class="codestrong1">a</span>ndoning<br/>an<span class="codestrong1">n</span>als<br/>ab<span class="codestrong1">e</span>rration<br/>ab<span class="codestrong1">l</span>aze<br/>ab<span class="codestrong1">a</span>ndoned<br/><span epub:type="pagebreak" id="page_101"/>ac<span class="codestrong1">t</span>ing<br/>ab<span class="codestrong1">e</span>tted<br/>ab<span class="codestrong1">a</span>sement<br/>ab<span class="codestrong1">s</span>eil<br/>ac<span class="codestrong1">t</span>ivated<br/>ad<span class="codestrong1">e</span>quately<br/>ab<span class="codestrong1">n</span>ormal<br/>ab<span class="codestrong1">d</span>omen<br/>ab<span class="codestrong1">o</span>lish<br/>af<span class="codestrong1">f</span>ecting<br/>ac<span class="codestrong1">c</span>eding<br/>ab<span class="codestrong1">h</span>ors<br/>ab<span class="codestrong1">a</span>lone<br/>am<span class="codestrong1">p</span>ersands<br/>ac<span class="codestrong1">e</span>tylene<br/>al<span class="codestrong1">l</span>egation<br/>ab<span class="codestrong1">s</span>conds<br/>ai<span class="codestrong1">l</span>eron<br/>ac<span class="codestrong1">i</span>difying<br/>ab<span class="codestrong1">d</span>icating<br/>ad<span class="codestrong1">e</span>pts<br/>ab<span class="codestrong1">s</span>ent</pre>
<p class="indent">Using a font with a consistent character width and stacking the words really compromises the cipher. We’ll look at ways to deal with this in “<a href="ch05.xhtml#lev128">Saving Mary</a>” on <a href="ch05.xhtml#page_102">page 102</a>.</p>
<h3 class="h3" id="lev125"><strong>Summary</strong></h3>
<p class="noindent">In this chapter, you wrote a program that reveals the hidden message in a Trevanion-type null cipher. Then, you wrote a second program that generates a null cipher and conceals it within a language learner’s vocabulary list. In the following practice projects, you can explore ways to make this list cipher more secure.</p>
<h3 class="h3" id="lev126"><strong>Further Reading</strong></h3>
<p class="noindent">More details on Mary, Queen of Scots, and Sir John Trevanion can be found in <em>Mysterious Messages: A History of Codes and Ciphers</em> (The Penguin Group, 2009) by Gary Blackwood and <em>The Code Book: The Science of Secrecy from Ancient Egypt to Quantum Cryptography</em> (Anchor, 2000) by Simon Singh.</p>
<h3 class="h3" id="lev127"><strong>Practice Projects</strong></h3>
<p class="noindent">Now that you’re an expert on the null cipher, see if you can change the fate of Mary, Queen of Scots, and then sneak a look at Sir John’s most secret correspondence.</p>
<h4 class="h4" id="lev128"><span epub:type="pagebreak" id="page_102"/><strong><em>Saving Mary</em></strong></h4>
<p class="noindent">The best part of coding is thinking about problems and how to solve them. Let’s revisit the sad case of Mary, Queen of Scots. Here’s what we know:</p>
<ul>
<li class="noindent">Mary was not allowed correspondence, so letters had to be smuggled in. This means that the traitorous Gilbert Gifford cannot be removed from the equation. Gifford was the only person Mary knew with the means to deliver her mail.</li>
<li class="noindent">Mary and her correspondents put too much faith in an insecure cipher and thus spoke too freely. With less confidence, they might have shown more forbearance.</li>
<li class="noindent">Mary’s jailors, having an obvious cipher in their possession, assumed it contained incriminating material and kept working until they found it.</li>
</ul>
<p class="indent">Gifford, the double agent, wasn’t privy to the details of the ciphers Mary used. Now, assume Mary used a null cipher. If the correspondence was somewhat seditious—though not treasonously so—the message might have been overlooked by her captors. In the event a cursory examination was made, the use of a variable pattern might have sufficed to stymie the cryptanalysts.</p>
<p class="indent">As you have seen, it’s easier to hide a null cipher in a list than in a letter. A list of families supporting Mary could serve the purpose. These could be known supporters or, in a Machiavellian twist, a mix of friends <em>and</em> enemies! This message wouldn’t be openly seditious, but would be close enough so that a lack of encryption would suggest no form of encryption was being used at all.</p>
<p class="indent">For this practice project, write a program that embeds the message “Give your word and we rise” in a list of surnames. To hide the letters in the message, start at the second letter in the second name, move to the third letter in the third name, and then keep alternating between second and third letters for the remaining words.</p>
<p class="indent">In addition to the unused first name, include “Stuart” and “Jacob” as null words early in the list to help hide the presence of the cipher. Don’t embed letters from the cipher in these null names and completely ignore them when choosing the letter position for the cipher in the following word; if the second letter was used in the word <em>before</em> the null name, use the third letter in the word <em>after</em> the null name. The null cipher would occupy the following bolded letters (the location of the null words is up to you, but don’t let them affect the pattern):</p>
<pre><span class="gray">First S</span><span class="codestrong1">e</span><span class="gray">cond Th</span><span class="codestrong1">i</span><span class="gray">rd STUART F</span><span class="codestrong1">o</span><span class="gray">urth Fi</span><span class="codestrong1">f</span><span class="gray">th JACOB S</span><span class="codestrong1">i</span><span class="gray">xth Se</span><span class="codestrong1">v</span><span class="gray">enth E</span><span class="codestrong1">i</span><span class="gray">ghth</span></pre>
<p class="indent">The program can print the list either vertically or horizontally. The name list should be credibly introduced with a short message, but that message shouldn’t be part of the cipher.</p>
<p class="indent"><span epub:type="pagebreak" id="page_103"/>The list of names can be downloaded from <em><a href="https://www.nostarch.com/impracticalpython/">https://www.nostarch.com/impracticalpython/</a></em> as <em>supporters.txt</em> and loaded as a standard dictionary file. You can find a solution in the appendix and online as <em>save_Mary_practice.py</em>.</p>
<h4 class="h4" id="lev129"><strong><em>The Colchester Catch</em></strong></h4>
<p class="noindent">Instead of some ale-sotted dimwit, <em>you</em> are left in charge of the prisoner John Trevanion when the following letter arrives at Colchester Castle:</p>
<p class="bqc">Sir John: Odd and too hard, your lot. Still, we will band together and, like you, persevere. Who else could love their enemies, stand firm when all others fail, hate and despair? While we all can, let us feel hope. -R.T.</p>
<p class="indent">It seems clumsily phrased, even for the 17th century, and you decide to examine it more closely before passing it to your inmate.</p>
<p class="indent">Write a Python program that takes an input, <em>n</em>, and checks for and displays a null cipher based on the <em>n</em>th letter after the start of every <em>n</em>th word. For example, an input of <code>2</code> would find the bolded letters in this message:</p>
<p class="indentc"><span class="gray">So, t</span><strong>h</strong><span class="gray">e cold t</span><strong>e</strong><span class="gray">a didn’t p</span><strong>l</strong><span class="gray">ease the o</span><strong>l</strong><span class="gray">d finicky w</span><strong>o</strong><span class="gray">man.</span></p>
<p class="indent">You can download the text file of the message from <em><a href="https://nostarch.com/impracticalpython/">https://nostarch.com/impracticalpython/</a></em> as <em>colchester_message.txt</em>. A solution can be found in the appendix and online as <em>colchester_practice.py</em>. Keep the text and Python files together in the same folder.<span epub:type="pagebreak" id="page_104"/></p>
</body></html>