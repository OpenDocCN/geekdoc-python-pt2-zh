<html><head></head><body>
<h2 class="h2" id="ch12"><span epub:type="pagebreak" id="page_197"/><strong><span class="blue"><span class="big">12</span></span><br/>DANGER! DANGER! ADDING HAZARDS</strong></h2>
<div class="image1"><img src="../images/common01.jpg" alt="image"/></div>
<p class="noindent">When the space station systems fail, all kinds of threats emerge. In this chapter, you’ll see the air start to leak from the station and will discover moving hazards in some of the rooms, including rogue robots, balls of energy, and toxic puddles.</p>
<p class="indent">I’ve put the dangers last so you can test the game up to this point without worrying about your time or energy running out. In this chapter, we’ll start the air leak and draw a timer bar to let you know how much air you have left. We’ll also add hazards that can harm you and drain your energy. Finally, we’ll clean up the game and get it ready to play!</p>
<h3 class="h3" id="lev149"><span epub:type="pagebreak" id="page_198"/><strong>ADDING THE AIR COUNTDOWN</strong></h3>
<p class="noindent">There are two ways for the player to fail in the game: their air can run out or their energy can run out. At the bottom of the screen, two bars show players how much air and how much energy they have remaining (see <a href="ch12.xhtml#ch12fig1">Figure 12-1</a>).</p>
<div class="image"><a id="ch12fig1"/><img src="../images/fig12-1.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-1: Two bars at the bottom of the screen show your remaining air and energy.</em></p>
<p class="indent">You lose energy when you walk over toxic spills or are hit by moving hazards, and the air gradually runs out because of the leak in the space station wall. If you put on a space suit, you can buy more time, but the air in the suit’s canister will eventually run out too. Some of your toughest decisions could be deciding when to top up your air and use food to restore your energy.</p>
<h4 class="h4" id="lev150"><strong>DISPLAYING THE AIR AND ENERGY BARS</strong></h4>
<p class="noindent">We’ll create a new section of the program called <span class="literal">AIR</span>, which you need to place after the <span class="literal">DOORS</span> section but before the <span class="literal">START</span> section at the end of the program. Add the new code shown in <a href="ch12.xhtml#ch12list1">Listing 12-1</a> to your final listing from the previous chapter (<em>listing11-7.py</em>). Save your file as <em>listing12-1.py</em>. If you run the program, it won’t do anything new yet, but this code creates the function for drawing the air and energy bars.</p>
<p class="margin"><span epub:type="pagebreak" id="page_199"/><em>listing12-1.py</em></p>
<p class="programs">   <span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>       <span class="gray">objects[21][0] = frames[airlock_door_frame]</span><br/>       <span class="gray">objects[21][1] = shadow_frames[airlock_door_frame]</span><br/><br/>   <span class="red">###############</span><br/>   <span class="red">##    AIR    ##</span><br/>   <span class="red">###############</span><br/><br/>   <span class="orange">def</span> <span class="blue">draw_energy_air</span>():<br/>       box = Rect((20, 765), (350, 20))<br/><span class="ent">➊</span>     screen.draw.filled_rect(box, BLACK) <span class="red"># Clear air bar.</span><br/><span class="ent">➋</span>     screen.draw.text(<span class="green">"AIR"</span>, (20, 766), color=BLUE)<br/><span class="ent">➌</span>     screen.draw.text(<span class="green">"ENERGY"</span>, (180, 766), color=YELLOW)<br/><br/><span class="ent">➍</span>     <span class="orange">if</span> air &gt; 0:<br/><span class="ent">➎</span>         box = Rect((50, 765), (air, 20))<br/><span class="ent">➏</span>         screen.draw.filled_rect(box, BLUE) <span class="red"># Draw new air bar.</span><br/><br/><span class="ent">➐</span>     if energy &gt; 0:<br/>           box = Rect((250, 765), (energy, 20))<br/>           screen.draw.filled_rect(box, YELLOW) <span class="red"># Draw new energy bar.</span><br/><br/>   <span class="gray">###############</span><br/>   <span class="gray">##   START   ##</span><br/>   <span class="gray">###############</span><br/>   <span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list1"><em>Listing 12-1: Drawing the air and energy bars</em></p>
<p class="indent">We begin the new <span class="literal">draw_energy_air()</span> function by drawing a black box over the status area at the bottom of the screen to clear it <span class="ent">➊</span>. We then add the AIR label in blue <span class="ent">➋</span>, and the ENERGY label in yellow <span class="ent">➌</span>. This function will use the <span class="literal">air</span> and <span class="literal">energy</span> variables, which are already set to 100 in the <span class="literal">VARIABLES</span> part of the program.</p>
<p class="indent">If the player has some air left (if the variable <span class="literal">air</span> is more than 0) <span class="ent">➍</span>, a box is created that uses the <span class="literal">air</span> variable for its width <span class="ent">➎</span>. The box is then filled with the color blue <span class="ent">➏</span>. This draws the AIR indicator bar, which starts off being 100 pixels wide and gets smaller as the <span class="literal">AIR</span> variable decreases.</p>
<p class="indent">We use similar instructions to draw the energy bar <span class="ent">➐</span>, but the bar’s start position is farther to the right (the <em>x</em> position is 250 instead of 50).</p>
<h4 class="h4" id="lev151"><strong>ADDING THE AIR COUNTDOWN FUNCTIONS</strong></h4>
<p class="noindent">We’ll make three functions to enable the air countdown. The <span class="literal">end_the_game()</span> function runs when you’re out of air. It displays the reason the player failed the mission, plays some sound effects, and shows a large GAME OVER message in the middle of the game window.</p>
<p class="indent">The <span class="literal">air_countdown()</span> function saps the air supply. We’ll also add an <span class="literal">alarm()</span> function that runs shortly after the game begins to warn the player that their air is failing.</p>
<p class="indent"><span epub:type="pagebreak" id="page_200"/>These three functions are in <a href="ch12.xhtml#ch12list2">Listing 12-2</a>. Add the new code shown here in the <span class="literal">AIR</span> section of the program, after the <span class="literal">draw_energy_air()</span> function you just added. Save your program as <em>listing12-2.py</em>. You can run this program using <span class="codestrong">pgzrun listing12-2.py</span>, but you won’t see anything new yet.</p>
<p class="margin"><em>listing12-2.py</em></p>
<p class="programs">   <span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>       <span class="gray">if energy &gt; 0:</span><br/>           <span class="gray">box = Rect((250, 765), (energy, 20))</span><br/>           <span class="gray">screen.draw.filled_rect(box, YELLOW) # Draw new energy bar.</span><br/><br/><span class="ent">➊</span> <span class="orange">def</span> <span class="blue">end_the_game</span>(reason):<br/>       <span class="orange">global</span> game_over<br/><span class="ent">➋</span>     show_text(reason, 1)<br/><span class="ent">➌</span>     game_over = <span class="orange">True</span><br/>       sounds.say_mission_fail.play()<br/>       sounds.gameover.play()<br/><span class="ent">➍</span>     screen.draw.text(<span class="green">"GAME OVER"</span>, (120, 400), color = <span class="green">"white"</span>,<br/>                        fontsize = 128, shadow = (1, 1), scolor = <span class="green">"black"</span>)<br/><br/><span class="ent">➎</span> <span class="orange">def</span> <span class="blue">air_countdown</span>():<br/>       <span class="orange">global</span> air, game_over<br/>       <span class="orange">if</span> game_over:<br/>           <span class="orange">return</span> <span class="red"># Don't sap air when they're already dead.</span><br/><span class="ent">➏</span>     air -= 1<br/><span class="ent">➐</span>     <span class="orange">if</span> air == 20:<br/>           sounds.say_air_low.play()<br/>       <span class="orange">if</span> air == 10:<br/>           sounds.say_act_now.play()<br/><span class="ent">➑</span>     draw_energy_air()<br/><span class="ent">➒</span>     <span class="orange">if</span> air &lt; 1:<br/>           end_the_game(<span class="green">"You're out of air!"</span>)<br/><br/><span class="ent">➓</span> <span class="orange">def</span> <span class="blue">alarm</span>():<br/>       show_text(<span class="green">"Air is running out, "</span> + PLAYER_NAME<br/>                 + <span class="green">"! Get to safety, then radio for help!"</span>, 1)<br/>       sounds.alarm.play(3)<br/>       sounds.say_breach.play()<br/><br/><br/>   <span class="gray">###############</span><br/>   <span class="gray">##   START   ##</span><br/>   <span class="gray">###############</span><br/>   <span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list2"><em>Listing 12-2: Adding the air countdown</em></p>
<p class="indent">The <span class="literal">air_countdown()</span> function <span class="ent">➎</span> reduces the <span class="literal">air</span> variable’s value by 1 each time it runs <span class="ent">➏</span>. If the value is equal to 20 <span class="ent">➐</span> or 10, a warning sound effect plays to let the player know their air is low.</p>
<p class="indent">The <span class="literal">draw_energy_air()</span> function you added in <a href="ch12.xhtml#ch12list1">Listing 12-1</a> updates the air and energy display <span class="ent">➑</span>. If the air has run out <span class="ent">➒</span>, the <span class="literal">end_the_game()</span> function runs and displays the string <span class="literal">"You're out of air!</span><span class="literal">"</span>.</p>
<div class="sidebar1">
<p class="sidebart"><span epub:type="pagebreak" id="page_201"/><strong>TIP</strong></p>
<p class="spara">Sound files must be stored in the <em>sounds</em> folder and should be in <em>.wav</em> or <em>.ogg</em> format. To play a sound called <em>bang.wav</em>, you would use <span class="literal">sounds.bang.play()</span>. As with images, you don’t need to tell Pygame Zero the file extension or where the sound is stored. Why not try recording and adding your own sound effects for various points in the game?</p>
</div>
<p class="indent">In the <span class="literal">end_the_game()</span> function <span class="ent">➊</span>, we use the variable <span class="literal">reason</span> for the information it receives, and display that on the screen as the reason for death <span class="ent">➋</span>. The <span class="literal">game_over</span> variable is set to <span class="literal">True</span> <span class="ent">➌</span>. Other functions use this variable to know when the game has finished so everything can come to a stop. The <span class="literal">end_the_game()</span> function then draws the words GAME OVER in large text in the middle of the screen. The text is drawn at position <em>x</em> = 120, <em>y</em> = 400 in white text using a font size of 128 <span class="ent">➍</span>. We also add a drop shadow under the text for effect, which is offset by 1 pixel in each direction and is colored black (see <a href="ch12.xhtml#ch12fig2">Figure 12-2</a>).</p>
<div class="image"><a id="ch12fig2"/><img src="../images/fig12-2.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-2: Oh no! You’re out of air!</em></p>
<p class="indent">The final function in this section, <span class="literal">alarm()</span> <span class="ent">➓</span>, plays the alarm sound and displays a message telling you to radio for help. It uses the player’s name in the warning to personalize it.</p>
<p class="indent">The number in parentheses in the <span class="literal">sounds.alarm.play()</span> command is the number of times the sound should be played (in <a href="ch12.xhtml#ch12list2">Listing 12-2</a>, it’s three).</p>
<h4 class="h4" id="lev152"><span epub:type="pagebreak" id="page_202"/><strong>STARTING THE AIR COUNTDOWN AND SOUNDING THE ALARM</strong></h4>
<p class="noindent">We haven’t set the three new functions to run yet. To do that, we need to add some instructions to the <span class="literal">START</span> section of the program, which is (perhaps confusingly!) at the end of the program listing. Add the new instructions shown in <a href="ch12.xhtml#ch12list3">Listing 12-3</a>, and save it as <em>listing12-3.py</em>.</p>
<p class="margin"><em>listing12-3.py</em></p>
<p class="programs"><span class="gray">--<span class="codeitalic1">snip</span>--</span><br/><span class="gray">###############</span><br/><span class="gray">##   START   ##</span><br/><span class="gray">###############</span><br/><br/><span class="gray">clock.schedule_interval(game_loop, 0.03)</span><br/><span class="gray">generate_map()</span><br/><span class="gray">clock.schedule_interval(adjust_wall_transparency, 0.05)</span><br/><span class="gray">clock.schedule_unique(display_inventory, 1)</span><br/>clock.schedule_unique(draw_energy_air, 0.5)<br/>clock.schedule_unique(alarm, 10)<br/><span class="red"># A higher number below gives a longer time limit.</span><br/>clock.schedule_interval(air_countdown, 5)</p>
<p class="listing" id="ch12list3"><em>Listing 12-3: Starting the air countdown</em></p>
<p class="indent">Now the game has a time limit. When the air runs out, the game ends. Run the program using <span class="codestrong">pgzrun listing12-3.py</span>, and you should see your air supply slowly go down.</p>
<p class="indent">If you find the game too difficult when you’re playing the final version, you can give yourself more time by changing the 5 in the final line in <a href="ch12.xhtml#ch12list3">Listing 12-3</a> to a higher number. This number decides how often the <span class="literal">air_countdown()</span> function saps your air supply, and is measured in seconds. In particular, if you’re using a Raspberry Pi 2, the time limit might be challenging because the game runs a bit more slowly there. It’s still possible to complete the game, but you can increase the number 5 to give yourself a little more, ahem, breathing space.</p>
<div class="sidebar">
<p class="sidebart" id="ch12sb1"><strong>TRAINING MISSION #1</strong></p>
<p class="spara">When your air supply reaches 0, you should see the GAME OVER message and find that you can no longer move the astronaut. Your energy goes down by 1 percent every 5 seconds, so it’ll take about 8.5 minutes (500 seconds) to run out. Can you work out how to make the air leak more often, so you can more easily test what happens when the air runs out?</p>
<p class="spara1">After completing the training mission, make sure you change the program back again: otherwise, you’ll find your mission rather hard to complete!</p>
</div>
<h3 class="h3" id="lev153"><span epub:type="pagebreak" id="page_203"/><strong>ADDING THE MOVING HAZARDS</strong></h3>
<p class="noindent">There are three types of moving hazards in the game: two types of energy balls and a flying drone that’s gone rogue.</p>
<p class="indent"><a href="ch12.xhtml#ch12fig3">Figure 12-3</a> shows the direction numbers the moving hazards use.</p>
<p class="indent">Hazards move in a straight line until they hit something, and then we add a number to change their direction. The number we add will decide the hazard’s movement pattern. For example, if we add <span class="literal">1</span> to the direction number, the hazard moves in a clockwise pattern (up, right, down, left). If we add <span class="literal">-1</span> to the direction number, the hazard moves in a counterclockwise pattern (left, down, right, up). If we add <span class="literal">2</span>, it will bounce between going left and right (2 and 4) or up and down (1 and 3). Take a look at <a href="ch12.xhtml#ch12fig3">Figure 12-3</a> and check this makes sense to you. Each hazard can have its own pattern of movement.</p>
<div class="image"><a id="ch12fig3"/><img src="../images/fig12-3.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-3: The direction numbers the moving hazards use are numbered in a clockwise order.</em></p>
<p class="indent">If the addition results in a number that’s higher than 4, we subtract 4. For example, if a hazard is moving clockwise, we add 1 to its direction number each time it hits something. If it’s going down (direction 3), we add 1 when it hits something, so it starts to move left (direction 4). The next time it hits something, we add 1, but that makes the direction number 5. So we subtract 4, and that gives us a direction number of 1. As <a href="ch12.xhtml#ch12fig3">Figure 12-3</a> shows, that’s the next direction number after 4, going around in a clockwise pattern.</p>
<p class="indent"><a href="ch12.xhtml#ch12tab1">Table 12-1</a> summarizes the numbers we can use to get different movement patterns.</p>
<p class="tabcap" id="ch12tab1"><strong>Table 12-1:</strong> How to Change Direction When a Hazard Hits Something</p>
<table class="topbot-d">
<thead>
<tr>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Movement pattern</strong></p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"> </p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Number to add to the direction number</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">Clockwise</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><img src="../images/f0203-01.jpg" alt="image"/></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">1</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">Counterclockwise</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><img src="../images/f0203-02.jpg" alt="image"/></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">-1</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba">Left/right</p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><img src="../images/f0203-03.jpg" alt="image"/></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">2</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-ba"><p class="taba">Up/down</p></td>
<td style="vertical-align: top;" class="table-ba"><p class="taba"><img src="../images/f0203-04.jpg" alt="image"/></p></td>
<td style="vertical-align: top;" class="table-ba"><p class="taba">2</p></td>
</tr>
</tbody>
</table>
<div class="note">
<p class="notet"><strong><span class="notes">RED ALERT</span></strong></p>
<p class="notep"><em>Take care not to mix up the two numbers that describe the movement. The direction number (see <a href="ch12.xhtml#ch12fig3">Figure 12-3</a>) tells the program which direction a hazard is moving in. The number we add to the direction number (see <a href="ch12.xhtml#ch12tab1">Table 12-1</a>) tells the program which way the hazard should bounce when it hits something.</em></p>
</div>
<h4 class="h4" id="lev154"><span epub:type="pagebreak" id="page_204"/><strong>ADDING THE HAZARD DATA</strong></h4>
<p class="noindent">Between the <span class="literal">AIR</span> and <span class="literal">START</span> sections, we’ll add a new section to the program called <span class="literal">HAZARDS</span>. <a href="ch12.xhtml#ch12list4">Listing 12-4</a> shows you the hazard data. Add it to your program, and save it as <em>listing12-4.py</em>. If you run the program, it won’t do anything new yet, but you can check that you don’t get any error messages in the command line window.</p>
<p class="margin"><em>listing12-4.py</em></p>
<p class="programs">   <span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>       <span class="gray">sounds.alarm.play(3)</span><br/>       <span class="gray">sounds.say_breach.play()</span>    <br/><br/>   <span class="red">###############</span><br/>   <span class="red">##  HAZARDS  ##</span><br/>   <span class="red">###############</span><br/><br/>   hazard_data = {<br/>       <span class="red"># room number: [[y, x, direction, bounce addition to direction]]</span><br/><span class="ent">➊</span>     28: [[1, 8, 2, 1], [7, 3, 4, 1]], 32: [[1, 5, 1, 1]],<br/>       34: [[5, 1, 1, 1], [5, 5, 1, 2]], 35: [[4, 4, 1, 2], [2, 5, 2, 2]],<br/>       36: [[2, 1, 2, 2]], 38: [[1, 4, 3, 2], [5, 8, 1, 2]],<br/>       40: [[3, 1, 3, 1], [6, 5, 2, 2], [7, 5, 4, 2]],<br/>       41: [[4, 5, 2, 2], [6, 3, 4, 2], [8, 1, 2, 2]],<br/>       42: [[2, 1, 2, 2], [4, 3, 2, 2], [6, 5, 2, 2]],<br/>       46: [[2, 1, 2, 2]],<br/>       48: [[1, 8, 3, 2], [8, 8, 1, 2], [3, 9, 3, 2]]<br/>       }<br/><br/><br/>   <span class="gray">###############</span><br/>   <span class="gray">##   START   ##</span><br/>   <span class="gray">###############</span><br/>   <span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list4"><em>Listing 12-4: Adding the hazard data</em></p>
<p class="indent">We create a <span class="literal">hazard_data</span> dictionary that uses room numbers as dictionary keys. For each room, there is a list that contains the data for all the hazards. The data for each hazard is in a list that contains the hazard’s <em>y</em> position, <em>x</em> position, starting direction, and number to add when it hits something.</p>
<p class="indent">For example, room 28 <span class="ent">➊</span> has a hazard with the list data <span class="literal">[7, 3, 4, 1]</span>. This means the hazard starts at <em>y</em> = 7, <em>x</em> = 3. It starts moving left (direction 4), and it moves clockwise when it hits something because we add 1 to its direction number.</p>
<p class="indent">Room 41 contains three hazards (in three lists), which are moving from left to right and back again. We know that because they start with a direction of 2 or 4 (right or left) and add 2 to the direction when they hit something (making 4 or 6: we know that 6 becomes 2 after we subtract 4).</p>
<h4 class="h4" id="lev155"><span epub:type="pagebreak" id="page_205"/><strong>SAPPING THE PLAYER’S ENERGY</strong></h4>
<p class="noindent">After the hazard data, we need to add a function called <span class="literal">deplete_energy()</span>, which reduces the player’s energy when a hazard hits them. <a href="ch12.xhtml#ch12list5">Listing 12-5</a> shows the new function. Add it after <a href="ch12.xhtml#ch12list4">Listing 12-4</a> in the <span class="literal">HAZARDS</span> section of the program, and save your program as <em>listing12-5.py</em>. You can run the program to check for errors using <span class="codestrong">pgzrun listing12-5.py</span>, but it won’t do anything new.</p>
<p class="margin"><em>listing12-5.py</em></p>
<p class="programs">   <span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>       <span class="gray">46: [[2, 1, 2, 2]],</span><br/>       <span class="gray">48: [[1, 8, 3, 2], [8, 8, 1, 2], [3, 9, 3, 2]]</span><br/>       <span class="gray">}</span><br/><br/><span class="ent">➊</span> <span class="orange">def</span> <span class="blue">deplete_energy</span>(penalty):<br/>       <span class="orange">global</span> energy, game_over<br/>       <span class="orange">if</span> game_over:<br/>           <span class="orange">return</span> <span class="red"># Don't sap energy when they're already dead.</span><br/><span class="ent">➋</span>     energy = energy - penalty<br/>       draw_energy_air()<br/>       <span class="orange">if</span> energy &lt; 1:<br/>           end_the_game(<span class="green">"You're out of energy!"</span>)<br/><br/><br/>   <span class="gray">###############</span><br/>   <span class="gray">##   START   ##</span><br/>   <span class="gray">###############</span><br/>   <span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list5"><em>Listing 12-5: Reducing the player’s energy</em></p>
<p class="indent">The <span class="literal">deplete_energy()</span> function accepts a number <span class="ent">➊</span> and uses that number to reduce the player’s <span class="literal">energy</span> variable <span class="ent">➋</span>. As a result, we can use this function for hazards that drain different amounts of energy.</p>
<h4 class="h4" id="lev156"><strong>STARTING AND STOPPING HAZARDS</strong></h4>
<p class="noindent">When the player enters a new room, the function <span class="literal">hazard_start()</span> puts the hazards into the room. <a href="ch12.xhtml#ch12list6">Listing 12-6</a> shows this function, which you need to add after the <span class="literal">deplete_energy()</span> function in the <span class="literal">HAZARDS</span> section of the program. Save your program as <em>listing12-6.py</em>. If you run it using <span class="codestrong">pgzrun</span> <span class="codestrong">listing12</span><span class="codestrong">-6.py</span>, you shouldn’t notice any difference yet, because we haven’t set this function to run.</p>
<p class="margin"><em>listing12-6.py</em></p>
<p class="programs">   <span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>       <span class="gray">if energy &lt; 1:</span><br/>           <span class="gray">end_the_game("You're out of energy!")</span><br/><br/>   <span class="orange">def</span> <span class="blue">hazard_start</span>():<br/>       <span class="orange">global</span> current_room_hazards_list, hazard_map<br/><span class="ent">➊</span>     <span class="orange">if</span> current_room <span class="orange">in</span> hazard_data.keys():<br/><span class="ent">➋</span>         current_room_hazards_list = hazard_data[current_room]<br/><span epub:type="pagebreak" id="page_206"/><span class="ent">➌</span>         <span class="orange">for</span> hazard <span class="orange">in</span> current_room_hazards_list:<br/>               hazard_y = hazard[0]<br/>               hazard_x = hazard[1]<br/><span class="ent">➍</span>             hazard_map[hazard_y][hazard_x] = 49 + (current_room % 3)<br/><span class="ent">➎</span>         clock.schedule_interval(hazard_move, 0.15)<br/><br/><br/>   <span class="gray">###############</span><br/>   <span class="gray">##   START   ##</span><br/>   <span class="gray">###############</span><br/>   <span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list6"><em>Listing 12-6: Adding the hazards to the current room</em></p>
<p class="indent">The <span class="literal">hazard_start()</span> function will run whenever the player enters a new room, so it begins by checking whether the current room has an entry in the <span class="literal">hazard_data</span> dictionary <span class="ent">➊</span>. If it does, that room should have moving hazards in it, and the rest of the function runs. We put the hazard data for the room into a list called <span class="literal">current_room_hazards_list</span> <span class="ent">➋</span>. The function then uses a loop <span class="ent">➌</span> to process each hazard in the list in turn.</p>
<p class="indent">The hazards use their own room map called <span class="literal">hazard_map</span>, so they can easily fly over objects on the floor without overwriting them in the room map. If the hazards used the same room map as the props, they would wipe out props as they flew over them, or we’d need a complicated way to remember what’s underneath the hazards.</p>
<p class="indent">The three hazard objects have the numbers 49, 50, and 51 in the <span class="literal">objects</span> dictionary. The program uses a simple calculation to work out which one goes into a particular room. As you’ve seen before, Python’s <span class="literal">%</span> operator gives you the remainder after doing a division. When you divide any number by 3, the remainder will be 0, 1, or 2. So the program divides the room number by 3 and adds the remainder to 49 to pick an object number <span class="ent">➍</span>. So, for example, if we were in room 34, the program would work out that <span class="literal">34 % 3</span> is 1, and add 1 to 49 to select hazard number 50 for all the hazards in that room.</p>
<p class="indent">This way of selecting hazard numbers ensures the hazard is always the same type when the player enters the room. Because the map is five rooms wide, it also guarantees that two directly connected rooms cannot have the same hazard in them. That adds a sense of variety to the map, although not all rooms have hazards, so in practice, players might still encounter the same hazard twice in a row, walking through some empty rooms in between.</p>
<p class="indent">The function finishes by scheduling the <span class="literal">hazard_move()</span> function to run every 0.15 seconds <span class="ent">➎</span>.</p>
<p class="indent">To start the <span class="literal">hazard_start()</span> function when the player enters a new room, add an instruction to the <span class="literal">start_room()</span> function, as shown in <a href="ch12.xhtml#ch12list7">Listing 12-7</a>. Save your program as <em>listing12-7.py</em>. This version of the program will freeze when you leave the start room, because we haven’t finished adding the code for the hazards yet.</p>
<p class="margin"><span epub:type="pagebreak" id="page_207"/><em>listing12-7.py</em></p>
<p class="programs"><span class="gray">--<span class="codeitalic1">snip</span>--</span><br/><span class="gray">###############</span><br/><span class="gray">## GAME LOOP ##</span><br/><span class="gray">###############</span><br/><br/><span class="gray">def start_room():</span><br/>    <span class="gray">global airlock_door_frame</span><br/>    <span class="gray">show_text("You are here: " + room_name, 0)</span><br/>    <span class="gray">if current_room == 26: # Room with self-shutting airlock door</span><br/>        <span class="gray">airlock_door_frame = 0</span><br/>        <span class="gray">clock.schedule_interval(door_in_room_26, 0.05)</span><br/>    hazard_start()<br/>--<span class="codeitalic1">snip</span>--</p>
<p class="listing" id="ch12list7"><em>Listing 12-7: Starting hazards when the player enters the room</em></p>
<p class="indent">Not all rooms have hazards, so we will stop the hazards from moving when the player leaves a room. We previously added instructions in the <span class="literal">game_loop()</span> function to turn off the function that makes the hazards move when the player changes room. We commented them out because we weren’t ready for them yet.</p>
<p class="indent">We’re ready for them now! Follow these steps to uncomment the instructions (you did something similar in <a href="ch08.xhtml#ch08">Chapter 8</a>):</p>
<ol>
<li class="noindent">Click <strong>Edit</strong> <span class="ent">▸</span> <strong>Replace</strong> (or press <small>CTRL</small>-H) in IDLE to show the Replace Text dialog box.</li>
<li class="noindent">Type <span class="codestrong">#clock.unschedule(hazard_move)</span> into the Find box.</li>
<li class="noindent">Type <span class="codestrong">clock.unschedule(hazard_move)</span> into the Replace With box.</li>
<li class="noindent">Click <strong>Replace All</strong>. IDLE should replace the instruction in four places, and jump to the last one in the listing. <a href="ch12.xhtml#ch12list8">Listing 12-8</a> shows the new line that will be highlighted at the end of the process (you don’t need to type this listing in). Above this block of code, there are three similar blocks that also now stop the hazards moving when the player leaves the room through one of the exits.</li>
</ol>
<p class="margin"><em>listing12-8.py</em></p>
<p class="programs"><span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>    <span class="gray">if player_y == -1: # through door at TOP</span><br/>        clock.unschedule(hazard_move)<br/>        <span class="gray">current_room -= MAP_WIDTH</span><br/>        <span class="gray">generate_map()</span><br/>        <span class="gray">player_y = room_height - 1 # enter at bottom</span><br/>        <span class="gray">player_x = int(room_width / 2) # enter at door</span><br/>        <span class="gray">player_frame = 0</span><br/>        <span class="gray">start_room()</span><br/>        <span class="gray">return</span><br/><span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list8"><em>Listing 12-8: Stopping hazards when the player leaves the room</em></p>
<p class="indent"><span epub:type="pagebreak" id="page_208"/>Save your updated program as <em>listing12-8.py</em>. If you run this version of the program, you’ll see an error message in the console, and the game will freeze when you leave the room. The reason is that we haven’t added the <span class="literal">hazard_move()</span> function yet.</p>
<h4 class="h4" id="lev157"><strong>SETTING UP THE HAZARD MAP</strong></h4>
<p class="noindent">We now need to make sure that when the room map is generated for scenery and props, an empty hazard map is also generated. The <span class="literal">hazard_start()</span> function will fill it with any hazards in the room.</p>
<p class="indent">Add the new code shown in <a href="ch12.xhtml#ch12list9">Listing 12-9</a> at the end of the <span class="literal">generate_map()</span> function in the <span class="literal">MAKE MAP</span> section of the program. Place this new code just before the <span class="literal">GAME LOOP</span> section, and make sure you indent the first line by four spaces because it’s inside a function.</p>
<p class="indent">Save your program as <em>listing12-9.py</em>. When you run it, the program won’t work properly yet because it is still incomplete.</p>
<p class="margin"><em>listing12-9.py</em></p>
<p class="programs"><span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>                <span class="gray">for tile_number in range(1, image_width_in_tiles):</span><br/>                    <span class="gray">room_map[prop_y][prop_x + tile_number] = 255    </span><br/><br/>    hazard_map = [] <span class="red"># empty list</span><br/>    <span class="orange">for</span> y <span class="orange">in</span> <span class="purple">range</span>(room_height):<br/>        hazard_map.append( [0] * room_width )<br/><br/><span class="gray">###############</span><br/><span class="gray">## GAME LOOP ##</span><br/><span class="gray">###############</span><br/><span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list9"><em>Listing 12-9: Creating the empty hazard map</em></p>
<p class="indent">These new instructions create an empty list for the hazard map and fill it with rows of 0s that are as wide as the room width.</p>
<h4 class="h4" id="lev158"><strong>MAKING THE HAZARDS MOVE</strong></h4>
<p class="noindent">Now let’s add the missing <span class="literal">hazard_move()</span> function to make the hazards move. Put this at the end of the <span class="literal">HAZARDS</span> section of the program after the <span class="literal">hazard_start()</span> function, as shown in <a href="ch12.xhtml#ch12list10">Listing 12-10</a>. Save your program as <em>listing12-10.py</em>.</p>
<p class="margin"><em>listing12-10.py</em></p>
<p class="programs">   <span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>               <span class="gray">hazard_map[hazard_y][hazard_x] = 49 + (current_room % 3)</span><br/>           <span class="gray">clock.schedule_interval(hazard_move, 0.15)</span><br/><br/>   <span class="orange">def</span> <span class="blue">hazard_move</span>():<br/>       <span class="orange">global</span> current_room_hazards_list, hazard_data, hazard_map<br/>       <span class="orange">global</span> old_player_x, old_player_y<br/><br/>       <span class="orange">if</span> game_over:<br/>           <span class="orange">return</span><br/><span epub:type="pagebreak" id="page_209"/>       <span class="orange">for</span> hazard <span class="orange">in</span> current_room_hazards_list:<br/>           hazard_y = hazard[0]<br/>           hazard_x = hazard[1]<br/>           hazard_direction = hazard[2]<br/><br/><span class="ent">➊</span>         old_hazard_x = hazard_x<br/>           old_hazard_y = hazard_y<br/>           hazard_map[old_hazard_y][old_hazard_x] = 0<br/><br/><span class="ent">➋</span>         <span class="orange">if</span> hazard_direction == 1: <span class="red"># up</span><br/>               hazard_y -= 1<br/>           <span class="orange">if</span> hazard_direction == 2: <span class="red"># right</span><br/>               hazard_x += 1<br/>           <span class="orange">if</span> hazard_direction == 3: <span class="red"># down</span><br/>               hazard_y += 1<br/>           <span class="orange">if</span> hazard_direction == 4: <span class="red"># left</span><br/>               hazard_x -= 1<br/><br/>           hazard_should_bounce = <span class="orange">False</span><br/><br/><span class="ent">➌</span>         <span class="orange">if</span> (hazard_y == player_y <span class="orange">and</span> hazard_x == player_x) <span class="orange">or</span> \<br/>              (hazard_y == from_player_y <span class="orange">and</span> hazard_x == from_player_x<br/>               <span class="orange">and</span> player_frame &gt; 0):<br/>               sounds.ouch.play()<br/>               deplete_energy(10)<br/>               hazard_should_bounce = <span class="orange">True</span><br/><br/><span class="ent">➍</span>         <span class="red"># Stop hazard going out of the doors</span><br/>           <span class="orange">if</span> hazard_x == room_width:<br/>               hazard_should_bounce = <span class="orange">True</span><br/>               hazard_x = room_width - 1<br/>           <span class="orange">if</span> hazard_x == -1:<br/>               hazard_should_bounce = <span class="orange">True</span><br/>               hazard_x = 0<br/>           <span class="orange">if</span> hazard_y == room_height:<br/>               hazard_should_bounce = <span class="orange">True</span><br/>               hazard_y = room_height - 1<br/>           <span class="orange">if</span> hazard_y == -1:<br/>               hazard_should_bounce = <span class="orange">True</span><br/>               hazard_y = 0<br/><br/><span class="ent">➎</span>         <span class="red"># Stop when hazard hits scenery or another hazard.</span><br/>           <span class="orange">if</span> room_map[hazard_y][hazard_x] <span class="orange">not in</span> items_player_may_stand_on \<br/>                  <span class="orange">or</span> hazard_map[hazard_y][hazard_x] != 0:<br/>               hazard_should_bounce = <span class="orange">True</span><br/><br/><span class="ent">➏</span>         <span class="orange">if</span> hazard_should_bounce:<br/>               hazard_y = old_hazard_y <span class="red"># Move back to last valid position.</span><br/>               hazard_x = old_hazard_x<br/><span class="ent">➐</span>             hazard_direction += hazard[3]<br/><span class="ent">➑</span>             <span class="orange">if</span> hazard_direction &gt; 4:<br/>                   hazard_direction -= 4<br/>               <span class="orange">if</span> hazard_direction &lt; 1:<br/>                   hazard_direction += 4<br/><span class="ent">➒</span>             hazard[2] = hazard_direction<br/><span epub:type="pagebreak" id="page_210"/><span class="ent">➓</span>         hazard_map[hazard_y][hazard_x] = 49 + (current_room % 3)<br/>           hazard[0] = hazard_y<br/>           hazard[1] = hazard_x<br/><br/><br/>   <span class="gray">###############</span><br/>   <span class="gray">##   START   ##</span><br/>   <span class="gray">###############</span><br/>   <span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list10"><em>Listing 12-10: Adding the hazard movement function</em></p>
<p class="indent">The <span class="literal">hazard_move()</span> function uses an idea similar to the player movement. The hazard’s position is stored in the <span class="literal">old_hazard_x</span> and <span class="literal">old_hazard_y</span> variables <span class="ent">➊</span>. The hazard is then moved <span class="ent">➋</span>.</p>
<p class="indent">Then we check whether the hazard has hit the player <span class="ent">➌</span>, gone out the door <span class="ent">➍</span>, or hit the scenery or another hazard <span class="ent">➎</span>. If it has <span class="ent">➏</span>, then its position is reset to its old values, and we change its direction by adding the last number in its list of data to the direction number <span class="ent">➐</span>. If adding this number increases the direction number to more than 4 <span class="ent">➑</span>, the function subtracts 4, as we discussed earlier in this chapter, because 4 is the highest valid direction number. On the other hand, if adding this number decreases the direction number to less than 1, the function adds 4. Finally, the new direction is saved in the hazard data <span class="ent">➒</span>.</p>
<p class="indent">At the end of the function <span class="ent">➓</span>, the hazard is put into the hazard map.</p>
<p class="indent">You can run this program using <span class="codestrong">pgzrun listing12-10.py</span>. The first room with a hazard is the one to the right of your starting room. When you enter it, your energy will mysteriously go down sometimes, even though you can’t see anything dangerous. This is because we haven’t added code to draw the hazards yet.</p>
<div class="sidebar1">
<p class="sidebart"><strong>TIP</strong></p>
<p class="spara">When a hazard hits you <span class="ent">➌</span>, the <span class="literal">deplete_energy()</span> function reduces your energy by 10 percent. If you find the game too difficult, you can change this number to 5. If you complete the game and want a tougher challenge the next time around, you could change it to 20!</p>
</div>
<h4 class="h4" id="lev159"><strong>DISPLAYING HAZARDS IN THE ROOM</strong></h4>
<p class="noindent">It doesn’t seem fair to have invisible dangers, so let’s add a few lines to show the hazards in the room. <a href="ch12.xhtml#ch12list11">Listing 12-11</a> shows three new lines to add to the <span class="literal">draw()</span> function in the <span class="literal">DISPLAY</span> section of the program. Put these near the end of the function, before the code to draw the player.</p>
<p class="indent">Indent these instructions by a total of 12 spaces because they’re inside the <span class="literal">draw()</span> function (4 spaces), inside the <span class="literal">y</span> loop (another 4), and inside the <span class="literal">x</span> loop (another 4-space indentation). Save your program as <em>listing12-11.py</em>.</p>
<p class="margin"><span epub:type="pagebreak" id="page_211"/><em>listing12-11.py</em></p>
<p class="programs"><span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>                        <span class="gray"># Use shadow across width of object.</span><br/>                        <span class="gray">for z in range(0, shadow_width):</span><br/>                            <span class="gray">draw_shadow(shadow_image, y, x+z)</span><br/>                    <span class="gray">else:</span><br/>                        <span class="gray">draw_shadow(shadow_image, y, x)</span><br/><br/>            hazard_here = hazard_map[y][x]<br/>            <span class="orange">if</span> hazard_here != 0: <span class="red"># If there's a hazard at this position</span><br/>                draw_image(objects[hazard_here][0], y, x)<br/><br/>        <span class="gray">if (player_y == y):</span><br/>                <span class="gray">draw_player()</span><br/><span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list11"><em>Listing 12-11: Displaying the moving hazards</em></p>
<p class="indent">This listing completes the moving hazards. Run your program using <span class="codestrong">pgzrun listing12-11.py</span>. Then start running for your life! You should now be able to see the moving hazards, such as the energy ball shown in <a href="ch12.xhtml#ch12fig4">Figure 12-4</a>.</p>
<div class="image"><a id="ch12fig4"/><img src="../images/fig12-4.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-4: This energy ball bounces around the room in a counterclockwise pattern.</em></p>
<div class="sidebar">
<p class="sidebart" id="ch12sb2"><strong>TRAINING MISSION #2</strong></p>
<p class="spara">Test that the moving hazards work correctly. Enter the room to the right of your start room (or teleport into room 32 if necessary). When the energy ball hits you, does your energy decrease? Does the energy ball bounce off you? Can you bounce the energy ball into both doorways to check that it stays in the room? Does the game end when you run out of energy?</p>
</div>
<h4 class="h4" id="lev160"><span epub:type="pagebreak" id="page_212"/><strong>STOPPING THE PLAYER FROM WALKING THROUGH HAZARDS</strong></h4>
<p class="noindent">We also need to add a line to stop the player from walking into or through hazards. In practice, the hazard will usually bounce off the player, but without making the fix shown in <a href="ch12.xhtml#ch12list12">Listing 12-12</a>, it’s sometimes possible to pass through the hazard.</p>
<p class="indent">We already added the code we need in the <span class="literal">game_loop()</span> function, but we commented it out. Now it’s time to uncomment it by deleting the <span class="literal">#</span> symbol before the <span class="literal">\</span> at the end of one line, and removing the <span class="literal">#</span> at the start of the next line.</p>
<p class="indent">We also need to delete the colon after <span class="literal">items_player_may_stand_on</span>. A quick way to find the right part of the program is to press <small>CTRL</small>-F to open the search box, and then enter <span class="literal">#\</span>. <a href="ch12.xhtml#ch12list12">Listing 12-12</a> shows you the lines to modify.</p>
<p class="margin"><em>listing12-12.py</em></p>
<p class="programs"><span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>  <span class="gray"># If the player is standing somewhere they shouldn't, move them back.</span><br/>    <span class="orange">if</span> room_map[player_y][player_x] <span class="orange">not in</span> items_player_may_stand_on \<br/>               <span class="orange">or</span> hazard_map[player_y][player_x] != 0:<br/>        <span class="gray">player_x = old_player_x</span><br/>        <span class="gray">player_y = old_player_y</span><br/>        <span class="gray">player_frame = 0</span><br/><span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list12"><em>Listing 12-12: Stopping the player from passing through hazards</em></p>
<p class="indent">Save your program as <em>listing12-12.py</em> and run it with <span class="codestrong">pgzrun</span> <span class="codestrong">listing12-12.py</span>. Can you track down all three types of flying hazards in the space station?</p>
<h3 class="h3" id="lev161"><strong>ADDING THE TOXIC SPILLS</strong></h3>
<p class="noindent">You might have noticed the green splash on the floor in <a href="ch12.xhtml#ch12fig4">Figure 12-4</a>. It’s a toxic spill, and it saps your energy when you walk on it. You’ll have to think strategically. Should you run through it to get somewhere faster? Or should you walk carefully around it, saving your energy for later but maybe slowing you down?</p>
<p class="indent"><a href="ch12.xhtml#ch12list13">Listing 12-13</a> shows the instructions to add to sap your energy when you’re walking on the toxic floor. These instructions go in the <span class="literal">game_loop()</span> function, just after the instructions you fixed in <a href="ch12.xhtml#ch12list12">Listing 12-12</a>.</p>
<p class="indent">Save your program as <em>listing12-13.py</em>. You can test that it works by running the program using <span class="codestrong">pgzrun listing12-13.py</span> and then walking on the toxic floor. The toxic floor is object 48 and is positioned as scenery in the room.</p>
<p class="margin"><em>listing12-13.py</em></p>
<p class="programs"><span class="gray">--<span class="codeitalic1">snip</span>--</span><br/>  <span class="gray"># If the player is standing somewhere they shouldn't, move them back.</span><br/>    <span class="gray">if room_map[player_y][player_x] not in items_player_may_stand_on \</span><br/>               <span class="gray">or hazard_map[player_y][player_x] != 0:</span><br/><span epub:type="pagebreak" id="page_213"/>        <span class="gray">player_x = old_player_x</span><br/>        <span class="gray">player_y = old_player_y</span><br/>        <span class="gray">player_frame = 0</span><br/><br/>    <span class="orange">if</span> room_map[player_y][player_x] == 48: <span class="red"># toxic floor</span><br/>        deplete_energy(1)<br/><br/>    <span class="gray">if player_direction == "right" and player_frame &gt; 0:</span><br/>        <span class="gray">player_offset_x = -1 + (0.25 * player_frame)</span><br/><span class="gray">--<span class="codeitalic1">snip</span>--</span></p>
<p class="listing" id="ch12list13"><em>Listing 12-13: Reducing the player’s energy when they walk on the toxic floor</em></p>
<h3 class="h3" id="lev162"><strong>MAKING THE FINISHING TOUCHES</strong></h3>
<p class="noindent">The game is now nearly complete. Before you embark on your exploration of the space station, we need to remove some of the instructions we used while building and testing the game.</p>
<h4 class="h4" id="lev163"><strong>DISABLING THE TELEPORTER</strong></h4>
<p class="noindent">Mission rules forbid the use of the teleporter once your work on the space station begins. Find its instructions in the <span class="literal">game_loop()</span> function, highlight them using your mouse, and then click <strong>Format</strong> <span class="ent">▸</span> <strong>Comment Out Region</strong> to disable them. Your code should now look like <a href="ch12.xhtml#ch12list14">Listing 12-14</a>.</p>
<p class="margin"><em>listing12-14.py</em></p>
<p class="programs">--<span class="codeitalic1">snip</span>--<br/><span class="red">#### Teleporter for testing</span><br/><span class="red">#### Remove this section for the real game</span><br/><span class="red">##    if keyboard.x:</span><br/><span class="red">##        current_room = int(input("Enter room number:"))</span><br/><span class="red">##        player_x = 2</span><br/><span class="red">##        player_y = 2</span><br/><span class="red">##        generate_map()</span><br/><span class="red">##        start_room()</span><br/><span class="red">##        sounds.teleport.play()</span><br/><span class="red">#### Teleport section ends</span><br/>--<span class="codeitalic1">snip</span>--</p>
<p class="listing" id="ch12list14"><em>Listing 12-14: The teleporter is turned off.</em></p>
<h4 class="h4" id="lev164"><strong>CLEANING UP THE DATA</strong></h4>
<p class="noindent">While testing the game, you might have changed the contents of some of the variables and lists. The game should look like <a href="ch12.xhtml#ch12fig5">Figure 12-5</a> when it begins. If it doesn’t, look at the <span class="literal">VARIABLES</span> section of the program and make sure the <span class="literal">current_room</span> variable is set to 31.</p>
<div class="image"><span epub:type="pagebreak" id="page_214"/><a id="ch12fig5"/><img src="../images/fig12-5.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 12-5: The start of your mission</em></p>
<p class="indent">If you’re carrying more than your yoyo, look at the <span class="literal">PROPS</span> part of the program and check that this line is correct:</p>
<p class="programs">in_my_pockets = [55]</p>
<h4 class="h4" id="lev165"><strong>YOUR ADVENTURE BEGINS</strong></h4>
<p class="noindent">It’s an exciting moment: your training is complete; the space station is ready; and your mission on Mars is about to begin. Let’s set a sci-fi fanfare to play when the game starts. <a href="ch12.xhtml#ch12list15">Listing 12-15</a> shows the final instruction you’ll add to <em>Escape</em>.</p>
<p class="margin"><em>listing12-15.py</em></p>
<p class="programs"><span class="gray">--</span><span class="codeitalic1">snip</span><span class="gray">--</span><br/><span class="gray">clock.schedule_unique(alarm, 10)</span><br/><span class="gray">clock.schedule_interval(air_countdown, 11) # A higher number gives a longer</span><br/><span class="gray">time limit.</span><br/>sounds.mission.play() <span class="red"># Intro music</span></p>
<p class="listing" id="ch12list15"><em>Listing 12-15: A sci-fi fanfare plays when the game begins.</em></p>
<p class="indent">Save your final program as <em>escape.py</em>. You can now play the game using <span class="codestrong">pgzrun escape.py</span>. See “<a href="intro.xhtml#lev15">Playing the Game</a>” on <a href="intro.xhtml#page_11">page 11</a> for instructions.</p>
<p class="indent">Congratulations on completing the space station construction. You’ve truly earned your place on this mission. It’s time to begin your work on the planet’s surface!</p>
<h3 class="h3" id="lev166"><span epub:type="pagebreak" id="page_215"/><strong>YOUR NEXT MISSION: CUSTOMIZING THE GAME</strong></h3>
<p class="noindent">Did you make it to safety in the <em>Escape</em> game? That was a close shave! For your next mission, try customizing the game. There are different ways to use this book, so you might already have made some customizations as you built the game. Here are some suggestions for modifying the game, starting with the easiest:</p>
<ul>
<li class="noindent">Change the names of the characters in the game to those of your friends. See <a href="ch04.xhtml#ch04list1">Listing 4-1</a> on <a href="ch04.xhtml#page_63">page 63</a> in <a href="ch04.xhtml#ch04">Chapter 4</a>.</li>
<li class="noindent">Customize the images. You can edit our images, or create your own. The game includes a whiteboard image that you can edit using your favorite art package. If you make your images the same size as ours, use the same filenames, and store them in the <em>images</em> folder, they should just drop into the game world with no problem.</li>
<li class="noindent">Redesign the room layouts. <a href="ch06.xhtml#ch06">Chapter 6</a> explains how scenery is positioned in a room.</li>
<li class="noindent">Add your own objects to the game. Start by creating their images. Props should be 30 pixels square. Scenery items can be bigger and should touch the left and right sides of their tile spaces so that it doesn’t look odd when the player can’t get closer to the scenery than the tile next door. (For example, if your image is 30, 60, or 90 pixels wide and touches the ground at both sides, it should look fine.) You need to add the new items in the <span class="literal">objects</span> dictionary (see <a href="ch05.xhtml#ch05">Chapter 5</a>). For help positioning scenery, see <a href="ch06.xhtml#ch06">Chapter 6</a>. For advice on positioning props, see <a href="ch09.xhtml#ch09">Chapter 9</a>.</li>
<li class="noindent">Create your own space station map (see <a href="ch04.xhtml#ch04">Chapter 4</a>).</li>
<li class="noindent">Use the game engine to make your own game. You can replace the images and maps, and code your own puzzles to make a new game based on the <em>Escape</em> code. The <span class="literal">USE OBJECTS</span> section is where the game puzzles are programmed. It details what happens when objects are used, individually or in combination with other objects. It might be useful to keep the code for combining objects (recipes) and just update it (see <a href="ch10.xhtml#ch10">Chapter 10</a>); keep the code for displaying standard responses (see <a href="ch10.xhtml#ch10">Chapter 10</a>); and keep the code for opening doors (see <a href="ch11.xhtml#ch11">Chapter 11</a>).</li>
</ul>
<p class="indent">If you make any changes that affect room 26, you’ll need to disable the code for its pressure pad (see <a href="ch11.xhtml#ch11">Chapter 11</a>).</p>
<p class="indent">Bear in mind that any changes you make might break the puzzles in the original <em>Escape</em> game, making it impossible to complete. For example, it might become impossible to find important tools. I recommend saving any changes you make separately, so you can always come back to the original code.</p>
<div class="sidebar1">
<p class="sidebart"><span epub:type="pagebreak" id="page_216"/><strong>SHARING YOUR CUSTOMIZATIONS</strong></p>
<p class="spara">I’d love to hear about your customizations! You can find me on Twitter at @musicandwords or visit my website at <em><a href="http://www.sean.co.uk">www.sean.co.uk</a></em>, which includes bonus content for the book. If you share your modified <em>Escape</em> game with others or share your own games built using its code, sounds, or images, please credit this book and its author, and make it clear that you’ve modified the code. Thank you!</p>
</div>
<h3 class="h3" id="lev167"><strong>ARE YOU FIT TO FLY?</strong></h3>
<p class="noindentb">Check the following boxes to confirm that you’ve learned the key lessons in this chapter.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  You can use Pygame Zero to draw text with a shadow underneath it and can adjust the size of the text displayed.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  You can play a sound multiple times by putting the number of times in parentheses in its <span class="literal">sounds.</span><span class="codeitalic">sound_name</span><span class="literal">.play()</span> instruction.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  The moving hazards’ directions are numbered from 1 at the top, moving clockwise. To create a movement pattern for a hazard, you provide the number you want to add to its direction number when it hits something.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  The <span class="literal">deplete_energy()</span> function reduces the player’s energy.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  Hazards use their own room map called <span class="literal">hazard_map</span>. This enables them to more easily move over objects on the floor.</p>
<p class="square"><img src="../images/box.jpg" alt="Images"/>  Before playing the game, check that the starting variables are correct.</p>
<div class="image" id="ch12sb3"><img src="../images/f0216-01.jpg" alt="image"/></div>
</body></html>