<html><head></head><body>
  <div id="sbo-rt-content"><h2 class="h2" id="ch04"><a id="page_93"/><strong><span class="big">4</span></strong><br/><strong>Algebra and Symbolic Math with SymPy</strong></h2>
<div class="image1"><img src="images/common-01.jpg" alt="image"/></div>
<p class="noindent">The mathematical problems and solutions in our programs so far have all involved the manipulation of numbers. But there’s another way math is taught, learned, and practiced, and that’s in terms of symbols and the operations between them. Just think of all the <em>x</em>s and <em>y</em>s in a typical algebra problem. We refer to this type of math as <em>symbolic math</em>. I’m sure you remember those dreaded “factorize <em>x</em><sup>3</sup> + 3<em>x</em><sup>2</sup> + 3<em>x</em> + 1” problems in your math class. Fear no more, for in this chapter, we learn how to write programs that can solve such problems and much more. To do so, we’ll use <em>SymPy</em>—a Python library that lets you write expressions containing symbols and perform operations on them. Because this is a third-party library, you’ll need to install it before you can use it in your programs. The installation instructions are described in <a href="app01.html#app01">Appendix A</a>.</p>
<h3 class="h3" id="ch04lev1sec01"><a id="page_94"/><strong>Defining Symbols and Symbolic Operations</strong></h3>
<p class="noindent"><em>Symbols</em> form the building blocks of symbolic math. The term <em>symbol</em> is just a general name for the <em>x</em>s, <em>y</em>s, <em>a</em>s, and <em>b</em>s you use in equations and algebraic expressions. Creating and using symbols will let us do things differently than before. Consider the following statements:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">x = 1</span><br/>&gt;&gt;&gt; <span class="codestrong">x + x + 1</span><br/>3</pre>
<p class="indent">Here we create a label, <code>x</code>, to refer to the number 1. Then, when we write the statement <code>x + x + 1</code>, it’s evaluated for us, and the result is 3. What if you wanted the result in terms of the symbol <em>x</em>? That is, if instead of 3, you wanted Python to tell you that the result is 2<em>x</em> + 1? You couldn’t just write <code>x + x + 1</code> <em>without</em> the statement <code>x = 1</code> because Python wouldn’t know what <code>x</code> refers to.</p>
<p class="indent">SymPy lets us write programs where we can express and evaluate mathematical expressions in terms of such symbols. To use a symbol in your program, you have to create an object of the <code>Symbol</code> class, like this:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import Symbol</span><br/>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span></pre>
<p class="indent">First, we import the <code>Symbol</code> class from the <code>sympy</code> library. Then, we create an object of this class passing <code>'x'</code> as a parameter. Note that this <code>'x'</code> is written as a string within quotes. We can now define expressions and equations in terms of this symbol. For example, here’s the earlier expression:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import Symbol</span><br/>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">x + x + 1</span><br/>2*x + 1</pre>
<p class="indent">Now the result is given in terms of the symbol <em>x</em>. In the statement <code>x = Symbol('x')</code>, the <code>x</code> on the left side is the Python label. This is the same kind of label we’ve used before, except this time it refers to the symbol <em>x</em> instead of a number—more specifically, a <code>Symbol</code> object representing the symbol <code>'x'</code>. This label doesn’t necessarily have to match the symbol either— we could have used a label like <code>a</code> or <code>var1</code> instead. So, it’s perfectly fine to write the preceding statements as follows:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">a = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">a + a + 1</span><br/>2*x + 1</pre>
<p class="indent">Using a non-matching label can be confusing, however, so I would recommend choosing a label that’s the same letter as the symbol it refers to.</p>
<div class="sidebar">
<p class="sidebart"><a id="page_95"/><strong>FINDING THE SYMBOL REPRESENTED BY A SYMBOL OBJECT</strong></p>
<p class="noindent">For any <code>Symbol</code> object, its <code>name</code> attribute is a string that is the actual symbol it represents:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">x.name</span><br/>'x'<br/>&gt;&gt;&gt; <span class="codestrong">a = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">a.name</span><br/>'x'</pre>
<p class="indent">You can use <code>.name</code> on a label to retrieve the symbol that it is storing.</p>
</div>
<p class="indent">Just to be clear, the symbol you create has to be specified as a string. For example, you can’t create the symbol <em>x</em> using <code>x = Symbol(x)</code>—you must define it as <code>x = Symbol('x')</code>.</p>
<p class="indent">To define multiple symbols, you can either create separate <code>Symbol</code> objects or use the <code>symbols()</code> function to define them more concisely. Let’s say you wanted to use three symbols—<em>x</em>, <em>y</em>, and <em>z</em>—in your program. You could define them individually, as we did earlier:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">y = Symbol('y')</span><br/>&gt;&gt;&gt; <span class="codestrong">z = Symbol('z')</span></pre>
<p class="indent">But a shorter method would be to use the <code>symbols()</code> function to define all three at once:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import symbols</span><br/>&gt;&gt;&gt; <span class="codestrong">x,y,z = symbols('x,y,z')</span></pre>
<p class="indent">First, we import the <code>symbols()</code> function from SymPy. Then, we call it with the three symbols we want to create, written as a string with commas separating them. After this statement is executed, <code>x</code>, <code>y</code>, and <code>z</code> will refer to the three symbols <code>'x'</code>, <code>'y'</code>, and <code>'z'</code>.</p>
<p class="indent">Once you’ve defined symbols, you can carry out basic mathematical operations on them, using the same operators you learned in <a href="ch01.html#ch01">Chapter 1</a> (<code>+</code>, <code>-</code>, <code>/</code>, <code>*</code>, and <code>**</code>). For example, you might do the following:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import Symbol</span><br/>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">y = Symbol('y')</span><br/><a id="page_96"/><br/>&gt;&gt;&gt; <span class="codestrong">s = x*y + x*y</span><br/>&gt;&gt;&gt; <span class="codestrong">s</span><br/>2*x*y</pre>
<p class="indent">Let’s see whether we can find the product of <code>x(x + x)</code>:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">p = x*(x + x)</span><br/>&gt;&gt;&gt; <span class="codestrong">p</span><br/>2*x**2</pre>
<p class="indent">SymPy will automatically make these simple addition and multiplication calculations, but if we enter a more complex expression, it will remain unchanged. Let’s see what happens when we enter the expression <code>(x + 2)*(x + 3)</code>:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">p = (x + 2)*(x + 3)</span><br/>&gt;&gt;&gt; <span class="codestrong">p</span><br/>(x + 2)*(x + 3)</pre>
<p class="indent">You may have expected SymPy to multiply everything out and output <code>x**2 + 5*x + 6</code>. Instead, the expression was printed exactly how we entered it. SymPy automatically simplifies only the most basic of expressions and leaves it to the programmer to explicitly require simplification in cases such as the preceding one. If you want to multiply out the expression to get the expanded version, you’ll have to use the <code>expand()</code> function, which we’ll see in a moment.</p>
<h3 class="h3" id="ch04lev1sec02"><strong>Working with Expressions</strong></h3>
<p class="noindent">Now that we know how to define our own symbolic expressions, let’s learn more about using them in our programs.</p>
<h4 class="h4" id="ch04lev2sec01"><strong><em>Factorizing and Expanding Expressions</em></strong></h4>
<p class="noindent">The <code>factor()</code> function decomposes an expression into its factors, and the <code>expand()</code> function expands an expression, expressing it as a sum of individual terms. Let’s test out these functions with the basic algebraic identity <em>x</em><sup>2</sup> – <em>y</em><sup>2</sup> = (<em>x</em> + <em>y</em>)(<em>x</em> – <em>y</em>). The left side of the identity is the expanded version, and the right side depicts the corresponding factorization. Because we have two symbols in the identity, we’ll create two <code>Symbol</code> objects:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import Symbol</span><br/>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">y = Symbol('y')</span></pre>
<p class="indent"><a id="page_97"/>Next, we import the <code>factor()</code> function and use it to convert the expanded version (on the left side of the identity) to the factored version (on the right side):</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import factor</span><br/>&gt;&gt;&gt; <span class="codestrong">expr = x**2 - y**2</span><br/>&gt;&gt;&gt; <span class="codestrong">factor(expr)</span><br/>(x - y)*(x + y)</pre>
<p class="indent">As expected, we get the factored version of the expression. Now let’s expand the factors to get back the original expanded version:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">factors = factor(expr)</span><br/>&gt;&gt;&gt; <span class="codestrong">expand(factors)</span><br/>x**2 - y**2</pre>
<p class="indent">We store the factorized expression in a new label, <code>factors</code>, and then call the <code>expand()</code> function with it. When we do this, we receive the original expression we started with. Let’s try it with the more complicated identity <em>x</em><sup>3</sup> + 3<em>x</em><sup>2</sup><em>y</em> + 3<em>xy</em><sup>2</sup> + <em>y</em><sup>3</sup> = (<em>x</em> + <em>y</em>)<sup>3</sup>:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">expr = x**3 + 3*x**2*y + 3*x*y**2 + y**3</span><br/>&gt;&gt;&gt; <span class="codestrong">factors = factor(expr)</span><br/>&gt;&gt;&gt; <span class="codestrong">factors</span><br/>(x + y)**3<br/><br/>&gt;&gt;&gt; <span class="codestrong">expand(factors)</span><br/>x**3 + 3*x**2*y + 3*x*y**2 + y**3</pre>
<p class="indent">The <code>factor()</code> function is able to factorize the expression, and then the <code>expand()</code> function expands the factorized expression to return to the original expression.</p>
<p class="indent">If you try to factorize an expression for which there’s no possible factorization, the original expression is returned by the <code>factor()</code> function. For example, see the following:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">expr = x + y + x*y</span><br/>&gt;&gt;&gt; <span class="codestrong">factor(expr)</span><br/>x*y + x + y</pre>
<p class="indent">Similarly, if you pass in an expression to <code>expand()</code> that can’t be expanded further, it returns the same expression.</p>
<h4 class="h4" id="ch04lev2sec02"><strong><em>Pretty Printing</em></strong></h4>
<p class="noindent">If you want the expressions we’ve been working with to look a bit nicer when you print them, you can use the <code>pprint()</code> function. This function will print the expression in a way that more closely resembles how we’d normally write it on paper. For example, here’s an expression:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">expr = x*x + 2*x*y + y*y</span></pre>
<p class="indent"><a id="page_98"/>If we print it as we’ve been doing so far or use the <code>print()</code> function, this is how it looks:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">expr</span><br/>x**2 + 2*x*y + y**2</pre>
<p class="indent">Now, let’s use the <code>pprint()</code> function to print the preceding expression:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import pprint</span><br/>&gt;&gt;&gt; <span class="codestrong">pprint(expr)</span><br/>x<sup>2</sup> + 2·x·y + y<sup>2</sup></pre>
<p class="indent">The expression now looks much cleaner—for example, instead of having a bunch of ugly asterisks, exponents appear above the rest of the numbers.</p>
<p class="indent">You can also change the order of the terms when you print an expression. Consider the expression 1 + 2<em>x</em> + 2<em>x</em><sup>2</sup>:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">expr = 1 + 2*x + 2*x**2</span><br/>&gt;&gt;&gt; <span class="codestrong">pprint(expr)</span><br/>2·x<sup>2</sup> + 2·x + 1</pre>
<p class="indent">The terms are arranged in the order of powers of <em>x</em>, from highest to lowest. If you want the expression in the opposite order, with the highest power of <em>x</em> last, you can make that happen with the <code>init_printing()</code> function, as follows:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import init_printing</span><br/>&gt;&gt;&gt; <span class="codestrong">init_printing(order='rev-lex')</span><br/>&gt;&gt;&gt; <span class="codestrong">pprint(expr)</span><br/>1 + 2·x + 2·x<sup>2</sup></pre>
<p class="indent">The <code>init_printing()</code> function is first imported and called with the keyword argument <code>order='rev-lex'</code>. This indicates that we want SymPy to print the expressions so that they’re in <em>reverse lexicographical order</em>. In this case, the keyword argument tells Python to print the lower-power terms first.</p>
<div class="note">
<p class="notet"><strong><span class="bordera">NOTE</span></strong></p>
<p class="noindent"><em>Although we used the</em> <code><span class="codeitalic">init_printing()</code></span> <em>function here to set the printed order of the expressions, this function can be used in many other ways to configure how an expression is printed. For more options and to learn more about printing in SymPy, see the documentation at</em> <a href="http://docs.sympy.org/latest/tutorial/printing.html">http://docs.sympy.org/latest/tutorial/printing.html</a>.</p>
</div>
<p class="indent">Let’s apply what we’ve learned so far to implement a series printing program.</p>
<h5 class="h5" id="ch04lev3sec01"><a id="page_99"/><strong>Printing a Series</strong></h5>
<p class="noindent">Consider the following series:</p>
<div class="image2"><img src="images/e0099-01.jpg" alt="image"/></div>
<p class="indent">Let’s write a program that will ask a user to input a number, <em>n</em>, and print this series for that number. In the series, <em>x</em> is a symbol and <em>n</em> is an integer input by the program’s user. The <em>n</em>th term in this series is given by</p>
<div class="image2"><img src="images/e0099-02.jpg" alt="image"/></div>
<p class="indent">We can print this series using the following program:</p>
<pre>   '''<br/>   Print the series:<br/>   x + x**2 + x**3 + ... + x**n<br/>       ____  _____         _____<br/>         2    3              n<br/>   '''<br/><br/>   from sympy import Symbol, pprint, init_printing<br/>   def print_series(n):<br/><br/>       # Initialize printing system with reverse order<br/>       init_printing(order='rev-lex')<br/><br/>       x = Symbol('x')<br/><span class="ent">➊</span>     series = x<br/><span class="ent">➋</span>         for i in range(2, n+1):<br/><span class="ent">➌</span>         series = series + (x**i)/i<br/>       pprint(series)<br/><br/>   if __name__ == '__main__':<br/>       n = input('Enter the number of terms you want in the series: ')<br/><span class="ent">➍</span>     print_series(int(n))</pre>
<p class="indent">The <code>print_series()</code> function accepts an integer, <code>n</code>, as a parameter that is the number of terms in the series that will be printed. Note that we convert the input to an integer using the <code>int()</code> function when calling the function at <span class="ent">➍</span>. We then call the <code>init_printing()</code> function to set the series to print in reverse lexicographical order.</p>
<p class="indent">At <span class="ent">➊</span>, we create the label, <code>series</code>, and set its initial value as <code>x</code>. Then, we define a <code>for</code> loop that will iterate over the integers from 2 to <code>n</code> at <span class="ent">➋</span>. Each time the loop iterates, it adds each term to <code>series</code> at <span class="ent">➌</span>, as follows:</p>
<pre>i = 2, series = x + x**2 / 2<br/>i = 3, series = x + x**2/2 + x**3/3<br/><br/>--<span class="codeitalic">snip</span>--</pre>
<p class="indent"><a id="page_100"/>The value of <code>series</code> starts off as just plain <code>x</code>, but with each iteration, <code>x**i/i</code> gets added to the value of <code>series</code> until the series we want is completed. You can see SymPy addition put to good use here. Finally, the <code>pprint()</code> function is used to print the series.</p>
<p class="indent">When you run the program, it asks you to input a number and then prints the series up to that term:</p>
<pre>Enter the number of terms you want in the series: <span class="codestrong">5</span><br/><br/>    x<sup>2</sup> x<sup>3</sup> x<sup>4</sup> x<sup>5</sup><br/>x + -- + -- + -- + --<br/>    2    3    4    5</pre>
<p class="indent">Try this out with a different number of terms every time. Next, we’ll see how to calculate the sum of this series for a certain value of <em>x</em>.</p>
<h4 class="h4" id="ch04lev2sec03"><strong><em>Substituting in Values</em></strong></h4>
<p class="noindent">Let’s see how we can use SymPy to plug values into an algebraic expression. This will let us calculate the value of the expression for certain values of the variables. Consider the mathematical expression <em>x</em><sup>2</sup> + 2<em>xy</em> + <em>y</em><sup>2</sup>, which can be defined as follows:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">y = Symbol('y')</span><br/>&gt;&gt;&gt; <span class="codestrong">x*x + x*y + x*y + y*y</span><br/>x**2 + 2*x*y + y**2</pre>
<p class="indent">If you want to evaluate this expression, you can substitute numbers in for the symbols using the <code>subs()</code> method:</p>
<pre><span class="ent">➊</span> &gt;&gt;&gt; <span class="codestrong">expr = x*x + x*y + x*y + y*y</span><br/>   &gt;&gt;&gt; <span class="codestrong">res = expr.subs({x:1, y:2})</span></pre>
<p class="indent">First, we create a new label to refer to the expression at <span class="ent">➊</span>, and then we call the <code>subs()</code> method. The argument to the <code>subs()</code> method is a Python <em>dictionary</em>, which contains the two symbol labels and the numerical values we want to substitute in for each symbol. Let’s check out the result:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">res</span><br/>9</pre>
<p class="indent">You can also express one symbol in terms of another and substitute accordingly, using the <code>subs()</code> method. For example, if you knew that <em>x</em> = 1 – <em>y</em>, here’s how you could evaluate the preceding expression:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">expr.subs({x:1-y})</span><br/>y**2 + 2*y*(-y + 1) + (-y + 1)**2</pre>
<div class="sidebar">
<p class="sidebart"><a id="page_101"/><strong>PYTHON DICTIONARIES</strong></p>
<p class="noindent">A dictionary is another type of data structure in Python (lists and tuples are other examples of data structures, which you’ve seen earlier). Dictionaries contain key-value pairs inside curly braces, where each key is matched up with a value, separated by a colon. In the preceding code listing, we entered the dictionary <code>{x:1, y:2}</code> as an argument to the <code>subs()</code> method. This dictionary has two key-value pairs—<code>x:1</code> and <code>y:2</code>, where <code>x</code> and <code>y</code> are the keys and <code>1</code> and <code>2</code> are the corresponding values. You can retrieve a value from a dictionary by entering its associated key in brackets, much as we would retrieve an element from a list using its index. For example, here we create a simple dictionary and then retrieve the value corresponding to <code>key1</code>:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">sampledict = {"key1": 5, "key2": 20}</span><br/>&gt;&gt;&gt; <span class="codestrong">sampledict["key1"]</span><br/>5</pre>
<p class="indent">To learn more about dictionaries, see <a href="app02.html#app02">Appendix B</a>.</p>
</div>
<p class="indent">If you want the result to be simplified further—for example, if there are terms that cancel each other out, we can use SymPy’s <code>simplify()</code> function, as follows:</p>
<pre><span class="ent">➊</span> &gt;&gt;&gt; <span class="codestrong">expr_subs = expr.subs({x:1-y})</span><br/>   &gt;&gt;&gt; <span class="codestrong">from sympy import simplify</span><br/><span class="ent">➋</span> &gt;&gt;&gt; <span class="codestrong">simplify(expr_subs)</span><br/>   1</pre>
<p class="indent">At <span class="ent">➊</span>, we create a new label, <code>expr_subs</code>, to refer to the result of substituting <em>x</em> = 1 – <em>y</em> in the expression. We then import the <code>simplify()</code> function from SymPy and call it at <span class="ent">➋</span>. The result turns out to be 1 because the other terms of the expression cancel each other.</p>
<p class="indent">Although there was a simplified version of the expression in the preceding example, you had to ask SymPy to simplify it using the <code>simplify()</code> function. Once again, this is because SymPy won’t do any simplification without being asked to.</p>
<p class="indent">The <code>simplify()</code> function can also simplify complicated expressions, such as those including logarithms and trigonometric functions, but we won’t get into that here.</p>
<h5 class="h5" id="ch04lev3sec02"><a id="page_102"/><strong>Calculating the Value of a Series</strong></h5>
<p class="noindent">Let’s revisit the series-printing program. In addition to printing the series, we want our program to be able to find the value of the series for a particular value of <em>x</em>. That is, our program will now take two inputs from the user—the number of terms in the series and the value of <em>x</em> for which the value of the series will be calculated. Then, the program will output both the series and the sum. The following program extends the series printing program to include these enhancements:</p>
<pre>   '''<br/>   Print the series:<br/>   x + x**2 + x**3 + ... + x**n<br/>       ____  _____         _____<br/>         2     3             n<br/>   '''<br/><br/>   from sympy import Symbol, pprint, init_printing<br/>   def print_series(n, x_value):<br/><br/>       # Initialize printing system with reverse order<br/>       init_printing(order='rev-lex')<br/><br/>       x = Symbol('x')<br/>       series = x<br/>       for i in range(2, n+1):<br/>           series = series + (x**i)/i<br/><br/>       pprint(series)<br/><br/>       # Evaluate the series at x_value<br/><span class="ent">➊</span>     series_value = series.subs({x:x_value})<br/>       print('Value of the series at {0}: {1}'.format(x_value, series_value))<br/><br/>   if __name__ == '__main__':<br/>       n = input('Enter the number of terms you want in the series: ')<br/><span class="ent">➋</span>     x_value = input('Enter the value of x at which you want to evaluate the series: ')<br/><br/>       print_series(int(n), float(x_value))</pre>
<p class="indent">The <code>print_series()</code> function now takes an additional argument, <code>x_value</code>, which is the value of <code>x</code> for which the series should be evaluated. At <span class="ent">➊</span>, we use the <code>subs()</code> method to perform the evaluation and the label <code>series_value</code> to refer to the result. In the next line, we display the result.</p>
<p class="indent">The additional input statement at <span class="ent">➋</span> asks the user to enter the value of <code>x</code> using the label <code>x_value</code> to refer to it. Before we call the <code>print_series()</code> function, we convert this value into its floating point equivalent using the <code>float()</code> function.</p>
<p class="indent"><a id="page_103"/>If you execute the program now, it will ask you for the two inputs and print out the series and the series value:</p>
<pre>Enter the number of terms you want in the series: <span class="codestrong">5</span><br/>Enter the value of x at which you want to evaluate the series: <span class="codestrong">1.2</span><br/><br/>    x<sup>2</sup> x<sup>3</sup> x<sup>4</sup> x<sup>5</sup><br/>x + -- + -- + -- + --<br/>    2    3    4    5<br/>Value of the series at 1.2: 3.51206400000000</pre>
<p class="indent">In this sample run, we ask for five terms in the series, with <code>x</code> set to 1.2, and the program prints and evaluates the series.</p>
<h4 class="h4" id="ch04lev2sec04"><strong><em>Converting Strings to Mathematical Expressions</em></strong></h4>
<p class="noindent">So far, we’ve been writing out individual expressions each time we want to do something with them. However, what if you wanted to write a more general program that could manipulate any expression provided by the user? For that, we need a way to convert a user’s input, which is a string, into something we can perform mathematical operations on. SymPy’s <code>sympify()</code> function helps us do exactly that. The function is so called because it converts the string into a SymPy object that makes it possible to apply SymPy’s functions to the input. Let’s see an example:</p>
<pre><span class="ent">➊</span> &gt;&gt;&gt; <span class="codestrong">from sympy import sympify</span><br/>   &gt;&gt;&gt; <span class="codestrong">expr = input('Enter a mathematical expression: ')</span><br/>   Enter a mathematical expression: <span class="codestrong">x**2 + 3*x + x**3 + 2*x</span><br/><span class="ent">➋</span> &gt;&gt;&gt; <span class="codestrong">expr = sympify(expr)</span></pre>
<p class="indent">We first import the <code>sympify()</code> function at <span class="ent">➊</span>. We then use the <code>input()</code> function to ask for a mathematical expression as input, using the label <code>expr</code> to refer to it. Next, we call the <code>sympify()</code> function with <code>expr</code> as its argument at <span class="ent">➋</span> and use the same label to refer to the converted expression.</p>
<p class="indent">You can perform various operations on this expression. For example, let’s try multiplying the expression by 2:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">2*expr</span><br/>2*x**3 + 2*x**2 + 10*x</pre>
<p class="indent">What happens when the user supplies an invalid expression? Let’s see:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">expr = input('Enter a mathematical expression: ')</span><br/>Enter a mathematical expression: <span class="codestrong">x**2 + 3*x + x**3 + 2x</span><br/>&gt;&gt;&gt; <span class="codestrong">expr = sympify(expr)</span><br/>Traceback (most recent call last):<br/>  File "&lt;pyshell#146&gt;", line 1, in &lt;module&gt;<br/>    expr = sympify(expr)<br/>  File "/usr/lib/python3.3/site-packages/sympy/core/sympify.py", line 180, in sympify<br/>    raise SympifyError('could not parse %r' % a)<br/>sympy.core.sympify.SympifyError: SympifyError: "could not parse 'x**2 + 3*x + x**3 + 2x'"</pre>
<p class="indent"><a id="page_104"/>The last line tells us that <code>sympify()</code> isn’t able to convert the supplied input expression. Because this user didn’t add an operator between <code>2</code> and <code>x</code>, SymPy doesn’t understand what it means. Your program should expect such invalid input and print an error message if it comes up. Let’s see how we can do that by catching the <code>SympifyError</code> exception:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import sympify</span><br/>&gt;&gt;&gt; <span class="codestrong">from sympy.core.sympify import SympifyError</span><br/>&gt;&gt;&gt; <span class="codestrong">expr = input('Enter a mathematical expression: ')</span><br/>Enter a mathematical expression: <span class="codestrong">x**2 + 3*x + x**3 + 2x</span><br/>&gt;&gt;&gt; <span class="codestrong">try:</span><br/>    <span class="codestrong">expr = sympify(expr)</span><br/><span class="codestrong">except SympifyError:</span><br/>    <span class="codestrong">print('Invalid input')</span><br/><br/>Invalid input</pre>
<p class="indent">The two changes in the preceding program are that we import the <code>SympifyError</code> exception class from the <code>sympy.core.sympify</code> module and call the <code>sympify()</code> function in a <code>try...except</code> block. Now if there’s a <code>SympifyError</code> exception, an error message is printed.</p>
<h5 class="h5" id="ch04lev3sec03"><strong>Expression Multiplier</strong></h5>
<p class="noindent">Let’s apply the <code>sympify()</code> function to write a program that calculates the product of two expressions:</p>
<pre>   '''<br/>   Product of two expressions<br/>   '''<br/><br/>   from sympy import expand, sympify<br/>   from sympy.core.sympify import SympifyError<br/><br/>   def product(expr1, expr2):<br/>       prod = expand(expr1*expr2)<br/>       print(prod)<br/><br/>   if __name__=='__main__':<br/><span class="ent">➊</span>     expr1 = input('Enter the first expression: ')<br/><span class="ent">➋</span>     expr2 = input('Enter the second expression: ')<br/><br/>       try:<br/>           expr1 = sympify(expr1)<br/>           expr2 = sympify(expr2)<br/>       except SympifyError:<br/>           print('Invalid input')<br/>       else:<br/><span class="ent">➌</span>         product(expr1, expr2)</pre>
<p class="indent">At <span class="ent">➊</span> and <span class="ent">➋</span>, we ask the user to enter the two expressions. Then, we convert them into a form understood by SymPy using the <code>sympify()</code> function <a id="page_105"/>in a <code>try...except</code> block. If the conversion succeeds (indicated by the <code>else</code> block), we call the <code>product()</code> function at <span class="ent">➌</span>. In this function, we calculate the product of the two expressions and print it. Note how we use the <code>expand()</code> function to print the product so that all its terms are expressed as a sum of its constituent terms.</p>
<p class="indent">Here’s a sample execution of the program:</p>
<pre>Enter the first expression: <span class="codestrong">x**2 + x*2 + x</span><br/>Enter the second expression: <span class="codestrong">x**3 + x*3 + x</span><br/>x**5 + 3*x**4 + 4*x**3 + 12*x**2</pre>
<p class="indent">The last line displays the product of the two expressions. The input can also have more than one symbol in any of the expressions:</p>
<pre>Enter the first expression: <span class="codestrong">x*y+x</span><br/>Enter the second expression: <span class="codestrong">x*x+y</span><br/>x**3*y + x**3 + x*y**2 + x*y</pre>
<h3 class="h3" id="ch04lev1sec03"><strong>Solving Equations</strong></h3>
<p class="noindent">SymPy’s <code>solve()</code> function can be used to find solutions to equations. When you input an expression with a symbol representing a variable, such as <em>x</em>, <code>solve()</code> calculates the value of that symbol. This function always makes its calculation by assuming the expression you enter is equal to zero—that is, it prints the value that, when substituted for the symbol, makes the entire expression equal zero. Let’s start with the simple equation <em>x</em> – 5 = 7. If we want to use <code>solve()</code> to find the value of <code>x</code>, we first have to make one side of the equation equal zero (<em>x</em> – 5 – 7 = 0). Then, we’re ready to use <code>solve()</code>, as follows:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import Symbol, solve</span><br/>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">expr = x - 5 - 7</span><br/>&gt;&gt;&gt; <span class="codestrong">solve(expr)</span><br/>[12]</pre>
<p class="indent">When we use <code>solve()</code>, it calculates the value of <code>'x'</code> as 12 because that’s the value that makes the expression (<em>x</em> – 5 – 7) equal to zero.</p>
<p class="indent">Note that the result 12 is returned in a list. An equation can have multiple solutions—for example, a quadratic equation has two solutions. In that case, the list will have all the solutions as its members. You can also ask the <code>solve()</code> function to return the result so that each member is dictionary instead. Each dictionary is composed of the symbol (variable name) and its value (the solution). This is especially useful when solving simultaneous equations where we have more than one variable to solve for because when the solution is returned as a dictionary, we know which solution corresponds to which variable.</p>
<h4 class="h4" id="ch04lev2sec05"><a id="page_106"/><strong><em>Solving Quadratic Equations</em></strong></h4>
<p class="noindent">In <a href="ch01.html#ch01">Chapter 1</a>, we found the roots of the quadratic equation <em>ax</em><sup>2</sup> + <em>bx</em> + <em>c</em> = 0 by writing the formulas for the two roots and then substituting the values of the constants <em>a</em>, <em>b</em>, and <em>c</em>. Now, we’ll learn how we can use SymPy’s <code>solve()</code> function to find the roots without needing to write out the formulas. Let’s see an example:</p>
<pre><span class="ent">➊</span> &gt;&gt;&gt; <span class="codestrong">from sympy import solve</span><br/>   &gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/><span class="ent">➋</span> &gt;&gt;&gt; <span class="codestrong">expr = x**2 + 5*x + 4</span><br/><span class="ent">➌</span> &gt;&gt;&gt; <span class="codestrong">solve(expr, dict=True)</span><br/><span class="ent">➍</span> [{x: -4}, {x: -1}]</pre>
<p class="indent">The <code>solve()</code> function is first imported at <span class="ent">➊</span>. We then define a symbol, <code>x</code>, and an expression corresponding to the quadratic equation, <code>x**2 + 5*x + 4</code>, at <span class="ent">➋</span>. Then, we call the <code>solve()</code> function with the preceding expression at <span class="ent">➌</span>. The second argument to the <code>solve()</code> function (<code>dict=True</code>) specifies that we want the result to be returned as a list of Python dictionaries.</p>
<p class="indent">Each solution in the returned list is a dictionary using the symbol as a key matched with its corresponding value. If the solution is empty, an empty list will be returned. The roots of the preceding equation are –4 and –1, as you can see at <span class="ent">➍</span>.</p>
<p class="indentb">We found out in the first chapter that the roots of the equation</p>
<p class="center"><em>x</em><sup>2</sup> + <em>x</em> + 1 = 0</p>
<p class="noindentt">are complex numbers. Let’s attempt to find those using <code>solve()</code>:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">x=Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">expr = x**2 + x + 1</span><br/>&gt;&gt;&gt; <span class="codestrong">solve(expr, dict=True)</span><br/>[{x: -1/2 - sqrt(3)*I/2}, {x: -1/2 + sqrt(3)*I/2}]</pre>
<p class="indent">Both the roots are imaginary, as expected with the imaginary component indicated by the <code>I</code> symbol.</p>
<h4 class="h4" id="ch04lev2sec06"><strong><em>Solving for One Variable in Terms of Others</em></strong></h4>
<p class="noindent">In addition to finding the roots of equations, we can take advantage of symbolic math to use the <code>solve()</code> function to express one variable in an equation in terms of the others. Let’s take a look at finding the roots for the generic quadratic equation <em>ax</em><sup>2</sup> + <em>bx</em> + <em>c</em> = 0. To do so, we’ll define <em>x</em> and three additional symbols—<em>a</em>, <em>b</em>, and <em>c</em>, which correspond to the three constants:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">a = Symbol('a')</span><br/>&gt;&gt;&gt; <span class="codestrong">b = Symbol('b')</span><br/>&gt;&gt;&gt; <span class="codestrong">c = Symbol('c')</span></pre>
<p class="indent"><a id="page_107"/>Next, we write the expression corresponding to the equation and use the <code>solve()</code> function on it:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">expr = a*x*x + b*x + c</span><br/>&gt;&gt;&gt; <span class="codestrong">solve(expr, x, dict=True)</span><br/>[{x: (-b + sqrt(-4*a*c + b**2))/(2*a)}, {x: -(b + sqrt(-4*a*c + b**2))/(2*a)}]</pre>
<p class="indent">Here, we have to include an additional argument, <code>x</code>, to the <code>solve()</code> function. Because there’s more than one symbol in the equation, we need to tell <code>solve()</code> which symbol it should solve for, which is what we indicate by passing in <code>x</code> as the second argument. As we’d expect, <code>solve()</code> prints the quadratic formula: the generic formula for finding the value(s) of <em>x</em> in a polynomial expression.</p>
<p class="indent">To be clear, when we use <code>solve()</code> on an equation with more than one symbol, we specify the symbol to solve for as the second argument (and now the third argument specifies how we want the results to be returned).</p>
<p class="indent">Next, let’s consider an example from physics. According to one of the equations of motion, the distance traveled by a body moving with a constant acceleration <em>a</em>, with an initial velocity <em>u</em>, in time <em>t</em>, is given by</p>
<div class="image2"><img src="images/e0107-01.jpg" alt="image"/></div>
<p class="indent">Given <em>u</em> and <em>a</em>, however, if you wanted to find the time required to travel a given distance, <em>s</em>, you’d have to first express <em>t</em> in terms of the other variables. Here’s how you could do that using SymPy’s <code>solve()</code> function:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import Symbol, solve, pprint</span><br/>&gt;&gt;&gt; <span class="codestrong">s = Symbol('s')</span><br/>&gt;&gt;&gt; <span class="codestrong">u = Symbol('u')</span><br/>&gt;&gt;&gt; <span class="codestrong">t = Symbol('t')</span><br/>&gt;&gt;&gt; <span class="codestrong">a = Symbol('a')</span><br/>&gt;&gt;&gt; <span class="codestrong">expr = u*t + (1/2)*a*t*t - s</span><br/>&gt;&gt;&gt; <span class="codestrong">t_expr = solve(expr,t, dict=True)</span><br/>&gt;&gt;&gt; <span class="codestrong">pprint(t_expr)</span></pre>
<p class="indent">The result looks like this:</p>
<div class="image2"><img src="images/f0107-01.jpg" alt="image"/></div>
<p class="indent">Now that we have the expression for <em>t</em> (referred to by the label <code>t_expr</code>), we can use the <code>subs()</code> method to replace the values of <em>s</em>, <em>u</em>, and <em>a</em> to find the two possible values of <em>t</em>.</p>
<h4 class="h4" id="ch04lev2sec07"><a id="page_108"/><strong><em>Solving a System of Linear Equations</em></strong></h4>
<p class="noindentb">Consider the following two equations:</p>
<p class="center">2<em>x</em> + 3<em>y</em> = 6</p>
<p class="center">3<em>x</em> + 2<em>y</em> = 12</p>
<p class="indentt">Say we want to find the pair of values (<em>x</em>, <em>y</em>) that satisfies both the equations. We can use the <code>solve()</code> function to find the solution for a system of equations like this one.</p>
<p class="indent">First, we define the two symbols and create the two equations:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">y = Symbol('y')</span><br/>&gt;&gt;&gt; <span class="codestrong">expr1 = 2*x + 3*y - 6</span><br/>&gt;&gt;&gt; <span class="codestrong">expr2 = 3*x + 2*y – 12</span></pre>
<p class="indent">The two equations are defined by the expressions <code>expr1</code> and <code>expr2</code>, respectively. Note how we’ve rearranged the expressions so they both equal zero (we moved the right side of the given equations to the left side). To find the solution, we call the <code>solve()</code> function with the two expressions forming a tuple:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">solve((expr1, expr2), dict=True)</span><br/>[{y: -6/5, x: 24/5}]</pre>
<p class="indent">As I mentioned earlier, getting the solution back as a dictionary is useful here. We can see that the value of <code>x</code> is 24/5 and the value of <code>y</code> is –6/5. Let’s verify whether the solution we got really satisfies the equations. To do so, we’ll first create a label, <code>soln</code>, to refer to the solution we got and then use the <code>subs()</code> method to substitute the corresponding values of <code>x</code> and <code>y</code> in the two expressions:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">soln = solve((expr1, expr2), dict=True)</span><br/>&gt;&gt;&gt; <span class="codestrong">soln = soln[0]</span><br/>&gt;&gt;&gt; <span class="codestrong">expr1.subs({x:soln[x], y:soln[y]})</span><br/>0<br/>&gt;&gt;&gt; <span class="codestrong">expr2.subs({x:soln[x], y:soln[y]})</span><br/>0</pre>
<p class="indent">The result of substituting the values of <code>x</code> and <code>y</code> corresponding to the solution in the two expressions is zero.</p>
<h3 class="h3" id="ch04lev1sec04"><strong>Plotting Using SymPy</strong></h3>
<p class="noindent">In <a href="ch02.html#ch02">Chapter 2</a>, we learned to make graphs where we explicitly specified the numbers we wanted to plot. For example, to plot the graph of the gravitational force against the distance between two bodies, you had to calculate <a id="page_109"/>the gravitational force for each distance value and supply the lists of distances and forces to matplotlib. With SymPy, on the other hand, you can just tell SymPy the equation of the line you want to plot, and the graph will be created for you. Let’s plot a line whose equation is given by <em>y</em> = 2<em>x</em> + 3:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy.plotting import plot</span><br/>&gt;&gt;&gt; <span class="codestrong">from sympy import Symbol</span><br/>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">plot(2*x+3)</span></pre>
<p class="indent">All we had to do was import <code>plot</code> and <code>Symbol</code> from <code>sympy.plotting</code>, create a symbol, <code>x</code>, and call the <code>plot()</code> function with the expression <code>2*x+3</code>. SymPy takes care of everything else and plots the graph of the function, as shown in <a href="ch04.html#ch4fig1">Figure 4-1</a>.</p>
<div class="image"><img src="images/f04-01.jpg" alt="image"/></div>
<p class="figuret"><a id="ch4fig1"/><em>Figure 4-1: Plot of the line</em> y = <em>2</em>x + <em>3</em></p>
<p class="indent">The graph shows that a default range of <em>x</em> values was automatically chosen: –10 to 10. You may notice that the graph window looks very similar to those you saw in <a href="ch02.html#ch02">Chapters 2</a> and <a href="ch03.html#ch03">3</a>. That’s because SymPy uses matplotlib behind the scenes to draw the graphs. Also note that we didn’t have to call the <code>show()</code> function to show the graphs because this is done automatically by SymPy.</p>
<p class="indent"><a id="page_110"/>Now, let’s say that you wanted to limit the values of <code>'x'</code> in the preceding graph to lie in the range –5 to 5 (instead of –10 to 10). You’d do that as follows:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">plot((2*x + 3), (x, -5, 5))</span></pre>
<p class="indent">Here, a tuple consisting of the symbol, the lower bound, and the upper bound of the range—<code>(x, -5, 5)</code>—is specified as the second argument to the <code>plot()</code> function. Now, the graph displays only the values of <em>y</em> corresponding to the values of <em>x</em> between –5 and 5 (see <a href="ch04.html#ch4fig2">Figure 4-2</a>).</p>
<div class="image"><img src="images/f04-02.jpg" alt="image"/></div>
<p class="figuret"><a id="ch4fig2"/><em>Figure 4-2: Plot of the line</em> y = <em>2</em>x + <em>3 with the values of</em> x <em>restricted to the range –5 to 5</em></p>
<p class="indent">You can use other keyword arguments in the <code>plot()</code> function, such as <code>title</code> to enter a title or <code>xlabel</code> and <code>ylabel</code> to label the <em>x</em>-axis and the <em>y</em>-axis, respectively. The following <code>plot()</code> function specifies the preceding three keyword arguments (see the corresponding graph in <a href="ch04.html#ch4fig3">Figure 4-3</a>):</p>
<pre>&gt;&gt;&gt; <span class="codestrong">plot(2*x + 3, (x, -5, 5), title='A Line', xlabel='x', ylabel='2x+3')</span></pre>
<div class="image"><a id="page_111"/><img src="images/f04-03.jpg" alt="image"/></div>
<p class="figuret"><a id="ch4fig3"/><em>Figure 4-3: Plot of the line</em> y = <em>2</em>x + <em>3 with the range of</em> x <em>and other attributes specified</em></p>
<p class="indent">The plot shown in <a href="ch04.html#ch4fig3">Figure 4-3</a> now has a title and labels on the <em>x</em>-axis and the <em>y</em>-axis. You can specify a number of other keyword arguments to the <code>plot()</code> function to customize the behavior of the function as well as the graph itself. The <code>show</code> keyword argument allows us to specify whether we want the graph to be displayed. Passing <code>show=False</code> will cause the graph to not be displayed when you call the <code>plot()</code> function:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">p = plot(2*x + 3, (x, -5, 5), title='A Line', xlabel='x', ylabel='2x+3', show=False)</span></pre>
<p class="indent">You will see that no graph is shown. The label <code>p</code> refers to the plot that is created, so you can now call <code>p.show()</code> to display the graph. You can also save the graph as an image file using the <code>save()</code> method, as follows:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">p.save('line.png')</span></pre>
<p class="indent">This will save the plot to a file <em>line.png</em> in the current directory.</p>
<h4 class="h4" id="ch04lev2sec08"><strong><em>Plotting Expressions Input by the User</em></strong></h4>
<p class="noindent">The expression that you pass to the <code>plot()</code> function must be expressed in terms of <em>x</em> only. For example, earlier we plotted <em>y</em> = 2<em>x</em> + 3, which we entered to the plot function as simply 2<em>x</em> + 3. If the expression were not originally in this form, we’d have to rewrite it. Of course, we could do this manually, <a id="page_112"/>outside the program. But what if you want to write a program that allows its users to graph any expression? If the user enters an expression in the form of 2<em>x</em> + 3<em>y</em> – 6, say, we have to first convert it. The <code>solve()</code> function will help us here. Let’s see an example:</p>
<pre>   &gt;&gt;&gt; <span class="codestrong">expr = input('Enter an expression: ')</span><br/>   Enter an expression: <span class="codestrong">2*x + 3*y - 6</span><br/><span class="ent">➊</span> &gt;&gt;&gt; <span class="codestrong">expr = sympify(expr)</span><br/><span class="ent">➋</span> &gt;&gt;&gt; <span class="codestrong">y = Symbol('y')</span><br/>   &gt;&gt;&gt; <span class="codestrong">solve(expr, y)</span><br/><span class="ent">➌</span> [-2*x/3 + 2]</pre>
<p class="indent">At <span class="ent">➊</span>, we use the <code>sympify()</code> function to convert the input expression to a SymPy object. At <span class="ent">➋</span>, we create a <code>Symbol</code> object to represent <code>'y'</code> so that we can tell SymPy which variable we want to solve the equation for. Then we solve the expression to find <code>y</code> in terms of <code>x</code> by specifying <code>y</code> as the second argument to the <code>solve()</code> function. At <span class="ent">➌</span>, this returns the equation in terms of <code>x</code>, which is what we need for plotting.</p>
<p class="indent">Notice that this final expression is stored in a list, so before we can use it, we’ll have to extract it from the list:</p>
<pre>   &gt;&gt;&gt; <span class="codestrong">solutions = solve(expr, 'y')</span><br/><span class="ent">➍</span> &gt;&gt;&gt; <span class="codestrong">expr_y = solutions[0]</span><br/>   &gt;&gt;&gt; <span class="codestrong">expr_y</span><br/>   -2*x/3 + 2</pre>
<p class="indent">We create a label, <code>solutions</code>, to refer to the result returned by the <code>solve()</code> function, which is a list with only one item. Then, we extract that item at <span class="ent">➍</span>. Now, we can call the <code>plot()</code> function to graph the expression. The next listing shows a full graph-drawing program:</p>
<pre>'''<br/>Plot the graph of an input expression<br/>'''<br/><br/>from sympy import Symbol, sympify, solve<br/>from sympy.plotting import plot<br/><br/>def plot_expression(expr):<br/><br/>    y = Symbol('y')<br/>    solutions = solve(expr, y)<br/>    expr_y = solutions[0]<br/>    plot(expr_y)<br/><br/>if __name__=='__main__':<br/><br/>    expr = input('Enter your expression in terms of x and y: ')<br/><a id="page_113"/><br/>    try:<br/>        expr = sympify(expr)<br/>    except SympifyError:<br/>        print('Invalid input')<br/>    else:<br/>        plot_expression(expr)</pre>
<p class="indent">Note that the preceding program includes a <code>try...except</code> block to check for invalid input, as we’ve done with <code>sympify()</code> earlier. When you run the program, it asks you to input an expression, and it will create the corresponding graph.</p>
<h4 class="h4" id="ch04lev2sec09"><strong><em>Plotting Multiple Functions</em></strong></h4>
<p class="noindent">You can enter multiple expressions when calling the SymPy <code>plot</code> function to plot more than one expression on the same graph. For example, the following code plots two lines at once (see <a href="ch04.html#ch4fig4">Figure 4-4</a>):</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy.plotting import plot</span><br/>&gt;&gt;&gt; <span class="codestrong">from sympy import Symbol</span><br/>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">plot(2*x+3, 3*x+1)</span></pre>
<div class="image"><img src="images/f04-04.jpg" alt="image"/></div>
<p class="figuret"><a id="ch4fig4"/><em>Figure 4-4: Plotting two lines on the same graph</em></p>
<p class="indent"><a id="page_114"/>This example brings out another difference between plotting in matplotlib and in SymPy. Here, using SymPy, both lines are the same color, whereas matplotlib would have automatically made the lines different colors. To set different colors for each line with SymPy, we’ll need to perform some extra steps, as shown in the following code, which also adds a legend to the graph:</p>
<pre>   &gt;&gt;&gt; <span class="codestrong">from sympy.plotting import plot</span><br/>   &gt;&gt;&gt; <span class="codestrong">from sympy import Symbol</span><br/>   &gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/><span class="ent">➊</span> &gt;&gt;&gt; <span class="codestrong">p = plot(2*x+3, 3*x+1, legend=True, show=False)</span><br/><span class="ent">➋</span> &gt;&gt;&gt; <span class="codestrong">p[0].line_color = 'b'</span><br/><span class="ent">➌</span> &gt;&gt;&gt; <span class="codestrong">p[1].line_color = 'r'</span><br/>   &gt;&gt;&gt; <span class="codestrong">p.show()</span></pre>
<p class="indent">At <span class="ent">➊</span>, we call the <code>plot()</code> function with the equations for the two lines but pass two additional keyword arguments—<code>legend</code> and <code>show</code>. By setting the legend argument to <code>True</code>, we add a legend to the graph, as we saw in <a href="ch02.html#ch02">Chapter 2</a>. Note, however, that the text that appears in the legend will match the expressions you plotted—you can’t specify any other text. We also set <code>show=False</code> because we want to set the color of the lines before we draw the graph. The statement at <span class="ent">➋</span>, <code>p[0]</code>, refers to the first line, 2<em>x</em> + 3, and we set its attribute <code>line_color</code> to <code>'b'</code>, meaning that we want this line to be blue. Similarly, we set the color of the second plot to red using the string <code>'r'</code> <span class="ent">➌</span>. Finally, we call the <code>show()</code> to display the graph (see <a href="ch04.html#ch4fig5">Figure 4-5</a>).</p>
<div class="image"><img src="images/f04-05.jpg" alt="image"/></div>
<p class="figuret"><a id="ch4fig5"/><em>Figure 4-5: Plot of the two lines with each line drawn in a different color</em></p>
<p class="indent"><a id="page_115"/>In addition to red and blue, you can plot the lines in green, cyan, magenta, yellow, black, and white (using the first letter of the color in each case).</p>
<h3 class="h3" id="ch04lev1sec05"><strong>What You Learned</strong></h3>
<p class="noindent">In this chapter, you learned the basics of symbolic math using SymPy. You learned about declaring symbols, constructing expressions using symbols and mathematical operators, solving equations, and plotting graphs. You will be learning more features of SymPy in later chapters.</p>
<h3 class="h3" id="ch04lev1sec06"><strong><span class="bordera">Programming Challenges</span></strong></h3>
<p class="noindent">Here are a few programming challenges that should help you further apply what you’ve learned. You can find sample solutions at <em><a href="http://www.nostarch.com/doingmathwithpython/">http://www.nostarch.com/doingmathwithpython/</a></em>.</p>
<h4 class="h4" id="ch04lev2sec10"><strong><em>#1: Factor Finder</em></strong></h4>
<p class="noindent">You learned about the <code>factor()</code> function, which prints the factors of an expression. Now that you know how your program can handle expressions input by a user, write a program that will ask the user to input an expression, calculate its factors, and print them. Your program should be able to handle invalid input by making use of exception handling.</p>
<h4 class="h4" id="ch04lev2sec11"><strong><em>#2: Graphical Equation Solver</em></strong></h4>
<p class="noindent">Earlier, you learned how to write a program that prompts the user to input an expression such as 3<em>x</em> + 2<em>y</em> – 6 and create the corresponding graph. Write a program that asks the user for two expressions and then graphs them both, as follows:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">expr1 = input('Enter your first expression in terms of x and y: ')</span><br/>&gt;&gt;&gt; <span class="codestrong">expr2 = input('Enter your second expression in terms of x and y: ')</span></pre>
<p class="indent">Now, <code>expr1</code> and <code>expr2</code> will store the two expressions input by the user. You should convert both of these into SymPy objects using the <code>sympify()</code> step in a <code>try...except</code> block.</p>
<p class="indent">All you need to do from here is plot these two expressions instead of one.</p>
<p class="indent">Once you’ve completed this, enhance your program to print the solution—the pair of <em>x</em> and <em>y</em> values that satisfies both equations. This will also be the spot where the two lines on the graph intersect. (Hint: Refer to how we used the <code>solve()</code> function earlier to find the solution of a system of two linear equations.)</p>
<h4 class="h4" id="ch04lev2sec12"><a id="page_116"/><strong><em>#3: Summing a Series</em></strong></h4>
<p class="noindent">We saw how to find the sum of a series in “<a href="ch04.html#ch04lev3sec01">Printing a Series</a>” on <a href="ch04.html#page_99">page 99</a>. There, we manually added the terms of the series by looping over all the terms. Here’s a snippet from that program:</p>
<pre>for i in range(2, n+1):<br/>    series = series + (x**i)/i</pre>
<p class="indent">SymPy’s <code>summation()</code> function can be directly used to find such summations. The following example prints the sum of the first five terms of the series we considered earlier:</p>
<pre>   &gt;&gt;&gt; <span class="codestrong">from sympy import Symbol, summation, pprint</span><br/>   &gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>   &gt;&gt;&gt; <span class="codestrong">n = Symbol('n')</span><br/><span class="ent">➊</span> &gt;&gt;&gt; <span class="codestrong">s = summation(x**n/n, (n, 1, 5))</span><br/>   &gt;&gt;&gt; <span class="codestrong">pprint(s)</span><br/>   x<sup>5</sup>   x<sup>4</sup>   x<sup>3</sup>   x<sup>2</sup><br/>   -- + -- + -- + -- + x<br/>   5     4   3     2</pre>
<p class="indent">We call the <code>summation()</code> function at <span class="ent">➊</span>, with the first argument being the <em>n</em>th term of the series and the second argument being a tuple that states the range of <em>n</em>. We want the sum of the first five terms here, so the second argument is <code>(n, 1, 5)</code>.</p>
<p class="indent">Once you have the sum, you can use the <code>subs()</code> method to substitute a value for <em>x</em> to find the numerical value of the sum:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">s.subs({x:1.2})</span><br/>3.51206400000000</pre>
<p class="indent">Your challenge is to write a program that’s capable of finding the sum of an arbitrary series when you supply the <em>n</em>th term of the series and the number of terms in it. Here’s an example of how the program would work:</p>
<pre>Enter the nth term: <span class="codestrong">a+(n-1)*d</span><br/>Enter the number of terms: <span class="codestrong">3</span><br/>3·a + 3·d</pre>
<p class="indent">In this example, the <em>n</em>th term supplied is that of an <em>arithmetic progression</em>. Starting with <code>a</code> and <code>d</code> as the <em>common difference</em>, the number of terms up to which the sum is to be calculated is 3. The sum turns out to be <code>3a + 3d</code>, which agrees with the known formula for the same.</p>
<h4 class="h4" id="ch04lev2sec13"><a id="page_117"/><strong><em>#4: Solving Single-Variable Inequalities</em></strong></h4>
<p class="noindent">You’ve seen how to solve an equation using SymPy’s <code>solve()</code> function. But SymPy is also capable of solving single-variable inequalities, such as <em>x</em> + 5 &gt; 3 and sin<em>x</em> – 0.6 &gt; 0. That is, SymPy can solve relations besides equality, like &gt;, &lt;, and so on. For this challenge, create a function, <code>isolve()</code>, that will take any inequality, solve it, and then return the solution.</p>
<p class="indent">First, let’s learn about the SymPy functions that will help you implement this. The inequality-solving functions are available as three separate functions for polynomial, rational, and all other inequalities. We’ll need to pick the right function to solve various inequalities, or we’ll get an error.</p>
<p class="indent">A <em>polynomial</em> is an algebraic expression consisting of a variable and coefficients and involving only the operations of addition, subtraction, and multiplication and only positive powers of the variable. An example of a polynomial inequality is <em>x</em><sup>2</sup> + 4 &lt; 0.</p>
<p class="indent">To solve a polynomial inequality, use the <code>solve_poly_inequality()</code> function:</p>
<pre>   &gt;&gt;&gt; <span class="codestrong">from sympy import Poly, Symbol, solve_poly_inequality</span><br/>   &gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/><span class="ent">➊</span> &gt;&gt;&gt; <span class="codestrong">ineq_obj = -x**2 + 4 &lt; 0</span><br/><span class="ent">➋</span> &gt;&gt;&gt; <span class="codestrong">lhs = ineq_obj.lhs</span><br/><span class="ent">➌</span> &gt;&gt;&gt; <span class="codestrong">p = Poly(lhs, x)</span><br/><span class="ent">➍</span> &gt;&gt;&gt; <span class="codestrong">rel = ineq_obj.rel_op</span><br/>   &gt;&gt;&gt; <span class="codestrong">solve_poly_inequality(p, rel)</span><br/>   [(-oo, -2), (2, oo)]</pre>
<p class="indent">First, create the expression representing an inequality, –<em>x</em><sup>2</sup> + 4 &lt; 0, at <span class="ent">➊</span> and refer to this expression with the label <code>ineq_obj</code>. Then, extract the left side of the inequality—that is, the algebraic expression –<em>x</em><sup>2</sup> + 4—using the <code>lhs</code> attribute at <span class="ent">➋</span>. Next, create a <code>Poly</code> object at <span class="ent">➌</span> to represent the polynomial we extracted at <span class="ent">➋</span>. The second argument passed when creating the object is the symbol object that represents the variable, <code>x</code>. At <span class="ent">➍</span>, extract the relational operator from the inequality object using the <code>rel</code> attribute. Finally, call the <code>solve_poly_inequality()</code> function with the polynomial object, <code>p</code>, and <code>rel</code> as the two arguments. The program returns the solution as a list of tuples, with each tuple representing a solution for the inequality as the lower limit and the upper limit of the range of numbers. For this inequality, the solution is all numbers less than –2 and all numbers greater than 2.</p>
<p class="indent">A <em>rational expression</em> is an algebraic expression in which the numerator and denominator are both polynomials. Here’s an example of a rational inequality:</p>
<div class="image2"><img src="images/e0117-01.jpg" alt="image"/></div>
<p class="indent"><a id="page_118"/>For rational inequalities, use the <code>solve_rational_inequalities()</code> function:</p>
<pre>   &gt;&gt;&gt; <span class="codestrong">from sympy import Symbol, Poly, solve_rational_inequalities</span><br/>   &gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/><span class="ent">➊</span> &gt;&gt;&gt; <span class="codestrong">ineq_obj = ((x-1)/(x+2)) &gt; 0</span><br/>   &gt;&gt;&gt; <span class="codestrong">lhs = ineq_obj.lhs</span><br/><span class="ent">➋</span> &gt;&gt;&gt; <span class="codestrong">numer, denom = lhs.as_numer_denom()</span><br/>   &gt;&gt;&gt; <span class="codestrong">p1 = Poly(numer)</span><br/>   &gt;&gt;&gt; <span class="codestrong">p2 = Poly(denom)</span><br/>   &gt;&gt;&gt; <span class="codestrong">rel = ineq_obj.rel_op</span><br/><span class="ent">➌</span> &gt;&gt;&gt; <span class="codestrong">solve_rational_inequalities([[((p1, p2), rel)]])</span><br/>   (-oo, -2) U (1, oo)</pre>
<p class="indent">Create an inequality object representing our example rational inequality at <span class="ent">➊</span> and then extract the rational expression using the <code>lhs</code> attribute. Separate out the numerator and the denominator into the labels <code>numer</code> and <code>denom</code> using the <code>as_numer_denom()</code> method at <span class="ent">➋</span>, which returns a tuple with the numerator and denominator as the two members. Then, create two polynomial objects, <code>p1</code> and <code>p2</code>, representing the numerator and denominator, respectively. Retrieve the relational operator and call the <code>solve_rational_inequalities()</code> function, passing it the two polynomial objects—<code>p1</code> and <code>p2</code>—and the relational operator.</p>
<p class="indent">The program returns the solution <code>(-oo, -2) U (1, oo)</code>, where <code>U</code> denotes that the solution is a <em>union</em> of the two <em>sets</em> of solutions consisting of all numbers less than –2 and all numbers greater than 1. (We’ll learn about sets in <a href="ch05.html#ch05">Chapter 5</a>.)</p>
<p class="indent">Finally, sin<em>x</em> – 0.6 &gt; 0 is an example of an inequality that belongs to neither the polynomial nor rational expression categories. If you have such an inequality to solve, use the <code>solve_univariate_inequality()</code> function:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import Symbol, solve, solve_univariate_inequality, sin</span><br/>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">ineq_obj = sin(x) - 0.6 &gt; 0</span><br/>&gt;&gt;&gt; <span class="codestrong">solve_univariate_inequality(ineq_obj, x, relational=False)</span><br/>(0.643501108793284, 2.49809154479651)</pre>
<p class="indent">Create an inequality object representing the inequality <code>sin(x) – 0.6 &gt; 0</code> and then call the <code>solve_univariate_inequality()</code> function with the first two arguments as the inequality object, <code>ineq_obj</code>, and the symbol object, <code>x</code>. The keyword argument <code>relational=False</code> specifies to the function that we want the solution to be returned as a <em>set</em>. The solution for this inequality turns out to be all numbers lying between the first and second members of the tuple the program returns.</p>
<h5 class="h5" id="ch04lev3sec04"><a id="page_119"/><strong>Hints: Handy Functions</strong></h5>
<p class="noindent">Now remember—your challenge is (1) to create a function, <code>isolve()</code>, that will take any inequality and (2) to choose one of the appropriate functions discussed in this section to solve it and return the solution. The following hints may be useful to implement this function.</p>
<p class="indent">The <code>is_polynomial()</code> method can be used to check whether an expression is a polynomial or not:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">x = Symbol('x')</span><br/>&gt;&gt;&gt; <span class="codestrong">expr = x**2 - 4</span><br/>&gt;&gt;&gt; <span class="codestrong">expr.is_polynomial()</span><br/>True<br/>&gt;&gt;&gt; <span class="codestrong">expr = 2*sin(x) + 3</span><br/>&gt;&gt;&gt; <span class="codestrong">expr.is_polynomial()</span><br/>False</pre>
<p class="indent">The <code>is_rational_function()</code> can be used to check whether an expression is a rational expression:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">expr = (2+x)/(3+x)</span><br/>&gt;&gt;&gt; <span class="codestrong">expr.is_rational_function()</span><br/>True<br/>&gt;&gt;&gt; <span class="codestrong">expr = 2+x</span><br/>&gt;&gt;&gt; <span class="codestrong">expr.is_rational_function()</span><br/>True<br/>&gt;&gt;&gt; <span class="codestrong">expr = 2+sin(x)</span><br/>&gt;&gt;&gt; <span class="codestrong">expr.is_rational_function()</span><br/>False</pre>
<p class="indent">The <code>sympify()</code> function can convert an inequality expressed as a string to an inequality object:</p>
<pre>&gt;&gt;&gt; <span class="codestrong">from sympy import sympify</span><br/>&gt;&gt;&gt; <span class="codestrong">sympify('x+3&gt;0')</span><br/>x + 3 &gt; 0</pre>
<p class="indent">When you run your program, it should ask the user to input an inequality expression and print back the solution.<a id="page_120"/></p>
</div>
</body></html>