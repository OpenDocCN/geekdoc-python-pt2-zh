<html><head></head><body>
<div id="sbo-rt-content"><h2 class="h2" id="ch07"><span epub:type="pagebreak" id="page_97"/><strong><span class="big">7</span><br/>VISUALIZATIONS</strong></h2>&#13;
<div class="image1"><img src="../Images/comm1.jpg" alt="Image" width="191" height="191"/></div>&#13;
<p class="noindents">Perhaps the simplest way to discover insights in data is to represent that data graphically. Visualizations, like the one shown in <a href="../Text/ch07.xhtml#ch07fig01">Figure 7-1</a>, allow you to immediately identify patterns within your data.</p>&#13;
<p class="indent">In this chapter, you’ll learn how to generate visualizations for the syntactic structure of a sentence and the named entities in a document using spaCy’s built-in visualizers: the displaCy dependency visualizer and the displaCy named entity visualizer.</p>&#13;
<p class="indent">We’ll start by exploring interactive demos of these visualizers, which are available on the Explosion AI website (Explosion AI is the maker of spaCy), to understand what the spaCy visualizers can accomplish. Next, you’ll learn to spin up a displaCy web server on your machine, allowing you to programmatically visualize a Doc object from within spaCy. You’ll also learn how to customize your visualizations. Finally, you’ll learn how to use displaCy to render manually prepared data without having to pass in a Doc object.</p>&#13;
<h3 class="h3" id="lev88"><span epub:type="pagebreak" id="page_98"/><strong>Getting Started with spaCy’s Built-In Visualizers</strong></h3>&#13;
<p class="noindent">Let’s begin by exploring how the displaCy dependency visualizer and the displaCy named entity visualizer work. The quickest way to get started with spaCy’s built-in visualizers is to take advantage of their interactive demos available at <em><a href="https://explosion.ai/demos/">https://explosion.ai/demos/</a></em>. On this page, you’ll find links to the demo pages for the two displaCy visualizers along with some other demo links.</p>&#13;
<h4 class="h4" id="lev89"><strong><em>displaCy Dependency Visualizer</em></strong></h4>&#13;
<p class="noindent">The displaCy dependency visualizer generates a syntactic dependency visualization for a submitted text. To use its interactive demo, navigate to <em><a href="https://explosion.ai/demos/displacy/">https://explosion.ai/demos/displacy/</a></em>. Replace the sample sentence in the “Text to parse” text box with your text, and then click the search icon (magnifying glass) at the right of the box to generate a visualization. The result might look like <a href="../Text/ch07.xhtml#ch07fig01">Figure 7-1</a>.</p>&#13;
<div class="image"><a id="ch07fig01"/><img src="../Images/fig7-1.jpg" alt="image" width="694" height="442"/></div>&#13;
<p class="figcap"><em>Figure 7-1: The displaCy dependency visualizer on the Explosion AI website</em></p>&#13;
<p class="indent">The dependency visualizer shows the part-of-speech tags and syntactic dependencies in a submitted text, displaying its syntactic structure immediately.</p>&#13;
<p class="indent">The visualizer allows you to customize your graphic with the “Merge Punctuation” and “Merge Phrases” checkboxes. “Merge Punctuation” merges a punctuation mark to the preceding token, making a visualization more compact and therefore more readable. “Merge Phrases” merges each noun phrase into a single token, as shown in the example in <a href="../Text/ch07.xhtml#ch07fig01">Figure 7-1</a>. Both options are set by default.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_99"/>You can change either or both of these defaults by deselecting the corresponding box or boxes. For example, if you deselect the “Merge Phrases” box for “I want a Greek pizza now,” you’ll see a more detailed dependency parsing for this sentence that shows you the dependencies within the noun phrase “a Greek pizza.”</p>&#13;
<p class="indent">Keeping the “Merge Phrases” box selected allows you to get a more compact dependency tree, which can be especially useful when dealing with a sentence containing several noun phrases. For example, consider the following sentence: “I see a few young people working in their vegetable field.” It contains two noun phrases: “a few young people” and “their vegetable field.” The first one is the direct object of the verb “see,” and the second is the object of the preposition in the prepositional phrase that modifies the verb “work,” showing the dependency labels <span class="literal">dobj</span> and <span class="literal">pobj</span>, respectively. Strictly speaking, these dependency labels are related to the nouns in the corresponding phrases rather than to an entire sentence.</p>&#13;
<p class="indent">In addition to the “Merge Punctuation” and “Merge Phrases” options, you can choose a statistical language model to use from the list of available models. This option allows you to try a model for dependency parsing without downloading and installing it in your environment. Currently, you can choose from the following models: <span class="literal">en_core_web_sm</span><span class="literal"/>, <span class="literal">en_core_web_md</span><span class="literal"/>, and <span class="literal">en_core_web_lg</span><span class="literal"/>, as well as small (<span class="literal">sm</span>) models for other European languages, such as German, Spanish, Portuguese, French, Italian, and Dutch.</p>&#13;
<h4 class="h4" id="lev90"><strong><em>displaCy Named Entity Visualizer</em></strong></h4>&#13;
<p class="noindent">The displaCy named entity visualizer generates a named entity visualization for a submitted text. You’ll find its interactive demo at <em><a href="https://explosion.ai/demos/displacy-ent/">https://explosion.ai/demos/displacy-ent/</a></em>. From a user’s standpoint, it works similarly to the displaCy dependency visualizer demo discussed in the previous section. To generate a visualization for a text, enter it into the text box, and then click the search icon. The visualizer will process your query and output an original text at the bottom of the window, highlighting the named entities discovered along with their labels, as shown in <a href="../Text/ch07.xhtml#ch07fig02">Figure 7-2</a>.</p>&#13;
<p class="indent">You can choose what types of named entities the application should recognize in a submitted text by selecting or deselecting the boxes under “Entity labels”. In the example shown in <a href="../Text/ch07.xhtml#ch07fig02">Figure 7-2</a>, you add <span class="literal">PERCENT</span><span class="literal"/> and <span class="literal">CARDINAL</span><span class="literal"/> to the list of entity label types chosen by default. Adding the <span class="literal">PERCENT</span> entity type tells the visualizer to recognize phrases expressing a percentage or that include the “%” symbol. Adding the <span class="literal">CARDINAL</span> entity type guarantees that the visualizer will recognize phrases related to numerals in the submitted text.</p>&#13;
<p class="indent">Which boxes you should select depends on your context. When processing a financial report, you might select the <span class="literal">money</span> and <span class="literal">date</span> boxes. But if the report includes records of the financial activities of more than one company, you might also want to select the <span class="literal">ORG</span><span class="literal"/> entity label box to instruct the visualizer to highlight company names in the text.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_100"/><a id="ch07fig02"/><img src="../Images/fig7-2.jpg" alt="image" width="694" height="506"/></div>&#13;
<p class="figcap"><em>Figure 7-2: The displaCy named entity visualizer on the Explosion AI website</em></p>&#13;
<h3 class="h3" id="lev91"><strong>Visualizing from Within spaCy</strong></h3>&#13;
<p class="noindent">Starting with spaCy v2.0, the displaCy visualizers are integrated into the core library. This means that you can start using them from within your Python code immediately after installing spaCy.</p>&#13;
<p class="indent">To do so, you must use the following process: start a built-in web server, and then send a Doc object (or a list of Doc objects) to it for rendering. The server will generate a visualization for the submitted Doc, which you can then view in your browser. We’ll walk through several examples in this section.</p>&#13;
<h4 class="h4" id="lev92"><strong><em>Visualizing Dependency Parsing</em></strong></h4>&#13;
<p class="noindent">The following script shows the simplest way to generate a dependency tree visualization for a sentence:</p>&#13;
<p class="programs">   import spacy<br/>&#13;
   nlp = spacy.load('en')<br/>&#13;
<span class="ent">➊</span> doc = nlp(u"I want a Greek pizza.")<br/>&#13;
<span class="ent">➋</span> from spacy import displacy<br/>&#13;
<span class="ent">➌</span> displacy.serve(doc, <span class="ent">➍</span>style='dep')</p>&#13;
<p class="indent">We create a Doc object to submit to displaCy <span class="ent">➊</span>. Then we import the displaCy library from the core library <span class="ent">➋</span>, after which we can start a displaCy web server, passing the Doc object to it. Both operations are done by calling <span epub:type="pagebreak" id="page_101"/>the <span class="literal">displacy.serve()</span><span class="literal"/> method <span class="ent">➌</span>. By setting parameter style to <span class="literal">'dep'</span>, we instruct displaCy to use the dependency visualizer <span class="ent">➍</span>, generating a dependency tree visualization for the text in the Doc object. If you’re interested in implementing the checkbox options explored earlier in this chapter, reference “<a href="../Text/ch07.xhtml#lev97">Try This</a>” on <a href="../Text/ch07.xhtml#page_104">page 104</a>.</p>&#13;
<p class="indent">Whether you run this code in a Python session or as a separate script, the execution enters an infinite loop and shows messages from the displaCy web server. The initial messages you should see are the following:</p>&#13;
<p class="programs">Serving on port 5000...<br/>&#13;
Using the 'dep' visualizer</p>&#13;
<p class="indent">This means that the server has generated a dependency tree visualization for the submitted text and serves HTTP requests on port 5000 (the default port) on your host. In practical terms, this means you can point your browser to <em>http://localhost:5000</em> to view the visualization. In this example, it should look like <a href="../Text/ch07.xhtml#ch07fig03">Figure 7-3</a>.</p>&#13;
<div class="image"><a id="ch07fig03"/><img src="../Images/fig7-3.jpg" alt="image" width="694" height="454"/></div>&#13;
<p class="figcap"><em>Figure 7-3: An example of a dependency tree visualization you can generate from within your Python code and then view in your browser</em></p>&#13;
<p class="indent">To shut down the displaCy server, enter <span class="smallcaps">CTRL</span>-C in the terminal in which you executed the script that started the server. As a result, you should see the following final message from the server:</p>&#13;
<p class="programs">Shutting down server on port 5000.</p>&#13;
<p class="indent">After shutting down the server, you won’t be able to generate a new copy of the visualization in your browser, but you’ll be able to view the copies you’ve already generated.</p>&#13;
<h4 class="h4" id="lev93"><span epub:type="pagebreak" id="page_102"/><strong><em>Try This</em></strong></h4>&#13;
<p class="noindent">Try using the named entity visualizer by altering the script for the dependency visualizer in the previous section. To instruct displaCy to apply the named entity visualizer, set the <span class="literal">displacy.serve()</span> method’s style parameter to <span class="literal">'ent'</span>.</p>&#13;
<p class="indent">To produce a more interesting visualization, you might use longer text containing, perhaps, more than one sentence. For example, try using the following text:</p>&#13;
<p class="programs">Microsoft Windows is a family of proprietary operating systems developed and<br/>&#13;
sold by Microsoft. Bill Gates announced Microsoft Windows on November 10,<br/>&#13;
1983. Microsoft first released Windows for sale on November 20, 1985. Windows<br/>&#13;
1.0 was initially sold for $100.00, and its sales surpassed 500,000 copies in<br/>&#13;
April 1987. For comparison, more than a million copies of Windows 95 were sold<br/>&#13;
in just the first 4 days.</p>&#13;
<p class="indent">After calling the <span class="literal">displacy.serve()</span><span class="literal"/> method on the Doc object, point your browser to <em>http://localhost:5000</em> to view the visualization. Pay attention to the named entities and their types recognized by the entity recognizer in this sample text. In particular, you should see that the entity recognizer finds the names of persons, products, and companies, as well as phrases related to dates, numbers, and money.</p>&#13;
<h4 class="h4" id="lev94"><strong><em>Sentence-by-Sentence Visualizations</em></strong></h4>&#13;
<p class="noindent">Visualizing dependency trees works fine when you’re working with a single sentence. But the graphics can get long and space consuming when you’re visualizing a long text, making them difficult to read when displayed in one row. Although displaCy generates separate visualizations for each sentence, when you pass in a Doc containing more than one sentence, it lays them out in a single row.</p>&#13;
<p class="indent">Instead of passing in a Doc object, you might want to visualize sentence-by-sentence. For example, this might be useful when you need to extract the meaning from an entire discourse and want to explore a sequence of sentences. Starting with version 2.0.12, displaCy allows you to pass in Span objects and then lays out the visualizations in rows. You can pass in a list of <span class="literal">doc.sents</span><span class="literal"/> if you want to create one visualization for each sentence found in <span class="literal">doc.sents</span>, as shown in the following code:</p>&#13;
<p class="programs">   import spacy<br/>&#13;
   nlp = spacy.load('en')<br/>&#13;
   doc = nlp(u"I have a relaxed pair of jeans. Now I want a skinny pair.")<br/>&#13;
<span class="ent">➊</span> spans = list(doc.sents)<br/>&#13;
   from spacy import displacy<br/>&#13;
   displacy.serve(<span class="ent">➋</span>spans, style='dep')</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_103"/>As discussed in <a href="../Text/ch03.xhtml#ch03">Chapter 3</a>, the Doc object’s <span class="literal">doc.sents</span> property is an iterator over the sentences in a Doc object. For this reason, you can’t use this property to refer to sentences by index, but you can iterate over them in a loop or create a list of Span objects where each span represents a sentence. In this code, we convert the sentences in the Doc into a list of Span objects <span class="ent">➊</span>. Then we pass in that spans list to <span class="literal">displacy.serve()</span> to visualize <span class="ent">➋</span>.</p>&#13;
<p class="indent">This should generate one visualization for each sentence, laid out in rows, allowing you to view them by scrolling vertically.</p>&#13;
<h3 class="h3" id="lev95"><strong>Customizing Your Visualizations with the Options Argument</strong></h3>&#13;
<p class="noindent">In addition to the docs and style arguments that you saw in the examples so far, the <span class="literal">displacy.serve()</span><span class="literal"/> method can take several other arguments. The <span class="literal">options</span> argument is perhaps one of the most interesting because it allows you to define a dictionary of settings to customize the layout of the visualization. We’ll cover some of the most useful <span class="literal">options</span> settings in this section.</p>&#13;
<h4 class="h4" id="lev96"><strong><em>Using Dependency Visualizer Options</em></strong></h4>&#13;
<p class="noindent">Long sentences can be difficult to view when they’re displayed in one row. In such cases, you can create visualizations in <em>compact mode</em>, which takes less space. For that you need to set the <span class="literal">'compact'</span> option to <span class="literal">True</span> in the <span class="literal">options</span> argument, as illustrated in this script. The script also changes the font that the visualizer uses. (The entire list of available options in the displaCy API documentation is at <em><a href="https://spacy.io/api/top-level/#options-dep/">https://spacy.io/api/top-level/#options-dep/</a></em>.)</p>&#13;
<p class="programs">import spacy<br/>&#13;
nlp = spacy.load('en')<br/>&#13;
doc = nlp(u"I want a Greek pizza.")<br/>&#13;
from spacy import displacy<br/>&#13;
options = {<span class="ent">➊</span>'compact': True, <span class="ent">➋</span>'font': 'Tahoma'}<br/>&#13;
displacy.serve(doc, style='dep', <span class="ent">➌</span>options=options)</p>&#13;
<p class="indent">The <span class="literal">displacy.serve()</span> method expects the <span class="literal">options</span> argument to be a dictionary. In this example, we set only two options: the <span class="literal">'compact'</span> option to <span class="literal">True</span> <span class="ent">➊</span> and the <span class="literal">'font'</span> option to <span class="literal">'Tahoma'</span> <span class="ent">➋</span>, changing their defaults in both cases. (The visualizer lets you use most standard web fonts, such as Arial, Courier, and so on.) We then pass the dictionary of options in as the <span class="literal">options</span> argument <span class="ent">➌</span>.</p>&#13;
<p class="indent"><a href="../Text/ch07.xhtml#ch07fig04">Figure 7-4</a> shows what your browser should display when you point it to <em>http://localhost:5000</em> after running the script.</p>&#13;
<p class="indent">The square arcs you see in the figure might look unusual, but they make the overall visualization more compact, which often can spare you from having to scroll to see the entire diagram.</p>&#13;
<div class="image"><span epub:type="pagebreak" id="page_104"/><a id="ch07fig04"/><img src="../Images/fig7-4.jpg" alt="image" width="694" height="355"/></div>&#13;
<p class="figcap"><em>Figure 7-4: An example of a customized dependency visualization</em></p>&#13;
<h4 class="h4" id="lev97"><strong><em>Try This</em></strong></h4>&#13;
<p class="noindent">In the dependency visualizer’s interactive demo discussed in “displaCy Dependency Visualizer” on <a href="../Text/ch07.xhtml#page_98">page 98</a>, you used the “Merge Phrases” and “Merge Punctuation” options. In spaCy, you can merge noun phrases into one token with the <span class="literal">collapse_phrases</span><span class="literal"/> option (Figure 7-1 shows the equivalent option on the displaCy visualizer website.), which is set to <span class="literal">False</span> by default. The <span class="literal">collapse_punct</span> option, which is responsible for attaching punctuation to tokens, is set to <span class="literal">True</span> by default.</p>&#13;
<p class="indent">Change the code in the previous script so it sets the <span class="literal">collapse_phrases</span> option to <span class="literal">True</span> in the set of passed-in options. Run the script, and then view the generated visualization in your browser to make sure the noun phrases are displayed as a single token.</p>&#13;
<h4 class="h4" id="lev98"><strong><em>Using Named Entity Visualizer Options</em></strong></h4>&#13;
<p class="noindent">The list of named entity visualizer options (available at <em><a href="https://spacy.io/api/top-level/#displacy_options-ent/">https://spacy.io/api/top-level/#displacy_options-ent/</a></em>) is much shorter than the list of dependency visualizer options. When using the entity visualizer, you can choose which entity types to highlight with the <span class="literal">'ents'</span> option and override default colors with the <span class="literal">'colors'</span> option.</p>&#13;
<p class="indent">The first option is the more important of the two, because it allows you to instruct the visualizer to highlight entities of selected types only. The following example illustrates a case when you might want to limit the entity types that the visualizer displays.</p>&#13;
<p class="indent">In this script, we don’t provide any options for the entity visualizer, which means it will highlight entities of all types in the submitted Doc.</p>&#13;
<p class="programs">import spacy<br/>&#13;
nlp = spacy.load('en')<br/>&#13;
doc = nlp(u"In 2011, Google launched Google +, its fourth foray into social<br/>&#13;
networking.")<br/>&#13;
<span epub:type="pagebreak" id="page_105"/><span class="ent">➊</span> doc.user_data['title'] = "An example of an entity visualization"<br/>&#13;
   from spacy import displacy<br/>&#13;
   displacy.serve(doc, style=<span class="ent">➋</span>'ent')</p>&#13;
<p class="indent">We use the Doc’s <span class="literal">user_data</span> attribute to set a title for the Doc <span class="ent">➊</span>. The displaCy visualizer automatically puts the text in this attribute as a headline for the visualization. Adding a title to a visualization is optional but can be useful when you need to annotate your visualizations.</p>&#13;
<p class="indent">We set the style parameter of <span class="literal">displacy.serve()</span><span class="literal"/> to <span class="literal">'ent'</span> <span class="ent">➋</span>, instructing displaCy to use the named entity visualizer. The resulting visualization should look like the one in <a href="../Text/ch07.xhtml#ch07fig05">Figure 7-5</a> (although these images are in grayscale, the website uses color).</p>&#13;
<div class="image"><a id="ch07fig05"/><img src="../Images/fig7-5.jpg" alt="image" width="694" height="384"/></div>&#13;
<p class="figcap"><em>Figure 7-5: An example of a named entity visualization generated with default options</em></p>&#13;
<p class="indent">The visualization looks fine in general. But in this context, highlighting the ordinal number “fourth” is probably unnecessary. It’s hard to figure out why we might need to extract that information in this context. With the <span class="literal">'ents'</span> option, we select the entity types that we want the visualizer to highlight. The following code illustrates how to implement this. To see how it works, we replace the last line of code in the previous script with the following two lines of code, and then run the updated script:</p>&#13;
<p class="programs">options = {<span class="ent">➊</span>'ents': ["ORG", "PRODUCT", "DATE"], <span class="ent">➋</span>'colors': {"ORG": "aqua",<br/>&#13;
"PRODUCT": "aqua"}}<br/>&#13;
displacy.serve(doc, style='ent', options=options)</p>&#13;
<p class="indent">This time, the visualizer shouldn’t recognize any entities except for those that are of the <span class="literal">ORG</span>, <span class="literal">PRODUCT</span>, or <span class="literal">DATE</span> type <span class="ent">➊</span>. This example also illustrates the use of the <span class="literal">'colors'</span> option that allows us to change the default colors assigned to entity types. In this example, we map the <span class="literal">ORG</span> and <span class="literal">PRODUCT</span> types to the color <span class="literal">"aqua"</span> <span class="ent">➋</span>.</p>&#13;
<div class="note">&#13;
<p class="notet"><strong><span class="notes"><span epub:type="pagebreak" id="page_106"/>NOTE</span></strong></p>&#13;
<p class="notep"><em>Using the <span class="literal">'colors'</span><span class="literal"/> option, you can map entity types to web color names or hex color codes. In the example on <a href="../Text/ch07.xhtml#page_105">page 105</a>, using the hex code <span class="literal">"</span><span class="literal">#00FFFF</span><span class="literal">"</span> would be equal to using the color name <span class="literal">"</span><span class="literal">aqua</span><span class="literal">"</span>.</em></p>&#13;
</div>&#13;
<p class="indent"><a href="../Text/ch07.xhtml#ch07fig06">Figure 7-6</a> illustrates what the resulting visualization should look like.</p>&#13;
<div class="image"><a id="ch07fig06"/><img src="../Images/fig7-6.jpg" alt="image" width="694" height="394"/></div>&#13;
<p class="figcap"><em>Figure 7-6: An example of an entity visualization generated with the <span class="codeitalic">'ents'</span> and <span class="codeitalic">'colors'</span> options specified</em></p>&#13;
<p class="indent">As you can see, this visualization is almost identical to the one shown in <a href="../Text/ch07.xhtml#ch07fig05">Figure 7-5</a>. But this time the visualizer doesn’t highlight the entity of type <span class="literal">ORDINAL</span><span class="literal"/>, because the<span class="literal"> 'ents'</span> option list we’ve passed in doesn’t include this type.</p>&#13;
<h3 class="h3" id="lev99"><strong>Exporting a Visualization to a File</strong></h3>&#13;
<p class="noindent">In the examples so far, we’ve used the displaCy web server to view the visualizations being generated. As you learned in these examples, you can open the visualization generated with the <span class="literal">displacy.serve()</span> method in your browser as long as the server started with this same invocation of<span class="literal"> displacy.serve()</span> is running.</p>&#13;
<p class="indent">Using the <span class="literal">displacy.render()</span><span class="literal"/> method, you can avoid this limitation and create a visualization for later use. The <span class="literal">displacy.render()</span> method allows you to render the markup wrapped as an HTML page and then save it in a separate file. Later, you can open this file in any browser without having to invoke a web browser.</p>&#13;
<p class="indent">The following script shows how to use the <span class="literal">displacy.render()</span> method for the named entity visualization shown in <a href="../Text/ch07.xhtml#ch07fig05">Figure 7-5</a>:</p>&#13;
<p class="programs">import spacy<br/>&#13;
nlp = spacy.load('en')<br/>&#13;
<span epub:type="pagebreak" id="page_107"/>doc = nlp(u"In 2011, Google launched Google +, its fourth foray into social<br/>&#13;
   networking.")<br/>&#13;
<span class="ent">➊</span> doc.user_data["title"] = "An example of an entity visualization"<br/>&#13;
   #In the next block, you instruct displaCy to render the markup wrapped as a<br/>&#13;
   full HTML page.<br/>&#13;
   from spacy import displacy<br/>&#13;
<span class="ent">➋</span> html = displacy.render(doc, style='ent', <span class="ent">➌</span>page=True)<br/>&#13;
   #In the next block, you save the html file generated by displacy.render() to<br/>&#13;
   disk on your machine. <br/>&#13;
<span class="ent">➍</span> from pathlib import Path<br/>&#13;
<span class="ent">➎</span> output_path = Path("/visualizations/ent_visual.html")<br/>&#13;
<span class="ent">➏</span> output_path.open("w", encoding="utf-8").write(html)</p>&#13;
<p class="indent">We can divide the code in this script into three parts, each of which begins with a comment line. The first block should be familiar. Here, we create a text processing pipeline and then apply it to a text. Then we use the Doc’s <span class="literal">user_data</span> attribute to set a headline for the Doc <span class="ent">➊</span>.</p>&#13;
<p class="indent">In the second block, we render a named entity visualization for the Doc created in the previous step, using the <span class="literal">displacy.render()</span><span class="literal"/> method <span class="ent">➋</span>. Unlike <span class="literal">displacy.serve()</span><span class="literal"/>, <span class="literal">displacy.render()</span> doesn’t run a web server but generates the HTML markup for a visualization. By setting the page argument to <span class="literal">True</span>, we instruct <span class="literal">displacy.render()</span> to generate the markup wrapped as a full HTML page <span class="ent">➌</span>.</p>&#13;
<p class="indent">In the final block, we import the <span class="literal">Path</span> class from the <span class="literal">pathlib</span> module introduced in Python 3.4 <span class="ent">➍</span>. We can use <span class="literal">Path</span> to perform system calls on path objects. In this example, we instantiate this class on the following path: <em>/visualizations/ent_visual.html</em> <span class="ent">➎</span>, assuming we already have the <em>/visualizations</em> folder available in our local filesystem (otherwise, an exception is thrown). Then we open the <em>ent_visual.html</em> file (it will be created if it doesn’t already exist) in the <em>/visualizations</em> folder and write the HTML page generated in the previous step to it <span class="ent">➏</span>.</p>&#13;
<p class="indent">To sum up, this script generates an HTML file containing a named entity visualization for the submitted text and saves that file in your filesystem. If you move to the folder where the file has been saved and double-click the file, it opens in your browser.</p>&#13;
<h3 class="h3" id="lev100"><strong>Using displaCy to Manually Render Data</strong></h3>&#13;
<p class="noindent">The displaCy visualizers allow you to manually create a dataset that you can then render rather than passing in data as either a doc or span. This can be useful when you need, for example, to visualize output from other NLP libraries or when you need to create a visualization using a set of custom tags or custom dependency labels. (I’ll discuss how to make these custom tags and labels in <a href="../Text/ch10.xhtml#ch10">Chapter 10</a>.)</p>&#13;
<p class="indent">As an example, let’s manually render the sentence “I want a Greek pizza.”</p>&#13;
<h4 class="h4" id="lev101"><span epub:type="pagebreak" id="page_108"/><strong><em>Formatting the Data</em></strong></h4>&#13;
<p class="noindent">To begin with, you need to put your data in displaCy’s format: a dictionary containing two lists: <span class="literal">"words"</span> and <span class="literal">"arcs"</span>, as illustrated in the following code:</p>&#13;
<p class="programs">sent = {<br/>&#13;
    "words": [<br/>&#13;
     <span class="ent">➊</span> {"text": "I", "tag": "PRON"},<br/>&#13;
        {"text": "want", "tag": "VERB"},<br/>&#13;
        {"text": "a", "tag": "DET"},<br/>&#13;
        {"text": "Greek", "tag": "ADJ"},<br/>&#13;
        {"text": "pizza", "tag": "NOUN"}<br/>&#13;
    ],<br/>&#13;
    "arcs": [<br/>&#13;
     <span class="ent">➋</span> {"start": 0, "end": 1, "label": "nsubj", "dir": "left"},<br/>&#13;
        {"start": 2, "end": 4, "label": "det", "dir": "left"},<br/>&#13;
        {"start": 3, "end": 4, "label": "amod", "dir": "left"},<br/>&#13;
        {"start": 1, "end": 4, "label": "dobj", "dir": "right"}<br/>&#13;
    ]<br/>&#13;
}</p>&#13;
<p class="indent">The <span class="literal">sent</span> dictionary contains two lists: <span class="literal">"words"</span> and <span class="literal">"arcs"</span>, each of which, in turn, includes a set of dictionaries. A dictionary in the <span class="literal">"words"</span> list assigns a tag to a certain token in the sentence <span class="ent">➊</span>, and a dictionary in the <span class="literal">"arcs"</span> list defines an arc in the dependency tree, connecting two syntactically related words in the sentence <span class="ent">➋</span>. In this example, five words are in the sentence and four syntactic relations are defined on them. That’s why the dictionary contains five items in the <span class="literal">"words"</span> list and four items in the <span class="literal">"arcs"</span> list.</p>&#13;
<p class="indent">Now that we have a dictionary with the data, we need to generate a dependency parsing visualization for the sample sentence; we can use the following code to render it:</p>&#13;
<p class="programs"><span class="ent">➊</span> from spacy import displacy<br/>&#13;
   displacy.serve(<span class="ent">➋</span>sent, style="dep", <span class="ent">➌</span>manual=True)</p>&#13;
<p class="indent">Note that we don’t have to import the entire spaCy library. All we need to do is import the <span class="literal">displacy</span> module from it <span class="ent">➊</span>. Then we invoke the <span class="literal">displacy</span><span class="literal">.serve()</span> method, passing in the <span class="literal">sent</span> dictionary as the first parameter in place of a Doc object <span class="ent">➋</span>. The third parameter, <span class="literal">manual</span>, tells displaCy that we created the dataset for rendering manually <span class="ent">➌</span>, so displaCy doesn’t need to extract the data from a Doc object.</p>&#13;
<h4 class="h4" id="lev102"><strong><em>Try This</em></strong></h4>&#13;
<p class="noindent">When you choose to manually create a dictionary with data to render into a visualization, you can use custom tags, specifying, for example, that the visualizer should use fine-grained part-of-speech tags instead of the coarse-grained tags used by default.</p>&#13;
<p class="indent">You could accomplish this task by simply setting the <span class="literal">fine_grained</span><span class="literal"/> option to <span class="literal">True</span> when passing in a Doc object for rendering, but for practice, try to implement this manually.</p>&#13;
<p class="indent"><span epub:type="pagebreak" id="page_109"/>In the example from “<a href="../Text/ch07.xhtml#lev101">Formatting the Data</a>” on <a href="../Text/ch07.xhtml#page_108">page 108</a>, change the tags in the <span class="literal">"words"</span> list of the <span class="literal">"sent"</span> dictionary so their values are fine-grained tags. Next, start the displaCy server and instruct it to generate a visualization based on the data specified in the <span class="literal">"sent"</span> dictionary. Then point your browser to <em>http://localhost:5000</em> to view the visualization.</p>&#13;
<h3 class="h3" id="lev103"><strong>Summary</strong></h3>&#13;
<p class="noindent">You’ve seen syntactic structure visualizations in previous chapters, but in this chapter, you learned how to generate those visualizations using the displaCy dependency visualizer. You also learned to generate graphics of named entity information with the displaCy named entity visualizer.<span epub:type="pagebreak" id="page_110"/></p>&#13;
</div>&#13;
</body></html>